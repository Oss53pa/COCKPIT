// ============================================
// CATALOGUE DES RAPPORTS BI
// 24 Types de Rapports en 6 Catégories
// ============================================

import type {
  TypeRapportDefinition,
  PackRapport,
  CategorieRapport,
  TypeRapportCode,
  SectionRapportType,
} from '../types/bi';
import { ALL_KPI_DEFINITIONS } from './kpiDefinitions';

// ===========================================
// HELPER - Créer sections standard
// ===========================================

function createSection(
  id: string,
  titre: string,
  titreCourt: string,
  description: string,
  ordre: number,
  kpisCodes: string[],
  optionnel = false
): SectionRapportType {
  return {
    id,
    titre,
    titreCourt,
    description,
    ordre,
    kpisCodes,
    graphiquesRecommandes: ['barre', 'ligne'],
    contenuType: 'mixte',
    optionnel,
  };
}

// ===========================================
// ASSET MANAGEMENT (4 rapports)
// ===========================================

const PERF_ACTIF: TypeRapportDefinition = {
  id: 'perf-actif',
  code: 'PERF_ACTIF',
  nom: 'Performance de l\'Actif',
  nomCourt: 'Perf. Actif',
  description: 'Analyse complète de la performance financière et opérationnelle de l\'actif immobilier',
  categorie: 'asset_management',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 15,
  categoriesRequises: ['loyers', 'charges', 'valorisation', 'etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.YIELD_NET,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_FINANCIER,
    ALL_KPI_DEFINITIONS.WAULT,
  ],
  sections: [
    createSection('exec', 'Résumé Exécutif', 'Résumé', 'Vue synthétique des performances', 1, ['NOI', 'YIELD_NET']),
    createSection('kpis', 'Indicateurs Clés', 'KPIs', 'Dashboard des KPIs principaux', 2, ['NOI', 'YIELD_NET', 'TAUX_OCCUPATION_FINANCIER', 'WAULT']),
    createSection('revenus', 'Analyse des Revenus', 'Revenus', 'Détail des revenus locatifs', 3, ['LOYER_TOTAL', 'LOYER_MOYEN_M2']),
    createSection('charges', 'Analyse des Charges', 'Charges', 'Détail des charges d\'exploitation', 4, ['CHARGES_TOTALES', 'TAUX_REFACTURATION']),
    createSection('occupation', 'Occupation', 'Occupation', 'Taux d\'occupation et vacance', 5, ['TAUX_OCCUPATION_PHYSIQUE', 'TAUX_VACANCE']),
    createSection('recomm', 'Recommandations', 'Recomm.', 'Actions recommandées', 6, [], true),
  ],
  graphiquesRecommandes: ['barre', 'ligne', 'camembert', 'jauge'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Asset Manager', 'Direction', 'Investisseurs'],
  combinableAvec: ['NOI_ANALYSIS', 'ANALYSE_PORTEFEUILLE'],
  icone: 'TrendingUp',
  couleur: '#3b82f6',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const ANALYSE_PORTEFEUILLE: TypeRapportDefinition = {
  id: 'analyse-portefeuille',
  code: 'ANALYSE_PORTEFEUILLE',
  nom: 'Analyse de Portefeuille',
  nomCourt: 'Portefeuille',
  description: 'Vision consolidée multi-actifs avec comparaisons et benchmarks',
  categorie: 'asset_management',
  complexite: 'avance',
  pagesMin: 15,
  pagesMax: 30,
  categoriesRequises: ['loyers', 'charges', 'valorisation', 'etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.VALEUR_ACTIF,
    ALL_KPI_DEFINITIONS.YIELD_NET,
    ALL_KPI_DEFINITIONS.WAULT,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
  ],
  sections: [
    createSection('exec', 'Résumé Exécutif', 'Résumé', 'Vue synthétique du portefeuille', 1, ['VALEUR_ACTIF', 'NOI']),
    createSection('compo', 'Composition du Portefeuille', 'Compo.', 'Répartition par type, géographie', 2, []),
    createSection('perf', 'Performances Comparées', 'Perf.', 'Benchmark entre actifs', 3, ['YIELD_NET', 'NOI_M2']),
    createSection('risques', 'Analyse des Risques', 'Risques', 'Concentration, échéances', 4, ['CONCENTRATION_TOP5', 'WAULT']),
    createSection('strat', 'Stratégie & Arbitrages', 'Stratégie', 'Recommandations arbitrages', 5, [], true),
  ],
  graphiquesRecommandes: ['barre', 'treemap', 'scatter', 'radar'],
  frequenceRecommandee: 'trimestriel',
  destinatairesTypes: ['Direction', 'Comité d\'Investissement', 'Investisseurs'],
  combinableAvec: ['PERF_ACTIF'],
  icone: 'Briefcase',
  couleur: '#3b82f6',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const BUSINESS_PLAN: TypeRapportDefinition = {
  id: 'business-plan',
  code: 'BUSINESS_PLAN',
  nom: 'Business Plan',
  nomCourt: 'BP',
  description: 'Plan d\'affaires sur 5-10 ans avec projections et hypothèses',
  categorie: 'asset_management',
  complexite: 'avance',
  pagesMin: 20,
  pagesMax: 40,
  categoriesRequises: ['loyers', 'charges', 'valorisation', 'bail', 'travaux', 'budget'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.YIELD_NET,
    ALL_KPI_DEFINITIONS.WAULT,
    ALL_KPI_DEFINITIONS.REVERSION,
  ],
  sections: [
    createSection('exec', 'Résumé Exécutif', 'Résumé', 'Synthèse du business plan', 1, []),
    createSection('hypo', 'Hypothèses', 'Hypothèses', 'Hypothèses retenues', 2, []),
    createSection('locatif', 'Stratégie Locative', 'Locatif', 'Plan de commercialisation', 3, ['WAULT', 'REVERSION']),
    createSection('capex', 'Plan CAPEX', 'CAPEX', 'Investissements prévus', 4, []),
    createSection('proj', 'Projections Financières', 'Projections', 'CF et NOI projetés', 5, ['NOI']),
    createSection('sensi', 'Analyses de Sensibilité', 'Sensibilité', 'Scénarios alternatifs', 6, []),
    createSection('sortie', 'Stratégie de Sortie', 'Sortie', 'Options de cession', 7, ['YIELD_NET'], true),
  ],
  graphiquesRecommandes: ['ligne', 'aire', 'waterfall', 'barre'],
  frequenceRecommandee: 'annuel',
  destinatairesTypes: ['Direction', 'Comité d\'Investissement', 'Banques'],
  combinableAvec: ['VALORISATION_DCF'],
  icone: 'FileText',
  couleur: '#3b82f6',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const VALORISATION_DCF: TypeRapportDefinition = {
  id: 'valorisation-dcf',
  code: 'VALORISATION_DCF',
  nom: 'Valorisation DCF',
  nomCourt: 'DCF',
  description: 'Valorisation par actualisation des flux de trésorerie',
  categorie: 'asset_management',
  complexite: 'avance',
  pagesMin: 10,
  pagesMax: 20,
  categoriesRequises: ['loyers', 'charges', 'valorisation', 'bail'],
  kpis: [
    ALL_KPI_DEFINITIONS.VALEUR_ACTIF,
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.YIELD_NET,
  ],
  sections: [
    createSection('exec', 'Résumé Valorisation', 'Résumé', 'Valeur retenue et fourchette', 1, ['VALEUR_ACTIF']),
    createSection('hypo', 'Hypothèses DCF', 'Hypothèses', 'Taux, durée, valeur terminale', 2, []),
    createSection('cf', 'Cash-Flows Projetés', 'CF', 'Flux par année', 3, ['NOI']),
    createSection('sensi', 'Analyses de Sensibilité', 'Sensibilité', 'Impact des variations', 4, []),
    createSection('compa', 'Comparaison Méthodes', 'Compa.', 'DCF vs Capitalisation', 5, ['YIELD_NET']),
  ],
  graphiquesRecommandes: ['ligne', 'waterfall', 'heatmap'],
  frequenceRecommandee: 'annuel',
  destinatairesTypes: ['Direction', 'Experts', 'Banques'],
  combinableAvec: ['BUSINESS_PLAN'],
  icone: 'Calculator',
  couleur: '#3b82f6',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// PROPERTY MANAGEMENT (4 rapports)
// ===========================================

const ETAT_LOCATIF_REPORT: TypeRapportDefinition = {
  id: 'etat-locatif-report',
  code: 'ETAT_LOCATIF_REPORT',
  nom: 'État Locatif',
  nomCourt: 'État Loc.',
  description: 'Liste exhaustive des baux et locataires avec détails contractuels',
  categorie: 'property_management',
  complexite: 'simple',
  pagesMin: 5,
  pagesMax: 20,
  categoriesRequises: ['etat_locatif', 'bail'],
  kpis: [
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
    ALL_KPI_DEFINITIONS.LOYER_TOTAL,
    ALL_KPI_DEFINITIONS.LOYER_MOYEN_M2,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Vue d\'ensemble de l\'occupation', 1, ['TAUX_OCCUPATION_PHYSIQUE']),
    createSection('liste', 'Liste des Locataires', 'Locataires', 'Tableau détaillé', 2, ['LOYER_TOTAL']),
    createSection('vacance', 'Lots Vacants', 'Vacance', 'Détail des lots disponibles', 3, ['TAUX_VACANCE']),
    createSection('loyers', 'Analyse des Loyers', 'Loyers', 'Répartition et moyennes', 4, ['LOYER_MOYEN_M2']),
  ],
  graphiquesRecommandes: ['camembert', 'barre', 'treemap'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Property Manager', 'Asset Manager', 'Propriétaire'],
  combinableAvec: ['SUIVI_BAUX'],
  icone: 'ClipboardList',
  couleur: '#10b981',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const SUIVI_BAUX: TypeRapportDefinition = {
  id: 'suivi-baux',
  code: 'SUIVI_BAUX',
  nom: 'Suivi des Baux',
  nomCourt: 'Baux',
  description: 'Échéancier des baux avec dates clés et options',
  categorie: 'property_management',
  complexite: 'simple',
  pagesMin: 4,
  pagesMax: 12,
  categoriesRequises: ['bail', 'etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.WAULT,
    ALL_KPI_DEFINITIONS.WALB,
  ],
  sections: [
    createSection('kpis', 'Indicateurs', 'KPIs', 'WAULT et WALB', 1, ['WAULT', 'WALB']),
    createSection('echeances', 'Échéancier', 'Échéances', 'Baux arrivant à terme', 2, []),
    createSection('breaks', 'Options de Break', 'Breaks', 'Dates de sortie possibles', 3, []),
    createSection('indexations', 'Indexations', 'Index.', 'Prochaines révisions', 4, []),
    createSection('actions', 'Actions Recommandées', 'Actions', 'Renouvellements prioritaires', 5, [], true),
  ],
  graphiquesRecommandes: ['barre', 'ligne', 'waterfall'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Property Manager', 'Leasing Manager', 'Juridique'],
  combinableAvec: ['ETAT_LOCATIF_REPORT'],
  icone: 'FileSignature',
  couleur: '#10b981',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const GESTION_CHARGES: TypeRapportDefinition = {
  id: 'gestion-charges',
  code: 'GESTION_CHARGES',
  nom: 'Gestion des Charges',
  nomCourt: 'Charges',
  description: 'Analyse des charges et budget avec taux de refacturation',
  categorie: 'property_management',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 15,
  categoriesRequises: ['charges', 'budget'],
  kpis: [
    ALL_KPI_DEFINITIONS.CHARGES_TOTALES,
    ALL_KPI_DEFINITIONS.CHARGES_M2,
    ALL_KPI_DEFINITIONS.TAUX_REFACTURATION,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Vue d\'ensemble des charges', 1, ['CHARGES_TOTALES', 'TAUX_REFACTURATION']),
    createSection('detail', 'Détail par Poste', 'Détail', 'Charges par catégorie', 2, ['CHARGES_M2']),
    createSection('evol', 'Évolution', 'Évolution', 'Comparaison N/N-1', 3, []),
    createSection('budget', 'Budget vs Réel', 'Budget', 'Écarts budgétaires', 4, []),
    createSection('refact', 'Refacturation', 'Refact.', 'Analyse refacturation', 5, ['TAUX_REFACTURATION']),
  ],
  graphiquesRecommandes: ['barre', 'camembert', 'ligne', 'waterfall'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Property Manager', 'Comptabilité', 'Propriétaire'],
  combinableAvec: ['BUDGET_VS_REEL'],
  icone: 'Receipt',
  couleur: '#10b981',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const REPORTING_PROPRIETAIRE: TypeRapportDefinition = {
  id: 'reporting-proprietaire',
  code: 'REPORTING_PROPRIETAIRE',
  nom: 'Reporting Propriétaire',
  nomCourt: 'Prop. Report',
  description: 'Rapport périodique complet pour le propriétaire de l\'actif',
  categorie: 'property_management',
  complexite: 'intermediaire',
  pagesMin: 10,
  pagesMax: 25,
  categoriesRequises: ['loyers', 'charges', 'etat_locatif', 'bail'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
    ALL_KPI_DEFINITIONS.TAUX_RECOUVREMENT,
    ALL_KPI_DEFINITIONS.WAULT,
  ],
  sections: [
    createSection('exec', 'Résumé Exécutif', 'Résumé', 'Points clés de la période', 1, ['NOI', 'TAUX_OCCUPATION_PHYSIQUE']),
    createSection('locatif', 'Situation Locative', 'Locatif', 'Mouvements et occupation', 2, ['TAUX_OCCUPATION_PHYSIQUE']),
    createSection('financier', 'Situation Financière', 'Financier', 'Revenus et charges', 3, ['NOI', 'TAUX_RECOUVREMENT']),
    createSection('baux', 'Échéances Baux', 'Baux', 'Points d\'attention', 4, ['WAULT']),
    createSection('travaux', 'Travaux', 'Travaux', 'État d\'avancement', 5, [], true),
    createSection('actions', 'Actions & Recommandations', 'Actions', 'Prochaines étapes', 6, []),
  ],
  graphiquesRecommandes: ['barre', 'ligne', 'camembert', 'jauge'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Propriétaire', 'Asset Manager'],
  combinableAvec: ['PERF_ACTIF'],
  icone: 'Building2',
  couleur: '#10b981',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// LEASING (4 rapports)
// ===========================================

const PIPELINE_COMMERCIAL: TypeRapportDefinition = {
  id: 'pipeline-commercial',
  code: 'PIPELINE_COMMERCIAL',
  nom: 'Pipeline Commercial',
  nomCourt: 'Pipeline',
  description: 'Suivi des prospects et négociations en cours',
  categorie: 'leasing',
  complexite: 'simple',
  pagesMin: 4,
  pagesMax: 10,
  categoriesRequises: ['etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.TAUX_VACANCE,
    ALL_KPI_DEFINITIONS.LOYER_MOYEN_M2,
  ],
  sections: [
    createSection('synth', 'Synthèse Pipeline', 'Synthèse', 'État des négociations', 1, []),
    createSection('prospects', 'Prospects Actifs', 'Prospects', 'Liste et statuts', 2, []),
    createSection('offres', 'Offres en Cours', 'Offres', 'Détail des propositions', 3, ['LOYER_MOYEN_M2']),
    createSection('signees', 'Signatures Prévues', 'Signatures', 'Baux à venir', 4, []),
    createSection('vacance', 'Disponibilités', 'Vacance', 'Lots à commercialiser', 5, ['TAUX_VACANCE']),
  ],
  graphiquesRecommandes: ['funnel', 'barre', 'camembert'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['Leasing Manager', 'Asset Manager', 'Direction'],
  combinableAvec: ['SUIVI_VACANCE'],
  icone: 'Target',
  couleur: '#f97316',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const MERCHANDISING_MIX: TypeRapportDefinition = {
  id: 'merchandising-mix',
  code: 'MERCHANDISING_MIX',
  nom: 'Merchandising Mix',
  nomCourt: 'Mix',
  description: 'Analyse de la répartition des activités et du mix commercial',
  categorie: 'leasing',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 15,
  categoriesRequises: ['etat_locatif', 'chiffre_affaires'],
  kpis: [
    ALL_KPI_DEFINITIONS.DIVERSITE_ACTIVITES,
    ALL_KPI_DEFINITIONS.RATIO_ANCRES,
    ALL_KPI_DEFINITIONS.CA_M2,
  ],
  sections: [
    createSection('synth', 'Vue d\'Ensemble', 'Synthèse', 'Répartition globale', 1, ['DIVERSITE_ACTIVITES']),
    createSection('activites', 'Répartition par Activité', 'Activités', 'Surface et CA par secteur', 2, []),
    createSection('ancres', 'Locomotives', 'Locomotives', 'Rôle et performance', 3, ['RATIO_ANCRES']),
    createSection('perf', 'Performance par Secteur', 'Performance', 'CA/m² par activité', 4, ['CA_M2']),
    createSection('recomm', 'Recommandations Mix', 'Recomm.', 'Optimisations suggérées', 5, [], true),
  ],
  graphiquesRecommandes: ['treemap', 'camembert', 'barre_horizontale', 'radar'],
  frequenceRecommandee: 'trimestriel',
  destinatairesTypes: ['Leasing Manager', 'Marketing', 'Direction'],
  combinableAvec: ['PERF_ENSEIGNES'],
  icone: 'Grid3X3',
  couleur: '#f97316',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const BENCHMARK_LOYERS: TypeRapportDefinition = {
  id: 'benchmark-loyers',
  code: 'BENCHMARK_LOYERS',
  nom: 'Benchmark Loyers',
  nomCourt: 'Benchmark',
  description: 'Comparaison des loyers avec le marché et potentiel de réversion',
  categorie: 'leasing',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: ['loyers', 'etat_locatif', 'bail'],
  kpis: [
    ALL_KPI_DEFINITIONS.LOYER_MOYEN_M2,
    ALL_KPI_DEFINITIONS.REVERSION,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Position vs marché', 1, ['LOYER_MOYEN_M2', 'REVERSION']),
    createSection('compa', 'Comparaison Marché', 'Marché', 'Loyers place vs marché', 2, []),
    createSection('activite', 'Par Activité', 'Activités', 'Benchmark par secteur', 3, []),
    createSection('potentiel', 'Potentiel de Réversion', 'Réversion', 'Opportunités identifiées', 4, ['REVERSION']),
    createSection('actions', 'Actions Commerciales', 'Actions', 'Priorités renégociation', 5, []),
  ],
  graphiquesRecommandes: ['barre', 'scatter', 'barre_horizontale'],
  frequenceRecommandee: 'semestriel',
  destinatairesTypes: ['Leasing Manager', 'Asset Manager'],
  combinableAvec: ['SUIVI_BAUX'],
  icone: 'Scale',
  couleur: '#f97316',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const SUIVI_VACANCE: TypeRapportDefinition = {
  id: 'suivi-vacance',
  code: 'SUIVI_VACANCE',
  nom: 'Suivi de la Vacance',
  nomCourt: 'Vacance',
  description: 'Analyse détaillée des lots vacants et stratégie de relocation',
  categorie: 'leasing',
  complexite: 'simple',
  pagesMin: 4,
  pagesMax: 10,
  categoriesRequises: ['etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.TAUX_VACANCE,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'État global de la vacance', 1, ['TAUX_VACANCE']),
    createSection('lots', 'Lots Vacants', 'Lots', 'Liste détaillée', 2, []),
    createSection('duree', 'Durée de Vacance', 'Durée', 'Ancienneté par lot', 3, []),
    createSection('causes', 'Analyse des Causes', 'Causes', 'Raisons de la vacance', 4, []),
    createSection('actions', 'Plan de Relocation', 'Actions', 'Stratégie par lot', 5, []),
  ],
  graphiquesRecommandes: ['barre', 'camembert', 'ligne'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Leasing Manager', 'Property Manager', 'Asset Manager'],
  combinableAvec: ['PIPELINE_COMMERCIAL'],
  icone: 'Home',
  couleur: '#f97316',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// CENTRE COMMERCIAL (4 rapports)
// ===========================================

const TDB_CENTRE: TypeRapportDefinition = {
  id: 'tdb-centre',
  code: 'TDB_CENTRE',
  nom: 'Tableau de Bord Centre',
  nomCourt: 'TDB',
  description: 'Dashboard opérationnel quotidien/hebdomadaire du centre commercial',
  categorie: 'centre_commercial',
  complexite: 'simple',
  pagesMin: 3,
  pagesMax: 8,
  categoriesRequises: ['frequentation', 'chiffre_affaires', 'etat_locatif'],
  kpis: [
    ALL_KPI_DEFINITIONS.FREQUENTATION_TOTALE,
    ALL_KPI_DEFINITIONS.CA_TOTAL,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
  ],
  sections: [
    createSection('flash', 'Flash', 'Flash', 'Chiffres clés instantanés', 1, ['FREQUENTATION_TOTALE', 'CA_TOTAL', 'TAUX_OCCUPATION_PHYSIQUE']),
    createSection('freq', 'Fréquentation', 'Fréq.', 'Courbe et comparaison', 2, ['FREQUENTATION_TOTALE', 'FREQUENTATION_JOUR_MOYEN']),
    createSection('ca', 'Chiffre d\'Affaires', 'CA', 'Performance commerciale', 3, ['CA_TOTAL']),
    createSection('alertes', 'Alertes', 'Alertes', 'Points d\'attention', 4, []),
  ],
  graphiquesRecommandes: ['ligne', 'jauge', 'barre'],
  frequenceRecommandee: 'quotidien',
  destinatairesTypes: ['Directeur Centre', 'Responsable Exploitation'],
  combinableAvec: ['ANALYSE_FREQUENTATION', 'ANALYSE_CA'],
  icone: 'LayoutDashboard',
  couleur: '#8b5cf6',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const ANALYSE_FREQUENTATION: TypeRapportDefinition = {
  id: 'analyse-frequentation',
  code: 'ANALYSE_FREQUENTATION',
  nom: 'Analyse de la Fréquentation',
  nomCourt: 'Fréquent.',
  description: 'Analyse approfondie des flux visiteurs et tendances',
  categorie: 'centre_commercial',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 15,
  categoriesRequises: ['frequentation'],
  kpis: [
    ALL_KPI_DEFINITIONS.FREQUENTATION_TOTALE,
    ALL_KPI_DEFINITIONS.FREQUENTATION_JOUR_MOYEN,
    ALL_KPI_DEFINITIONS.TAUX_TRANSFORMATION,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Performance globale', 1, ['FREQUENTATION_TOTALE']),
    createSection('evol', 'Évolution', 'Évolution', 'Tendances mensuelles/annuelles', 2, []),
    createSection('jour', 'Analyse par Jour', 'Jours', 'Répartition hebdomadaire', 3, ['FREQUENTATION_JOUR_MOYEN']),
    createSection('heure', 'Analyse Horaire', 'Heures', 'Pics et creux', 4, []),
    createSection('zones', 'Par Zone', 'Zones', 'Fréquentation par entrée', 5, [], true),
    createSection('events', 'Impact Événements', 'Événements', 'Corrélation événements', 6, [], true),
  ],
  graphiquesRecommandes: ['ligne', 'aire', 'heatmap', 'barre'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Directeur Centre', 'Marketing', 'Leasing Manager'],
  combinableAvec: ['TDB_CENTRE', 'ANALYSE_CA'],
  icone: 'Users',
  couleur: '#8b5cf6',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const PERF_ENSEIGNES: TypeRapportDefinition = {
  id: 'perf-enseignes',
  code: 'PERF_ENSEIGNES',
  nom: 'Performance des Enseignes',
  nomCourt: 'Enseignes',
  description: 'Classement et analyse des performances par enseigne',
  categorie: 'centre_commercial',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 20,
  categoriesRequises: ['chiffre_affaires', 'etat_locatif', 'loyers'],
  kpis: [
    ALL_KPI_DEFINITIONS.CA_M2,
    ALL_KPI_DEFINITIONS.TAUX_EFFORT,
    ALL_KPI_DEFINITIONS.CA_TOTAL,
  ],
  sections: [
    createSection('ranking', 'Classement Général', 'Ranking', 'Top et bottom performers', 1, ['CA_M2']),
    createSection('activites', 'Par Activité', 'Activités', 'Performance par secteur', 2, []),
    createSection('effort', 'Taux d\'Effort', 'Effort', 'Analyse soutenabilité', 3, ['TAUX_EFFORT']),
    createSection('evol', 'Évolution', 'Évolution', 'Tendances vs N-1', 4, []),
    createSection('risques', 'Enseignes à Risque', 'Risques', 'Alertes et surveillance', 5, []),
  ],
  graphiquesRecommandes: ['barre_horizontale', 'scatter', 'treemap'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Directeur Centre', 'Leasing Manager', 'Asset Manager'],
  combinableAvec: ['ANALYSE_CA', 'MERCHANDISING_MIX'],
  icone: 'Store',
  couleur: '#8b5cf6',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const ANALYSE_CA: TypeRapportDefinition = {
  id: 'analyse-ca',
  code: 'ANALYSE_CA',
  nom: 'Analyse du Chiffre d\'Affaires',
  nomCourt: 'Analyse CA',
  description: 'Analyse détaillée des CA déclarés par les locataires',
  categorie: 'centre_commercial',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 15,
  categoriesRequises: ['chiffre_affaires', 'frequentation'],
  kpis: [
    ALL_KPI_DEFINITIONS.CA_TOTAL,
    ALL_KPI_DEFINITIONS.CA_M2,
    ALL_KPI_DEFINITIONS.CA_VISITEUR,
    ALL_KPI_DEFINITIONS.PANIER_MOYEN,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Vue globale CA', 1, ['CA_TOTAL', 'CA_M2']),
    createSection('evol', 'Évolution', 'Évolution', 'Tendance mensuelle/annuelle', 2, []),
    createSection('activites', 'Par Activité', 'Activités', 'Contribution par secteur', 3, []),
    createSection('transfo', 'Transformation', 'Transfo.', 'CA/visiteur et panier', 4, ['CA_VISITEUR', 'PANIER_MOYEN']),
    createSection('compa', 'Comparaison N-1', 'N-1', 'Performance vs année précédente', 5, []),
  ],
  graphiquesRecommandes: ['ligne', 'barre', 'aire_empilee', 'camembert'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Directeur Centre', 'Asset Manager', 'Leasing Manager'],
  combinableAvec: ['ANALYSE_FREQUENTATION', 'PERF_ENSEIGNES'],
  icone: 'TrendingUp',
  couleur: '#8b5cf6',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// FINANCIER (4 rapports)
// ===========================================

const COMPTE_RESULTAT: TypeRapportDefinition = {
  id: 'compte-resultat',
  code: 'COMPTE_RESULTAT',
  nom: 'Compte de Résultat',
  nomCourt: 'P&L',
  description: 'État des produits et charges avec analyse des marges',
  categorie: 'financier',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: ['loyers', 'charges'],
  kpis: [
    ALL_KPI_DEFINITIONS.LOYER_TOTAL,
    ALL_KPI_DEFINITIONS.CHARGES_TOTALES,
    ALL_KPI_DEFINITIONS.NOI,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'P&L résumé', 1, ['NOI']),
    createSection('revenus', 'Revenus', 'Revenus', 'Détail des produits', 2, ['LOYER_TOTAL']),
    createSection('charges', 'Charges', 'Charges', 'Détail des charges', 3, ['CHARGES_TOTALES']),
    createSection('result', 'Résultat', 'Résultat', 'Formation du NOI', 4, ['NOI']),
    createSection('evol', 'Évolution', 'Évolution', 'Comparaison périodes', 5, []),
  ],
  graphiquesRecommandes: ['waterfall', 'barre', 'ligne'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Comptabilité', 'DAF', 'Asset Manager'],
  combinableAvec: ['NOI_ANALYSIS', 'BUDGET_VS_REEL'],
  icone: 'FileSpreadsheet',
  couleur: '#ec4899',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const CF_OPERATIONNEL: TypeRapportDefinition = {
  id: 'cf-operationnel',
  code: 'CF_OPERATIONNEL',
  nom: 'Cash-Flow Opérationnel',
  nomCourt: 'CF Opé',
  description: 'Analyse des flux de trésorerie opérationnels',
  categorie: 'financier',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: ['loyers', 'charges'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.TAUX_RECOUVREMENT,
    ALL_KPI_DEFINITIONS.DSO,
  ],
  sections: [
    createSection('synth', 'Synthèse CF', 'Synthèse', 'Cash-flow net', 1, ['NOI']),
    createSection('encaiss', 'Encaissements', 'Encaiss.', 'Détail des entrées', 2, ['TAUX_RECOUVREMENT']),
    createSection('decaiss', 'Décaissements', 'Décaiss.', 'Détail des sorties', 3, []),
    createSection('bfr', 'BFR', 'BFR', 'Évolution créances/dettes', 4, ['DSO']),
    createSection('prev', 'Prévisionnel', 'Prévi.', 'CF à venir', 5, [], true),
  ],
  graphiquesRecommandes: ['waterfall', 'ligne', 'barre'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['DAF', 'Trésorerie', 'Asset Manager'],
  combinableAvec: ['COMPTE_RESULTAT'],
  icone: 'Wallet',
  couleur: '#ec4899',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const NOI_ANALYSIS: TypeRapportDefinition = {
  id: 'noi-analysis',
  code: 'NOI_ANALYSIS',
  nom: 'Analyse du NOI',
  nomCourt: 'NOI',
  description: 'Analyse détaillée du Net Operating Income et ses composantes',
  categorie: 'financier',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: ['loyers', 'charges'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.NOI_M2,
    ALL_KPI_DEFINITIONS.YIELD_NET,
  ],
  sections: [
    createSection('synth', 'Synthèse NOI', 'Synthèse', 'Vue globale', 1, ['NOI', 'NOI_M2']),
    createSection('decomp', 'Décomposition', 'Décomp.', 'Formation du NOI', 2, []),
    createSection('evol', 'Évolution', 'Évolution', 'Tendance sur 12 mois', 3, []),
    createSection('drivers', 'Drivers', 'Drivers', 'Facteurs d\'évolution', 4, []),
    createSection('benchmark', 'Benchmark', 'Bench.', 'Comparaison marché', 5, ['YIELD_NET'], true),
  ],
  graphiquesRecommandes: ['waterfall', 'ligne', 'barre', 'aire'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Asset Manager', 'DAF', 'Direction'],
  combinableAvec: ['COMPTE_RESULTAT', 'PERF_ACTIF'],
  icone: 'TrendingUp',
  couleur: '#ec4899',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const BUDGET_VS_REEL: TypeRapportDefinition = {
  id: 'budget-vs-reel',
  code: 'BUDGET_VS_REEL',
  nom: 'Budget vs Réel',
  nomCourt: 'Budget',
  description: 'Analyse des écarts entre budget et réalisé',
  categorie: 'financier',
  complexite: 'simple',
  pagesMin: 5,
  pagesMax: 12,
  categoriesRequises: ['budget', 'loyers', 'charges'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.LOYER_TOTAL,
    ALL_KPI_DEFINITIONS.CHARGES_TOTALES,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Écarts globaux', 1, ['NOI']),
    createSection('revenus', 'Revenus', 'Revenus', 'Écarts sur revenus', 2, ['LOYER_TOTAL']),
    createSection('charges', 'Charges', 'Charges', 'Écarts sur charges', 3, ['CHARGES_TOTALES']),
    createSection('detail', 'Détail par Poste', 'Détail', 'Analyse ligne par ligne', 4, []),
    createSection('actions', 'Actions Correctives', 'Actions', 'Mesures proposées', 5, []),
  ],
  graphiquesRecommandes: ['barre', 'waterfall', 'ligne'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Contrôle de Gestion', 'DAF', 'Asset Manager'],
  combinableAvec: ['COMPTE_RESULTAT', 'GESTION_CHARGES'],
  icone: 'Scale',
  couleur: '#ec4899',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// INVESTISSEMENT (4 rapports)
// ===========================================

const DUE_DILIGENCE: TypeRapportDefinition = {
  id: 'due-diligence',
  code: 'DUE_DILIGENCE',
  nom: 'Due Diligence',
  nomCourt: 'Due Dil.',
  description: 'Rapport d\'audit complet pour acquisition potentielle',
  categorie: 'investissement',
  complexite: 'avance',
  pagesMin: 30,
  pagesMax: 60,
  categoriesRequises: ['loyers', 'charges', 'bail', 'valorisation', 'etat_locatif', 'travaux'],
  kpis: [
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.YIELD_NET,
    ALL_KPI_DEFINITIONS.WAULT,
    ALL_KPI_DEFINITIONS.TAUX_OCCUPATION_PHYSIQUE,
  ],
  sections: [
    createSection('exec', 'Executive Summary', 'Summary', 'Synthèse décisionnelle', 1, ['NOI', 'YIELD_NET']),
    createSection('actif', 'Description de l\'Actif', 'Actif', 'Caractéristiques physiques', 2, []),
    createSection('locatif', 'Situation Locative', 'Locatif', 'Analyse des baux', 3, ['WAULT', 'TAUX_OCCUPATION_PHYSIQUE']),
    createSection('financier', 'Analyse Financière', 'Financier', 'Revenus et charges', 4, ['NOI']),
    createSection('technique', 'Audit Technique', 'Technique', 'État du bâtiment', 5, []),
    createSection('juridique', 'Points Juridiques', 'Juridique', 'Risques légaux', 6, []),
    createSection('risques', 'Analyse des Risques', 'Risques', 'Matrice des risques', 7, []),
    createSection('valo', 'Valorisation', 'Valorisation', 'Proposition de prix', 8, ['YIELD_NET']),
  ],
  graphiquesRecommandes: ['barre', 'radar', 'waterfall', 'heatmap'],
  frequenceRecommandee: 'ponctuel',
  destinatairesTypes: ['Comité d\'Investissement', 'Direction', 'Acquéreur'],
  combinableAvec: ['VALORISATION_DCF'],
  icone: 'Search',
  couleur: '#06b6d4',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const ETUDE_MARCHE: TypeRapportDefinition = {
  id: 'etude-marche',
  code: 'ETUDE_MARCHE',
  nom: 'Étude de Marché',
  nomCourt: 'Marché',
  description: 'Analyse de la zone de chalandise et du marché local',
  categorie: 'investissement',
  complexite: 'intermediaire',
  pagesMin: 15,
  pagesMax: 30,
  categoriesRequises: ['frequentation'],
  kpis: [
    ALL_KPI_DEFINITIONS.FREQUENTATION_TOTALE,
    ALL_KPI_DEFINITIONS.CA_M2,
  ],
  sections: [
    createSection('exec', 'Synthèse', 'Synthèse', 'Points clés du marché', 1, []),
    createSection('zone', 'Zone de Chalandise', 'Zone', 'Délimitation et population', 2, []),
    createSection('socio', 'Données Socio-démo', 'Socio', 'Profil de la clientèle', 3, []),
    createSection('concurrence', 'Analyse Concurrence', 'Concurrence', 'Offre existante', 4, []),
    createSection('potentiel', 'Potentiel Commercial', 'Potentiel', 'Dépenses captables', 5, ['CA_M2']),
    createSection('tendances', 'Tendances', 'Tendances', 'Évolution du marché', 6, []),
  ],
  graphiquesRecommandes: ['camembert', 'barre', 'radar', 'scatter'],
  frequenceRecommandee: 'ponctuel',
  destinatairesTypes: ['Leasing Manager', 'Direction', 'Investisseurs'],
  combinableAvec: ['ANALYSE_CONCURRENTIELLE'],
  icone: 'MapPin',
  couleur: '#06b6d4',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const ANALYSE_CONCURRENTIELLE: TypeRapportDefinition = {
  id: 'analyse-concurrentielle',
  code: 'ANALYSE_CONCURRENTIELLE',
  nom: 'Analyse Concurrentielle',
  nomCourt: 'Concurrence',
  description: 'Benchmark détaillé vs centres commerciaux concurrents',
  categorie: 'investissement',
  complexite: 'intermediaire',
  pagesMin: 10,
  pagesMax: 20,
  categoriesRequises: ['frequentation', 'chiffre_affaires'],
  kpis: [
    ALL_KPI_DEFINITIONS.FREQUENTATION_TOTALE,
    ALL_KPI_DEFINITIONS.CA_M2,
    ALL_KPI_DEFINITIONS.LOYER_MOYEN_M2,
  ],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Positionnement global', 1, []),
    createSection('mapping', 'Cartographie', 'Carte', 'Localisation concurrents', 2, []),
    createSection('compa', 'Tableau Comparatif', 'Comparatif', 'Benchmark détaillé', 3, ['FREQUENTATION_TOTALE', 'CA_M2']),
    createSection('forces', 'Forces/Faiblesses', 'SWOT', 'Analyse comparative', 4, []),
    createSection('recomm', 'Recommandations', 'Recomm.', 'Positionnement suggéré', 5, []),
  ],
  graphiquesRecommandes: ['radar', 'barre', 'scatter'],
  frequenceRecommandee: 'annuel',
  destinatairesTypes: ['Direction', 'Marketing', 'Leasing Manager'],
  combinableAvec: ['ETUDE_MARCHE'],
  icone: 'GitCompare',
  couleur: '#06b6d4',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const SCENARIOS_ACQUISITION: TypeRapportDefinition = {
  id: 'scenarios-acquisition',
  code: 'SCENARIOS_ACQUISITION',
  nom: 'Scénarios d\'Acquisition',
  nomCourt: 'Scénarios',
  description: 'Modélisation de différents scénarios d\'investissement',
  categorie: 'investissement',
  complexite: 'avance',
  pagesMin: 15,
  pagesMax: 25,
  categoriesRequises: ['loyers', 'charges', 'valorisation', 'bail'],
  kpis: [
    ALL_KPI_DEFINITIONS.YIELD_NET,
    ALL_KPI_DEFINITIONS.NOI,
    ALL_KPI_DEFINITIONS.VALEUR_ACTIF,
  ],
  sections: [
    createSection('exec', 'Synthèse', 'Synthèse', 'Comparaison scénarios', 1, ['YIELD_NET']),
    createSection('base', 'Scénario Base', 'Base', 'Hypothèses conservatrices', 2, ['NOI']),
    createSection('opti', 'Scénario Optimiste', 'Optimiste', 'Hypothèses favorables', 3, []),
    createSection('pessi', 'Scénario Pessimiste', 'Pessimiste', 'Hypothèses défavorables', 4, []),
    createSection('sensi', 'Sensibilités', 'Sensibilité', 'Analyses de sensibilité', 5, []),
    createSection('recomm', 'Recommandation', 'Recomm.', 'Avis et conditions', 6, ['VALEUR_ACTIF']),
  ],
  graphiquesRecommandes: ['ligne', 'barre', 'heatmap', 'waterfall'],
  frequenceRecommandee: 'ponctuel',
  destinatairesTypes: ['Comité d\'Investissement', 'Direction', 'Banques'],
  combinableAvec: ['DUE_DILIGENCE', 'VALORISATION_DCF'],
  icone: 'GitBranch',
  couleur: '#06b6d4',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// PROJET & MOBILISATION (8 rapports)
// ===========================================

const DASHBOARD_PROJET: TypeRapportDefinition = {
  id: 'dashboard-projet',
  code: 'DASHBOARD_PROJET',
  nom: 'Dashboard Projet',
  nomCourt: 'Dashboard',
  description: 'Vue synthétique de l\'avancement global du projet de construction/rénovation',
  categorie: 'projet',
  complexite: 'simple',
  pagesMin: 4,
  pagesMax: 8,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('exec', 'Vue d\'Ensemble', 'Vue', 'Synthèse de l\'avancement projet', 1, []),
    createSection('jalons', 'Jalons Clés', 'Jalons', 'État des jalons principaux', 2, []),
    createSection('budget', 'Budget', 'Budget', 'Suivi budgétaire synthétique', 3, []),
    createSection('equipe', 'Équipe', 'Équipe', 'Avancement du recrutement', 4, []),
    createSection('commercial', 'Commercial', 'Commercial', 'Pipeline de commercialisation', 5, []),
    createSection('risques', 'Risques', 'Risques', 'Top risques identifiés', 6, []),
  ],
  graphiquesRecommandes: ['jauge', 'barre', 'ligne'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['Directeur Projet', 'Direction', 'Comité de Pilotage'],
  combinableAvec: ['SUIVI_JALONS', 'BUDGET_PROJET'],
  icone: 'LayoutDashboard',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const SUIVI_JALONS: TypeRapportDefinition = {
  id: 'suivi-jalons',
  code: 'SUIVI_JALONS',
  nom: 'Suivi des Jalons',
  nomCourt: 'Jalons',
  description: 'Suivi détaillé des étapes clés du projet avec planning et alertes',
  categorie: 'projet',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'État global des jalons', 1, []),
    createSection('gantt', 'Planning Gantt', 'Planning', 'Vue chronologique', 2, []),
    createSection('detail', 'Détail par Jalon', 'Détail', 'Avancement de chaque jalon', 3, []),
    createSection('retards', 'Retards & Alertes', 'Alertes', 'Jalons en retard ou à risque', 4, []),
    createSection('deps', 'Dépendances', 'Dépendances', 'Liens entre jalons', 5, [], true),
    createSection('prev', 'Prévisionnel', 'Prévi.', 'Projection de fin de projet', 6, []),
  ],
  graphiquesRecommandes: ['ligne', 'barre', 'heatmap'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['Chef de Projet', 'Directeur Projet', 'MOE/MOA'],
  combinableAvec: ['DASHBOARD_PROJET', 'RISQUES_PROJET'],
  icone: 'Milestone',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const SUIVI_RECRUTEMENT: TypeRapportDefinition = {
  id: 'suivi-recrutement',
  code: 'SUIVI_RECRUTEMENT',
  nom: 'Suivi du Recrutement',
  nomCourt: 'Recrutement',
  description: 'État d\'avancement du recrutement de l\'équipe d\'exploitation',
  categorie: 'projet',
  complexite: 'simple',
  pagesMin: 4,
  pagesMax: 10,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Vue d\'ensemble du recrutement', 1, []),
    createSection('organi', 'Organigramme Cible', 'Organi.', 'Structure cible vs actuelle', 2, []),
    createSection('postes', 'Détail par Poste', 'Postes', 'État de chaque recrutement', 3, []),
    createSection('pipeline', 'Pipeline Candidats', 'Pipeline', 'Candidatures en cours', 4, []),
    createSection('planning', 'Planning Intégration', 'Planning', 'Dates d\'arrivée prévues', 5, []),
    createSection('formation', 'Plan de Formation', 'Formation', 'Besoins de formation', 6, [], true),
  ],
  graphiquesRecommandes: ['barre', 'camembert', 'ligne'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['DRH', 'Directeur Projet', 'Futur Directeur Centre'],
  combinableAvec: ['DASHBOARD_PROJET'],
  icone: 'Users',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const COMMERCIALISATION_PROJET: TypeRapportDefinition = {
  id: 'commercialisation-projet',
  code: 'COMMERCIALISATION_PROJET',
  nom: 'Commercialisation Projet',
  nomCourt: 'Commerc.',
  description: 'Suivi de la pré-commercialisation du centre en construction',
  categorie: 'projet',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 15,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'État global de la commercialisation', 1, []),
    createSection('objectifs', 'Objectifs', 'Objectifs', 'Cibles GLA et nombre de baux', 2, []),
    createSection('signes', 'Baux Signés', 'Signés', 'Détail des engagements fermes', 3, []),
    createSection('nego', 'En Négociation', 'Négo.', 'Prospects avancés', 4, []),
    createSection('pipeline', 'Pipeline Prospects', 'Pipeline', 'Tous les contacts en cours', 5, []),
    createSection('mix', 'Mix Commercial Cible', 'Mix', 'Répartition par activité', 6, []),
    createSection('risques', 'Risques Commerciaux', 'Risques', 'Alertes et points d\'attention', 7, [], true),
  ],
  graphiquesRecommandes: ['funnel', 'barre', 'camembert', 'treemap'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['Directeur Commercial', 'Directeur Projet', 'Direction'],
  combinableAvec: ['DASHBOARD_PROJET', 'PIPELINE_COMMERCIAL'],
  icone: 'Store',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const BUDGET_PROJET: TypeRapportDefinition = {
  id: 'budget-projet',
  code: 'BUDGET_PROJET',
  nom: 'Budget Projet',
  nomCourt: 'Budget',
  description: 'Suivi budgétaire détaillé du projet de construction',
  categorie: 'projet',
  complexite: 'intermediaire',
  pagesMin: 8,
  pagesMax: 15,
  categoriesRequises: ['budget', 'travaux'],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse Budgétaire', 'Synthèse', 'Vue d\'ensemble budget', 1, []),
    createSection('depenses', 'Dépenses Réalisées', 'Dépenses', 'Engagements et paiements', 2, []),
    createSection('ecarts', 'Analyse des Écarts', 'Écarts', 'Budget vs Réel', 3, []),
    createSection('postes', 'Détail par Poste', 'Postes', 'Ventilation par catégorie', 4, []),
    createSection('prev', 'Prévisionnel', 'Prévi.', 'Projection jusqu\'à livraison', 5, []),
    createSection('tresorerie', 'Plan de Trésorerie', 'Tréso.', 'Appels de fonds', 6, [], true),
  ],
  graphiquesRecommandes: ['waterfall', 'barre', 'ligne', 'camembert'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['DAF', 'Directeur Projet', 'Comité de Pilotage'],
  combinableAvec: ['DASHBOARD_PROJET', 'BUDGET_VS_REEL'],
  icone: 'Wallet',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const RISQUES_PROJET: TypeRapportDefinition = {
  id: 'risques-projet',
  code: 'RISQUES_PROJET',
  nom: 'Risques Projet',
  nomCourt: 'Risques',
  description: 'Cartographie et suivi des risques du projet',
  categorie: 'projet',
  complexite: 'intermediaire',
  pagesMin: 6,
  pagesMax: 12,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse', 'Synthèse', 'Vue d\'ensemble des risques', 1, []),
    createSection('matrice', 'Matrice des Risques', 'Matrice', 'Impact x Probabilité', 2, []),
    createSection('top', 'Top Risques', 'Top', 'Risques majeurs détaillés', 3, []),
    createSection('actions', 'Plans d\'Action', 'Actions', 'Mesures de mitigation', 4, []),
    createSection('suivi', 'Évolution', 'Évolution', 'Historique des risques', 5, []),
    createSection('opportunites', 'Opportunités', 'Opport.', 'Upside potentiel', 6, [], true),
  ],
  graphiquesRecommandes: ['heatmap', 'barre', 'radar'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Chef de Projet', 'Directeur Projet', 'Comité de Pilotage'],
  combinableAvec: ['DASHBOARD_PROJET', 'SUIVI_JALONS'],
  icone: 'AlertTriangle',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const HANDOVER_CHECKLIST: TypeRapportDefinition = {
  id: 'handover-checklist',
  code: 'HANDOVER_CHECKLIST',
  nom: 'Checklist Handover',
  nomCourt: 'Handover',
  description: 'Liste de contrôle pour la pré-ouverture et le transfert aux opérations',
  categorie: 'projet',
  complexite: 'intermediaire',
  pagesMin: 10,
  pagesMax: 25,
  categoriesRequises: [],
  kpis: [],
  sections: [
    createSection('synth', 'Synthèse Préparation', 'Synthèse', 'État de préparation global', 1, []),
    createSection('tech', 'Technique', 'Technique', 'Réceptions et levées de réserves', 2, []),
    createSection('admin', 'Administratif', 'Admin.', 'Autorisations et conformité', 3, []),
    createSection('comm', 'Commercial', 'Commercial', 'État des baux et locataires', 4, []),
    createSection('rh', 'RH & Organisation', 'RH', 'Équipe et procédures', 5, []),
    createSection('market', 'Marketing', 'Marketing', 'Plan d\'ouverture et communication', 6, []),
    createSection('exploit', 'Exploitation', 'Exploit.', 'Contrats et prestataires', 7, []),
    createSection('finance', 'Finance', 'Finance', 'Budget d\'exploitation', 8, [], true),
  ],
  graphiquesRecommandes: ['barre', 'jauge', 'camembert'],
  frequenceRecommandee: 'hebdomadaire',
  destinatairesTypes: ['Directeur Projet', 'Futur Directeur Centre', 'Direction'],
  combinableAvec: ['DASHBOARD_PROJET'],
  icone: 'ClipboardCheck',
  couleur: '#84cc16',
  estPremium: false,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

const REPORTING_PROJET: TypeRapportDefinition = {
  id: 'reporting-projet',
  code: 'REPORTING_PROJET',
  nom: 'Reporting Projet',
  nomCourt: 'Report. Proj.',
  description: 'Rapport mensuel complet pour le comité de pilotage',
  categorie: 'projet',
  complexite: 'avance',
  pagesMin: 15,
  pagesMax: 30,
  categoriesRequises: ['budget', 'travaux'],
  kpis: [],
  sections: [
    createSection('exec', 'Résumé Exécutif', 'Résumé', 'Points clés et décisions', 1, []),
    createSection('avancement', 'Avancement Global', 'Avancement', 'État des jalons et planning', 2, []),
    createSection('budget', 'Situation Budgétaire', 'Budget', 'Financier et prévisions', 3, []),
    createSection('commercial', 'Commercialisation', 'Commercial', 'Pré-commercialisation', 4, []),
    createSection('rh', 'Ressources Humaines', 'RH', 'Recrutement et formation', 5, []),
    createSection('risques', 'Risques & Opportunités', 'Risques', 'Cartographie mise à jour', 6, []),
    createSection('actions', 'Plan d\'Actions', 'Actions', 'Prochaines étapes', 7, []),
    createSection('annexes', 'Annexes', 'Annexes', 'Documents complémentaires', 8, [], true),
  ],
  graphiquesRecommandes: ['barre', 'ligne', 'waterfall', 'heatmap', 'jauge'],
  frequenceRecommandee: 'mensuel',
  destinatairesTypes: ['Comité de Pilotage', 'Direction Générale', 'Investisseurs'],
  combinableAvec: ['DASHBOARD_PROJET', 'SUIVI_JALONS', 'BUDGET_PROJET'],
  icone: 'FileText',
  couleur: '#84cc16',
  estPremium: true,
  actif: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
};

// ===========================================
// CATALOGUE COMPLET
// ===========================================

export const CATALOGUE_RAPPORTS: Record<TypeRapportCode, TypeRapportDefinition> = {
  // Asset Management
  PERF_ACTIF,
  ANALYSE_PORTEFEUILLE,
  BUSINESS_PLAN,
  VALORISATION_DCF,
  // Property Management
  ETAT_LOCATIF_REPORT,
  SUIVI_BAUX,
  GESTION_CHARGES,
  REPORTING_PROPRIETAIRE,
  // Leasing
  PIPELINE_COMMERCIAL,
  MERCHANDISING_MIX,
  BENCHMARK_LOYERS,
  SUIVI_VACANCE,
  // Centre Commercial
  TDB_CENTRE,
  ANALYSE_FREQUENTATION,
  PERF_ENSEIGNES,
  ANALYSE_CA,
  // Financier
  COMPTE_RESULTAT,
  CF_OPERATIONNEL,
  NOI_ANALYSIS,
  BUDGET_VS_REEL,
  // Investissement
  DUE_DILIGENCE,
  ETUDE_MARCHE,
  ANALYSE_CONCURRENTIELLE,
  SCENARIOS_ACQUISITION,
  // Projet & Mobilisation
  DASHBOARD_PROJET,
  SUIVI_JALONS,
  SUIVI_RECRUTEMENT,
  COMMERCIALISATION_PROJET,
  BUDGET_PROJET,
  RISQUES_PROJET,
  HANDOVER_CHECKLIST,
  REPORTING_PROJET,
};

// ===========================================
// RAPPORTS PAR CATEGORIE
// ===========================================

export function getRapportsByCategorie(categorie: CategorieRapport): TypeRapportDefinition[] {
  return Object.values(CATALOGUE_RAPPORTS).filter(r => r.categorie === categorie);
}

export const RAPPORTS_PAR_CATEGORIE: Record<CategorieRapport, TypeRapportCode[]> = {
  asset_management: ['PERF_ACTIF', 'ANALYSE_PORTEFEUILLE', 'BUSINESS_PLAN', 'VALORISATION_DCF'],
  property_management: ['ETAT_LOCATIF_REPORT', 'SUIVI_BAUX', 'GESTION_CHARGES', 'REPORTING_PROPRIETAIRE'],
  leasing: ['PIPELINE_COMMERCIAL', 'MERCHANDISING_MIX', 'BENCHMARK_LOYERS', 'SUIVI_VACANCE'],
  centre_commercial: ['TDB_CENTRE', 'ANALYSE_FREQUENTATION', 'PERF_ENSEIGNES', 'ANALYSE_CA'],
  financier: ['COMPTE_RESULTAT', 'CF_OPERATIONNEL', 'NOI_ANALYSIS', 'BUDGET_VS_REEL'],
  investissement: ['DUE_DILIGENCE', 'ETUDE_MARCHE', 'ANALYSE_CONCURRENTIELLE', 'SCENARIOS_ACQUISITION'],
  projet: ['DASHBOARD_PROJET', 'SUIVI_JALONS', 'SUIVI_RECRUTEMENT', 'COMMERCIALISATION_PROJET', 'BUDGET_PROJET', 'RISQUES_PROJET', 'HANDOVER_CHECKLIST', 'REPORTING_PROJET'],
};

// ===========================================
// PACKS DE RAPPORTS PREDEFINIS
// ===========================================

export const PACKS_RAPPORTS: PackRapport[] = [
  {
    id: 'pack-mensuel',
    code: 'MENSUEL',
    nom: 'Pack Reporting Mensuel',
    description: 'Ensemble des rapports pour le reporting mensuel standard',
    rapportsCodes: ['PERF_ACTIF', 'ETAT_LOCATIF_REPORT', 'TDB_CENTRE', 'BUDGET_VS_REEL'],
    pagesEstimees: '30-50',
    periodicite: 'Mensuel',
    destinataires: ['Asset Manager', 'Property Manager', 'Directeur Centre'],
    icone: 'Calendar',
    couleur: '#3b82f6',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-proprietaire',
    code: 'PROPRIETAIRE',
    nom: 'Pack Reporting Propriétaire',
    description: 'Rapports complets pour le reporting au propriétaire',
    rapportsCodes: ['REPORTING_PROPRIETAIRE', 'SUIVI_BAUX', 'GESTION_CHARGES', 'NOI_ANALYSIS'],
    pagesEstimees: '25-40',
    periodicite: 'Mensuel/Trimestriel',
    destinataires: ['Propriétaire', 'Asset Manager'],
    icone: 'Building2',
    couleur: '#10b981',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-centre',
    code: 'CENTRE',
    nom: 'Pack Centre Commercial',
    description: 'Rapports opérationnels pour la gestion quotidienne du centre',
    rapportsCodes: ['TDB_CENTRE', 'ANALYSE_FREQUENTATION', 'PERF_ENSEIGNES', 'ANALYSE_CA'],
    pagesEstimees: '25-45',
    periodicite: 'Hebdomadaire/Mensuel',
    destinataires: ['Directeur Centre', 'Responsable Marketing'],
    icone: 'ShoppingBag',
    couleur: '#8b5cf6',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-leasing',
    code: 'LEASING',
    nom: 'Pack Commercialisation',
    description: 'Rapports pour le suivi de la commercialisation',
    rapportsCodes: ['PIPELINE_COMMERCIAL', 'MERCHANDISING_MIX', 'BENCHMARK_LOYERS', 'SUIVI_VACANCE'],
    pagesEstimees: '20-35',
    periodicite: 'Hebdomadaire/Mensuel',
    destinataires: ['Leasing Manager', 'Asset Manager'],
    icone: 'Target',
    couleur: '#f97316',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-investisseur',
    code: 'INVESTISSEUR',
    nom: 'Pack Investisseur',
    description: 'Rapports complets pour les investisseurs et comités',
    rapportsCodes: ['ANALYSE_PORTEFEUILLE', 'PERF_ACTIF', 'VALORISATION_DCF', 'BUSINESS_PLAN'],
    pagesEstimees: '50-80',
    periodicite: 'Trimestriel/Annuel',
    destinataires: ['Investisseurs', 'Comité d\'Investissement', 'Direction'],
    icone: 'Briefcase',
    couleur: '#06b6d4',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-acquisition',
    code: 'ACQUISITION',
    nom: 'Pack Acquisition',
    description: 'Documents complets pour une opération d\'acquisition',
    rapportsCodes: ['DUE_DILIGENCE', 'ETUDE_MARCHE', 'ANALYSE_CONCURRENTIELLE', 'SCENARIOS_ACQUISITION'],
    pagesEstimees: '70-120',
    periodicite: 'Ponctuel',
    destinataires: ['Comité d\'Investissement', 'Banques', 'Acquéreur'],
    icone: 'Search',
    couleur: '#06b6d4',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-projet',
    code: 'PROJET',
    nom: 'Pack Projet & Mobilisation',
    description: 'Rapports complets pour le pilotage d\'un projet de construction',
    rapportsCodes: ['DASHBOARD_PROJET', 'SUIVI_JALONS', 'BUDGET_PROJET', 'RISQUES_PROJET', 'REPORTING_PROJET'],
    pagesEstimees: '40-70',
    periodicite: 'Hebdomadaire/Mensuel',
    destinataires: ['Directeur Projet', 'Comité de Pilotage', 'Direction'],
    icone: 'HardHat',
    couleur: '#84cc16',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    id: 'pack-preopening',
    code: 'PREOPENING',
    nom: 'Pack Pré-Ouverture',
    description: 'Documents pour la phase finale avant ouverture',
    rapportsCodes: ['HANDOVER_CHECKLIST', 'SUIVI_RECRUTEMENT', 'COMMERCIALISATION_PROJET'],
    pagesEstimees: '25-45',
    periodicite: 'Hebdomadaire',
    destinataires: ['Directeur Projet', 'Futur Directeur Centre', 'Direction'],
    icone: 'ClipboardCheck',
    couleur: '#84cc16',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
];

// ===========================================
// HELPERS
// ===========================================

export function getTypeRapport(code: TypeRapportCode): TypeRapportDefinition | undefined {
  return CATALOGUE_RAPPORTS[code];
}

export function getPackRapport(code: string): PackRapport | undefined {
  return PACKS_RAPPORTS.find(p => p.code === code);
}

export function getRapportsActifs(): TypeRapportDefinition[] {
  return Object.values(CATALOGUE_RAPPORTS).filter(r => r.actif);
}

export function getRapportsPremium(): TypeRapportDefinition[] {
  return Object.values(CATALOGUE_RAPPORTS).filter(r => r.estPremium);
}

export function getRapportsSimples(): TypeRapportDefinition[] {
  return Object.values(CATALOGUE_RAPPORTS).filter(r => r.complexite === 'simple');
}

export function getRapportsCombinables(code: TypeRapportCode): TypeRapportDefinition[] {
  const rapport = CATALOGUE_RAPPORTS[code];
  if (!rapport) return [];
  return rapport.combinableAvec.map(c => CATALOGUE_RAPPORTS[c]).filter(Boolean);
}

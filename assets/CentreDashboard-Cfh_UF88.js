import{j as e,R as K,g as V,h as q,i as G,k as H,l as L,T as U}from"./vendor-charts-cvMpHz0W.js";import{e as X,d as _,r as F}from"./vendor-react-BdB5Pz3t.js";import{u as J,a as Q,b as W,c as Y,d as Z,B as h,C as a,g as n,h as j,i as f}from"./index-IaNwoOYO.js";import{a as ee,B as se}from"./Badge-CM23X0aP.js";import{a1 as te,P as re,T as b,c as ie,A as w,B as ae}from"./vendor-icons-B6Rt7gcW.js";import{f as A}from"./vendor-utils-BBD155gO.js";import{f as C}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";function pe(){const{centreId:t}=X(),m=_(),{setCurrentCentre:k}=J(),c=Q(s=>s.getCentre(t||"")),{axes:ne,loadAxes:E,objectifs:ce,loadObjectifs:M,getAxesByCentre:P,getObjectifsByCentre:R}=W(),{mesures:T,loadMesures:S}=Y(),{actions:le,loadActions:B,getActionsByCentre:I,getActionsEnRetard:O}=Z();if(F.useEffect(()=>{t&&(k(t),E(t),M(t),S(t),B(t))},[t]),!c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-primary-500",children:"Centre non trouvé"})});const u=P(t||""),p=R(t||""),$=I(t||""),l=T.filter(s=>s.centreId===t),g=O().filter(s=>s.centreId===t),N=u.map(s=>{const r=p.filter(x=>x.axeId===s.id),i=l.filter(x=>r.some(z=>z.id===x.objectifId)),y=i.filter(x=>x.statut==="vert").length,D=i.length>0?Math.round(y/i.length*100):0;return{axe:s.nom.split(" ").slice(0,2).join(" "),code:s.code,performance:D,fullMark:100,couleur:s.couleur}}),d={objectifsTotal:p.length,objectifsAtteints:l.filter(s=>s.statut==="vert").length,actionsEnCours:$.filter(s=>s.statut==="en_cours").length,actionsEnRetard:g.length},o=l.length>0?Math.round(d.objectifsAtteints/l.length*100):0,v=l.sort((s,r)=>new Date(r.dateSaisie).getTime()-new Date(s.dateSaisie).getTime()).slice(0,5);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-xl",style:{backgroundColor:c.couleurTheme},children:c.code.substring(0,2)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:c.nom}),e.jsx("p",{className:"text-primary-500",children:c.ville})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(h,{variant:"secondary",onClick:()=>m(`/centre/${t}/pilotage`),rightIcon:e.jsx(te,{className:"w-4 h-4"}),children:"Piloter les KPIs"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(a,{children:e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Performance globale"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-900 mt-1",children:[o,"%"]})]}),e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${o>=80?"bg-success/10":o>=60?"bg-warning/10":"bg-error/10"}`,children:e.jsx(re,{className:`w-6 h-6 ${o>=80?"text-success":o>=60?"text-warning":"text-error"}`})})]})})}),e.jsx(a,{children:e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Objectifs atteints"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-900 mt-1",children:[d.objectifsAtteints,e.jsxs("span",{className:"text-lg text-primary-400",children:["/",d.objectifsTotal]})]})]}),e.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-success"})})]})})}),e.jsx(a,{children:e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Actions en cours"}),e.jsx("p",{className:"text-3xl font-bold text-primary-900 mt-1",children:d.actionsEnCours})]}),e.jsx("div",{className:"w-12 h-12 bg-info/10 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-info"})})]})})}),e.jsx(a,{children:e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Actions en retard"}),e.jsx("p",{className:"text-3xl font-bold text-error mt-1",children:d.actionsEnRetard})]}),e.jsx("div",{className:"w-12 h-12 bg-error/10 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-error"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Performance par axe stratégique"]})}),e.jsx(n,{children:e.jsx("div",{className:"h-80",children:N.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(V,{data:N,children:[e.jsx(q,{stroke:"#e5e5e5"}),e.jsx(G,{dataKey:"axe",tick:{fill:"#737373",fontSize:11}}),e.jsx(H,{angle:30,domain:[0,100],tick:{fill:"#737373",fontSize:10}}),e.jsx(L,{name:"Performance",dataKey:"performance",stroke:"#171717",fill:"#171717",fillOpacity:.3}),e.jsx(U,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-primary-500",children:"Aucune donnée disponible"})})})})]}),e.jsxs(a,{children:[e.jsx(j,{action:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>m(`/centre/${t}/pilotage`),children:"Détails"}),children:e.jsx(f,{children:"Axes stratégiques"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-3",children:[u.map(s=>{const r=N.find(y=>y.code===s.code),i=(r==null?void 0:r.performance)||0;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:s.couleur},children:s.code.replace("AXE","")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-primary-900 text-sm",children:s.nom}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-2 bg-primary-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${i}%`,backgroundColor:i>=80?"#22c55e":i>=60?"#f59e0b":"#ef4444"}})}),e.jsxs("span",{className:"text-sm font-medium text-primary-600 w-12 text-right",children:[i,"%"]})]})]})]},s.id)}),u.length===0&&e.jsx("p",{className:"text-center text-primary-500 py-4",children:"Aucun axe configuré"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsx(j,{action:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>m(`/centre/${t}/pilotage`),children:"Voir tout"}),children:e.jsx(f,{children:"Dernières mesures saisies"})}),e.jsx(n,{children:v.length>0?e.jsx("div",{className:"space-y-3",children:v.map(s=>{const r=p.find(i=>i.id===s.objectifId);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900 text-sm",children:(r==null?void 0:r.intitule)||"Objectif inconnu"}),e.jsx("p",{className:"text-xs text-primary-500",children:A(new Date(s.dateSaisie),"dd/MM/yyyy",{locale:C})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-primary-900",children:s.valeurReelle}),e.jsx(ee,{statut:s.statut})]})]},s.id)})}):e.jsx("p",{className:"text-center text-primary-500 py-4",children:"Aucune mesure enregistrée"})})]}),e.jsxs(a,{children:[e.jsx(j,{action:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>m(`/centre/${t}/actions`),children:"Voir tout"}),children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-warning"}),"Actions prioritaires"]})}),e.jsx(n,{children:g.length>0?e.jsx("div",{className:"space-y-3",children:g.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-error/5 border border-error/10 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900 text-sm",children:s.titre}),e.jsxs("p",{className:"text-xs text-error",children:["Échéance: ",A(new Date(s.dateEcheance),"dd/MM/yyyy",{locale:C})]})]}),e.jsx(se,{variant:"error",children:"En retard"})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(b,{className:"w-6 h-6 text-success"})}),e.jsx("p",{className:"text-primary-500",children:"Aucune action en retard"})]})})]})]})]})}export{pe as CentreDashboard};

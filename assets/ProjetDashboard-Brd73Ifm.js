import{j as e,R as ne,B as le,C as ce,X as oe,Y as de,T as xe,c as me,e as he}from"./vendor-charts-cvMpHz0W.js";import{e as pe,d as ue,r as f}from"./vendor-react-BdB5Pz3t.js";import{a as F,u as je,f as fe,B as m,C as h,h as u,i as j,g as p}from"./index-IaNwoOYO.js";import{B as c}from"./Badge-CM23X0aP.js";import{C as ge}from"./Modal-J_gxoCCM.js";import{d as E,av as Ne,T,a1 as O,aF as S,f as ve,ay as v,h as _,ai as L,W as J,o as ye,A as y,aG as H,x as be}from"./vendor-icons-B6Rt7gcW.js";import{f as G,d as we,q as Ce,r as Ie}from"./vendor-utils-BBD155gO.js";import{f as K}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";function V({title:r,targetDate:i,icon:t,color:x}){const[n,o]=f.useState({days:0,hours:0,minutes:0});f.useEffect(()=>{const I=()=>{const g=new Date(i),N=new Date,P=we(g,N),A=Ce(g,N)%24,M=Ie(g,N)%60;o({days:Math.max(0,P),hours:Math.max(0,A),minutes:Math.max(0,M)})};I();const $=setInterval(I,6e4);return()=>clearInterval($)},[i]);const w=n.days<=30,C=n.days<=7;return e.jsxs(h,{className:`relative overflow-hidden ${C?"ring-2 ring-error":w?"ring-2 ring-warning":""}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 rounded-full opacity-10 -translate-y-8 translate-x-8",style:{backgroundColor:x}}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500 mb-1",children:r}),e.jsx("p",{className:"text-xs text-primary-400 mb-3",children:G(new Date(i),"EEEE d MMMM yyyy",{locale:K})}),e.jsxs("div",{className:"flex items-baseline gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-primary-900",children:n.days}),e.jsx("p",{className:"text-xs text-primary-500",children:"jours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-primary-700",children:n.hours}),e.jsx("p",{className:"text-xs text-primary-500",children:"heures"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-medium text-primary-600",children:n.minutes}),e.jsx("p",{className:"text-xs text-primary-500",children:"min"})]})]})]}),e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:`${x}20`},children:e.jsx(t,{className:"w-7 h-7",style:{color:x}})})]})})]})}function b({label:r,current:i,total:t,icon:x,color:n}){const o=t>0?Math.round(i/t*100):0;return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-primary-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center",style:{backgroundColor:`${n}15`},children:e.jsx(x,{className:"w-6 h-6",style:{color:n}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-primary-900",children:r}),e.jsxs("p",{className:"text-sm font-bold text-primary-900",children:[i,e.jsxs("span",{className:"text-primary-400 font-normal",children:["/",t]})]})]}),e.jsx("div",{className:"h-2 bg-primary-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${o}%`,backgroundColor:n}})})]}),e.jsxs("span",{className:"text-lg font-bold",style:{color:o>=80?"#22c55e":o>=50?n:"#ef4444"},children:[o,"%"]})]})}function qe(){const{centreId:r}=pe(),i=ue(),t=F(s=>s.getCentre(r||"")),x=F(s=>s.updateCentre),{addToast:n}=je(),{projets:o,phases:w,jalons:C,vaguesRecrutement:I,postesARecruter:$,prospects:g,reserves:N,suiviBEFA:P,risquesProjet:A,loadProjet:M,getStatistiquesProjet:U,initializeDefaultProjet:W}=fe(),[q,D]=f.useState(!1),[X,k]=f.useState(!1),Y=(t==null?void 0:t.statut)==="en_construction"&&!(t!=null&&t.modeExploitationActif),Z=(t==null?void 0:t.statut)==="en_construction"&&(t==null?void 0:t.modeExploitationActif),Q=async()=>{if(r)try{await x(r,{modeExploitationActif:!0}),n({type:"success",title:"Mode exploitation activé",message:"Le centre est maintenant en période de transition (projet + exploitation)."}),k(!1)}catch{n({type:"error",title:"Erreur",message:"Impossible d'activer le mode exploitation."})}};if(f.useEffect(()=>{r&&M(r)},[r]),!t)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-primary-500",children:"Centre non trouvé"})});const d=o.find(s=>s.centreId===r),ee=async()=>{D(!0);try{const s=new Date;s.setMonth(s.getMonth()+6);const l=new Date(s);l.setMonth(l.getMonth()+1),await W(r,t.nom,s.toISOString(),l.toISOString())}finally{D(!1)}};if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 bg-primary-50 rounded-2xl",children:[e.jsx(E,{className:"w-16 h-16 text-primary-300 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-primary-900 mb-2",children:"Mode Projet non initialisé"}),e.jsx("p",{className:"text-primary-500 mb-6 text-center max-w-md",children:"Ce centre est en phase de construction. Initialisez le projet pour commencer à suivre les jalons, le recrutement et la commercialisation."}),e.jsx(m,{onClick:ee,disabled:q,children:q?"Initialisation...":"Initialiser le projet de lancement"})]});const a=U(d.id),se=C.filter(s=>s.projetId===d.id),te=w.filter(s=>s.projetId===d.id),ae=A.filter(s=>s.projetId===d.id),B=se.filter(s=>s.statut!=="atteint").sort((s,l)=>new Date(s.dateCible).getTime()-new Date(l.dateCible).getTime()).slice(0,5),R=ae.filter(s=>s.criticite>=15&&s.statut!=="clos").sort((s,l)=>l.criticite-s.criticite).slice(0,3),z=te.map(s=>({nom:s.nom,avancement:s.avancement,budget:Math.round(s.budgetConsomme/s.budget*100),statut:s.statut})),re=s=>{switch(s){case"atteint":return e.jsx(c,{variant:"success",children:"Atteint"});case"en_cours":return e.jsx(c,{variant:"info",children:"En cours"});case"en_retard":return e.jsx(c,{variant:"error",children:"En retard"});case"a_risque":return e.jsx(c,{variant:"warning",children:"À risque"});default:return e.jsx(c,{variant:"default",children:"À venir"})}},ie=s=>{switch(s){case"atteint":return e.jsx(v,{className:"w-5 h-5 text-success"});case"en_cours":return e.jsx(H,{className:"w-5 h-5 text-info fill-info/20"});case"en_retard":return e.jsx(be,{className:"w-5 h-5 text-error"});case"a_risque":return e.jsx(y,{className:"w-5 h-5 text-warning"});default:return e.jsx(H,{className:"w-5 h-5 text-primary-300"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-xl relative",style:{backgroundColor:t.couleurTheme},children:[t.code.substring(0,2),e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-info rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-2.5 h-2.5 text-white"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:t.nom}),e.jsx(c,{variant:"info",children:"Mode Projet"})]}),e.jsxs("p",{className:"text-primary-500",children:["Phase: ",d.phaseActuelle]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[Y&&e.jsx(m,{variant:"secondary",onClick:()=>k(!0),leftIcon:e.jsx(T,{className:"w-4 h-4"}),className:"text-success border-success hover:bg-success/10",children:"Activer exploitation"}),Z&&e.jsxs(c,{variant:"warning",className:"flex items-center gap-1 px-3 py-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Période de transition"]}),e.jsx(m,{variant:"secondary",onClick:()=>i(`/centre/${r}/projet/jalons`),rightIcon:e.jsx(O,{className:"w-4 h-4"}),children:"Planning"}),e.jsx(m,{onClick:()=>i(`/centre/${r}/projet/recrutement`),rightIcon:e.jsx(O,{className:"w-4 h-4"}),children:"Recrutement"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(V,{title:"Soft Opening",targetDate:d.dateSoftOpening,icon:S,color:"#f59e0b"}),e.jsx(V,{title:"Inauguration",targetDate:d.dateInauguration,icon:ve,color:"#22c55e"})]}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Indicateurs de progression"]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{label:"Jalons atteints",current:a.jalonsAtteints,total:a.jalonsTotal,icon:v,color:"#22c55e"}),e.jsx(b,{label:"Postes recrutés",current:a.postesRecrutes,total:a.postesTotal,icon:_,color:"#3b82f6"}),e.jsx(b,{label:"Occupation commerciale",current:a.glaSigne,total:a.glaTotal,icon:E,color:"#8b5cf6"}),e.jsx(b,{label:"BEFA complets",current:a.befaComplets,total:a.befaTotal,icon:L,color:"#f59e0b"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(u,{action:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>i(`/centre/${r}/projet/budget`),children:"Détails"}),children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Budget projet"]})}),e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Consommé"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-900",children:[(a.budgetConsomme/1e6).toFixed(1),"M",e.jsx("span",{className:"text-lg text-primary-400 font-normal",children:" FCFA"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-primary-500",children:"Budget total"}),e.jsxs("p",{className:"text-xl font-semibold text-primary-700",children:[(a.budgetTotal/1e6).toFixed(1),"M FCFA"]})]})]}),e.jsx("div",{className:"h-3 bg-primary-100 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:`h-full rounded-full transition-all ${a.ecartBudget>5?"bg-error":a.ecartBudget>0?"bg-warning":"bg-success"}`,style:{width:`${Math.min(100,a.budgetConsomme/a.budgetTotal*100)}%`}})}),e.jsxs("p",{className:`text-sm ${a.ecartBudget>0?"text-error":"text-success"}`,children:[a.ecartBudget>0?"+":"",a.ecartBudget,"% par rapport au budget"]})]})]}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{children:"Avancement des phases"})}),e.jsx(p,{children:e.jsx("div",{className:"h-64",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(le,{data:z,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#e5e5e5"}),e.jsx(oe,{type:"number",domain:[0,100],tick:{fill:"#737373",fontSize:12}}),e.jsx(de,{dataKey:"nom",type:"category",width:100,tick:{fill:"#737373",fontSize:12}}),e.jsx(xe,{formatter:s=>[`${s}%`,"Avancement"],contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(me,{dataKey:"avancement",radius:[0,4,4,0],children:z.map((s,l)=>e.jsx(he,{fill:s.statut==="termine"?"#22c55e":s.statut==="en_cours"?"#3b82f6":"#d4d4d4"},`cell-${l}`))})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(u,{action:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>i(`/centre/${r}/projet/jalons`),children:"Voir tout"}),children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Prochains jalons"]})}),e.jsx(p,{children:B.length>0?e.jsx("div",{className:"space-y-3",children:B.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-50 rounded-xl hover:bg-primary-100 transition-colors cursor-pointer",onClick:()=>i(`/centre/${r}/projet/jalons`),children:[e.jsxs("div",{className:"flex flex-col items-center",children:[ie(s.statut),l<B.length-1&&e.jsx("div",{className:"w-0.5 h-8 bg-primary-200 mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs text-primary-500",children:s.code}),e.jsx(c,{variant:s.importance==="critique"?"error":s.importance==="majeur"?"warning":"default",size:"sm",children:s.importance})]}),e.jsx("p",{className:"font-medium text-primary-900",children:s.titre}),e.jsx("p",{className:"text-xs text-primary-500",children:G(new Date(s.dateCible),"dd MMMM yyyy",{locale:K})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[re(s.statut),e.jsx(ye,{className:"w-4 h-4 text-primary-400"})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-primary-500",children:"Tous les jalons sont atteints"})]})})]}),e.jsxs(h,{children:[e.jsx(u,{action:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>i(`/centre/${r}/projet/risques`),children:"Voir tout"}),children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-warning"}),"Risques critiques"]})}),e.jsxs(p,{children:[R.length>0?e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsxs("div",{className:"p-4 bg-error/5 border border-error/10 rounded-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs text-primary-500",children:s.code}),e.jsx("p",{className:"font-medium text-primary-900",children:s.titre})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-error/10 rounded-full",children:[e.jsx("span",{className:"text-xs font-bold text-error",children:s.criticite}),e.jsx("span",{className:"text-xs text-error",children:"/25"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-primary-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"P:"})," ",s.probabilite,"/5"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"I:"})," ",s.impact,"/5"]}),e.jsx(c,{variant:"default",size:"sm",children:s.categorie})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-primary-500",children:"Aucun risque critique identifié"})]}),a.reservesBloquantes>0&&e.jsxs("div",{className:"mt-4 p-4 bg-warning/10 border border-warning/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-warning",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:[a.reservesBloquantes," réserve(s) bloquante(s)"]})]}),e.jsxs("p",{className:"text-sm text-primary-600 mt-1",children:[a.reservesTotales," réserves ouvertes au total"]})]})]})]})]}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{children:"Navigation rapide"})}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[{label:"Jalons",icon:S,path:"jalons",color:"#3b82f6"},{label:"Recrutement",icon:_,path:"recrutement",color:"#22c55e"},{label:"Commercial",icon:E,path:"commercial",color:"#8b5cf6"},{label:"Handover",icon:L,path:"handover",color:"#f59e0b"},{label:"Budget",icon:J,path:"budget",color:"#ec4899"},{label:"Risques",icon:y,path:"risques",color:"#ef4444"}].map(s=>e.jsxs("button",{onClick:()=>i(`/centre/${r}/projet/${s.path}`),className:"flex flex-col items-center gap-2 p-4 bg-primary-50 rounded-xl hover:bg-primary-100 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center transition-transform group-hover:scale-110",style:{backgroundColor:`${s.color}15`},children:e.jsx(s.icon,{className:"w-6 h-6",style:{color:s.color}})}),e.jsx("span",{className:"text-sm font-medium text-primary-700",children:s.label})]},s.path))})})]}),e.jsx(ge,{isOpen:X,onClose:()=>k(!1),onConfirm:Q,title:"Activer le mode exploitation",message:"Le centre entrera en période de transition avec accès simultané au mode projet et au mode exploitation. Cela permet de préparer l'exploitation tout en finalisant le projet de lancement.",confirmLabel:"Activer",variant:"default"})]})}export{qe as ProjetDashboard};

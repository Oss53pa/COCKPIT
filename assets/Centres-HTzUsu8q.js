import{j as e}from"./vendor-charts-cvMpHz0W.js";import{d as F,r as i}from"./vendor-react-BdB5Pz3t.js";import{a as _,b as z,u as B,B as c,C as b,g as N,h as P,i as V}from"./index-IaNwoOYO.js";import{B as y}from"./Badge-CM23X0aP.js";import{I as l,S as G}from"./Input-BZ7duGHL.js";import{M as q,C as R}from"./Modal-J_gxoCCM.js";import{ab as Y,d as $,ad as H,ae as K,_ as U,af as X,K as J,T as h,f as Q}from"./vendor-icons-B6Rt7gcW.js";import{f as W}from"./vendor-utils-BBD155gO.js";import{f as Z}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";function ue(){const C=F(),{centres:f,loadCentres:w,addCentre:S,updateCentre:A,deleteCentre:E}=_(),{initializeDefaultAxes:O}=z(),{setCurrentCentre:L,addToast:o}=B(),[T,n]=i.useState(!1),[M,m]=i.useState(!1),[r,u]=i.useState(null),[v,d]=i.useState(null),[a,t]=i.useState({code:"",nom:"",adresse:"",ville:"",dateOuverture:"",surfaceTotale:0,surfaceLocative:0,nombreNiveaux:1,nombreLocaux:0,statut:"actif",modeExploitationActif:!0,couleurTheme:"#171717"});i.useEffect(()=>{w()},[]);const x=()=>{t({code:"",nom:"",adresse:"",ville:"",dateOuverture:"",surfaceTotale:0,surfaceLocative:0,nombreNiveaux:1,nombreLocaux:0,statut:"actif",modeExploitationActif:!0,couleurTheme:"#171717"}),u(null)},p=s=>{s?(u(s),t({code:s.code,nom:s.nom,adresse:s.adresse,ville:s.ville,dateOuverture:s.dateOuverture,surfaceTotale:s.surfaceTotale,surfaceLocative:s.surfaceLocative,nombreNiveaux:s.nombreNiveaux,nombreLocaux:s.nombreLocaux,statut:s.statut,modeExploitationActif:s.modeExploitationActif??s.statut==="actif",couleurTheme:s.couleurTheme})):x(),n(!0),d(null)},k=async()=>{try{if(r)await A(r.id,a),o({type:"success",title:"Centre modifié avec succès"});else{const s=await S({...a,configuration:{deviseMonetaire:"XOF",exerciceFiscal:{debut:1,fin:12},objectifsAnnee:new Date().getFullYear(),seuilsAlerte:{kpiRouge:70,kpiOrange:90,retardAction:3,rappelSaisie:5}}});await O(s.id),o({type:"success",title:"Centre créé avec succès"})}n(!1),x()}catch(s){o({type:"error",title:"Erreur",message:String(s)})}},D=async()=>{if(r)try{await E(r.id),o({type:"success",title:"Centre supprimé"}),m(!1),u(null)}catch(s){o({type:"error",title:"Erreur de suppression",message:String(s)})}},g=s=>{L(s.id),C(`/centre/${s.id}`),d(null)},I=[{value:"en_construction",label:"En construction"},{value:"actif",label:"En exploitation"},{value:"inactif",label:"Inactif"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Centres commerciaux"}),e.jsx("p",{className:"text-primary-500 mt-1",children:"Gérez vos centres commerciaux"})]}),e.jsx(c,{leftIcon:e.jsx(Y,{className:"w-4 h-4"}),onClick:()=>p(),children:"Nouveau centre"})]}),f.length===0?e.jsx(b,{children:e.jsxs(N,{className:"text-center py-12",children:[e.jsx($,{className:"w-12 h-12 text-primary-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-primary-900 mb-2",children:"Aucun centre enregistré"}),e.jsx("p",{className:"text-primary-500 mb-4",children:"Créez votre premier centre commercial pour commencer"}),e.jsx(c,{onClick:()=>p(),children:"Créer un centre"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(s=>e.jsxs(b,{className:"relative",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:s.couleurTheme},children:s.code.substring(0,2)}),e.jsxs("div",{children:[e.jsx(V,{children:s.nom}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-primary-500 mt-1",children:[e.jsx(H,{className:"w-3 h-3"}),s.ville]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>d(v===s.id?null:s.id),className:"p-1 hover:bg-primary-100 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5 text-primary-500"})}),v===s.id&&e.jsxs("div",{className:"absolute right-0 top-8 bg-white border border-primary-200 rounded-lg shadow-lg z-10 py-1 min-w-[150px]",children:[e.jsxs("button",{onClick:()=>g(s),className:"w-full px-4 py-2 text-left text-sm hover:bg-primary-50 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Voir"]}),e.jsxs("button",{onClick:()=>p(s),className:"w-full px-4 py-2 text-left text-sm hover:bg-primary-50 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Modifier"]}),e.jsxs("button",{onClick:()=>{u(s),m(!0),d(null)},className:"w-full px-4 py-2 text-left text-sm hover:bg-primary-50 flex items-center gap-2 text-error",children:[e.jsx(J,{className:"w-4 h-4"}),"Supprimer"]})]})]})]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Statut"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:s.statut==="actif"?"success":s.statut==="en_construction"?"warning":"default",children:s.statut==="actif"?"En exploitation":s.statut==="en_construction"?"En construction":"Inactif"}),s.statut==="en_construction"&&s.modeExploitationActif&&e.jsxs(y,{variant:"warning",className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Transition"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-primary-500",children:"Surface GLA"}),e.jsxs("p",{className:"font-semibold text-primary-900",children:[s.surfaceLocative.toLocaleString()," m²"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-primary-500",children:"Locaux"}),e.jsx("p",{className:"font-semibold text-primary-900",children:s.nombreLocaux})]})]}),s.dateOuverture&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-500",children:[e.jsx(Q,{className:"w-4 h-4"}),"Ouvert depuis ",W(new Date(s.dateOuverture),"MMMM yyyy",{locale:Z})]}),e.jsx(c,{variant:"secondary",className:"w-full",onClick:()=>g(s),children:"Accéder au centre"})]})})]},s.id))}),e.jsx(q,{isOpen:T,onClose:()=>{n(!1),x()},title:r?"Modifier le centre":"Nouveau centre",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",onClick:()=>n(!1),children:"Annuler"}),e.jsx(c,{onClick:k,children:r?"Enregistrer":"Créer"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Code",placeholder:"Ex: CYP",value:a.code,onChange:s=>t({...a,code:s.target.value.toUpperCase()})}),e.jsx(l,{label:"Nom",placeholder:"Nom du centre",value:a.nom,onChange:s=>t({...a,nom:s.target.value})})]}),e.jsx(l,{label:"Adresse",placeholder:"Adresse complète",value:a.adresse,onChange:s=>t({...a,adresse:s.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Ville",placeholder:"Ville",value:a.ville,onChange:s=>t({...a,ville:s.target.value})}),e.jsx(l,{label:"Date d'ouverture",type:"date",value:a.dateOuverture,onChange:s=>t({...a,dateOuverture:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Surface totale (m²)",type:"number",value:a.surfaceTotale,onChange:s=>t({...a,surfaceTotale:Number(s.target.value)})}),e.jsx(l,{label:"Surface locative GLA (m²)",type:"number",value:a.surfaceLocative,onChange:s=>t({...a,surfaceLocative:Number(s.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(l,{label:"Nombre de niveaux",type:"number",min:1,value:a.nombreNiveaux,onChange:s=>t({...a,nombreNiveaux:Number(s.target.value)})}),e.jsx(l,{label:"Nombre de locaux",type:"number",value:a.nombreLocaux,onChange:s=>t({...a,nombreLocaux:Number(s.target.value)})}),e.jsx(G,{label:"Statut",options:I,value:a.statut,onChange:s=>{const j=s.target.value;t({...a,statut:j,modeExploitationActif:j==="actif"?!0:a.modeExploitationActif})}})]}),a.statut==="en_construction"&&e.jsx("div",{className:"p-4 bg-success/10 rounded-lg border border-success/20",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.modeExploitationActif,onChange:s=>t({...a,modeExploitationActif:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-success focus:ring-success"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-success"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-primary-900",children:"Activer le mode exploitation"}),e.jsx("p",{className:"text-xs text-primary-500 mt-0.5",children:"Permet d'accéder aux modules d'exploitation en parallèle du mode projet (période de transition)"})]})]})]})}),a.statut==="actif"&&e.jsxs("div",{className:"p-3 bg-success/10 rounded-lg border border-success/20 flex items-center gap-2 text-sm",children:[e.jsx(h,{className:"w-4 h-4 text-success"}),e.jsx("span",{className:"text-primary-700",children:"Le mode exploitation est automatiquement activé pour les centres actifs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-600 mb-1",children:"Couleur du thème"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:a.couleurTheme,onChange:s=>t({...a,couleurTheme:s.target.value}),className:"w-10 h-10 rounded-lg border border-primary-200 cursor-pointer"}),e.jsx("span",{className:"text-sm text-primary-500",children:a.couleurTheme})]})]})]})}),e.jsx(R,{isOpen:M,onClose:()=>m(!1),onConfirm:D,title:"Supprimer le centre",message:`Êtes-vous sûr de vouloir supprimer "${r==null?void 0:r.nom}" ? Cette action supprimera également tous les objectifs, mesures et actions associés.`,confirmLabel:"Supprimer",variant:"danger"})]})}export{ue as Centres};

import{j as e}from"./vendor-charts-cvMpHz0W.js";import{e as we,r as i}from"./vendor-react-BdB5Pz3t.js";import{a as Ce,u as De,j as Me,B as c}from"./index-IaNwoOYO.js";import{S as y,I as f,T as Se}from"./Input-BZ7duGHL.js";import{M as U,C as Re}from"./Modal-J_gxoCCM.js";import{C as _e,o as ke,r as Oe,ab as E,f as V,X as K,a7 as Ee,h as Pe,g as Ae,ac as Ie}from"./vendor-icons-B6Rt7gcW.js";import{f as o,a as Te,e as Je,b as He,g as $e,h as qe,s as Fe,i as Le,j as ze,k as Be,m as Q}from"./vendor-utils-BBD155gO.js";import{f as W}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";const Ue={point_hebdo_cm:"Point Hebdo CM",comite_pilotage:"Comité de Pilotage",revue_mensuelle:"Revue Mensuelle",revue_trimestrielle:"Revue Trimestrielle",revue_strategique:"Revue Stratégique",one_to_one:"One-to-One",autre:"Autre"},P={point_hebdo_cm:"bg-emerald-50 border-l-emerald-500",comite_pilotage:"bg-purple-50 border-l-purple-500",revue_mensuelle:"bg-blue-50 border-l-blue-500",revue_trimestrielle:"bg-orange-50 border-l-orange-500",revue_strategique:"bg-red-50 border-l-red-500",one_to_one:"bg-cyan-50 border-l-cyan-500",autre:"bg-gray-50 border-l-gray-400"},A={point_hebdo_cm:"bg-emerald-500",comite_pilotage:"bg-purple-500",revue_mensuelle:"bg-blue-500",revue_trimestrielle:"bg-orange-500",revue_strategique:"bg-red-500",one_to_one:"bg-cyan-500",autre:"bg-gray-400"},Ve={planifiee:"Planifiée",realisee:"Réalisée",annulee:"Annulée",reportee:"Reportée"},Ke={planifiee:"bg-info/10 text-info border-info/20",realisee:"bg-success/10 text-success border-success/20",annulee:"bg-error/10 text-error border-error/20",reportee:"bg-warning/10 text-warning border-warning/20"};function at(){const{centreId:d}=we();Ce(t=>t.getCentre(d||""));const{addToast:m}=De(),{reunions:Qe,loadReunions:X,getReunionsByCentre:G,addReunion:Y,updateReunion:Z,deleteReunion:ee,changerStatut:te}=Me(),[u,N]=i.useState(new Date),[se,v]=i.useState(!1),[re,I]=i.useState(!1),[ae,p]=i.useState(!1),[s,x]=i.useState(null),[g,T]=i.useState("all"),[w,le]=i.useState("all"),[C,ie]=i.useState(""),[J,H]=i.useState(null),[r,l]=i.useState({titre:"",type:"point_hebdo_cm",date:o(new Date,"yyyy-MM-dd"),heure:"09:00",duree:60,participants:[],ordreDuJour:[],compteRendu:"",statut:"planifiee"}),[b,D]=i.useState(""),[M,S]=i.useState("");i.useEffect(()=>{d&&X(d)},[d]);const $=G(d||""),ne=$.filter(t=>!(g!=="all"&&t.type!==g||w!=="all"&&t.statut!==w||C&&!t.titre.toLowerCase().includes(C.toLowerCase()))),q=$.filter(t=>t.statut==="reportee"),oe=Te(u),ce=Je(u),de=He(oe,{weekStartsOn:0}),me=$e(ce,{weekStartsOn:0}),ue=qe({start:de,end:me}),pe=t=>ne.filter(a=>Q(new Date(a.date),t)),R=()=>{l({titre:"",type:"point_hebdo_cm",date:o(new Date,"yyyy-MM-dd"),heure:"09:00",duree:60,participants:[],ordreDuJour:[],compteRendu:"",statut:"planifiee"}),D(""),S(""),x(null)},j=(t,a)=>{if(t){x(t);const n=new Date(t.date);l({titre:t.titre,type:t.type,date:o(n,"yyyy-MM-dd"),heure:o(n,"HH:mm"),duree:t.duree,participants:[...t.participants],ordreDuJour:[...t.ordreDuJour],compteRendu:t.compteRendu||"",statut:t.statut})}else R(),a&&l(n=>({...n,date:o(a,"yyyy-MM-dd")}));v(!0)},F=t=>{x(t),p(!0)},xe=async()=>{if(!(!d||!r.titre))try{const t=new Date(`${r.date}T${r.heure}`),a={centreId:d,titre:r.titre,type:r.type,date:t.toISOString(),duree:r.duree,participants:r.participants,ordreDuJour:r.ordreDuJour,compteRendu:r.compteRendu||void 0,decisions:(s==null?void 0:s.decisions)||[],actionsCreees:(s==null?void 0:s.actionsCreees)||[],statut:r.statut};s?(await Z(s.id,a),m({type:"success",title:"Réunion modifiée"})):(await Y(a),m({type:"success",title:"Réunion créée"})),v(!1),R()}catch(t){m({type:"error",title:"Erreur",message:String(t)})}},he=async()=>{if(s)try{await ee(s.id),m({type:"success",title:"Réunion supprimée"}),I(!1),p(!1),x(null)}catch(t){m({type:"error",title:"Erreur",message:String(t)})}},L=()=>{b.trim()&&!r.participants.includes(b.trim())&&(l({...r,participants:[...r.participants,b.trim()]}),D(""))},ye=t=>{l({...r,participants:r.participants.filter(a=>a!==t)})},z=()=>{M.trim()&&(l({...r,ordreDuJour:[...r.ordreDuJour,M.trim()]}),S(""))},ge=t=>{l({...r,ordreDuJour:r.ordreDuJour.filter((a,n)=>n!==t)})},fe=async(t,a)=>{try{await te(t.id,a),m({type:"success",title:"Statut mis à jour"})}catch(n){m({type:"error",title:"Erreur",message:String(n)})}},_=[{value:"point_hebdo_cm",label:"Point Hebdo CM"},{value:"comite_pilotage",label:"Comité de Pilotage"},{value:"revue_mensuelle",label:"Revue Mensuelle"},{value:"revue_trimestrielle",label:"Revue Trimestrielle"},{value:"revue_strategique",label:"Revue Stratégique"},{value:"one_to_one",label:"One-to-One"},{value:"autre",label:"Autre"}],B=[{value:"planifiee",label:"Planifiée"},{value:"realisee",label:"Réalisée"},{value:"reportee",label:"Reportée"},{value:"annulee",label:"Annulée"}],ve=[{value:"30",label:"30 min"},{value:"60",label:"1h"},{value:"90",label:"1h30"},{value:"120",label:"2h"},{value:"180",label:"3h"},{value:"240",label:"4h"}],be=["DIMANCHE","LUNDI","MARDI","MERCREDI","JEUDI","VENDREDI","SAMEDI"];return e.jsxs("div",{className:"flex gap-6 h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{options:[{value:"all",label:"Tous les types"},..._],value:g,onChange:t=>T(t.target.value),className:"w-44"}),e.jsx(y,{options:[{value:"all",label:"Tous les statuts"},...B],value:w,onChange:t=>le(t.target.value),className:"w-40"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-primary-900 capitalize",children:o(u,"MMMM yyyy",{locale:W})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>N(Fe(u,1)),className:"p-2 hover:bg-primary-100 rounded-lg transition-colors",children:e.jsx(_e,{className:"w-5 h-5 text-primary-600"})}),e.jsx("button",{onClick:()=>N(new Date),className:"px-3 py-1.5 text-sm font-medium bg-primary-900 text-white rounded-lg hover:bg-primary-800 transition-colors",children:"Aujourd'hui"}),e.jsx("button",{onClick:()=>N(Le(u,1)),className:"p-2 hover:bg-primary-100 rounded-lg transition-colors",children:e.jsx(ke,{className:"w-5 h-5 text-primary-600"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher...",value:C,onChange:t=>ie(t.target.value),className:"pl-9 pr-4 py-2 border border-primary-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 w-48"})]})]}),e.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-primary-200 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-primary-200",children:be.map((t,a)=>e.jsx("div",{className:`py-3 text-center text-xs font-semibold tracking-wider ${a===0||a===6?"text-primary-400":"text-primary-600"}`,children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 flex-1",style:{gridAutoRows:"1fr"},children:ue.map((t,a)=>{const n=pe(t),k=ze(t,u),je=Be(t),Ne=J&&Q(t,J),O=3;return e.jsxs("div",{onMouseEnter:()=>H(t),onMouseLeave:()=>H(null),className:`min-h-[120px] border-b border-r border-primary-100 p-1 relative ${k?"bg-white":"bg-primary-50/50"} ${a%7===0?"border-l-0":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 px-1",children:[e.jsx("span",{className:`text-sm font-medium ${je?"bg-primary-900 text-white w-7 h-7 rounded-full flex items-center justify-center":k?"text-primary-700":"text-primary-300"}`,children:o(t,"d")}),Ne&&k&&e.jsx("button",{onClick:()=>j(void 0,t),className:"text-xs text-primary-400 hover:text-primary-600 transition-colors",children:"+ Ajouter"})]}),e.jsxs("div",{className:"space-y-1",children:[n.slice(0,O).map(h=>e.jsxs("div",{onClick:()=>F(h),className:`px-2 py-1 text-xs rounded cursor-pointer border-l-[3px] hover:opacity-80 transition-opacity ${P[h.type]}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${A[h.type]}`}),e.jsx("span",{className:"text-primary-600 font-medium",children:o(new Date(h.date),"HH:mm")})]}),e.jsx("div",{className:"text-primary-800 truncate font-medium",children:h.titre})]},h.id)),n.length>O&&e.jsxs("button",{onClick:()=>{},className:"text-xs text-primary-500 hover:text-primary-700 pl-2",children:["Voir ",n.length-O," de plus"]})]})]},t.toISOString())})})]})]}),e.jsxs("div",{className:"w-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-primary-900",children:"Réunions reportées"}),e.jsx(c,{size:"sm",leftIcon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>j(),children:"Nouvelle"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-primary-200 flex-1 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-3 border-b border-primary-100",children:e.jsx(y,{options:_,value:g==="all"?"":g,onChange:t=>T(t.target.value||"all"),className:"w-full"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:q.length===0?e.jsxs("div",{className:"text-center py-8 text-primary-400",children:[e.jsx(V,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Aucune réunion reportée"})]}):q.map(t=>e.jsxs("div",{onClick:()=>F(t),className:`p-3 rounded-lg border-l-[3px] cursor-pointer hover:shadow-md transition-shadow ${P[t.type]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${A[t.type]}`}),e.jsx("span",{className:"text-xs text-primary-500",children:o(new Date(t.date),"HH:mm")})]}),e.jsx("div",{className:"text-sm font-medium text-primary-800 line-clamp-2",children:t.titre}),t.ordreDuJour.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-primary-500",children:[t.ordreDuJour.length," point(s) à l'ordre du jour"]})]},t.id))}),e.jsx("div",{className:"p-3 border-t border-primary-100",children:e.jsx("button",{onClick:()=>j(),className:"w-full py-2 text-sm font-medium text-white bg-emerald-500 hover:bg-emerald-600 rounded-lg transition-colors",children:"+ Ajouter une réunion"})})]})]}),e.jsx(U,{isOpen:se,onClose:()=>{v(!1),R()},title:s?"Modifier la réunion":"Nouvelle réunion",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",onClick:()=>v(!1),children:"Annuler"}),e.jsx(c,{onClick:xe,children:s?"Enregistrer":"Créer"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{label:"Titre",value:r.titre,onChange:t=>l({...r,titre:t.target.value}),placeholder:"Ex: Point hebdomadaire avec l'équipe"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(y,{label:"Type de réunion",options:_,value:r.type,onChange:t=>l({...r,type:t.target.value})}),e.jsx(y,{label:"Statut",options:B,value:r.statut,onChange:t=>l({...r,statut:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(f,{label:"Date",type:"date",value:r.date,onChange:t=>l({...r,date:t.target.value})}),e.jsx(f,{label:"Heure",type:"time",value:r.heure,onChange:t=>l({...r,heure:t.target.value})}),e.jsx(y,{label:"Durée",options:ve,value:String(r.duree),onChange:t=>l({...r,duree:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-600 mb-2",children:"Participants"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(f,{value:b,onChange:t=>D(t.target.value),placeholder:"Nom du participant",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),L())}}),e.jsx(c,{variant:"secondary",onClick:L,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.participants.map((t,a)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm",children:[t,e.jsx("button",{onClick:()=>ye(t),className:"hover:text-error",children:e.jsx(K,{className:"w-3 h-3"})})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-600 mb-2",children:"Ordre du jour"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(f,{value:M,onChange:t=>S(t.target.value),placeholder:"Ajouter un point",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),z())}}),e.jsx(c,{variant:"secondary",onClick:z,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-1",children:r.ordreDuJour.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-primary-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[a+1,". ",t]}),e.jsx("button",{onClick:()=>ge(a),className:"text-primary-400 hover:text-error",children:e.jsx(K,{className:"w-4 h-4"})})]},a))})]}),s&&e.jsx(Se,{label:"Compte-rendu",rows:4,value:r.compteRendu,onChange:t=>l({...r,compteRendu:t.target.value}),placeholder:"Résumé de la réunion..."})]})}),e.jsx(U,{isOpen:ae,onClose:()=>{p(!1),x(null)},title:(s==null?void 0:s.titre)||"",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",onClick:()=>{p(!1),x(null)},children:"Fermer"}),e.jsx(c,{variant:"secondary",onClick:()=>{p(!1),s&&j(s)},children:"Modifier"}),(s==null?void 0:s.statut)==="planifiee"&&e.jsx(c,{onClick:()=>{s&&(fe(s,"realisee"),p(!1))},children:"Marquer comme réalisée"})]}),children:s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Type"}),e.jsxs("div",{className:`mt-1 inline-flex items-center gap-2 text-sm px-3 py-1.5 rounded-lg ${P[s.type]} border-l-[3px]`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${A[s.type]}`}),Ue[s.type]]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Statut"}),e.jsx("p",{className:`mt-1 inline-block text-sm px-2 py-1 rounded-full border ${Ke[s.statut]}`,children:Ve[s.statut]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Date & Heure"}),e.jsxs("p",{className:"mt-1 font-medium flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-primary-400"}),o(new Date(s.date),"EEEE dd MMMM yyyy à HH:mm",{locale:W})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Durée"}),e.jsxs("p",{className:"mt-1 font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-primary-400"}),s.duree," minutes"]})]})]}),s.participants.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-500 mb-2 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Participants (",s.participants.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.participants.map((t,a)=>e.jsx("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 rounded-full text-sm",children:t},a))})]}),s.ordreDuJour.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-500 mb-2 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Ordre du jour"]}),e.jsx("ol",{className:"list-decimal list-inside space-y-1",children:s.ordreDuJour.map((t,a)=>e.jsx("li",{className:"text-sm text-primary-700",children:t},a))})]}),s.compteRendu&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-primary-500 mb-2",children:"Compte-rendu"}),e.jsx("div",{className:"p-3 bg-primary-50 rounded-lg text-sm text-primary-700 whitespace-pre-wrap",children:s.compteRendu})]}),s.decisions.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-primary-500 mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Décisions (",s.decisions.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.decisions.map(t=>e.jsxs("div",{className:"p-3 bg-primary-50 rounded-lg border border-primary-100",children:[e.jsx("p",{className:"text-sm text-primary-700",children:t.description}),t.echeance&&e.jsxs("p",{className:"text-xs text-primary-500 mt-1",children:["Échéance: ",o(new Date(t.echeance),"dd/MM/yyyy")]})]},t.id))})]})]})}),e.jsx(Re,{isOpen:re,onClose:()=>I(!1),onConfirm:he,title:"Supprimer la réunion",message:`Êtes-vous sûr de vouloir supprimer "${s==null?void 0:s.titre}" ?`,confirmLabel:"Supprimer",variant:"danger"})]})}export{at as Agenda};

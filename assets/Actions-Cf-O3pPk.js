import{j as s}from"./vendor-charts-cvMpHz0W.js";import{e as es,r as i}from"./vendor-react-BdB5Pz3t.js";import{a as ss,u as ts,b as as,d as rs,B as u,C as ls,g as ns}from"./index-IaNwoOYO.js";import{B as N,P as le,S as V}from"./Badge-CM23X0aP.js";import{S as p,I as h,T as ne}from"./Input-BZ7duGHL.js";import{M as is,C as cs}from"./Modal-J_gxoCCM.js";import{ab as w,r as os,aa as ds,a9 as ms,a6 as us,a8 as xs,C as ps,o as hs,af as ie,K as ce,f as X,ac as oe,ag as G,A as de,ah as bs,h as gs,X as W,q as fs,ae as vs,a7 as js}from"./vendor-icons-B6Rt7gcW.js";import{f as x,b as ys,a as Ns,g as ws,e as Cs,h as Ds,s as As,i as Ss,j as ks,k as Ms,l as me,d as ue,v as xe}from"./vendor-utils-BBD155gO.js";import{f as Es}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";const P={critique:"bg-error",haute:"bg-warning",moyenne:"bg-info",basse:"bg-success"},H={critique:"border-l-error",haute:"border-l-warning",moyenne:"border-l-info",basse:"border-l-success"};function Vs(){const{centreId:d}=es(),B=ss(e=>e.getCentre(d||"")),{addToast:f}=ts(),{axes:Is,loadAxes:pe,getAxesByCentre:he,objectifs:$s,loadObjectifs:be,getObjectifsByCentre:ge,getObjectifsByAxe:fe}=as(),{actions:Ts,loadActions:ve,getActionsByCentre:je,addAction:ye,updateAction:J,deleteAction:Ne,changerStatut:we}=rs(),[b,k]=i.useState("calendar"),[Ce,C]=i.useState(!1),[De,M]=i.useState(!1),[c,E]=i.useState(null),[I,Ae]=i.useState("all"),[$,Se]=i.useState("all"),[T,ke]=i.useState("all"),[O,Me]=i.useState(""),[v,F]=i.useState(new Date),[Os,D]=i.useState(null),[t,n]=i.useState({titre:"",description:"",axeId:"",objectifId:"",priorite:"moyenne",statut:"a_faire",responsableId:"",contributeurs:[],dateDebut:x(new Date,"yyyy-MM-dd"),dateEcheance:"",dateRealisation:"",avancement:0,budget:{prevu:0,consomme:0,devise:"XOF"},sousActions:[],risques:[]}),[j,L]=i.useState("general"),[A,z]=i.useState(""),[q,U]=i.useState(""),[m,y]=i.useState({description:"",probabilite:"moyenne",impact:"moyen",mitigation:""});i.useEffect(()=>{d&&(pe(d),be(d),ve(d))},[d]);const S=he(d||""),Q=je(d||""),Ee=ge(d||""),Ie=t.axeId?fe(t.axeId):Ee,o=i.useMemo(()=>Q.filter(e=>!(I!=="all"&&e.axeId!==I||$!=="all"&&e.priorite!==$||T!=="all"&&e.statut!==T||O&&!e.titre.toLowerCase().includes(O.toLowerCase()))),[Q,I,$,T,O]),Y=o.filter(e=>!e.dateEcheance&&e.statut!=="termine"&&e.statut!=="annule"),Z={a_faire:o.filter(e=>e.statut==="a_faire"),en_cours:o.filter(e=>e.statut==="en_cours"),en_attente:o.filter(e=>e.statut==="en_attente"),termine:o.filter(e=>e.statut==="termine"),annule:o.filter(e=>e.statut==="annule")},$e={a_faire:"À faire",en_cours:"En cours",en_attente:"En attente",termine:"Terminé",annule:"Annulé"},Te={a_faire:"bg-primary-100 border-primary-300",en_cours:"bg-info/10 border-info/30",en_attente:"bg-warning/10 border-warning/30",termine:"bg-success/10 border-success/30",annule:"bg-error/10 border-error/30"},Oe=i.useMemo(()=>{const e=ys(Ns(v),{weekStartsOn:0}),a=ws(Cs(v),{weekStartsOn:0});return Ds({start:e,end:a})},[v]),qe=i.useMemo(()=>{const e={};return o.forEach(a=>{if(a.dateEcheance){const r=x(new Date(a.dateEcheance),"yyyy-MM-dd");e[r]||(e[r]=[]),e[r].push(a)}}),e},[o]),K=()=>{n({titre:"",description:"",axeId:"",objectifId:"",priorite:"moyenne",statut:"a_faire",responsableId:"",contributeurs:[],dateDebut:x(new Date,"yyyy-MM-dd"),dateEcheance:"",dateRealisation:"",avancement:0,budget:{prevu:0,consomme:0,devise:"EUR"},sousActions:[],risques:[]}),E(null),L("general"),z(""),U(""),y({description:"",probabilite:"moyenne",impact:"moyen",mitigation:""})},g=e=>{e?(E(e),n({titre:e.titre,description:e.description,axeId:e.axeId||"",objectifId:e.objectifId||"",priorite:e.priorite,statut:e.statut,responsableId:e.responsableId||"",contributeurs:e.contributeurs||[],dateDebut:e.dateDebut,dateEcheance:e.dateEcheance,dateRealisation:e.dateRealisation||"",avancement:e.avancement,budget:e.budget||{prevu:0,consomme:0,devise:"EUR"},sousActions:e.sousActions||[],risques:e.risques||[]})):K(),L("general"),C(!0)},_e=async()=>{if(d){if(!t.titre.trim()){f({type:"error",title:"Erreur",message:"Le titre est obligatoire"});return}try{const e={...t,centreId:d,commentaires:(c==null?void 0:c.commentaires)||[]};c?(await J(c.id,e),f({type:"success",title:"Action modifiée"})):(await ye(e),f({type:"success",title:"Action créée"})),C(!1),K()}catch(e){f({type:"error",title:"Erreur",message:String(e)})}}},ee=()=>{if(!q.trim())return;const e={id:xe(),description:q,statut:"a_faire",echeance:t.dateEcheance||"",avancement:0};n({...t,sousActions:[...t.sousActions,e]}),U("")},Re=e=>{n({...t,sousActions:t.sousActions.filter(a=>a.id!==e)})},Pe=e=>{n({...t,sousActions:t.sousActions.map(a=>a.id===e?{...a,statut:a.statut==="termine"?"a_faire":"termine",avancement:a.statut==="termine"?0:100}:a)})},se=()=>{!A.trim()||t.contributeurs.includes(A.trim())||(n({...t,contributeurs:[...t.contributeurs,A.trim()]}),z(""))},Be=e=>{n({...t,contributeurs:t.contributeurs.filter(a=>a!==e)})},Fe=()=>{if(!m.description.trim())return;const e={id:xe(),...m};n({...t,risques:[...t.risques,e]}),y({description:"",probabilite:"moyenne",impact:"moyen",mitigation:""})},Le=e=>{n({...t,risques:t.risques.filter(a=>a.id!==e)})};i.useEffect(()=>{if(t.sousActions.length>0){const e=t.sousActions.length,a=t.sousActions.filter(l=>l.statut==="termine").length,r=Math.round(a/e*100);r!==t.avancement&&n(l=>({...l,avancement:r}))}},[t.sousActions]);const ze=async()=>{if(c)try{await Ne(c.id),f({type:"success",title:"Action supprimée"}),M(!1),E(null)}catch(e){f({type:"error",title:"Erreur",message:String(e)})}},Ue=(e,a)=>{e.dataTransfer.setData("actionId",a.id),e.dataTransfer.setData("dragType","kanban"),D(a)},Ke=async(e,a)=>{e.preventDefault();const r=e.dataTransfer.getData("actionId"),l=e.dataTransfer.getData("dragType");r&&l==="kanban"&&(await we(r,a),f({type:"success",title:"Statut mis à jour"})),D(null)},Ve=(e,a)=>{e.dataTransfer.setData("actionId",a.id),e.dataTransfer.setData("dragType","calendar"),D(a)},Xe=async(e,a)=>{e.preventDefault();const r=e.dataTransfer.getData("actionId"),l=e.dataTransfer.getData("dragType");r&&(l==="calendar"||l==="unscheduled")&&(await J(r,{dateEcheance:x(a,"yyyy-MM-dd")}),f({type:"success",title:"Date mise à jour"})),D(null)},Ge=(e,a)=>{e.dataTransfer.setData("actionId",a.id),e.dataTransfer.setData("dragType","unscheduled"),D(a)},te=e=>{e.preventDefault()},ae=[{value:"critique",label:"Critique"},{value:"haute",label:"Haute"},{value:"moyenne",label:"Moyenne"},{value:"basse",label:"Basse"}],re=[{value:"a_faire",label:"À faire"},{value:"en_cours",label:"En cours"},{value:"en_attente",label:"En attente"},{value:"termine",label:"Terminé"},{value:"annule",label:"Annulé"}],We=[{value:"",label:"Aucun axe"},...S.map(e=>({value:e.id,label:e.nom}))],He=({action:e,mini:a=!1})=>s.jsx("div",{draggable:!0,onDragStart:r=>Ve(r,e),onClick:()=>g(e),className:`group cursor-pointer px-2 py-1 rounded text-xs border-l-2 ${H[e.priorite]} bg-white hover:shadow-sm transition-all mb-1 truncate`,children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${P[e.priorite]}`}),s.jsx("span",{className:"truncate font-medium text-primary-900",children:e.titre})]})}),Je=({action:e})=>{const a=e.statut!=="termine"&&e.statut!=="annule"&&e.dateEcheance&&new Date(e.dateEcheance)<new Date;e.dateEcheance&&ue(new Date(e.dateEcheance),new Date);const r=S.find(l=>l.id===e.axeId);return s.jsxs("div",{draggable:!0,onDragStart:l=>Ue(l,e),className:`bg-white p-3 rounded-lg border-l-4 shadow-sm cursor-move hover:shadow-md transition-all ${H[e.priorite]} ${a?"ring-1 ring-error/30":""}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsx("h4",{className:"font-medium text-primary-900 text-sm line-clamp-2",children:e.titre}),s.jsx("button",{onClick:l=>{l.stopPropagation(),g(e)},className:"p-1 hover:bg-primary-100 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx(vs,{className:"w-4 h-4 text-primary-400"})})]}),e.description&&s.jsx("p",{className:"text-xs text-primary-500 mb-2 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[s.jsx(le,{priorite:e.priorite}),r&&s.jsxs(N,{size:"sm",children:[s.jsx("span",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:r.couleur}}),r.code]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.dateEcheance&&s.jsxs("div",{className:`flex items-center gap-1 ${a?"text-error":"text-primary-500"}`,children:[s.jsx(X,{className:"w-3 h-3"}),x(new Date(e.dateEcheance),"dd/MM")]}),s.jsxs("div",{className:"flex items-center gap-1 text-primary-500",children:[s.jsx("div",{className:"w-12 h-1 bg-primary-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-primary-700 rounded-full",style:{width:`${e.avancement}%`}})}),s.jsxs("span",{children:[e.avancement,"%"]})]})]})]})},Qe=({action:e})=>{const a=e.statut!=="termine"&&e.statut!=="annule"&&e.dateEcheance&&new Date(e.dateEcheance)<new Date,r=e.dateEcheance?ue(new Date(e.dateEcheance),new Date):null,l=S.find(_=>_.id===e.axeId);return s.jsxs("div",{className:`bg-white p-4 rounded-xl border shadow-sm hover:shadow-md transition-all cursor-pointer ${a?"border-error/30":"border-primary-200"}`,onClick:()=>g(e),children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${P[e.priorite]}`}),s.jsx(V,{statut:e.statut})]}),l&&s.jsx(N,{size:"sm",style:{backgroundColor:`${l.couleur}20`,color:l.couleur},children:l.code})]}),s.jsx("h3",{className:"font-semibold text-primary-900 mb-2",children:e.titre}),e.description&&s.jsx("p",{className:"text-sm text-primary-600 mb-3 line-clamp-2",children:e.description}),s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("div",{className:"flex items-center gap-4 text-sm text-primary-500",children:[e.dateDebut&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(X,{className:"w-4 h-4"}),x(new Date(e.dateDebut),"dd/MM")]}),e.dateEcheance&&s.jsxs("span",{className:`flex items-center gap-1 ${a?"text-error font-medium":""}`,children:[s.jsx(js,{className:"w-4 h-4"}),x(new Date(e.dateEcheance),"dd/MM"),a&&s.jsx("span",{className:"ml-1",children:"(En retard)"}),!a&&r!==null&&r<=3&&r>=0&&s.jsxs("span",{className:"ml-1 text-warning",children:["J-",r]})]})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-primary-500 mb-1",children:[s.jsx("span",{children:"Avancement"}),s.jsxs("span",{className:"font-medium",children:[e.avancement,"%"]})]}),s.jsx("div",{className:"h-2 bg-primary-100 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full rounded-full transition-all ${e.avancement===100?"bg-success":"bg-primary-700"}`,style:{width:`${e.avancement}%`}})})]})]})};return s.jsxs("div",{className:"flex gap-6 h-[calc(100vh-180px)]",children:[s.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Plans d'actions"}),s.jsx("p",{className:"text-primary-500 mt-1",children:B==null?void 0:B.nom})]}),s.jsx(u,{leftIcon:s.jsx(w,{className:"w-4 h-4"}),onClick:()=>g(),children:"Nouvelle action"})]}),s.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[s.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-[300px]",children:[s.jsx(os,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),s.jsx("input",{type:"text",value:O,onChange:e=>Me(e.target.value),placeholder:"Rechercher...",className:"w-full pl-9 pr-4 py-2 border border-primary-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500"})]}),s.jsx(p,{options:[{value:"all",label:"Tous les axes"},...S.map(e=>({value:e.id,label:e.nom}))],value:I,onChange:e=>Ae(e.target.value),className:"w-36"}),s.jsx(p,{options:[{value:"all",label:"Toutes priorités"},...ae],value:$,onChange:e=>Se(e.target.value),className:"w-36"}),s.jsx(p,{options:[{value:"all",label:"Tous statuts"},...re],value:T,onChange:e=>ke(e.target.value),className:"w-36"}),s.jsxs("div",{className:"flex border border-primary-200 rounded-lg overflow-hidden ml-auto",children:[s.jsx("button",{onClick:()=>k("calendar"),className:`p-2 flex items-center gap-1 text-sm ${b==="calendar"?"bg-primary-900 text-white":"bg-white text-primary-600 hover:bg-primary-50"}`,title:"Vue Calendrier",children:s.jsx(ds,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>k("kanban"),className:`p-2 flex items-center gap-1 text-sm ${b==="kanban"?"bg-primary-900 text-white":"bg-white text-primary-600 hover:bg-primary-50"}`,title:"Vue Kanban",children:s.jsx(ms,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>k("cards"),className:`p-2 flex items-center gap-1 text-sm ${b==="cards"?"bg-primary-900 text-white":"bg-white text-primary-600 hover:bg-primary-50"}`,title:"Vue Cartes",children:s.jsx(us,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>k("list"),className:`p-2 flex items-center gap-1 text-sm ${b==="list"?"bg-primary-900 text-white":"bg-white text-primary-600 hover:bg-primary-50"}`,title:"Vue Liste",children:s.jsx(xs,{className:"w-4 h-4"})})]})]}),b==="calendar"&&s.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-primary-200 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-primary-200",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>F(As(v,1)),className:"p-1.5 hover:bg-primary-100 rounded-lg",children:s.jsx(ps,{className:"w-5 h-5 text-primary-600"})}),s.jsx("h2",{className:"text-lg font-semibold text-primary-900 w-40 text-center",children:x(v,"MMMM yyyy",{locale:Es})}),s.jsx("button",{onClick:()=>F(Ss(v,1)),className:"p-1.5 hover:bg-primary-100 rounded-lg",children:s.jsx(hs,{className:"w-5 h-5 text-primary-600"})})]}),s.jsx(u,{variant:"secondary",size:"sm",onClick:()=>F(new Date),children:"Aujourd'hui"})]}),s.jsx("div",{className:"grid grid-cols-7 border-b border-primary-200",children:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"].map((e,a)=>s.jsx("div",{className:`py-2 text-center text-sm font-medium ${a===0||a===6?"text-primary-400":"text-primary-600"}`,children:e},e))}),s.jsx("div",{className:"flex-1 grid grid-cols-7 auto-rows-fr overflow-auto",children:Oe.map((e,a)=>{const r=x(e,"yyyy-MM-dd"),l=qe[r]||[],_=ks(e,v),Ye=Ms(e),Ze=me(e)===0||me(e)===6;return s.jsxs("div",{className:`border-b border-r border-primary-100 p-1 min-h-[100px] ${_?Ze?"bg-primary-50/30":"bg-white":"bg-primary-50/50"}`,onDrop:R=>Xe(R,e),onDragOver:te,children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:`text-sm font-medium w-6 h-6 flex items-center justify-center rounded-full ${Ye?"bg-primary-900 text-white":_?"text-primary-700":"text-primary-300"}`,children:x(e,"d")}),l.length>0&&s.jsx("button",{onClick:()=>g(),className:"p-0.5 hover:bg-primary-100 rounded text-primary-400 hover:text-primary-600",children:s.jsx(w,{className:"w-3 h-3"})})]}),s.jsxs("div",{className:"space-y-0.5 overflow-hidden",children:[l.slice(0,3).map(R=>s.jsx(He,{action:R},R.id)),l.length>3&&s.jsxs("button",{className:"text-xs text-primary-500 hover:text-primary-700 w-full text-left px-2",children:["+",l.length-3," autres"]})]})]},a)})})]}),b==="kanban"&&s.jsx("div",{className:"flex-1 overflow-x-auto",children:s.jsx("div",{className:"flex gap-4 h-full min-w-[1000px]",children:["a_faire","en_cours","en_attente","termine","annule"].map(e=>s.jsxs("div",{className:`flex-1 rounded-xl p-3 min-w-[200px] flex flex-col ${Te[e]}`,onDrop:a=>Ke(a,e),onDragOver:te,children:[s.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[s.jsx("h3",{className:"font-semibold text-primary-900 text-sm",children:$e[e]}),s.jsx(N,{size:"sm",children:Z[e].length})]}),s.jsx("div",{className:"flex-1 space-y-2 overflow-y-auto",children:Z[e].map(a=>s.jsx(Je,{action:a},a.id))})]},e))})}),b==="cards"&&s.jsx("div",{className:"flex-1 overflow-auto",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[o.map(e=>s.jsx(Qe,{action:e},e.id)),o.length===0&&s.jsx("div",{className:"col-span-full text-center py-12 text-primary-500",children:"Aucune action trouvée"})]})}),b==="list"&&s.jsx("div",{className:"flex-1 overflow-auto",children:s.jsx(ls,{className:"h-full",children:s.jsx(ns,{className:"p-0",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-primary-50 sticky top-0",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Action"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Axe"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Priorité"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Statut"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Échéance"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700",children:"Avancement"}),s.jsx("th",{className:"py-3 px-4"})]})}),s.jsx("tbody",{children:o.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center py-8 text-primary-500",children:"Aucune action trouvée"})}):o.map(e=>{const a=S.find(l=>l.id===e.axeId),r=e.statut!=="termine"&&e.statut!=="annule"&&e.dateEcheance&&new Date(e.dateEcheance)<new Date;return s.jsxs("tr",{className:`border-b border-primary-100 hover:bg-primary-50 cursor-pointer ${r?"bg-error/5":""}`,onClick:()=>g(e),children:[s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${P[e.priorite]}`}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-primary-900",children:e.titre}),e.description&&s.jsx("p",{className:"text-xs text-primary-500 line-clamp-1 max-w-[200px]",children:e.description})]})]})}),s.jsx("td",{className:"py-3 px-4",children:a?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-3 h-3 rounded",style:{backgroundColor:a.couleur}}),s.jsx("span",{className:"text-sm",children:a.code})]}):s.jsx("span",{className:"text-primary-400",children:"—"})}),s.jsx("td",{className:"py-3 px-4",children:s.jsx(le,{priorite:e.priorite})}),s.jsx("td",{className:"py-3 px-4",children:s.jsx(V,{statut:e.statut})}),s.jsx("td",{className:"py-3 px-4",children:e.dateEcheance?s.jsx("span",{className:r?"text-error font-medium":"",children:x(new Date(e.dateEcheance),"dd/MM/yyyy")}):s.jsx("span",{className:"text-primary-400",children:"—"})}),s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-16 h-2 bg-primary-200 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-primary-700 rounded-full",style:{width:`${e.avancement}%`}})}),s.jsxs("span",{className:"text-sm text-primary-600",children:[e.avancement,"%"]})]})}),s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(u,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),g(e)},children:s.jsx(ie,{className:"w-4 h-4"})}),s.jsx(u,{variant:"ghost",size:"sm",onClick:l=>{l.stopPropagation(),E(e),M(!0)},children:s.jsx(ce,{className:"w-4 h-4 text-error"})})]})})]},e.id)})})]})})})})]}),b==="calendar"&&s.jsx("div",{className:"w-64 flex-shrink-0",children:s.jsxs("div",{className:"bg-white rounded-xl border border-primary-200 h-full flex flex-col",children:[s.jsxs("div",{className:"p-3 border-b border-primary-200",children:[s.jsx("h3",{className:"font-semibold text-primary-900 text-sm",children:"Non planifiées"}),s.jsx("p",{className:"text-xs text-primary-500 mt-0.5",children:"Glissez vers le calendrier"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:Y.length>0?Y.map(e=>s.jsxs("div",{draggable:!0,onDragStart:a=>Ge(a,e),onClick:()=>g(e),className:`p-3 bg-primary-50 rounded-lg border-l-4 ${H[e.priorite]} cursor-move hover:bg-primary-100 transition-colors`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${P[e.priorite]}`}),s.jsx("span",{className:"text-xs font-medium text-primary-600 capitalize",children:e.priorite})]}),s.jsx("p",{className:"text-sm font-medium text-primary-900 line-clamp-2",children:e.titre}),s.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.jsx(V,{statut:e.statut})})]},e.id)):s.jsx("div",{className:"text-center py-8 text-primary-400 text-sm",children:"Toutes les actions sont planifiées"})}),s.jsx("div",{className:"p-2 border-t border-primary-200",children:s.jsx(u,{variant:"secondary",size:"sm",className:"w-full",leftIcon:s.jsx(w,{className:"w-4 h-4"}),onClick:()=>g(),children:"Nouvelle action"})})]})}),s.jsxs(is,{isOpen:Ce,onClose:()=>{C(!1),K()},title:c?"Modifier l'action":"Nouvelle action",size:"xl",footer:s.jsxs(s.Fragment,{children:[c&&s.jsxs(u,{variant:"ghost",onClick:()=>{C(!1),M(!0)},className:"text-error mr-auto",children:[s.jsx(ce,{className:"w-4 h-4 mr-2"}),"Supprimer"]}),s.jsx(u,{variant:"ghost",onClick:()=>C(!1),children:"Annuler"}),s.jsx(u,{onClick:_e,children:c?"Enregistrer":"Créer"})]}),children:[s.jsx("div",{className:"flex border-b border-primary-200 mb-4 -mt-2",children:[{id:"general",label:"Général",icon:ie},{id:"planning",label:"Planification",icon:X},{id:"tasks",label:"Sous-actions",icon:oe},{id:"budget",label:"Budget",icon:G},{id:"risks",label:"Risques",icon:de}].map(({id:e,label:a,icon:r})=>s.jsxs("button",{type:"button",onClick:()=>L(e),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium border-b-2 transition-colors ${j===e?"border-accent text-accent":"border-transparent text-primary-500 hover:text-primary-700"}`,children:[s.jsx(r,{className:"w-4 h-4"}),a,e==="tasks"&&t.sousActions.length>0&&s.jsx(N,{size:"sm",children:t.sousActions.length}),e==="risks"&&t.risques.length>0&&s.jsx(N,{size:"sm",className:"bg-warning/10 text-warning",children:t.risques.length})]},e))}),j==="general"&&s.jsxs("div",{className:"space-y-4",children:[s.jsx(h,{label:"Titre *",value:t.titre,onChange:e=>n({...t,titre:e.target.value}),placeholder:"Titre de l'action",required:!0}),s.jsx(ne,{label:"Description",rows:3,value:t.description,onChange:e=>n({...t,description:e.target.value}),placeholder:"Décrivez l'action, ses objectifs et le contexte..."}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(p,{label:"Axe stratégique",options:We,value:t.axeId,onChange:e=>n({...t,axeId:e.target.value,objectifId:""})}),s.jsx(p,{label:"Objectif lié",options:[{value:"",label:"Aucun objectif"},...Ie.map(e=>({value:e.id,label:`${e.code} - ${e.intitule}`}))],value:t.objectifId,onChange:e=>n({...t,objectifId:e.target.value})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(h,{label:"Responsable",value:t.responsableId,onChange:e=>n({...t,responsableId:e.target.value}),placeholder:"Nom du responsable",leftIcon:s.jsx(bs,{className:"w-4 h-4"})}),s.jsx(p,{label:"Priorité",options:ae,value:t.priorite,onChange:e=>n({...t,priorite:e.target.value})})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-primary-700 mb-2",children:[s.jsx(gs,{className:"w-4 h-4 inline mr-1"}),"Contributeurs"]}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.contributeurs.map(e=>s.jsxs(N,{className:"bg-primary-100 text-primary-700 flex items-center gap-1",children:[e,s.jsx("button",{type:"button",onClick:()=>Be(e),className:"hover:text-error",children:s.jsx(W,{className:"w-3 h-3"})})]},e))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(h,{value:A,onChange:e=>z(e.target.value),placeholder:"Ajouter un contributeur",onKeyDown:e=>e.key==="Enter"&&(e.preventDefault(),se()),className:"flex-1"}),s.jsx(u,{type:"button",variant:"secondary",onClick:se,disabled:!A.trim(),children:s.jsx(w,{className:"w-4 h-4"})})]})]})]}),j==="planning"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(p,{label:"Statut",options:re,value:t.statut,onChange:e=>n({...t,statut:e.target.value})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1",children:"Avancement"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"range",min:0,max:100,value:t.avancement,onChange:e=>n({...t,avancement:Number(e.target.value)}),className:"flex-1 h-2 bg-primary-200 rounded-lg appearance-none cursor-pointer",disabled:t.sousActions.length>0}),s.jsxs("span",{className:"text-sm font-medium text-primary-700 w-12 text-right",children:[t.avancement,"%"]})]}),t.sousActions.length>0&&s.jsx("p",{className:"text-xs text-primary-500 mt-1",children:"Calculé automatiquement depuis les sous-actions"})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsx(h,{label:"Date de début",type:"date",value:t.dateDebut,onChange:e=>n({...t,dateDebut:e.target.value})}),s.jsx(h,{label:"Date d'échéance",type:"date",value:t.dateEcheance,onChange:e=>n({...t,dateEcheance:e.target.value})}),(t.statut==="termine"||t.statut==="annule")&&s.jsx(h,{label:"Date de réalisation",type:"date",value:t.dateRealisation,onChange:e=>n({...t,dateRealisation:e.target.value})})]}),s.jsxs("div",{className:"p-4 bg-primary-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-primary-700",children:"Progression globale"}),s.jsxs("span",{className:`text-lg font-bold ${t.avancement===100?"text-success":"text-primary-900"}`,children:[t.avancement,"%"]})]}),s.jsx("div",{className:"h-3 bg-primary-200 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full transition-all rounded-full ${t.avancement===100?"bg-success":t.avancement>50?"bg-info":"bg-warning"}`,style:{width:`${t.avancement}%`}})})]})]}),j==="tasks"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx(h,{value:q,onChange:e=>U(e.target.value),placeholder:"Ajouter une sous-action / tâche...",onKeyDown:e=>e.key==="Enter"&&(e.preventDefault(),ee()),className:"flex-1"}),s.jsxs(u,{type:"button",onClick:ee,disabled:!q.trim(),children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),s.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:t.sousActions.length===0?s.jsxs("div",{className:"text-center py-8 text-primary-400",children:[s.jsx(oe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"Aucune sous-action définie"}),s.jsx("p",{className:"text-xs mt-1",children:"Les sous-actions permettent de décomposer l'action en tâches plus petites"})]}):t.sousActions.map((e,a)=>s.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-colors ${e.statut==="termine"?"bg-success/5 border-success/20":"bg-white border-primary-200"}`,children:[s.jsx("button",{type:"button",onClick:()=>Pe(e.id),className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${e.statut==="termine"?"bg-success border-success text-white":"border-primary-300 hover:border-primary-500"}`,children:e.statut==="termine"&&s.jsx(fs,{className:"w-3 h-3"})}),s.jsx("span",{className:`flex-1 ${e.statut==="termine"?"line-through text-primary-400":"text-primary-900"}`,children:e.description}),s.jsx("button",{type:"button",onClick:()=>Re(e.id),className:"p-1 text-primary-400 hover:text-error transition-colors",children:s.jsx(W,{className:"w-4 h-4"})})]},e.id))}),t.sousActions.length>0&&s.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg",children:[s.jsxs("span",{className:"text-sm text-primary-600",children:[t.sousActions.filter(e=>e.statut==="termine").length," / ",t.sousActions.length," complétées"]}),s.jsx("div",{className:"w-32 h-2 bg-primary-200 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-success rounded-full transition-all",style:{width:`${t.sousActions.filter(e=>e.statut==="termine").length/t.sousActions.length*100}%`}})})]})]}),j==="budget"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsx(h,{label:"Budget prévu",type:"number",min:0,step:100,value:t.budget.prevu,onChange:e=>n({...t,budget:{...t.budget,prevu:Number(e.target.value)}}),leftIcon:s.jsx(G,{className:"w-4 h-4"})}),s.jsx(h,{label:"Budget consommé",type:"number",min:0,step:100,value:t.budget.consomme,onChange:e=>n({...t,budget:{...t.budget,consomme:Number(e.target.value)}}),leftIcon:s.jsx(G,{className:"w-4 h-4"})}),s.jsx(p,{label:"Devise",options:[{value:"XOF",label:"XOF (FCFA)"},{value:"EUR",label:"EUR (€)"},{value:"USD",label:"USD ($)"},{value:"MAD",label:"MAD (DH)"}],value:t.budget.devise,onChange:e=>n({...t,budget:{...t.budget,devise:e.target.value}})})]}),t.budget.prevu>0&&s.jsxs("div",{className:"p-4 bg-primary-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-primary-700",children:"Consommation budgétaire"}),s.jsxs("span",{className:`text-lg font-bold ${t.budget.consomme>t.budget.prevu?"text-error":t.budget.consomme>t.budget.prevu*.8?"text-warning":"text-success"}`,children:[Math.round(t.budget.consomme/t.budget.prevu*100),"%"]})]}),s.jsx("div",{className:"h-3 bg-primary-200 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full transition-all rounded-full ${t.budget.consomme>t.budget.prevu?"bg-error":t.budget.consomme>t.budget.prevu*.8?"bg-warning":"bg-success"}`,style:{width:`${Math.min(t.budget.consomme/t.budget.prevu*100,100)}%`}})}),s.jsxs("div",{className:"flex justify-between mt-2 text-xs text-primary-500",children:[s.jsxs("span",{children:["Consommé: ",t.budget.consomme.toLocaleString()," ",t.budget.devise]}),s.jsxs("span",{children:["Reste: ",Math.max(0,t.budget.prevu-t.budget.consomme).toLocaleString()," ",t.budget.devise]})]})]})]}),j==="risks"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"p-4 bg-primary-50 rounded-lg space-y-3",children:[s.jsx(h,{label:"Description du risque",value:m.description,onChange:e=>y({...m,description:e.target.value}),placeholder:"Décrivez le risque identifié..."}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(p,{label:"Probabilité",options:[{value:"faible",label:"Faible"},{value:"moyenne",label:"Moyenne"},{value:"elevee",label:"Élevée"}],value:m.probabilite,onChange:e=>y({...m,probabilite:e.target.value})}),s.jsx(p,{label:"Impact",options:[{value:"faible",label:"Faible"},{value:"moyen",label:"Moyen"},{value:"eleve",label:"Élevé"}],value:m.impact,onChange:e=>y({...m,impact:e.target.value})})]}),s.jsx(ne,{label:"Plan de mitigation",rows:2,value:m.mitigation,onChange:e=>y({...m,mitigation:e.target.value}),placeholder:"Actions prévues pour réduire ou éliminer ce risque..."}),s.jsxs(u,{type:"button",onClick:Fe,disabled:!m.description.trim(),className:"w-full",children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"Ajouter le risque"]})]}),s.jsx("div",{className:"space-y-2 max-h-[250px] overflow-y-auto",children:t.risques.length===0?s.jsxs("div",{className:"text-center py-6 text-primary-400",children:[s.jsx(de,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"Aucun risque identifié"})]}):t.risques.map(e=>{const a=e.probabilite==="elevee"?"text-error":e.probabilite==="moyenne"?"text-warning":"text-success",r=e.impact==="eleve"?"text-error":e.impact==="moyen"?"text-warning":"text-success";return s.jsx("div",{className:"p-3 bg-white border border-primary-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-primary-900",children:e.description}),s.jsxs("div",{className:"flex gap-4 mt-1 text-xs",children:[s.jsxs("span",{className:a,children:["Probabilité: ",e.probabilite]}),s.jsxs("span",{className:r,children:["Impact: ",e.impact]})]}),e.mitigation&&s.jsxs("p",{className:"text-sm text-primary-600 mt-2 p-2 bg-primary-50 rounded",children:[s.jsx("strong",{children:"Mitigation:"})," ",e.mitigation]})]}),s.jsx("button",{type:"button",onClick:()=>Le(e.id),className:"p-1 text-primary-400 hover:text-error transition-colors",children:s.jsx(W,{className:"w-4 h-4"})})]})},e.id)})})]})]}),s.jsx(cs,{isOpen:De,onClose:()=>M(!1),onConfirm:ze,title:"Supprimer l'action",message:`Êtes-vous sûr de vouloir supprimer "${c==null?void 0:c.titre}" ?`,confirmLabel:"Supprimer",variant:"danger"})]})}export{Vs as Actions};

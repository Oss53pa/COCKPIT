import{j as e}from"./vendor-charts-cvMpHz0W.js";import{e as Ne,r as o}from"./vendor-react-BdB5Pz3t.js";import{a as ye,u as we,m as Ce,B as i,C as b,h as P,i as k,n as Ae,g as N}from"./index-IaNwoOYO.js";import{S as K,T as _,I as E}from"./Input-BZ7duGHL.js";import{M as D,C as Se}from"./Modal-J_gxoCCM.js";import{g as Fe,ab as j,a7 as W,af as Pe,ak as ke,o as U,x as M,al as Ee,P as De,y as Z,X as O,T as X,am as Me,N as ee}from"./vendor-icons-B6Rt7gcW.js";import{f as Oe}from"./vendor-utils-BBD155gO.js";import{f as $e}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";const $={brouillon:"Brouillon",finalise:"Finalisée",valide:"Validée"},I={brouillon:"bg-warning/10 text-warning border-warning/20",finalise:"bg-info/10 text-info border-info/20",valide:"bg-success/10 text-success border-success/20"},Ie={brouillon:e.jsx(W,{className:"w-4 h-4"}),finalise:e.jsx(ee,{className:"w-4 h-4"}),valide:e.jsx(Z,{className:"w-4 h-4"})},Q={1:"Insuffisant",2:"À améliorer",3:"Satisfaisant",4:"Excellent"},y={1:"bg-error text-white",2:"bg-warning text-white",3:"bg-info text-white",4:"bg-success text-white"};function Ke(){const{centreId:d}=Ne(),w=ye(s=>s.getCentre(d||"")),{addToast:c}=we(),{evaluations:Ge,loadEvaluations:G,getEvaluationsByCentre:se,creerAutoEvaluation:te,updateEvaluation:ae,deleteEvaluation:re,updateCritere:Te,finaliserAutoEvaluation:ie,calculerNoteGlobale:ne}=Ce(),[le,p]=o.useState(!1),[oe,x]=o.useState(!1),[ce,T]=o.useState(!1),[de,f]=o.useState(!1),[t,n]=o.useState(null),[u,q]=o.useState({annee:new Date().getFullYear(),semestre:Math.ceil((new Date().getMonth()+1)/6)}),[C,Y]=o.useState(""),[A,z]=o.useState(""),[S,J]=o.useState("");o.useEffect(()=>{d&&G(d)},[d]);const R=se(d||""),l=R.find(s=>s.statut==="brouillon"),h=R.filter(s=>s.statut!=="brouillon"),me=async()=>{if(d)try{const s={annee:u.annee,semestre:u.semestre},a=await te(d,"self",s);n(a),p(!1),x(!0),c({type:"success",title:"Auto-évaluation créée"})}catch(s){c({type:"error",title:"Erreur",message:String(s)})}},F=s=>{n(s),x(!0)},B=async()=>{if(t)try{await ae(t.id,{criteres:t.criteres,pointsForts:t.pointsForts,axesAmelioration:t.axesAmelioration,objectifsProchainePeriode:t.objectifsProchainePeriode,commentaireGeneral:t.commentaireGeneral}),c({type:"success",title:"Brouillon sauvegardé"})}catch(s){c({type:"error",title:"Erreur",message:String(s)})}},xe=async()=>{if(!t)return;if(!t.criteres.every(a=>a.note!==void 0)){c({type:"warning",title:"Attention",message:"Veuillez noter tous les critères avant de finaliser."});return}try{await ie(t.id),c({type:"success",title:"Auto-évaluation finalisée",message:"Votre évaluation a été envoyée pour validation."}),x(!1),G(d)}catch(a){c({type:"error",title:"Erreur",message:String(a)})}},ue=async()=>{if(t)try{await re(t.id),c({type:"success",title:"Évaluation supprimée"}),T(!1),n(null)}catch(s){c({type:"error",title:"Erreur",message:String(s)})}},pe=(s,a)=>{if(!t)return;const r=t.criteres.map(m=>m.id===s?{...m,note:a}:m);n({...t,criteres:r,noteGlobale:ne(r)})},he=(s,a)=>{if(!t)return;const r=t.criteres.map(m=>m.id===s?{...m,commentaire:a}:m);n({...t,criteres:r})},H=()=>{!t||!C.trim()||(n({...t,pointsForts:[...t.pointsForts,C.trim()]}),Y(""))},je=s=>{t&&n({...t,pointsForts:t.pointsForts.filter((a,r)=>r!==s)})},L=()=>{!t||!A.trim()||(n({...t,axesAmelioration:[...t.axesAmelioration,A.trim()]}),z(""))},fe=s=>{t&&n({...t,axesAmelioration:t.axesAmelioration.filter((a,r)=>r!==s)})},V=()=>{!t||!S.trim()||(n({...t,objectifsProchainePeriode:[...t.objectifsProchainePeriode,S.trim()]}),J(""))},ve=s=>{t&&n({...t,objectifsProchainePeriode:t.objectifsProchainePeriode.filter((a,r)=>r!==s)})},v=s=>s===void 0?"text-primary-400":s>=3.5?"text-success":s>=2.5?"text-info":s>=1.5?"text-warning":"text-error",g=s=>s.semestre?`S${s.semestre} ${s.annee}`:s.trimestre?`T${s.trimestre} ${s.annee}`:s.mois?`${["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"][s.mois-1]} ${s.annee}`:String(s.annee),ge=[{value:"1",label:"1er semestre (Jan-Juin)"},{value:"2",label:"2ème semestre (Juil-Déc)"}],be=[{value:String(new Date().getFullYear()-1),label:String(new Date().getFullYear()-1)},{value:String(new Date().getFullYear()),label:String(new Date().getFullYear())},{value:String(new Date().getFullYear()+1),label:String(new Date().getFullYear()+1)}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Mon Auto-évaluation"}),e.jsx("p",{className:"text-primary-500 mt-1",children:w==null?void 0:w.nom})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h.length>0&&e.jsx(i,{variant:"secondary",leftIcon:e.jsx(Fe,{className:"w-4 h-4"}),onClick:()=>f(!0),children:"Historique"}),!l&&e.jsx(i,{leftIcon:e.jsx(j,{className:"w-4 h-4"}),onClick:()=>p(!0),children:"Nouvelle auto-évaluation"})]})]}),l?e.jsxs(b,{className:"border-2 border-warning/30",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-warning"}),"Auto-évaluation en cours"]}),e.jsxs(Ae,{children:["Période: ",g(l.periode)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${I[l.statut]}`,children:$[l.statut]})})]})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Critères remplis"}),e.jsxs("p",{className:"text-xl font-bold text-primary-900",children:[l.criteres.filter(s=>s.note!==void 0).length," / ",l.criteres.length]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Note provisoire"}),e.jsx("p",{className:`text-xl font-bold ${v(l.noteGlobale)}`,children:l.noteGlobale!==void 0?`${l.noteGlobale.toFixed(2)} / 4`:"—"})]})]}),e.jsx(i,{leftIcon:e.jsx(Pe,{className:"w-4 h-4"}),onClick:()=>F(l),children:"Continuer"})]})})]}):e.jsx(b,{children:e.jsxs(N,{className:"py-12 text-center",children:[e.jsx(ke,{className:"w-12 h-12 text-primary-300 mx-auto mb-4"}),e.jsx("p",{className:"text-primary-500 mb-4",children:"Aucune auto-évaluation en cours"}),e.jsx(i,{leftIcon:e.jsx(j,{className:"w-4 h-4"}),onClick:()=>p(!0),children:"Démarrer mon auto-évaluation"})]})}),h.length>0&&e.jsxs(b,{children:[e.jsx(P,{children:e.jsx(k,{children:"Dernière évaluation"})}),e.jsx(N,{children:(()=>{var a;const s=h[0];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Période"}),e.jsx("p",{className:"font-medium",children:g(s.periode)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Note globale"}),e.jsxs("p",{className:`text-2xl font-bold ${v(s.noteGlobale)}`,children:[(a=s.noteGlobale)==null?void 0:a.toFixed(2)," / 4"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Statut"}),e.jsxs("p",{className:`inline-flex items-center gap-1 text-sm px-2 py-1 rounded-full border ${I[s.statut]}`,children:[Ie[s.statut],$[s.statut]]})]})]}),e.jsxs(i,{variant:"ghost",onClick:()=>F(s),children:["Voir détails",e.jsx(U,{className:"w-4 h-4 ml-1"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:s.criteres.map(r=>e.jsxs("div",{className:"text-center p-2 bg-primary-50 rounded-lg",title:r.nom,children:[e.jsx("div",{className:`text-lg font-bold ${r.note?y[r.note].replace("bg-","text-").replace(" text-white",""):"text-primary-300"}`,children:r.note||"—"}),e.jsx("div",{className:"text-xs text-primary-500 truncate",children:r.nom.split(" ")[0]})]},r.id))})]})})()})]}),e.jsxs(b,{children:[e.jsx(P,{children:e.jsx(k,{children:"Guide de notation"})}),e.jsx(N,{children:e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"text-center p-4 rounded-lg bg-primary-50",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full ${y[s]} mb-2`,children:s}),e.jsx("p",{className:"font-medium text-primary-900",children:Q[s]}),e.jsxs("p",{className:"text-xs text-primary-500 mt-1",children:[s===1&&"Objectifs non atteints, difficultés importantes",s===2&&"Objectifs partiellement atteints, progression nécessaire",s===3&&"Objectifs atteints, bonne performance",s===4&&"Objectifs dépassés, performance exceptionnelle"]})]},s))})})]}),e.jsx(D,{isOpen:le,onClose:()=>p(!1),title:"Nouvelle auto-évaluation",size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",onClick:()=>p(!1),children:"Annuler"}),e.jsx(i,{onClick:me,children:"Démarrer"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-primary-600",children:"Sélectionnez la période pour votre auto-évaluation :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(K,{label:"Année",options:be,value:String(u.annee),onChange:s=>q({...u,annee:Number(s.target.value)})}),e.jsx(K,{label:"Semestre",options:ge,value:String(u.semestre),onChange:s=>q({...u,semestre:Number(s.target.value)})})]}),e.jsx("div",{className:"p-4 bg-info/10 rounded-lg border border-info/20",children:e.jsxs("p",{className:"text-sm text-info",children:[e.jsx(M,{className:"w-4 h-4 inline mr-2"}),"L'auto-évaluation vous permet de faire le point sur votre performance. Prenez le temps de réfléchir à chaque critère de manière objective."]})})]})}),e.jsx(D,{isOpen:oe,onClose:()=>{(t==null?void 0:t.statut)==="brouillon"&&B(),x(!1)},title:`Auto-évaluation - ${t?g(t.periode):""}`,size:"xl",footer:(t==null?void 0:t.statut)==="brouillon"?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",onClick:()=>x(!1),children:"Fermer"}),e.jsx(i,{variant:"secondary",leftIcon:e.jsx(Me,{className:"w-4 h-4"}),onClick:B,children:"Sauvegarder"}),e.jsx(i,{leftIcon:e.jsx(ee,{className:"w-4 h-4"}),onClick:xe,children:"Finaliser"})]}):e.jsx(i,{variant:"ghost",onClick:()=>x(!1),children:"Fermer"}),children:t&&e.jsxs("div",{className:"space-y-6 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-primary-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Note globale calculée"}),e.jsx("p",{className:`text-3xl font-bold ${v(t.noteGlobale)}`,children:t.noteGlobale!==void 0?`${t.noteGlobale.toFixed(2)} / 4`:"En attente"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Progression"}),e.jsxs("p",{className:"text-lg font-medium text-primary-700",children:[t.criteres.filter(s=>s.note!==void 0).length," / ",t.criteres.length," critères"]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-primary-900 mb-4 flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Critères d'évaluation"]}),e.jsx("div",{className:"space-y-4",children:t.criteres.map(s=>e.jsxs("div",{className:"p-4 bg-white border border-primary-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-primary-900",children:s.nom}),e.jsxs("span",{className:"text-xs text-primary-400 ml-2",children:["(",s.poids,"%)"]})]}),t.statut==="brouillon"?e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(a=>e.jsx("button",{onClick:()=>pe(s.id,a),className:`w-10 h-10 rounded-lg font-bold transition-all ${s.note===a?y[a]:"bg-primary-100 text-primary-400 hover:bg-primary-200"}`,children:a},a))}):e.jsx("div",{className:`px-3 py-1 rounded-lg font-bold ${s.note?y[s.note]:"bg-primary-100 text-primary-400"}`,children:s.note?`${s.note} - ${Q[s.note]}`:"Non noté"})]}),t.statut==="brouillon"?e.jsx(_,{placeholder:"Commentaire justificatif (optionnel)...",rows:2,value:s.commentaire||"",onChange:a=>he(s.id,a.target.value)}):s.commentaire?e.jsx("p",{className:"text-sm text-primary-600 italic",children:s.commentaire}):null]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-primary-900 mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-success"}),"Mes points forts"]}),t.statut==="brouillon"&&e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(E,{placeholder:"Ajouter un point fort...",value:C,onChange:s=>Y(s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),H())}),e.jsx(i,{variant:"secondary",onClick:H,children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.pointsForts.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-success/5 rounded-lg border border-success/20",children:[e.jsx(Z,{className:"w-4 h-4 text-success flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-sm text-primary-700",children:s}),t.statut==="brouillon"&&e.jsx("button",{onClick:()=>je(a),className:"text-primary-400 hover:text-error",children:e.jsx(O,{className:"w-4 h-4"})})]},a)),t.pointsForts.length===0&&e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucun point fort ajouté"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-primary-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-warning"}),"Mes axes d'amélioration"]}),t.statut==="brouillon"&&e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(E,{placeholder:"Ajouter un axe d'amélioration...",value:A,onChange:s=>z(s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),L())}),e.jsx(i,{variant:"secondary",onClick:L,children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.axesAmelioration.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-warning/5 rounded-lg border border-warning/20",children:[e.jsx(M,{className:"w-4 h-4 text-warning flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-sm text-primary-700",children:s}),t.statut==="brouillon"&&e.jsx("button",{onClick:()=>fe(a),className:"text-primary-400 hover:text-error",children:e.jsx(O,{className:"w-4 h-4"})})]},a)),t.axesAmelioration.length===0&&e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucun axe d'amélioration ajouté"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-primary-900 mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-info"}),"Mes objectifs pour la prochaine période"]}),t.statut==="brouillon"&&e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(E,{placeholder:"Ajouter un objectif...",value:S,onChange:s=>J(s.target.value),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),V())}),e.jsx(i,{variant:"secondary",onClick:V,children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.objectifsProchainePeriode.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-info/5 rounded-lg border border-info/20",children:[e.jsx(X,{className:"w-4 h-4 text-info flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-sm text-primary-700",children:s}),t.statut==="brouillon"&&e.jsx("button",{onClick:()=>ve(a),className:"text-primary-400 hover:text-error",children:e.jsx(O,{className:"w-4 h-4"})})]},a)),t.objectifsProchainePeriode.length===0&&e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucun objectif ajouté"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-primary-900 mb-4",children:"Commentaire général"}),t.statut==="brouillon"?e.jsx(_,{rows:4,placeholder:"Réflexions globales sur la période, contexte particulier, remarques...",value:t.commentaireGeneral||"",onChange:s=>n({...t,commentaireGeneral:s.target.value})}):t.commentaireGeneral?e.jsx("p",{className:"text-sm text-primary-600 p-3 bg-primary-50 rounded-lg",children:t.commentaireGeneral}):e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucun commentaire"})]})]})}),e.jsx(D,{isOpen:de,onClose:()=>f(!1),title:"Historique des évaluations",size:"lg",footer:e.jsx(i,{variant:"ghost",onClick:()=>f(!1),children:"Fermer"}),children:e.jsxs("div",{className:"space-y-3",children:[h.map(s=>{var a;return e.jsx("div",{className:"p-4 bg-primary-50 rounded-lg border border-primary-100 cursor-pointer hover:bg-primary-100 transition-colors",onClick:()=>{f(!1),F(s)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-primary-900",children:g(s.periode)}),s.dateEvaluation&&e.jsxs("p",{className:"text-xs text-primary-500",children:["Finalisée le ",Oe(new Date(s.dateEvaluation),"dd MMMM yyyy",{locale:$e})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-xl font-bold ${v(s.noteGlobale)}`,children:[(a=s.noteGlobale)==null?void 0:a.toFixed(2)," / 4"]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${I[s.statut]}`,children:$[s.statut]}),e.jsx(U,{className:"w-5 h-5 text-primary-400"})]})]})},s.id)}),h.length===0&&e.jsx("p",{className:"text-center text-primary-500 py-8",children:"Aucune évaluation dans l'historique"})]})}),e.jsx(Se,{isOpen:ce,onClose:()=>T(!1),onConfirm:ue,title:"Supprimer l'évaluation",message:"Êtes-vous sûr de vouloir supprimer cette auto-évaluation ?",confirmLabel:"Supprimer",variant:"danger"})]})}export{Ke as Evaluations};

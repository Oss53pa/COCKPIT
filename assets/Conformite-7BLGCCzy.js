import{j as e}from"./vendor-charts-cvMpHz0W.js";import{e as ts,r as l,b as rs}from"./vendor-react-BdB5Pz3t.js";import{a as as,u as is,l as ls,B as i,C as o,g as d,h as ne,i as ce}from"./index-IaNwoOYO.js";import{B as Q}from"./Badge-CM23X0aP.js";import{S as u,I as T,T as y}from"./Input-BZ7duGHL.js";import{M as E,C as ns}from"./Modal-J_gxoCCM.js";import{ab as C,ai as V,A as W,f as oe,a2 as cs,aj as os,y as X,i as de,P as ds,p as xs,o as ms,ah as us,g as ps,af as xe,K as me}from"./vendor-icons-B6Rt7gcW.js";import{f as w}from"./vendor-utils-BBD155gO.js";import{f as hs}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";const ue={interne:"Interne",externe:"Externe",reglementaire:"Réglementaire"},pe={interne:"bg-blue-100 text-blue-800 border-blue-200",externe:"bg-purple-100 text-purple-800 border-purple-200",reglementaire:"bg-orange-100 text-orange-800 border-orange-200"},he={planifie:"Planifié",en_cours:"En cours",termine:"Terminé",annule:"Annulé"},je={planifie:"bg-info/10 text-info border-info/20",en_cours:"bg-warning/10 text-warning border-warning/20",termine:"bg-success/10 text-success border-success/20",annule:"bg-primary-100 text-primary-500 border-primary-200"},ge={mineure:"Mineure",majeure:"Majeure",critique:"Critique"},ve={mineure:"bg-info/10 text-info border-info/20",majeure:"bg-warning/10 text-warning border-warning/20",critique:"bg-error/10 text-error border-error/20"},fe={ouverte:"Ouverte",en_cours:"En cours",cloturee:"Clôturée"},js={identifie:"Identifié",en_traitement:"En traitement",accepte:"Accepté",cloture:"Clôturé"},gs={identifie:"bg-info/10 text-info border-info/20",en_traitement:"bg-warning/10 text-warning border-warning/20",accepte:"bg-primary-100 text-primary-600 border-primary-200",cloture:"bg-success/10 text-success border-success/20"},vs=["Opérationnel","Financier","Juridique","Technique","Sécurité","Environnemental","Réputationnel","RH","Autre"];function Ts(){const{centreId:n}=ts(),F=as(s=>s.getCentre(n||"")),{addToast:x}=is(),{audits:fs,risques:bs,loadAudits:I,loadRisques:be,getAuditsByCentre:Ne,getRisquesByCentre:ye,addAudit:Ce,updateAudit:we,deleteAudit:Ae,changerStatutAudit:Ns,addNonConformite:Se,updateNonConformite:ys,cloturerNonConformite:Me,addRisque:qe,updateRisque:Re,deleteRisque:Oe,changerStatutRisque:Cs,getStatsAudits:De,getStatsRisques:Pe}=ls(),[b,Y]=l.useState("audits"),[ke,A]=l.useState(!1),[Te,S]=l.useState(!1),[Ee,M]=l.useState(!1),[Fe,q]=l.useState(!1),[Ie,$]=l.useState(!1),[t,g]=l.useState(null),[f,R]=l.useState(null),[O,Z]=l.useState("audit"),[ee,$e]=l.useState(new Set),[z,ze]=l.useState("all"),[L,Le]=l.useState("all"),[_,_e]=l.useState("all"),[c,h]=l.useState({titre:"",type:"interne",description:"",datePlanifiee:w(new Date,"yyyy-MM-dd"),auditeur:"",statut:"planifie"}),[r,p]=l.useState({categorie:"Opérationnel",description:"",probabilite:3,impact:3,proprietaire:"",planMitigation:"",statut:"identifie"}),[j,D]=l.useState({description:"",gravite:"mineure",actionCorrective:""});l.useEffect(()=>{n&&(I(n),be(n))},[n]);const se=Ne(n||""),Be=ye(n||""),N=De(n||""),P=Pe(n||""),te=se.filter(s=>!(z!=="all"&&s.type!==z||L!=="all"&&s.statut!==L)),k=Be.filter(s=>!(_!=="all"&&s.categorie!==_||s.statut==="cloture")),He=s=>{const m=new Set(ee);m.has(s)?m.delete(s):m.add(s),$e(m)},B=()=>{h({titre:"",type:"interne",description:"",datePlanifiee:w(new Date,"yyyy-MM-dd"),auditeur:"",statut:"planifie"}),g(null)},H=()=>{p({categorie:"Opérationnel",description:"",probabilite:3,impact:3,proprietaire:"",planMitigation:"",statut:"identifie"}),R(null)},U=()=>{D({description:"",gravite:"mineure",actionCorrective:""})},G=s=>{s?(g(s),h({titre:s.titre,type:s.type,description:s.description||"",datePlanifiee:w(new Date(s.datePlanifiee),"yyyy-MM-dd"),auditeur:s.auditeur,statut:s.statut})):B(),A(!0)},J=s=>{s?(R(s),p({categorie:s.categorie,description:s.description,probabilite:s.probabilite,impact:s.impact,proprietaire:s.proprietaire||"",planMitigation:s.planMitigation||"",statut:s.statut})):H(),S(!0)},Ue=s=>{g(s),U(),M(!0)},Ge=s=>{g(s),$(!0)},Je=async()=>{if(!(!n||!c.titre))try{t?(await we(t.id,c),x({type:"success",title:"Audit modifié"})):(await Ce({...c,centreId:n,nonConformites:[]}),x({type:"success",title:"Audit créé"})),A(!1),B()}catch(s){x({type:"error",title:"Erreur",message:String(s)})}},Ke=async()=>{if(!(!n||!r.description))try{f?(await Re(f.id,r),x({type:"success",title:"Risque modifié"})):(await qe({...r,centreId:n,scoreRisque:r.probabilite*r.impact,dateIdentification:new Date().toISOString()}),x({type:"success",title:"Risque créé"})),S(!1),H()}catch(s){x({type:"error",title:"Erreur",message:String(s)})}},Qe=async()=>{if(!(!t||!j.description))try{await Se(t.id,{...j,dateDetection:new Date().toISOString(),statut:"ouverte"}),x({type:"success",title:"Non-conformité ajoutée"}),M(!1),U(),I(n)}catch(s){x({type:"error",title:"Erreur",message:String(s)})}},Ve=async()=>{try{O==="audit"&&t?(await Ae(t.id),x({type:"success",title:"Audit supprimé"})):O==="risque"&&f&&(await Oe(f.id),x({type:"success",title:"Risque supprimé"})),q(!1),g(null),R(null)}catch(s){x({type:"error",title:"Erreur",message:String(s)})}},We=async(s,m)=>{try{await Me(s.id,m),x({type:"success",title:"Non-conformité clôturée"}),I(n)}catch(v){x({type:"error",title:"Erreur",message:String(v)})}},K=s=>s>=15?"bg-error text-white":s>=8?"bg-warning text-white":"bg-success text-white",Xe=s=>s>=15?"Critique":s>=8?"Moyen":"Faible",re=[{value:"interne",label:"Interne"},{value:"externe",label:"Externe"},{value:"reglementaire",label:"Réglementaire"}],ae=[{value:"planifie",label:"Planifié"},{value:"en_cours",label:"En cours"},{value:"termine",label:"Terminé"},{value:"annule",label:"Annulé"}],Ye=[{value:"mineure",label:"Mineure"},{value:"majeure",label:"Majeure"},{value:"critique",label:"Critique"}],Ze=[{value:"identifie",label:"Identifié"},{value:"en_traitement",label:"En traitement"},{value:"accepte",label:"Accepté"},{value:"cloture",label:"Clôturé"}],ie=vs.map(s=>({value:s,label:s})),es=[{value:"1",label:"1 - Très improbable"},{value:"2",label:"2 - Peu probable"},{value:"3",label:"3 - Possible"},{value:"4",label:"4 - Probable"},{value:"5",label:"5 - Très probable"}],ss=[{value:"1",label:"1 - Négligeable"},{value:"2",label:"2 - Mineur"},{value:"3",label:"3 - Modéré"},{value:"4",label:"4 - Majeur"},{value:"5",label:"5 - Critique"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Conformité"}),e.jsx("p",{className:"text-primary-500 mt-1",children:F==null?void 0:F.nom})]}),e.jsx("div",{className:"flex items-center gap-3",children:b==="audits"?e.jsxs(e.Fragment,{children:[e.jsx(u,{options:[{value:"all",label:"Tous les types"},...re],value:z,onChange:s=>ze(s.target.value),className:"w-40"}),e.jsx(u,{options:[{value:"all",label:"Tous les statuts"},...ae],value:L,onChange:s=>Le(s.target.value),className:"w-40"}),e.jsx(i,{leftIcon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>G(),children:"Nouvel audit"})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{options:[{value:"all",label:"Toutes catégories"},...ie],value:_,onChange:s=>_e(s.target.value),className:"w-44"}),e.jsx(i,{leftIcon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>J(),children:"Nouveau risque"})]})})]}),e.jsxs("div",{className:"flex border-b border-primary-200",children:[e.jsx("button",{onClick:()=>Y("audits"),className:`px-6 py-3 font-medium border-b-2 transition-colors ${b==="audits"?"border-primary-900 text-primary-900":"border-transparent text-primary-500 hover:text-primary-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Audits",e.jsx(Q,{children:se.length})]})}),e.jsx("button",{onClick:()=>Y("risques"),className:`px-6 py-3 font-medium border-b-2 transition-colors ${b==="risques"?"border-primary-900 text-primary-900":"border-transparent text-primary-500 hover:text-primary-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Risques",e.jsx(Q,{children:k.length})]})})]}),b==="audits"?e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary-900",children:N.total}),e.jsx("div",{className:"text-sm text-primary-500",children:"Audits"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-info/10 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5 text-info"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-info",children:N.planifies}),e.jsx("div",{className:"text-sm text-primary-500",children:"Planifiés"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-warning/10 rounded-lg",children:e.jsx(cs,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:N.enCours}),e.jsx("div",{className:"text-sm text-primary-500",children:"En cours"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-error/10 rounded-lg",children:e.jsx(os,{className:"w-5 h-5 text-error"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-error",children:N.ncOuvertes}),e.jsx("div",{className:"text-sm text-primary-500",children:"NC ouvertes"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-success/10 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:N.termines}),e.jsx("div",{className:"text-sm text-primary-500",children:"Terminés"})]})]})})})]}):e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(de,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary-900",children:P.total}),e.jsx("div",{className:"text-sm text-primary-500",children:"Risques actifs"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-error/10 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-error"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-error",children:P.critiques}),e.jsx("div",{className:"text-sm text-primary-500",children:"Critiques"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-warning/10 rounded-lg",children:e.jsx(ds,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:P.moyens}),e.jsx("div",{className:"text-sm text-primary-500",children:"Moyens"})]})]})})}),e.jsx(o,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-success/10 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:P.faibles}),e.jsx("div",{className:"text-sm text-primary-500",children:"Faibles"})]})]})})})]}),b==="audits"?e.jsx("div",{className:"space-y-4",children:te.length===0?e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-primary-300 mx-auto mb-4"}),e.jsx("p",{className:"text-primary-500",children:"Aucun audit trouvé"}),e.jsx(i,{className:"mt-4",leftIcon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>G(),children:"Créer un audit"})]})}):te.map(s=>{const m=ee.has(s.id),v=s.nonConformites.filter(a=>a.statut!=="cloturee").length;return e.jsxs(o,{children:[e.jsx(ne,{className:"cursor-pointer hover:bg-primary-50 transition-colors",onClick:()=>He(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m?e.jsx(xs,{className:"w-5 h-5 text-primary-400"}):e.jsx(ms,{className:"w-5 h-5 text-primary-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{children:s.titre}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${pe[s.type]}`,children:ue[s.type]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${je[s.statut]}`,children:he[s.statut]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-primary-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),w(new Date(s.datePlanifiee),"dd/MM/yyyy")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),s.auditeur]}),v>0&&e.jsxs("span",{className:"flex items-center gap-1 text-error",children:[e.jsx(W,{className:"w-4 h-4"}),v," NC ouverte(s)"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",onClick:a=>a.stopPropagation(),children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>Ge(s),children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>G(s),children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{g(s),Z("audit"),q(!0)},children:e.jsx(me,{className:"w-4 h-4 text-error"})})]})]})}),m&&e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[s.description&&e.jsx("p",{className:"text-sm text-primary-600",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-primary-900",children:["Non-conformités (",s.nonConformites.length,")"]}),e.jsx(i,{variant:"secondary",size:"sm",leftIcon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>Ue(s),children:"Ajouter NC"})]}),s.nonConformites.length===0?e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucune non-conformité"}):e.jsx("div",{className:"space-y-2",children:s.nonConformites.map(a=>e.jsx("div",{className:`p-3 rounded-lg border ${a.statut==="cloturee"?"bg-primary-50 border-primary-100":"bg-white border-primary-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${ve[a.gravite]}`,children:ge[a.gravite]}),e.jsx("span",{className:"text-xs text-primary-500",children:fe[a.statut]})]}),e.jsx("p",{className:"text-sm text-primary-700",children:a.description}),a.actionCorrective&&e.jsxs("p",{className:"text-xs text-primary-500 mt-1",children:[e.jsx("strong",{children:"Action:"})," ",a.actionCorrective]})]}),a.statut!=="cloturee"&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>We(s,a.id),children:e.jsx(X,{className:"w-4 h-4 text-success"})})]})},a.id))})]})})]},s.id)})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(o,{children:[e.jsx(ne,{children:e.jsx(ce,{children:"Matrice des risques"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-6 gap-1 text-center text-xs",children:[e.jsx("div",{}),[1,2,3,4,5].map(s=>e.jsxs("div",{className:"p-2 font-medium text-primary-600",children:["Impact ",s]},s)),[5,4,3,2,1].map(s=>e.jsxs(rs.Fragment,{children:[e.jsxs("div",{className:"p-2 font-medium text-primary-600",children:["P",s]}),[1,2,3,4,5].map(m=>{const v=s*m,a=k.filter(le=>le.probabilite===s&&le.impact===m);return e.jsx("div",{className:`p-2 rounded ${K(v)} ${a.length>0?"ring-2 ring-primary-900":""}`,children:a.length>0?e.jsx("span",{className:"font-bold",children:a.length}):e.jsx("span",{className:"opacity-50",children:v})},`${s}-${m}`)})]},s))]})})]}),k.length===0?e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(de,{className:"w-12 h-12 text-primary-300 mx-auto mb-4"}),e.jsx("p",{className:"text-primary-500",children:"Aucun risque trouvé"}),e.jsx(i,{className:"mt-4",leftIcon:e.jsx(C,{className:"w-4 h-4"}),onClick:()=>J(),children:"Identifier un risque"})]})}):e.jsx(o,{children:e.jsx(d,{className:"p-0",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Score"}),e.jsx("th",{children:"Catégorie"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"P x I"}),e.jsx("th",{children:"Propriétaire"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:k.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-lg font-bold ${K(s.scoreRisque)}`,children:s.scoreRisque})}),e.jsx("td",{children:e.jsx(Q,{children:s.categorie})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-900 line-clamp-2",children:s.description}),s.planMitigation&&e.jsxs("p",{className:"text-xs text-primary-500 mt-1 line-clamp-1",children:[e.jsx("strong",{children:"Plan:"})," ",s.planMitigation]})]})}),e.jsx("td",{children:e.jsxs("span",{className:"text-sm text-primary-600",children:[s.probabilite," x ",s.impact]})}),e.jsx("td",{children:e.jsx("span",{className:"text-sm text-primary-600",children:s.proprietaire||"—"})}),e.jsx("td",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${gs[s.statut]}`,children:js[s.statut]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>J(s),children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{R(s),Z("risque"),q(!0)},children:e.jsx(me,{className:"w-4 h-4 text-error"})})]})})]},s.id))})]})})})]}),e.jsx(E,{isOpen:ke,onClose:()=>{A(!1),B()},title:t?"Modifier l'audit":"Nouvel audit",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",onClick:()=>A(!1),children:"Annuler"}),e.jsx(i,{onClick:Je,children:t?"Enregistrer":"Créer"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{label:"Titre",value:c.titre,onChange:s=>h({...c,titre:s.target.value}),placeholder:"Ex: Audit sécurité incendie"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Type d'audit",options:re,value:c.type,onChange:s=>h({...c,type:s.target.value})}),e.jsx(u,{label:"Statut",options:ae,value:c.statut,onChange:s=>h({...c,statut:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(T,{label:"Date planifiée",type:"date",value:c.datePlanifiee,onChange:s=>h({...c,datePlanifiee:s.target.value})}),e.jsx(T,{label:"Auditeur",value:c.auditeur,onChange:s=>h({...c,auditeur:s.target.value}),placeholder:"Nom de l'auditeur"})]}),e.jsx(y,{label:"Description",rows:3,value:c.description,onChange:s=>h({...c,description:s.target.value}),placeholder:"Périmètre et objectifs de l'audit..."})]})}),e.jsx(E,{isOpen:Te,onClose:()=>{S(!1),H()},title:f?"Modifier le risque":"Nouveau risque",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",onClick:()=>S(!1),children:"Annuler"}),e.jsx(i,{onClick:Ke,children:f?"Enregistrer":"Créer"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Catégorie",options:ie,value:r.categorie,onChange:s=>p({...r,categorie:s.target.value})}),e.jsx(u,{label:"Statut",options:Ze,value:r.statut,onChange:s=>p({...r,statut:s.target.value})})]}),e.jsx(y,{label:"Description du risque",rows:3,value:r.description,onChange:s=>p({...r,description:s.target.value}),placeholder:"Décrivez le risque identifié..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Probabilité",options:es,value:String(r.probabilite),onChange:s=>p({...r,probabilite:Number(s.target.value)})}),e.jsx(u,{label:"Impact",options:ss,value:String(r.impact),onChange:s=>p({...r,impact:Number(s.target.value)})})]}),e.jsx("div",{className:"p-4 bg-primary-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-primary-600",children:"Score de risque:"}),e.jsxs("span",{className:`px-3 py-1 rounded-lg font-bold ${K(r.probabilite*r.impact)}`,children:[r.probabilite*r.impact," - ",Xe(r.probabilite*r.impact)]})]})}),e.jsx(T,{label:"Propriétaire",value:r.proprietaire,onChange:s=>p({...r,proprietaire:s.target.value}),placeholder:"Responsable du risque"}),e.jsx(y,{label:"Plan de mitigation",rows:3,value:r.planMitigation,onChange:s=>p({...r,planMitigation:s.target.value}),placeholder:"Actions prévues pour réduire le risque..."})]})}),e.jsx(E,{isOpen:Ee,onClose:()=>{M(!1),U()},title:"Nouvelle non-conformité",size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",onClick:()=>M(!1),children:"Annuler"}),e.jsx(i,{onClick:Qe,children:"Ajouter"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{label:"Gravité",options:Ye,value:j.gravite,onChange:s=>D({...j,gravite:s.target.value})}),e.jsx(y,{label:"Description",rows:3,value:j.description,onChange:s=>D({...j,description:s.target.value}),placeholder:"Décrivez la non-conformité..."}),e.jsx(y,{label:"Action corrective (optionnel)",rows:2,value:j.actionCorrective,onChange:s=>D({...j,actionCorrective:s.target.value}),placeholder:"Action corrective prévue..."})]})}),e.jsx(E,{isOpen:Ie,onClose:()=>{$(!1),g(null)},title:(t==null?void 0:t.titre)||"",size:"lg",footer:e.jsx(i,{variant:"ghost",onClick:()=>$(!1),children:"Fermer"}),children:t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Type"}),e.jsx("p",{className:`mt-1 inline-block text-sm px-2 py-1 rounded-full border ${pe[t.type]}`,children:ue[t.type]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Statut"}),e.jsx("p",{className:`mt-1 inline-block text-sm px-2 py-1 rounded-full border ${je[t.statut]}`,children:he[t.statut]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Date planifiée"}),e.jsx("p",{className:"mt-1 font-medium",children:w(new Date(t.datePlanifiee),"dd MMMM yyyy",{locale:hs})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Auditeur"}),e.jsx("p",{className:"mt-1 font-medium",children:t.auditeur})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-primary-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-primary-700",children:t.description})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-primary-900 mb-3",children:["Non-conformités (",t.nonConformites.length,")"]}),t.nonConformites.length===0?e.jsx("p",{className:"text-sm text-primary-400 italic",children:"Aucune non-conformité détectée"}):e.jsx("div",{className:"space-y-2",children:t.nonConformites.map(s=>e.jsxs("div",{className:`p-3 rounded-lg border ${s.statut==="cloturee"?"bg-success/5 border-success/20":s.gravite==="critique"?"bg-error/5 border-error/20":"bg-white border-primary-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${ve[s.gravite]}`,children:ge[s.gravite]}),e.jsx("span",{className:"text-xs text-primary-500",children:s.statut==="cloturee"?e.jsx("span",{className:"text-success",children:"Clôturée"}):fe[s.statut]})]}),e.jsx("p",{className:"text-sm text-primary-700",children:s.description}),s.actionCorrective&&e.jsxs("p",{className:"text-xs text-primary-500 mt-2",children:[e.jsx("strong",{children:"Action corrective:"})," ",s.actionCorrective]})]},s.id))})]})]})}),e.jsx(ns,{isOpen:Fe,onClose:()=>q(!1),onConfirm:Ve,title:O==="audit"?"Supprimer l'audit":"Supprimer le risque",message:O==="audit"?`Êtes-vous sûr de vouloir supprimer l'audit "${t==null?void 0:t.titre}" et toutes ses non-conformités ?`:"Êtes-vous sûr de vouloir supprimer ce risque ?",confirmLabel:"Supprimer",variant:"danger"})]})}export{Ts as Conformite};

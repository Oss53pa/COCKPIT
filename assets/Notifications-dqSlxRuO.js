import{j as e}from"./vendor-charts-cvMpHz0W.js";import{r as h}from"./vendor-react-BdB5Pz3t.js";import{F as L,u as M,B as n,C as c,g as d,h as k,i as I,n as S}from"./index-IaNwoOYO.js";import{B as z}from"./Badge-CM23X0aP.js";import{I as u}from"./Input-BZ7duGHL.js";import{M as A}from"./Modal-J_gxoCCM.js";import{H as q,bF as Q,u as D,ay as y,A as $,bG as J,I as T,ap as U,n as X,g as Z,Z as W,_ as Y,e as ee,i as se,Q as ae,N as te,K as ie,ax as re}from"./vendor-icons-B6Rt7gcW.js";import"./vendor-export-C98UG4Mq.js";import"./vendor-utils-BBD155gO.js";function fe(){var w,C,E;const{config:a,isConfigured:o,isSending:j,lastTestResult:i,history:x,updateConfig:K,setEmailJSConfig:H,updateOptions:r,enableNotifications:R,sendTestEmail:_,clearHistory:O,getStats:V}=L(),{addToast:l}=M(),[le,ne]=h.useState(!1),[B,N]=h.useState(!1),[G,f]=h.useState(!1),[g,P]=h.useState(!1),[t,p]=h.useState({serviceId:((w=a.emailjs)==null?void 0:w.serviceId)||"",templateId:((C=a.emailjs)==null?void 0:C.templateId)||"",publicKey:((E=a.emailjs)==null?void 0:E.publicKey)||"",destinataireEmail:a.destinataireEmail||"",destinataireNom:a.destinataireNom||""}),m=V(),v=()=>{if(!t.serviceId||!t.templateId||!t.publicKey){l({type:"error",title:"Configuration incomplÃ¨te",message:"Veuillez remplir tous les champs EmailJS"});return}if(!t.destinataireEmail){l({type:"error",title:"Email manquant",message:"Veuillez saisir votre adresse email"});return}H({serviceId:t.serviceId,templateId:t.templateId,templateIdAlerte:t.templateId,publicKey:t.publicKey}),K({destinataireEmail:t.destinataireEmail,destinataireNom:t.destinataireNom,configuredAt:new Date().toISOString()}),l({type:"success",title:"Configuration sauvegardÃ©e",message:"Vous pouvez maintenant envoyer un email de test"})},F=async()=>{if(!t.destinataireEmail){l({type:"error",title:"Email manquant",message:"Veuillez d'abord configurer votre adresse email"});return}v();const s=await _();l(s?{type:"success",title:"Email envoyÃ© !",message:"VÃ©rifiez votre boÃ®te de rÃ©ception"}:{type:"error",title:"Ã‰chec de l'envoi",message:(i==null?void 0:i.message)||"VÃ©rifiez votre configuration"})},b=s=>new Date(s).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Notifications Email"}),e.jsx("p",{className:"text-primary-500 mt-1",children:"Configurez l'envoi d'alertes et notifications par email"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"secondary",onClick:()=>N(!0),leftIcon:e.jsx(q,{className:"w-4 h-4"}),children:"Historique"}),e.jsx(n,{variant:a.enabled?"danger":"primary",onClick:()=>R(!a.enabled),leftIcon:a.enabled?e.jsx(Q,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"}),children:a.enabled?"DÃ©sactiver":"Activer"})]})]}),e.jsx(c,{className:a.enabled&&o?"border-success/30 bg-success/5":"border-warning/30 bg-warning/5",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${a.enabled&&o?"bg-success/10":"bg-warning/10"}`,children:a.enabled&&o?e.jsx(y,{className:"w-8 h-8 text-success"}):e.jsx($,{className:"w-8 h-8 text-warning"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-primary-900",children:a.enabled&&o?"Notifications email activÃ©es":a.enabled?"Configuration requise":"Notifications dÃ©sactivÃ©es"}),e.jsx("p",{className:"text-sm text-primary-500",children:a.enabled&&o?`Les alertes seront envoyÃ©es Ã  ${a.destinataireEmail}`:a.enabled?"Configurez EmailJS pour recevoir les notifications":"Activez les notifications pour recevoir des alertes par email"})]}),m.dernierEnvoi&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-primary-500",children:"Dernier envoi"}),e.jsx("p",{className:"text-sm font-medium text-primary-700",children:b(m.dernierEnvoi)})]})]})})}),e.jsxs(c,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Configuration EmailJS"]}),e.jsx(S,{children:"Service gratuit pour envoyer des emails depuis le navigateur"})]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>f(!0),leftIcon:e.jsx(T,{className:"w-4 h-4"}),children:"Guide de configuration"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-info/10 border border-info/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-info mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-primary-700",children:"CrÃ©ez un compte gratuit sur EmailJS pour obtenir vos identifiants. 200 emails/mois gratuits."}),e.jsxs("a",{href:"https://www.emailjs.com",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-info hover:underline mt-2",children:["Ouvrir EmailJS ",e.jsx(U,{className:"w-3 h-3"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Service ID",value:t.serviceId,onChange:s=>p({...t,serviceId:s.target.value}),placeholder:"service_xxxxxxx",leftIcon:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(u,{label:"Template ID",value:t.templateId,onChange:s=>p({...t,templateId:s.target.value}),placeholder:"template_xxxxxxx",leftIcon:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{label:"ClÃ© publique (Public Key)",type:g?"text":"password",value:t.publicKey,onChange:s=>p({...t,publicKey:s.target.value}),placeholder:"xxxxxxxxxxxxxxx",leftIcon:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>P(!g),className:"absolute right-3 top-9 text-primary-400 hover:text-primary-600",children:g?e.jsx(W,{className:"w-4 h-4"}):e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"border-t border-primary-100 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-primary-900 mb-3",children:"Destinataire"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"Votre adresse email",type:"email",value:t.destinataireEmail,onChange:s=>p({...t,destinataireEmail:s.target.value}),placeholder:"votre@email.com",leftIcon:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(u,{label:"Votre nom (optionnel)",value:t.destinataireNom,onChange:s=>p({...t,destinataireNom:s.target.value}),placeholder:"Jean Dupont"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsx(z,{variant:i.success?"success":"danger",children:i.success?"Test rÃ©ussi":"Test Ã©chouÃ©"}),i&&!i.success&&e.jsx("span",{className:"text-xs text-danger",children:i.message})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",onClick:v,leftIcon:e.jsx(se,{className:"w-4 h-4"}),children:"Sauvegarder"}),e.jsx(n,{variant:"primary",onClick:F,disabled:j||!t.destinataireEmail,leftIcon:j?e.jsx(ae,{className:"w-4 h-4 animate-spin"}):e.jsx(te,{className:"w-4 h-4"}),children:j?"Envoi...":"Envoyer un test"})]})]})]})})]}),e.jsxs(c,{children:[e.jsxs(k,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Types de Notifications"]}),e.jsx(S,{children:"Choisissez les notifications que vous souhaitez recevoir"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-primary-700 mb-3",children:"Alertes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸš¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Alertes critiques"}),e.jsx("p",{className:"text-xs text-primary-500",children:"KPIs en rouge, retards importants"})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.alertesCritiques,onChange:s=>r({alertesCritiques:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Alertes importantes"}),e.jsx("p",{className:"text-xs text-primary-500",children:"KPIs en orange, Ã©chÃ©ances proches"})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.alertesImportantes,onChange:s=>r({alertesImportantes:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"â„¹ï¸"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Notifications informatives"}),e.jsx("p",{className:"text-xs text-primary-500",children:"Rappels, mises Ã  jour gÃ©nÃ©rales"})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.alertesInfo,onChange:s=>r({alertesInfo:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"border-t border-primary-100 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-primary-700 mb-3",children:"Rappels automatiques"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Expiration de baux"}),e.jsxs("p",{className:"text-xs text-primary-500",children:["Rappel ",a.options.rappelBailJours," jours avant expiration"]})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.baillExpiration,onChange:s=>r({baillExpiration:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Ã‰chÃ©ances d'actions"}),e.jsxs("p",{className:"text-xs text-primary-500",children:["Rappel ",a.options.rappelEcheanceJours," jours avant l'Ã©chÃ©ance"]})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.nouvelleEcheance,onChange:s=>r({nouvelleEcheance:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸŽ¯"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Objectifs atteints"}),e.jsx("p",{className:"text-xs text-primary-500",children:"Notification quand un objectif passe au vert"})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.objectifAtteint,onChange:s=>r({objectifAtteint:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"border-t border-primary-100 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-primary-700 mb-3",children:"RÃ©sumÃ©s pÃ©riodiques"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Digest hebdomadaire"}),e.jsxs("p",{className:"text-xs text-primary-500",children:["RÃ©sumÃ© envoyÃ© le lundi Ã  ",a.options.heureDigest]})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.digestHebdomadaire,onChange:s=>r({digestHebdomadaire:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg cursor-pointer hover:bg-primary-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“°"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:"Digest quotidien"}),e.jsxs("p",{className:"text-xs text-primary-500",children:["RÃ©sumÃ© envoyÃ© chaque jour Ã  ",a.options.heureDigest]})]})]}),e.jsx("input",{type:"checkbox",checked:a.options.digestQuotidien,onChange:s=>r({digestQuotidien:s.target.checked}),className:"w-5 h-5 rounded border-primary-300 text-primary-900 focus:ring-primary-500"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsxs(d,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-success",children:m.totalEnvoyes}),e.jsx("p",{className:"text-sm text-primary-500",children:"EnvoyÃ©s"})]})}),e.jsx(c,{children:e.jsxs(d,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-danger",children:m.totalEchecs}),e.jsx("p",{className:"text-sm text-primary-500",children:"Ã‰checs"})]})}),e.jsx(c,{children:e.jsxs(d,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-warning",children:m.parType.alertes}),e.jsx("p",{className:"text-sm text-primary-500",children:"Alertes"})]})}),e.jsx(c,{children:e.jsxs(d,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-info",children:m.parType.rappels}),e.jsx("p",{className:"text-sm text-primary-500",children:"Rappels"})]})})]}),e.jsx(A,{isOpen:B,onClose:()=>N(!1),title:"Historique des notifications",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-primary-500",children:[x.length," notification",x.length>1?"s":""," dans l'historique"]}),x.length>0&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>{O(),l({type:"success",title:"Historique effacÃ©"})},leftIcon:e.jsx(ie,{className:"w-4 h-4"}),children:"Effacer"})]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-primary-500",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Aucune notification envoyÃ©e"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.statut==="envoye"?e.jsx(y,{className:"w-5 h-5 text-success"}):e.jsx(re,{className:"w-5 h-5 text-danger"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900",children:s.sujet}),e.jsxs("p",{className:"text-xs text-primary-500",children:[s.destinataire," - ",b(s.envoyeAt)]})]})]}),e.jsx(z,{variant:s.type==="alerte"?"warning":s.type==="rappel"?"info":"secondary",children:s.type})]},s.id))})]})}),e.jsx(A,{isOpen:G,onClose:()=>f(!1),title:"Guide de configuration EmailJS",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-info/10 rounded-lg",children:e.jsx("p",{className:"text-sm text-primary-700",children:"EmailJS permet d'envoyer des emails directement depuis votre navigateur, sans avoir besoin d'un serveur backend. Suivez ces Ã©tapes pour configurer le service."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-900 text-white rounded-full flex items-center justify-center font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-primary-900",children:"CrÃ©er un compte EmailJS"}),e.jsxs("p",{className:"text-sm text-primary-500 mt-1",children:["Rendez-vous sur ",e.jsx("a",{href:"https://www.emailjs.com",target:"_blank",rel:"noopener noreferrer",className:"text-info hover:underline",children:"emailjs.com"})," et crÃ©ez un compte gratuit. Vous aurez droit Ã  200 emails/mois."]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-900 text-white rounded-full flex items-center justify-center font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-primary-900",children:"CrÃ©er un service email"}),e.jsxs("p",{className:"text-sm text-primary-500 mt-1",children:['Dans le dashboard EmailJS, allez dans "Email Services" et ajoutez un service. Choisissez Gmail, Outlook ou tout autre fournisseur compatible. Notez le ',e.jsx("strong",{children:"Service ID"})," (ex: service_xxxxxx)."]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-900 text-white rounded-full flex items-center justify-center font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-primary-900",children:"CrÃ©er un template"}),e.jsx("p",{className:"text-sm text-primary-500 mt-1",children:'Allez dans "Email Templates" et crÃ©ez un nouveau template. Utilisez ces variables dans votre template:'}),e.jsxs("div",{className:"mt-2 p-3 bg-primary-50 rounded font-mono text-xs",children:["{{to_email}}"," - Email destinataire",e.jsx("br",{}),"{{to_name}}"," - Nom destinataire",e.jsx("br",{}),"{{subject}}"," - Sujet de l'email",e.jsx("br",{}),"{{message_html}}"," - Contenu HTML"]}),e.jsxs("p",{className:"text-sm text-primary-500 mt-2",children:["Notez le ",e.jsx("strong",{children:"Template ID"})," (ex: template_xxxxxx)."]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-900 text-white rounded-full flex items-center justify-center font-bold",children:"4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-primary-900",children:"RÃ©cupÃ©rer la clÃ© publique"}),e.jsxs("p",{className:"text-sm text-primary-500 mt-1",children:['Allez dans "Account" puis "General" pour trouver votre ',e.jsx("strong",{children:"Public Key"}),". Cette clÃ© permet Ã  Cockpit d'utiliser votre compte EmailJS."]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-success text-white rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-primary-900",children:"Configuration terminÃ©e !"}),e.jsx("p",{className:"text-sm text-primary-500 mt-1",children:"Entrez vos identifiants dans le formulaire ci-dessus et envoyez un email de test pour vÃ©rifier que tout fonctionne."})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(n,{variant:"primary",onClick:()=>f(!1),children:"J'ai compris"})})]})})]})}export{fe as Notifications};

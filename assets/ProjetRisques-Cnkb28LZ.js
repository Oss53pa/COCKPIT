import{j as e}from"./vendor-charts-cvMpHz0W.js";import{e as V,d as G,r as m,b as J}from"./vendor-react-BdB5Pz3t.js";import{a as W,f as X,B as P,C as d,g as x,h as E,i as D}from"./index-IaNwoOYO.js";import{B as F}from"./Badge-CM23X0aP.js";import{I as B}from"./Input-BZ7duGHL.js";import{M as Y}from"./Modal-J_gxoCCM.js";import{C as Z,ab as q,B as ee,A as O,i as $,x as te,P as A,a7 as se,aQ as ae,K as ie,am as re}from"./vendor-icons-B6Rt7gcW.js";import"./vendor-export-C98UG4Mq.js";import"./vendor-utils-BBD155gO.js";const le={planning:{bg:"bg-blue-100",text:"text-blue-600",icon:se},budget:{bg:"bg-green-100",text:"text-green-600",icon:A},technique:{bg:"bg-purple-100",text:"text-purple-600",icon:$},commercial:{bg:"bg-orange-100",text:"text-orange-600",icon:A},rh:{bg:"bg-pink-100",text:"text-pink-600",icon:te},externe:{bg:"bg-yellow-100",text:"text-yellow-600",icon:O},reglementaire:{bg:"bg-red-100",text:"text-red-600",icon:$}},w=r=>r>=20?{bg:"bg-error",text:"text-white",label:"Critique"}:r>=15?{bg:"bg-error/70",text:"text-white",label:"Très élevé"}:r>=10?{bg:"bg-warning",text:"text-white",label:"Élevé"}:r>=5?{bg:"bg-warning/60",text:"text-primary-900",label:"Modéré"}:{bg:"bg-success/40",text:"text-primary-900",label:"Faible"};function ne({isOpen:r,onClose:p,risque:s,projetId:c,onSave:n}){var g;const[a,l]=m.useState({code:(s==null?void 0:s.code)||"",titre:(s==null?void 0:s.titre)||"",description:(s==null?void 0:s.description)||"",categorie:(s==null?void 0:s.categorie)||"planning",probabilite:(s==null?void 0:s.probabilite)||3,impact:(s==null?void 0:s.impact)||3,statut:(s==null?void 0:s.statut)||"identifie",actionMitigation:((g=s==null?void 0:s.actionsMitigation[0])==null?void 0:g.description)||""});m.useEffect(()=>{var i;s&&l({code:s.code,titre:s.titre,description:s.description,categorie:s.categorie,probabilite:s.probabilite,impact:s.impact,statut:s.statut,actionMitigation:((i=s.actionsMitigation[0])==null?void 0:i.description)||""})},[s]);const h=a.probabilite*a.impact,C=i=>{var j;i.preventDefault();const M=a.actionMitigation?[{id:((j=s==null?void 0:s.actionsMitigation[0])==null?void 0:j.id)||crypto.randomUUID(),description:a.actionMitigation,echeance:new Date().toISOString(),statut:"a_faire"}]:[];n({code:a.code,titre:a.titre,description:a.description,categorie:a.categorie,probabilite:a.probabilite,impact:a.impact,criticite:h,statut:a.statut,actionsMitigation:M,dateIdentification:(s==null?void 0:s.dateIdentification)||new Date().toISOString(),projetId:c}),p()};return e.jsx(Y,{isOpen:r,onClose:p,title:s?"Modifier le risque":"Nouveau risque",size:"lg",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(B,{label:"Code",value:a.code,onChange:i=>l({...a,code:i.target.value}),placeholder:"R01",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:"Catégorie"}),e.jsxs("select",{value:a.categorie,onChange:i=>l({...a,categorie:i.target.value}),className:"w-full px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"budget",children:"Budget"}),e.jsx("option",{value:"technique",children:"Technique"}),e.jsx("option",{value:"commercial",children:"Commercial"}),e.jsx("option",{value:"rh",children:"RH"}),e.jsx("option",{value:"externe",children:"Externe"}),e.jsx("option",{value:"reglementaire",children:"Réglementaire"})]})]})]}),e.jsx(B,{label:"Titre",value:a.titre,onChange:i=>l({...a,titre:i.target.value}),placeholder:"Titre du risque",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:i=>l({...a,description:i.target.value}),rows:2,className:"w-full px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Description détaillée du risque..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:["Probabilité: ",a.probabilite,"/5"]}),e.jsx("input",{type:"range",min:"1",max:"5",value:a.probabilite,onChange:i=>l({...a,probabilite:parseInt(i.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-primary-500",children:[e.jsx("span",{children:"Faible"}),e.jsx("span",{children:"Élevée"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:["Impact: ",a.impact,"/5"]}),e.jsx("input",{type:"range",min:"1",max:"5",value:a.impact,onChange:i=>l({...a,impact:parseInt(i.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-primary-500",children:[e.jsx("span",{children:"Faible"}),e.jsx("span",{children:"Élevé"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:"Criticité"}),e.jsxs("div",{className:`text-center py-2 rounded-lg ${w(h).bg} ${w(h).text}`,children:[e.jsx("span",{className:"text-2xl font-bold",children:h}),e.jsx("span",{className:"text-sm",children:"/25"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:"Statut"}),e.jsxs("select",{value:a.statut,onChange:i=>l({...a,statut:i.target.value}),className:"w-full px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"identifie",children:"Identifié"}),e.jsx("option",{value:"en_traitement",children:"En traitement"}),e.jsx("option",{value:"mitige",children:"Mitigé"}),e.jsx("option",{value:"realise",children:"Réalisé"}),e.jsx("option",{value:"clos",children:"Clos"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-700 mb-1.5",children:"Action de mitigation"}),e.jsx("textarea",{value:a.actionMitigation,onChange:i=>l({...a,actionMitigation:i.target.value}),rows:2,className:"w-full px-3 py-2 border border-primary-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Mesure pour réduire le risque..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(P,{variant:"secondary",onClick:p,type:"button",children:"Annuler"}),e.jsx(P,{type:"submit",leftIcon:e.jsx(re,{className:"w-4 h-4"}),children:s?"Enregistrer":"Créer"})]})]})})}function ce({risques:r}){const p=(s,c)=>r.filter(n=>n.probabilite===s&&n.impact===c&&n.statut!=="clos").length;return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"w-16 flex flex-col items-center gap-1 text-xs text-primary-500",children:e.jsx("span",{className:"transform -rotate-90 whitespace-nowrap",children:"Probabilité"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"grid grid-cols-5 gap-1",children:[5,4,3,2,1].map(s=>e.jsx(J.Fragment,{children:[1,2,3,4,5].map(c=>{const n=p(s,c),a=s*c,l=w(a);return e.jsx("div",{className:`h-12 flex items-center justify-center rounded text-sm font-medium ${l.bg} ${l.text}`,children:n>0?n:""},`${s}-${c}`)})},s))}),e.jsx("div",{className:"grid grid-cols-5 gap-1 mt-1",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"text-center text-xs text-primary-500",children:s},s))}),e.jsx("div",{className:"text-center text-xs text-primary-500 mt-1",children:"Impact"})]})]})})}function be(){const{centreId:r}=V(),p=G(),s=W(t=>t.getCentre(r||"")),{projets:c,risquesProjet:n,loadProjet:a,addRisque:l,updateRisque:h,deleteRisque:C}=X(),[g,i]=m.useState("list"),[M,j]=m.useState(!1),[S,v]=m.useState(),[I,_]=m.useState("all"),[R,z]=m.useState("all");if(m.useEffect(()=>{r&&a(r)},[r]),!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-primary-500",children:"Centre non trouvé"})});const k=c.find(t=>t.centreId===r);if(!k)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-primary-500",children:"Projet non initialisé"})});const N=n.filter(t=>t.projetId===k.id).sort((t,o)=>o.criticite-t.criticite),T=N.filter(t=>{const o=I==="all"||t.categorie===I,y=R==="all"||t.statut===R;return o&&y}),u=N.filter(t=>t.statut!=="clos"),b={total:N.length,actifs:u.length,critiques:u.filter(t=>t.criticite>=15).length,eleves:u.filter(t=>t.criticite>=10&&t.criticite<15).length,moderes:u.filter(t=>t.criticite>=5&&t.criticite<10).length,faibles:u.filter(t=>t.criticite<5).length,scoreTotal:u.reduce((t,o)=>t+o.criticite,0)},H=async t=>{S?await h(S.id,t):await l(t),v(void 0)},U=async t=>{window.confirm("Supprimer ce risque ?")&&await C(t)},L=t=>{v(t),j(!0)},K=()=>{v(void 0),j(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(`/centre/${r}/projet`),className:"p-2 hover:bg-primary-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900",children:"Risques Projet"}),e.jsx("p",{className:"text-primary-500",children:s.nom})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex bg-primary-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>i("list"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${g==="list"?"bg-white shadow text-primary-900":"text-primary-600"}`,children:"Liste"}),e.jsx("button",{onClick:()=>i("matrix"),className:`px-3 py-1.5 text-sm rounded-md transition-colors ${g==="matrix"?"bg-white shadow text-primary-900":"text-primary-600"}`,children:"Matrice"})]}),e.jsx(P,{onClick:K,leftIcon:e.jsx(q,{className:"w-4 h-4"}),children:"Nouveau risque"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[e.jsx(d,{children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary-900",children:b.actifs}),e.jsx("p",{className:"text-xs text-primary-500",children:"Risques actifs"})]})})}),e.jsx(d,{className:"border-error/30 bg-error/5",children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-error",children:b.critiques}),e.jsx("p",{className:"text-xs text-error",children:"Critiques (15-25)"})]})})}),e.jsx(d,{className:"border-warning/30 bg-warning/5",children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-warning",children:b.eleves}),e.jsx("p",{className:"text-xs text-warning",children:"Élevés (10-14)"})]})})}),e.jsx(d,{className:"border-orange-300 bg-orange-50",children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:b.moderes}),e.jsx("p",{className:"text-xs text-orange-600",children:"Modérés (5-9)"})]})})}),e.jsx(d,{className:"border-success/30 bg-success/5",children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-success",children:b.faibles}),e.jsx("p",{className:"text-xs text-success",children:"Faibles (1-4)"})]})})}),e.jsx(d,{children:e.jsx(x,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary-900",children:b.scoreTotal}),e.jsx("p",{className:"text-xs text-primary-500",children:"Score total"})]})})})]}),g==="matrix"&&e.jsxs(d,{children:[e.jsx(E,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Matrice des risques"]})}),e.jsxs(x,{children:[e.jsx(ce,{risques:N}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-success/40"}),e.jsx("span",{children:"Faible (1-4)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-warning/60"}),e.jsx("span",{children:"Modéré (5-9)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-warning"}),e.jsx("span",{children:"Élevé (10-14)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-error/70"}),e.jsx("span",{children:"Très élevé (15-19)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-error"}),e.jsx("span",{children:"Critique (20-25)"})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{value:I,onChange:t=>_(t.target.value),className:"px-3 py-2 border border-primary-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"Toutes catégories"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"budget",children:"Budget"}),e.jsx("option",{value:"technique",children:"Technique"}),e.jsx("option",{value:"commercial",children:"Commercial"}),e.jsx("option",{value:"rh",children:"RH"}),e.jsx("option",{value:"externe",children:"Externe"}),e.jsx("option",{value:"reglementaire",children:"Réglementaire"})]}),e.jsxs("select",{value:R,onChange:t=>z(t.target.value),className:"px-3 py-2 border border-primary-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"Tous statuts"}),e.jsx("option",{value:"identifie",children:"Identifié"}),e.jsx("option",{value:"en_traitement",children:"En traitement"}),e.jsx("option",{value:"mitige",children:"Mitigé"}),e.jsx("option",{value:"realise",children:"Réalisé"}),e.jsx("option",{value:"clos",children:"Clos"})]})]}),e.jsxs(d,{children:[e.jsx(E,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Registre des risques"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[T.map(t=>{const o=le[t.categorie],y=w(t.criticite),Q=o.icon;return e.jsx("div",{className:`p-4 rounded-xl border ${t.criticite>=15?"border-error/30 bg-error/5":"border-primary-200 bg-primary-50"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${o.bg}`,children:e.jsx(Q,{className:`w-6 h-6 ${o.text}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-mono text-xs text-primary-500",children:t.code}),e.jsx(F,{variant:"default",size:"sm",children:t.categorie}),e.jsx(F,{variant:t.statut==="clos"?"success":t.statut==="mitige"?"info":t.statut==="realise"?"error":"default",size:"sm",children:t.statut.replace("_"," ")})]}),e.jsx("p",{className:"font-medium text-primary-900",children:t.titre}),t.description&&e.jsx("p",{className:"text-sm text-primary-600 mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-6 mt-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-primary-500",children:"Probabilité:"}),e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(f=>e.jsx("div",{className:`w-3 h-3 rounded-full ${f<=t.probabilite?"bg-primary-900":"bg-primary-200"}`},f))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-primary-500",children:"Impact:"}),e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(f=>e.jsx("div",{className:`w-3 h-3 rounded-full ${f<=t.impact?"bg-primary-900":"bg-primary-200"}`},f))})]})]}),t.actionsMitigation.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg border border-primary-200",children:[e.jsx("p",{className:"text-xs text-primary-500 mb-1",children:"Plan de mitigation:"}),e.jsx("p",{className:"text-sm text-primary-700",children:t.actionsMitigation[0].description})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:`px-3 py-1.5 rounded-lg ${y.bg} ${y.text}`,children:[e.jsx("span",{className:"text-xl font-bold",children:t.criticite}),e.jsx("span",{className:"text-xs",children:"/25"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>L(t),className:"p-2 hover:bg-primary-200 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-4 h-4 text-primary-600"})}),e.jsx("button",{onClick:()=>U(t.id),className:"p-2 hover:bg-error/10 rounded-lg transition-colors",children:e.jsx(ie,{className:"w-4 h-4 text-error"})})]})]})]})},t.id)}),T.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"w-12 h-12 text-primary-300 mx-auto mb-3"}),e.jsx("p",{className:"text-primary-500",children:"Aucun risque trouvé"})]})]})})]}),e.jsx(ne,{isOpen:M,onClose:()=>{j(!1),v(void 0)},risque:S,projetId:k.id,onSave:H})]})}export{be as ProjetRisques};

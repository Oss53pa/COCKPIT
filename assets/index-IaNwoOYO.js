const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/reportExport-BgnGCEkm.js","assets/vendor-export-C98UG4Mq.js","assets/vendor-react-BdB5Pz3t.js","assets/Dashboard-C_eK16sJ.js","assets/vendor-charts-cvMpHz0W.js","assets/Badge-CM23X0aP.js","assets/vendor-utils-BBD155gO.js","assets/vendor-icons-B6Rt7gcW.js","assets/fr-C0qvdQu_.js","assets/ActionsConsolidees-DV0zflJ-.js","assets/Input-BZ7duGHL.js","assets/Modal-J_gxoCCM.js","assets/Centres-HTzUsu8q.js","assets/CentreDashboard-Cfh_UF88.js","assets/Pilotage-t4M2FoUm.js","assets/Actions-Cf-O3pPk.js","assets/Agenda-Cd2_AsTC.js","assets/Reporting-CIW2GV7e.js","assets/Conformite-7BLGCCzy.js","assets/Evaluations-CiuvPbP6.js","assets/Alertes-B6sGoBdL.js","assets/Parametres-UKaD7awb.js","assets/Equipe-Bkm_bBsx.js","assets/ImportData-DO5devOz.js","assets/ComparateurCentres-B3pcTrJI.js","assets/ProjetDashboard-Brd73Ifm.js","assets/ProjetJalons-DQmRg5GS.js","assets/ProjetRecrutement-DN6xWXNB.js","assets/ProjetCommercial-Dpi4c2_V.js","assets/ProjetRisques-Cnkb28LZ.js","assets/ProjetHandover-COFxiThV.js","assets/ProjetBudget-Dl4iXPMO.js","assets/ProjetSynchronisation-C5JCafNO.js","assets/index-CUAGUUVd.js","assets/Profil-2yrSUmE2.js","assets/Templates-Ddyd-dfX.js","assets/Journal-D9OQqFac.js","assets/Notifications-dqSlxRuO.js","assets/TemplatesEmail-DrXWCuZt.js","assets/NotFound-Bww5NLzV.js"])))=>i.map(i=>d[i]);
var mt=Object.defineProperty;var gt=(i,s,e)=>s in i?mt(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var I=(i,s,e)=>gt(i,typeof s!="symbol"?s+"":s,e);import{j as c}from"./vendor-charts-cvMpHz0W.js";import{a as ft,N as we,u as oe,d as $e,e as ht,r as C,b as yt,O as bt,f as At,B as xt,h as vt,i as N}from"./vendor-react-BdB5Pz3t.js";import{r as It,u as Et,_ as P,p as ce}from"./vendor-export-C98UG4Mq.js";import{c as q,D as wt,v as E,d as Ce}from"./vendor-utils-BBD155gO.js";import{M as Ct,U as ze,S as St,F as Rt,W as Tt,A as ne,a as Ot,b as Se,C as Nt,R as Re,T as Te,B as He,L as Oe,c as Ne,d as fe,D as Pt,e as Ge,H as _t,f as Dt,g as Ye,h as jt,i as Ke,j as Lt,k as kt,l as qt,m as Mt,n as Ft,o as Ut,p as Je,q as Bt,r as Vt,s as $t,t as zt,u as Ht,v as Gt,w as Yt,X as Ae,I as Xe,x as Qe,y as We,z as le,E as de,G as Kt,J as he,K as Jt,N as Xt,O as Qt,P as Wt,Q as Zt,V as er,Y as Pe,Z as tr,_ as rr,$ as ar}from"./vendor-icons-B6Rt7gcW.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();var Ze,_e=ft;Ze=_e.createRoot,_e.hydrateRoot;function ir(i,s){let e;try{e=i()}catch{return}return{getItem:r=>{var a;const o=d=>d===null?null:JSON.parse(d,void 0),n=(a=e.getItem(r))!=null?a:null;return n instanceof Promise?n.then(o):o(n)},setItem:(r,a)=>e.setItem(r,JSON.stringify(a,void 0)),removeItem:r=>e.removeItem(r)}}const ye=i=>s=>{try{const e=i(s);return e instanceof Promise?e:{then(t){return ye(t)(e)},catch(t){return this}}}catch(e){return{then(t){return this},catch(t){return ye(t)(e)}}}},sr=(i,s)=>(e,t,r)=>{let a={storage:ir(()=>localStorage),partialize:f=>f,version:0,merge:(f,S)=>({...S,...f}),...s},o=!1;const n=new Set,d=new Set;let u=a.storage;if(!u)return i((...f)=>{e(...f)},t,r);const p=()=>{const f=a.partialize({...t()});return u.setItem(a.name,{state:f,version:a.version})},g=r.setState;r.setState=(f,S)=>(g(f,S),p());const A=i((...f)=>(e(...f),p()),t,r);r.getInitialState=()=>A;let h;const b=()=>{var f,S;if(!u)return;o=!1,n.forEach(_=>{var D;return _((D=t())!=null?D:A)});const T=((S=a.onRehydrateStorage)==null?void 0:S.call(a,(f=t())!=null?f:A))||void 0;return ye(u.getItem.bind(u))(a.name).then(_=>{if(_)if(typeof _.version=="number"&&_.version!==a.version){if(a.migrate){const D=a.migrate(_.state,_.version);return D instanceof Promise?D.then(v=>[!0,v]):[!0,D]}}else return[!1,_.state];return[!1,void 0]}).then(_=>{var D;const[v,L]=_;if(h=a.merge(L,(D=t())!=null?D:A),e(h,!0),v)return p()}).then(()=>{T==null||T(h,void 0),h=t(),o=!0,d.forEach(_=>_(h))}).catch(_=>{T==null||T(void 0,_)})};return r.persist={setOptions:f=>{a={...a,...f},f.storage&&(u=f.storage)},clearStorage:()=>{u==null||u.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>b(),hasHydrated:()=>o,onHydrate:f=>(n.add(f),()=>{n.delete(f)}),onFinishHydration:f=>(d.add(f),()=>{d.delete(f)})},a.skipHydration||b(),h||A},W=sr,ie=q()(W(i=>({sidebarOpen:!0,currentCentreId:null,theme:"light",isLoading:!1,loadingMessage:"",toasts:[],autoSaveConfig:{enabled:!1,intervalMinutes:30,target:"local",lastSaveTime:null,lastSaveStatus:null},setSidebarOpen:s=>i({sidebarOpen:s}),toggleSidebar:()=>i(s=>({sidebarOpen:!s.sidebarOpen})),setCurrentCentre:s=>i({currentCentreId:s}),setTheme:s=>{const e=document.documentElement;if(e.classList.remove("light","dark"),s==="system"){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.classList.add(t)}else e.classList.add(s);i({theme:s})},setLoading:(s,e="")=>i({isLoading:s,loadingMessage:e}),addToast:s=>i(e=>({toasts:[...e.toasts,{...s,id:crypto.randomUUID()}]})),removeToast:s=>i(e=>({toasts:e.toasts.filter(t=>t.id!==s)})),setAutoSaveConfig:s=>i(e=>({autoSaveConfig:{...e.autoSaveConfig,...s}})),updateLastSave:s=>i(e=>({autoSaveConfig:{...e.autoSaveConfig,lastSaveTime:new Date().toISOString(),lastSaveStatus:s}}))}),{name:"cockpit-app-store",partialize:i=>({sidebarOpen:i.sidebarOpen,currentCentreId:i.currentCentreId,theme:i.theme,autoSaveConfig:i.autoSaveConfig})}));class or extends wt{constructor(){super("CockpitCRMC");I(this,"centres");I(this,"postes");I(this,"membresEquipe");I(this,"axes");I(this,"objectifs");I(this,"mesures");I(this,"actions");I(this,"reunions");I(this,"livrables");I(this,"evaluations");I(this,"audits");I(this,"risques");I(this,"alertes");I(this,"parametres");I(this,"importLogs");I(this,"fichiersImport");I(this,"dossiersImport");I(this,"etatsLocatifs");I(this,"donneesLoyers");I(this,"donneesFrequentation");I(this,"donneesChiffreAffaires");I(this,"donneesCharges");I(this,"donneesBaux");I(this,"donneesTravaux");I(this,"donneesValorisation");I(this,"donneesEnergie");I(this,"donneesSatisfaction");I(this,"typesRapport");I(this,"packsRapport");I(this,"rapports");I(this,"modelesRapport");I(this,"resultatsKPI");I(this,"insights");I(this,"reglesAlerte");I(this,"alertesGenerees");I(this,"tendancesPrediction");I(this,"benchmarks");I(this,"configurationsBI");I(this,"projets");I(this,"phasesProjet");I(this,"jalons");I(this,"vaguesRecrutement");I(this,"postesARecruter");I(this,"prospectsCommerciaux");I(this,"suiviBEFA");I(this,"reserves");I(this,"documentsDOE");I(this,"risquesProjet");I(this,"actionsCommunication");I(this,"evenementsLancement");I(this,"phasesHandover");I(this,"jalonsCommerciaux");I(this,"userProfile");I(this,"backupHistory");I(this,"journalModifications");I(this,"periodesCloturees");I(this,"documents");I(this,"mappingHistory");I(this,"authCredentials");this.version(1).stores({centres:"id, code, nom, statut, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut"}),this.version(2).stores({centres:"id, code, nom, statut, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut",fichiersImport:"id, centreId, dossierId, categorie, statut, dateImport, version, createdAt",dossiersImport:"id, centreId, parentId, categorie, ordre, createdAt",etatsLocatifs:"id, centreId, fichierImportId, lotId, locataireEnseigne, statutOccupation, createdAt",donneesLoyers:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], statut, createdAt",donneesFrequentation:"id, centreId, fichierImportId, date, zone, createdAt",donneesChiffreAffaires:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], createdAt",donneesCharges:"id, centreId, fichierImportId, categorieCharge, [periodeAnnee+periodeMois], createdAt",donneesBaux:"id, centreId, fichierImportId, lotId, locataireEnseigne, dateFin, createdAt",donneesTravaux:"id, centreId, fichierImportId, reference, categorie, statut, createdAt",donneesValorisation:"id, centreId, fichierImportId, dateValorisation, createdAt",donneesEnergie:"id, centreId, fichierImportId, typeEnergie, [periodeAnnee+periodeMois], createdAt",donneesSatisfaction:"id, centreId, fichierImportId, date, typeEnquete, createdAt",typesRapport:"id, code, categorie, complexite, actif, createdAt",packsRapport:"id, code, nom, createdAt",rapports:"id, centreId, typeRapportCode, statut, auteur, dateCreation, createdAt",modelesRapport:"id, typeRapportCode, nom, estPublic, auteur, createdAt",resultatsKPI:"id, centreId, typeKPI, [periodeDebut+periodeFin], dateCalcul, createdAt",insights:"id, centreId, type, severite, traitee, dateDetection, createdAt",reglesAlerte:"id, centreId, type, actif, priorite, createdAt",alertesGenerees:"id, centreId, regleId, priorite, lue, traitee, dateGeneration, createdAt",tendancesPrediction:"id, centreId, kpi, dateCalcul, createdAt",benchmarks:"id, centreId, kpi, dateComparaison, createdAt",configurationsBI:"id, centreId, createdAt"}),this.version(3).stores({centres:"id, code, nom, statut, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut",fichiersImport:"id, centreId, dossierId, categorie, statut, dateImport, version, createdAt",dossiersImport:"id, centreId, parentId, categorie, ordre, createdAt",etatsLocatifs:"id, centreId, fichierImportId, lotId, locataireEnseigne, statutOccupation, createdAt",donneesLoyers:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], statut, createdAt",donneesFrequentation:"id, centreId, fichierImportId, date, zone, createdAt",donneesChiffreAffaires:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], createdAt",donneesCharges:"id, centreId, fichierImportId, categorieCharge, [periodeAnnee+periodeMois], createdAt",donneesBaux:"id, centreId, fichierImportId, lotId, locataireEnseigne, dateFin, createdAt",donneesTravaux:"id, centreId, fichierImportId, reference, categorie, statut, createdAt",donneesValorisation:"id, centreId, fichierImportId, dateValorisation, createdAt",donneesEnergie:"id, centreId, fichierImportId, typeEnergie, [periodeAnnee+periodeMois], createdAt",donneesSatisfaction:"id, centreId, fichierImportId, date, typeEnquete, createdAt",typesRapport:"id, code, categorie, complexite, actif, createdAt",packsRapport:"id, code, nom, createdAt",rapports:"id, centreId, typeRapportCode, statut, auteur, dateCreation, createdAt",modelesRapport:"id, typeRapportCode, nom, estPublic, auteur, createdAt",resultatsKPI:"id, centreId, typeKPI, [periodeDebut+periodeFin], dateCalcul, createdAt",insights:"id, centreId, type, severite, traitee, dateDetection, createdAt",reglesAlerte:"id, centreId, type, actif, priorite, createdAt",alertesGenerees:"id, centreId, regleId, priorite, lue, traitee, dateGeneration, createdAt",tendancesPrediction:"id, centreId, kpi, dateCalcul, createdAt",benchmarks:"id, centreId, kpi, dateComparaison, createdAt",configurationsBI:"id, centreId, createdAt",projets:"id, centreId, statut, dateSoftOpening, dateInauguration, createdAt",phasesProjet:"id, projetId, numero, statut, createdAt",jalons:"id, projetId, code, importance, statut, dateCible, ordre, createdAt",vaguesRecrutement:"id, projetId, numero, priorite, createdAt",postesARecruter:"id, projetId, vagueId, departement, statut, priorite, createdAt",prospectsCommerciaux:"id, projetId, enseigne, categorie, statut, probabilite, estLocomotive, createdAt",suiviBEFA:"id, projetId, prospectId, enseigne, vague, statut, createdAt",reserves:"id, projetId, numero, lot, classification, statut, createdAt",documentsDOE:"id, projetId, lot, type, obligatoire, recu, conforme, createdAt",risquesProjet:"id, projetId, code, categorie, criticite, statut, createdAt",actionsCommunication:"id, projetId, type, periode, statut, createdAt",evenementsLancement:"id, projetId, type, date, statut, createdAt",phasesHandover:"id, projetId, code, statut, createdAt",jalonsCommerciaux:"id, projetId, date, statut, createdAt"}),this.version(4).stores({centres:"id, code, nom, statut, modeExploitationActif, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut",fichiersImport:"id, centreId, dossierId, categorie, statut, dateImport, version, createdAt",dossiersImport:"id, centreId, parentId, categorie, ordre, createdAt",etatsLocatifs:"id, centreId, fichierImportId, lotId, locataireEnseigne, statutOccupation, createdAt",donneesLoyers:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], statut, createdAt",donneesFrequentation:"id, centreId, fichierImportId, date, zone, createdAt",donneesChiffreAffaires:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], createdAt",donneesCharges:"id, centreId, fichierImportId, categorieCharge, [periodeAnnee+periodeMois], createdAt",donneesBaux:"id, centreId, fichierImportId, lotId, locataireEnseigne, dateFin, createdAt",donneesTravaux:"id, centreId, fichierImportId, reference, categorie, statut, createdAt",donneesValorisation:"id, centreId, fichierImportId, dateValorisation, createdAt",donneesEnergie:"id, centreId, fichierImportId, typeEnergie, [periodeAnnee+periodeMois], createdAt",donneesSatisfaction:"id, centreId, fichierImportId, date, typeEnquete, createdAt",typesRapport:"id, code, categorie, complexite, actif, createdAt",packsRapport:"id, code, nom, createdAt",rapports:"id, centreId, typeRapportCode, statut, auteur, dateCreation, createdAt",modelesRapport:"id, typeRapportCode, nom, estPublic, auteur, createdAt",resultatsKPI:"id, centreId, typeKPI, [periodeDebut+periodeFin], dateCalcul, createdAt",insights:"id, centreId, type, severite, traitee, dateDetection, createdAt",reglesAlerte:"id, centreId, type, actif, priorite, createdAt",alertesGenerees:"id, centreId, regleId, priorite, lue, traitee, dateGeneration, createdAt",tendancesPrediction:"id, centreId, kpi, dateCalcul, createdAt",benchmarks:"id, centreId, kpi, dateComparaison, createdAt",configurationsBI:"id, centreId, createdAt",projets:"id, centreId, statut, dateSoftOpening, dateInauguration, createdAt",phasesProjet:"id, projetId, numero, statut, createdAt",jalons:"id, projetId, code, importance, statut, dateCible, ordre, createdAt",vaguesRecrutement:"id, projetId, numero, priorite, createdAt",postesARecruter:"id, projetId, vagueId, departement, statut, priorite, createdAt",prospectsCommerciaux:"id, projetId, enseigne, categorie, statut, probabilite, estLocomotive, createdAt",suiviBEFA:"id, projetId, prospectId, enseigne, vague, statut, createdAt",reserves:"id, projetId, numero, lot, classification, statut, createdAt",documentsDOE:"id, projetId, lot, type, obligatoire, recu, conforme, createdAt",risquesProjet:"id, projetId, code, categorie, criticite, statut, createdAt",actionsCommunication:"id, projetId, type, periode, statut, createdAt",evenementsLancement:"id, projetId, type, date, statut, createdAt",phasesHandover:"id, projetId, code, statut, createdAt",jalonsCommerciaux:"id, projetId, date, statut, createdAt"}).upgrade(async e=>{await e.table("centres").toCollection().modify(t=>{t.modeExploitationActif=t.statut==="actif"})}),this.version(5).stores({centres:"id, code, nom, statut, modeExploitationActif, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",membresEquipe:"id, centreId, matricule, nom, prenom, departement, typeContrat, statut, managerId, dateEmbauche, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut",fichiersImport:"id, centreId, dossierId, categorie, statut, dateImport, version, createdAt",dossiersImport:"id, centreId, parentId, categorie, ordre, createdAt",etatsLocatifs:"id, centreId, fichierImportId, lotId, locataireEnseigne, statutOccupation, createdAt",donneesLoyers:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], statut, createdAt",donneesFrequentation:"id, centreId, fichierImportId, date, zone, createdAt",donneesChiffreAffaires:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], createdAt",donneesCharges:"id, centreId, fichierImportId, categorieCharge, [periodeAnnee+periodeMois], createdAt",donneesBaux:"id, centreId, fichierImportId, lotId, locataireEnseigne, dateFin, createdAt",donneesTravaux:"id, centreId, fichierImportId, reference, categorie, statut, createdAt",donneesValorisation:"id, centreId, fichierImportId, dateValorisation, createdAt",donneesEnergie:"id, centreId, fichierImportId, typeEnergie, [periodeAnnee+periodeMois], createdAt",donneesSatisfaction:"id, centreId, fichierImportId, date, typeEnquete, createdAt",typesRapport:"id, code, categorie, complexite, actif, createdAt",packsRapport:"id, code, nom, createdAt",rapports:"id, centreId, typeRapportCode, statut, auteur, dateCreation, createdAt",modelesRapport:"id, typeRapportCode, nom, estPublic, auteur, createdAt",resultatsKPI:"id, centreId, typeKPI, [periodeDebut+periodeFin], dateCalcul, createdAt",insights:"id, centreId, type, severite, traitee, dateDetection, createdAt",reglesAlerte:"id, centreId, type, actif, priorite, createdAt",alertesGenerees:"id, centreId, regleId, priorite, lue, traitee, dateGeneration, createdAt",tendancesPrediction:"id, centreId, kpi, dateCalcul, createdAt",benchmarks:"id, centreId, kpi, dateComparaison, createdAt",configurationsBI:"id, centreId, createdAt",projets:"id, centreId, statut, dateSoftOpening, dateInauguration, createdAt",phasesProjet:"id, projetId, numero, statut, createdAt",jalons:"id, projetId, code, importance, statut, dateCible, ordre, createdAt",vaguesRecrutement:"id, projetId, numero, priorite, createdAt",postesARecruter:"id, projetId, vagueId, departement, statut, priorite, createdAt",prospectsCommerciaux:"id, projetId, enseigne, categorie, statut, probabilite, estLocomotive, createdAt",suiviBEFA:"id, projetId, prospectId, enseigne, vague, statut, createdAt",reserves:"id, projetId, numero, lot, classification, statut, createdAt",documentsDOE:"id, projetId, lot, type, obligatoire, recu, conforme, createdAt",risquesProjet:"id, projetId, code, categorie, criticite, statut, createdAt",actionsCommunication:"id, projetId, type, periode, statut, createdAt",evenementsLancement:"id, projetId, type, date, statut, createdAt",phasesHandover:"id, projetId, code, statut, createdAt",jalonsCommerciaux:"id, projetId, date, statut, createdAt"}),this.version(6).stores({centres:"id, code, nom, statut, modeExploitationActif, ville, createdAt",postes:"id, centreId, departement, titre, titulaire, createdAt",membresEquipe:"id, centreId, matricule, nom, prenom, departement, typeContrat, statut, managerId, dateEmbauche, createdAt",axes:"id, centreId, code, ordre, createdAt",objectifs:"id, axeId, centreId, code, responsableId, frequenceMesure, createdAt",mesures:"id, objectifId, centreId, [periode.annee+periode.mois], statut, dateSaisie, createdAt",actions:"id, centreId, axeId, objectifId, statut, priorite, responsableId, dateEcheance, createdAt",reunions:"id, centreId, type, date, statut, createdAt",livrables:"id, centreId, axeId, frequence, createdAt",evaluations:"id, centreId, posteId, [periode.annee+periode.mois], statut, createdAt",audits:"id, centreId, type, datePlanifiee, statut, createdAt",risques:"id, centreId, categorie, statut, scoreRisque, createdAt",alertes:"id, centreId, type, priorite, lue, traitee, dateCreation",parametres:"id",importLogs:"id, centreId, typeImport, dateImport, statut",fichiersImport:"id, centreId, dossierId, categorie, statut, dateImport, version, createdAt",dossiersImport:"id, centreId, parentId, categorie, ordre, createdAt",etatsLocatifs:"id, centreId, fichierImportId, lotId, locataireEnseigne, statutOccupation, createdAt",donneesLoyers:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], statut, createdAt",donneesFrequentation:"id, centreId, fichierImportId, date, zone, createdAt",donneesChiffreAffaires:"id, centreId, fichierImportId, lotId, [periodeAnnee+periodeMois], createdAt",donneesCharges:"id, centreId, fichierImportId, categorieCharge, [periodeAnnee+periodeMois], createdAt",donneesBaux:"id, centreId, fichierImportId, lotId, locataireEnseigne, dateFin, createdAt",donneesTravaux:"id, centreId, fichierImportId, reference, categorie, statut, createdAt",donneesValorisation:"id, centreId, fichierImportId, dateValorisation, createdAt",donneesEnergie:"id, centreId, fichierImportId, typeEnergie, [periodeAnnee+periodeMois], createdAt",donneesSatisfaction:"id, centreId, fichierImportId, date, typeEnquete, createdAt",typesRapport:"id, code, categorie, complexite, actif, createdAt",packsRapport:"id, code, nom, createdAt",rapports:"id, centreId, typeRapportCode, statut, auteur, dateCreation, createdAt",modelesRapport:"id, typeRapportCode, nom, estPublic, auteur, createdAt",resultatsKPI:"id, centreId, typeKPI, [periodeDebut+periodeFin], dateCalcul, createdAt",insights:"id, centreId, type, severite, traitee, dateDetection, createdAt",reglesAlerte:"id, centreId, type, actif, priorite, createdAt",alertesGenerees:"id, centreId, regleId, priorite, lue, traitee, dateGeneration, createdAt",tendancesPrediction:"id, centreId, kpi, dateCalcul, createdAt",benchmarks:"id, centreId, kpi, dateComparaison, createdAt",configurationsBI:"id, centreId, createdAt",projets:"id, centreId, statut, dateSoftOpening, dateInauguration, createdAt",phasesProjet:"id, projetId, numero, statut, createdAt",jalons:"id, projetId, code, importance, statut, dateCible, ordre, createdAt",vaguesRecrutement:"id, projetId, numero, priorite, createdAt",postesARecruter:"id, projetId, vagueId, departement, statut, priorite, createdAt",prospectsCommerciaux:"id, projetId, enseigne, categorie, statut, probabilite, estLocomotive, createdAt",suiviBEFA:"id, projetId, prospectId, enseigne, vague, statut, createdAt",reserves:"id, projetId, numero, lot, classification, statut, createdAt",documentsDOE:"id, projetId, lot, type, obligatoire, recu, conforme, createdAt",risquesProjet:"id, projetId, code, categorie, criticite, statut, createdAt",actionsCommunication:"id, projetId, type, periode, statut, createdAt",evenementsLancement:"id, projetId, type, date, statut, createdAt",phasesHandover:"id, projetId, code, statut, createdAt",jalonsCommerciaux:"id, projetId, date, statut, createdAt",userProfile:"id, email, createdAt",backupHistory:"id, date, type, cible, statut, createdAt",journalModifications:"id, date, action, table, centreId, createdAt",periodesCloturees:"id, centreId, [annee+mois], dateCloture, createdAt",documents:"id, centreId, categorie, entiteType, entiteId, typeStockage, dateAjout, *tags, createdAt",mappingHistory:"id, templateType, dateCreation, nombreUtilisations"}),this.version(7).stores({authCredentials:"id, email, createdAt"})}}const l=new or;async function nr(){await l.parametres.get("default")||await l.parametres.add({id:"default",theme:"light",langue:"fr",configEmail:{provider:"none",recipients:{primary:"",cc:[]},preferences:{digestMode:!1,digestTime:"18:00",digestDays:[1,2,3,4,5],immediateFor:["critique","haute"]},actif:!1},versionDonnees:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}async function no(){const i={version:1,exportDate:new Date().toISOString(),centres:await l.centres.toArray(),postes:await l.postes.toArray(),axes:await l.axes.toArray(),objectifs:await l.objectifs.toArray(),mesures:await l.mesures.toArray(),actions:await l.actions.toArray(),reunions:await l.reunions.toArray(),livrables:await l.livrables.toArray(),evaluations:await l.evaluations.toArray(),audits:await l.audits.toArray(),risques:await l.risques.toArray(),alertes:await l.alertes.toArray(),parametres:await l.parametres.toArray()};return JSON.stringify(i,null,2)}const cr={deviseMonetaire:"XOF",exerciceFiscal:{debut:1,fin:12},objectifsAnnee:new Date().getFullYear(),seuilsAlerte:{kpiRouge:70,kpiOrange:90,retardAction:3,rappelSaisie:5}},Q=q((i,s)=>({centres:[],isLoading:!1,error:null,loadCentres:async()=>{i({isLoading:!0,error:null});try{const e=await l.centres.orderBy("createdAt").reverse().toArray();i({centres:e,isLoading:!1})}catch(e){i({error:`Erreur de chargement: ${e}`,isLoading:!1})}},getCentre:e=>s().centres.find(t=>t.id===e),addCentre:async e=>{const t=new Date().toISOString(),r={...e,id:E(),configuration:e.configuration||cr,modeExploitationActif:e.modeExploitationActif??e.statut==="actif",createdAt:t,updatedAt:t};return await l.centres.add(r),i(a=>({centres:[r,...a.centres]})),r},updateCentre:async(e,t)=>{const r=new Date().toISOString();await l.centres.update(e,{...t,updatedAt:r}),i(a=>({centres:a.centres.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteCentre:async e=>{await l.centres.delete(e),await l.postes.where("centreId").equals(e).delete(),await l.axes.where("centreId").equals(e).delete(),await l.objectifs.where("centreId").equals(e).delete(),await l.mesures.where("centreId").equals(e).delete(),await l.actions.where("centreId").equals(e).delete(),await l.reunions.where("centreId").equals(e).delete(),i(t=>({centres:t.centres.filter(r=>r.id!==e)}))}})),lr=[{code:"AXE1",nom:"Performance Financi√®re",couleur:"#3b82f6",icone:"TrendingUp",poids:25},{code:"AXE2",nom:"Excellence Op√©rationnelle",couleur:"#10b981",icone:"Settings",poids:20},{code:"AXE3",nom:"Gouvernance & Conformit√©",couleur:"#8b5cf6",icone:"Shield",poids:15},{code:"AXE4",nom:"D√©veloppement Commercial",couleur:"#f97316",icone:"Store",poids:20},{code:"AXE5",nom:"Leadership & Capital Humain",couleur:"#ec4899",icone:"Users",poids:10},{code:"AXE6",nom:"Relations Stakeholders",couleur:"#06b6d4",icone:"Handshake",poids:10}],co=q((i,s)=>({axes:[],objectifs:[],isLoading:!1,error:null,loadAxes:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.axes.where("centreId").equals(e).sortBy("ordre"):t=await l.axes.orderBy("ordre").toArray(),i({axes:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getAxesByCentre:e=>s().axes.filter(t=>t.centreId===e).sort((t,r)=>t.ordre-r.ordre),addAxe:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.axes.add(r),i(a=>({axes:[...a.axes,r]})),r},updateAxe:async(e,t)=>{const r=new Date().toISOString();await l.axes.update(e,{...t,updatedAt:r}),i(a=>({axes:a.axes.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteAxe:async e=>{await l.axes.delete(e),await l.objectifs.where("axeId").equals(e).delete(),i(t=>({axes:t.axes.filter(r=>r.id!==e),objectifs:t.objectifs.filter(r=>r.axeId!==e)}))},loadObjectifs:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.objectifs.where("centreId").equals(e).toArray():t=await l.objectifs.toArray(),i({objectifs:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getObjectifsByAxe:e=>s().objectifs.filter(t=>t.axeId===e),getObjectifsByCentre:e=>s().objectifs.filter(t=>t.centreId===e),addObjectif:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.objectifs.add(r),i(a=>({objectifs:[...a.objectifs,r]})),r},updateObjectif:async(e,t)=>{const r=new Date().toISOString();await l.objectifs.update(e,{...t,updatedAt:r}),i(a=>({objectifs:a.objectifs.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteObjectif:async e=>{await l.objectifs.delete(e),i(t=>({objectifs:t.objectifs.filter(r=>r.id!==e)}))},initializeDefaultAxes:async e=>{const t=new Date().toISOString(),r=lr.map((a,o)=>({...a,id:E(),centreId:e,description:`Axe strat√©gique ${a.nom}`,ordre:o+1,createdAt:t,updatedAt:t}));await l.axes.bulkAdd(r),i(a=>({axes:[...a.axes,...r]}))}})),lo=q((i,s)=>({mesures:[],isLoading:!1,error:null,loadMesures:async(e,t)=>{i({isLoading:!0,error:null});try{let r;t?r=await l.mesures.where("objectifId").equals(t).toArray():e?r=await l.mesures.where("centreId").equals(e).toArray():r=await l.mesures.toArray(),r.sort((a,o)=>new Date(o.dateSaisie).getTime()-new Date(a.dateSaisie).getTime()),i({mesures:r,isLoading:!1})}catch(r){i({error:`Erreur de chargement: ${r}`,isLoading:!1})}},getMesuresByObjectif:e=>s().mesures.filter(t=>t.objectifId===e),getMesuresByPeriode:(e,t)=>s().mesures.filter(r=>r.centreId===e&&r.periode.annee===t.annee&&(t.mois===void 0||r.periode.mois===t.mois)&&(t.trimestre===void 0||r.periode.trimestre===t.trimestre)),getLastMesure:e=>s().getMesuresByObjectif(e)[0],addMesure:async e=>{const t=new Date().toISOString(),{ecart:r,ecartPourcentage:a}=s().calculerEcart(e.valeurReelle,e.valeurCible),o={...e,id:E(),ecart:r,ecartPourcentage:a,createdAt:t,updatedAt:t};return await l.mesures.add(o),i(n=>({mesures:[o,...n.mesures]})),o},updateMesure:async(e,t)=>{const r=new Date().toISOString();let a={...t,updatedAt:r};if(t.valeurReelle!==void 0||t.valeurCible!==void 0){const o=s().mesures.find(n=>n.id===e);if(o){const n=t.valeurReelle??o.valeurReelle,d=t.valeurCible??o.valeurCible,{ecart:u,ecartPourcentage:p}=s().calculerEcart(n,d);a={...a,ecart:u,ecartPourcentage:p}}}await l.mesures.update(e,a),i(o=>({mesures:o.mesures.map(n=>n.id===e?{...n,...a}:n)}))},deleteMesure:async e=>{await l.mesures.delete(e),i(t=>({mesures:t.mesures.filter(r=>r.id!==e)}))},calculerStatut:(e,t,r,a)=>t>a?e>=t?"vert":e>=r?"orange":"rouge":e<=t?"vert":e<=r?"orange":"rouge",calculerEcart:(e,t)=>{const r=e-t,a=t!==0?(e-t)/t*100:0;return{ecart:r,ecartPourcentage:Math.round(a*100)/100}}})),uo=q((i,s)=>({actions:[],isLoading:!1,error:null,loadActions:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.actions.where("centreId").equals(e).toArray():t=await l.actions.toArray(),t.sort((r,a)=>{const o={critique:0,haute:1,moyenne:2,basse:3};return o[r.priorite]!==o[a.priorite]?o[r.priorite]-o[a.priorite]:new Date(r.dateEcheance).getTime()-new Date(a.dateEcheance).getTime()}),i({actions:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getActionsByCentre:e=>s().actions.filter(t=>t.centreId===e),getActionsByStatut:e=>s().actions.filter(t=>t.statut===e),getActionsByAxe:e=>s().actions.filter(t=>t.axeId===e),getActionsEnRetard:()=>{const e=new Date;return s().actions.filter(t=>t.statut!=="termine"&&t.statut!=="annule"&&new Date(t.dateEcheance)<e)},addAction:async e=>{const t=new Date().toISOString(),r={...e,id:E(),sousActions:e.sousActions||[],risques:e.risques||[],commentaires:e.commentaires||[],contributeurs:e.contributeurs||[],createdAt:t,updatedAt:t};return await l.actions.add(r),i(a=>({actions:[...a.actions,r]})),r},updateAction:async(e,t)=>{const r=new Date().toISOString();await l.actions.update(e,{...t,updatedAt:r}),i(a=>({actions:a.actions.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteAction:async e=>{await l.actions.delete(e),i(t=>({actions:t.actions.filter(r=>r.id!==e)}))},addSousAction:async(e,t)=>{const r={...t,id:E()},a=s().actions.find(o=>o.id===e);if(a){const o=[...a.sousActions,r];await s().updateAction(e,{sousActions:o})}},updateSousAction:async(e,t,r)=>{const a=s().actions.find(o=>o.id===e);if(a){const o=a.sousActions.map(n=>n.id===t?{...n,...r}:n);await s().updateAction(e,{sousActions:o})}},deleteSousAction:async(e,t)=>{const r=s().actions.find(a=>a.id===e);if(r){const a=r.sousActions.filter(o=>o.id!==t);await s().updateAction(e,{sousActions:a})}},addCommentaire:async(e,t,r)=>{const a={id:E(),auteur:t,contenu:r,date:new Date().toISOString()},o=s().actions.find(n=>n.id===e);if(o){const n=[...o.commentaires,a];await s().updateAction(e,{commentaires:n})}},changerStatut:async(e,t)=>{const r={statut:t};t==="termine"&&(r.dateRealisation=new Date().toISOString(),r.avancement=100),await s().updateAction(e,r)},calculerAvancement:e=>{if(e.sousActions.length===0)return e.avancement;const t=e.sousActions.reduce((r,a)=>r+a.avancement,0);return Math.round(t/e.sousActions.length)}})),y={colors:{primary:"#1E3A5F",primaryDark:"#0F1F33",success:"#059669",warning:"#D97706",danger:"#DC2626",info:"#0284C7",gray:"#6B7280",grayLight:"#F3F4F6"},fonts:{primary:"'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif",heading:"'Segoe UI Semibold', Roboto, 'Helvetica Neue', Arial, sans-serif"}},B=(i,s,e)=>`
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${i}</title>
  <!--[if mso]>
  <style type="text/css">
    table { border-collapse: collapse; }
    td { padding: 0; }
  </style>
  <![endif]-->
</head>
<body style="margin: 0; padding: 0; background-color: #F3F4F6; font-family: ${y.fonts.primary};">
  <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: #F3F4F6;">
    <tr>
      <td align="center" style="padding: 40px 20px;">
        <table role="presentation" width="600" cellspacing="0" cellpadding="0" border="0" style="background-color: #FFFFFF; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
          <!-- Header avec logo -->
          <tr>
            <td style="background: linear-gradient(135deg, ${e} 0%, ${y.colors.primaryDark} 100%); padding: 30px 40px; text-align: center;">
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    <span style="font-size: 48px;">${s}</span>
                  </td>
                </tr>
                <tr>
                  <td style="padding-top: 15px; text-align: center;">
                    <h1 style="margin: 0; color: #FFFFFF; font-size: 24px; font-weight: 600; font-family: ${y.fonts.heading};">
                      ${i}
                    </h1>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
`,V=(i=!0)=>`
          <!-- Footer -->
          <tr>
            <td style="background-color: ${y.colors.grayLight}; padding: 30px 40px; text-align: center; border-top: 1px solid #E5E7EB;">
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 15px;">
                    <img src="https://via.placeholder.com/120x40/1E3A5F/FFFFFF?text=COCKPIT" alt="Cockpit" style="height: 40px;" />
                  </td>
                </tr>
                <tr>
                  <td style="text-align: center; color: ${y.colors.gray}; font-size: 12px; line-height: 1.6;">
                    <p style="margin: 0 0 10px 0;">
                      Cockpit - Plateforme de Pilotage Immobilier Commercial
                    </p>
                    <p style="margin: 0 0 10px 0;">
                      Cet email a √©t√© envoy√© automatiquement. Ne pas r√©pondre directement.
                    </p>
                    ${i?`
                    <p style="margin: 0;">
                      <a href="{{unsubscribe_link}}" style="color: ${y.colors.info}; text-decoration: none;">
                        G√©rer mes pr√©f√©rences de notification
                      </a>
                    </p>
                    `:""}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
`,$=(i,s,e=y.colors.primary)=>`
<table role="presentation" cellspacing="0" cellpadding="0" border="0" style="margin: 0 auto;">
  <tr>
    <td style="border-radius: 6px; background-color: ${e};">
      <a href="${s}" target="_blank" style="display: inline-block; padding: 14px 32px; color: #FFFFFF; text-decoration: none; font-weight: 600; font-size: 14px; font-family: ${y.fonts.primary};">
        ${i}
      </a>
    </td>
  </tr>
</table>
`,G=(i,s,e,t="#F9FAFB")=>`
<td style="padding: 12px; background-color: ${t}; border-radius: 6px; border: 1px solid #E5E7EB;">
  <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
    <tr>
      <td style="font-size: 20px; padding-right: 10px; vertical-align: top;">${i}</td>
      <td style="vertical-align: top;">
        <p style="margin: 0; color: ${y.colors.gray}; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">${s}</p>
        <p style="margin: 4px 0 0 0; color: ${y.colors.primaryDark}; font-size: 16px; font-weight: 600;">${e}</p>
      </td>
    </tr>
  </table>
</td>
`,dr=`
${B("Alerte Critique","üö®",y.colors.danger)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Badge de priorit√© -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 20px;">
                    <span style="display: inline-block; background-color: #FEE2E2; color: ${y.colors.danger}; padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                      ‚ö†Ô∏è Action Imm√©diate Requise
                    </span>
                  </td>
                </tr>
              </table>

              <!-- Titre de l'alerte -->
              <h2 style="margin: 0 0 20px 0; color: ${y.colors.danger}; font-size: 22px; font-weight: 600; text-align: center; font-family: ${y.fonts.heading};">
                {{titre}}
              </h2>

              <!-- Message -->
              <div style="background-color: #FEF2F2; border-left: 4px solid ${y.colors.danger}; padding: 20px; border-radius: 0 6px 6px 0; margin-bottom: 30px;">
                <p style="margin: 0; color: #991B1B; font-size: 15px; line-height: 1.6;">
                  {{message}}
                </p>
              </div>

              <!-- Informations -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                <tr>
                  ${G("üè¢","Centre","{{centre}}")}
                  <td style="width: 20px;"></td>
                  ${G("üìÖ","Date","{{date}}")}
                </tr>
              </table>

              <!-- Bouton CTA -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Voir dans Cockpit ‚Üí","{{lien}}",y.colors.danger)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,ur=`
${B("Alerte Importante","‚ö†Ô∏è",y.colors.warning)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Badge -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 20px;">
                    <span style="display: inline-block; background-color: #FEF3C7; color: ${y.colors.warning}; padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                      Attention Requise
                    </span>
                  </td>
                </tr>
              </table>

              <!-- Titre -->
              <h2 style="margin: 0 0 20px 0; color: #92400E; font-size: 22px; font-weight: 600; text-align: center;">
                {{titre}}
              </h2>

              <!-- Message -->
              <div style="background-color: #FFFBEB; border-left: 4px solid ${y.colors.warning}; padding: 20px; border-radius: 0 6px 6px 0; margin-bottom: 30px;">
                <p style="margin: 0; color: #78350F; font-size: 15px; line-height: 1.6;">
                  {{message}}
                </p>
              </div>

              <!-- D√©tails -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                <tr>
                  ${G("üè¢","Centre","{{centre}}")}
                  <td style="width: 20px;"></td>
                  ${G("üìÖ","Date","{{date}}")}
                </tr>
              </table>

              <!-- Actions sugg√©r√©es -->
              <div style="background-color: #F9FAFB; padding: 20px; border-radius: 6px; margin-bottom: 30px;">
                <h4 style="margin: 0 0 12px 0; color: ${y.colors.primaryDark}; font-size: 14px; font-weight: 600;">
                  üí° Actions sugg√©r√©es:
                </h4>
                <ul style="margin: 0; padding-left: 20px; color: ${y.colors.gray}; font-size: 14px; line-height: 1.8;">
                  <li>V√©rifiez les donn√©es concern√©es dans le tableau de bord</li>
                  <li>Consultez l'historique pour identifier la cause</li>
                  <li>Prenez les mesures correctives n√©cessaires</li>
                </ul>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Consulter dans Cockpit","{{lien}}",y.colors.warning)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,pr=`
${B("Information","‚ÑπÔ∏è",y.colors.info)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <h2 style="margin: 0 0 20px 0; color: ${y.colors.primaryDark}; font-size: 22px; font-weight: 600; text-align: center;">
                {{titre}}
              </h2>

              <div style="background-color: #EFF6FF; border-left: 4px solid ${y.colors.info}; padding: 20px; border-radius: 0 6px 6px 0; margin-bottom: 30px;">
                <p style="margin: 0; color: #1E40AF; font-size: 15px; line-height: 1.6;">
                  {{message}}
                </p>
              </div>

              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                <tr>
                  ${G("üè¢","Centre","{{centre}}")}
                  <td style="width: 20px;"></td>
                  ${G("üïê","Date","{{date}}")}
                </tr>
              </table>

              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("En savoir plus","{{lien}}",y.colors.info)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,mr=`
${B("R√©sum√© Hebdomadaire","üìä",y.colors.primary)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- P√©riode -->
              <p style="text-align: center; color: ${y.colors.gray}; font-size: 14px; margin: 0 0 30px 0;">
                Semaine du <strong>{{dateDebut}}</strong> au <strong>{{dateFin}}</strong>
              </p>

              <!-- R√©sum√© rapide -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                <tr>
                  <td style="padding: 20px; background-color: #FEF2F2; border-radius: 8px; text-align: center; width: 33%;">
                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: ${y.colors.danger};">{{nbAlertesCritiques}}</p>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: ${y.colors.gray}; text-transform: uppercase;">Critiques</p>
                  </td>
                  <td style="width: 10px;"></td>
                  <td style="padding: 20px; background-color: #FEF3C7; border-radius: 8px; text-align: center; width: 33%;">
                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: ${y.colors.warning};">{{nbAlertesImportantes}}</p>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: ${y.colors.gray}; text-transform: uppercase;">Importantes</p>
                  </td>
                  <td style="width: 10px;"></td>
                  <td style="padding: 20px; background-color: #D1FAE5; border-radius: 8px; text-align: center; width: 33%;">
                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: ${y.colors.success};">{{nbObjectifsVerts}}</p>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: ${y.colors.gray}; text-transform: uppercase;">Objectifs ‚úì</p>
                  </td>
                </tr>
              </table>

              <!-- Section Alertes -->
              <div style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 15px 0; color: ${y.colors.primaryDark}; font-size: 16px; font-weight: 600; border-bottom: 2px solid #E5E7EB; padding-bottom: 10px;">
                  üîî Alertes de la semaine
                </h3>
                {{alertesHtml}}
              </div>

              <!-- Section √âch√©ances -->
              <div style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 15px 0; color: ${y.colors.primaryDark}; font-size: 16px; font-weight: 600; border-bottom: 2px solid #E5E7EB; padding-bottom: 10px;">
                  üìÖ √âch√©ances √† venir
                </h3>
                {{echeancesHtml}}
              </div>

              <!-- Section KPIs -->
              <div style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 15px 0; color: ${y.colors.primaryDark}; font-size: 16px; font-weight: 600; border-bottom: 2px solid #E5E7EB; padding-bottom: 10px;">
                  üìà Performance des KPIs
                </h3>
                {{kpisHtml}}
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Acc√©der au tableau de bord","{{lien}}")}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,gr=`
${B("Rappel Expiration Bail","üìã","#7C3AED")}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Urgence -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 20px;">
                    <span style="display: inline-block; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); color: #92400E; padding: 8px 20px; border-radius: 25px; font-size: 14px; font-weight: 700;">
                      ‚è∞ {{joursRestants}} jours restants
                    </span>
                  </td>
                </tr>
              </table>

              <!-- Message introductif -->
              <p style="text-align: center; color: ${y.colors.gray}; font-size: 15px; margin: 0 0 30px 0; line-height: 1.6;">
                Le bail suivant arrive √† expiration. Pensez √† pr√©parer le renouvellement ou la relocation.
              </p>

              <!-- D√©tails du bail -->
              <div style="background-color: #F9FAFB; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  <tr>
                    <td style="padding: 12px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="width: 30px; font-size: 18px;">üë§</td>
                          <td style="color: ${y.colors.gray}; font-size: 13px;">Locataire</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600; font-size: 15px;">{{locataire}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 12px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="width: 30px; font-size: 18px;">üè™</td>
                          <td style="color: ${y.colors.gray}; font-size: 13px;">Local</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600; font-size: 15px;">{{local}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 12px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="width: 30px; font-size: 18px;">üè¢</td>
                          <td style="color: ${y.colors.gray}; font-size: 13px;">Centre</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600; font-size: 15px;">{{centre}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 12px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="width: 30px; font-size: 18px;">üí∞</td>
                          <td style="color: ${y.colors.gray}; font-size: 13px;">Loyer mensuel</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600; font-size: 15px;">{{loyerMensuel}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 12px 0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="width: 30px; font-size: 18px;">üìÖ</td>
                          <td style="color: ${y.colors.gray}; font-size: 13px;">Date d'expiration</td>
                          <td style="text-align: right; color: ${y.colors.danger}; font-weight: 700; font-size: 15px;">{{dateExpiration}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </div>

              <!-- Actions sugg√©r√©es -->
              <div style="background-color: #EFF6FF; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h4 style="margin: 0 0 12px 0; color: #1E40AF; font-size: 14px; font-weight: 600;">
                  üìù Prochaines √©tapes recommand√©es:
                </h4>
                <ol style="margin: 0; padding-left: 20px; color: #1E40AF; font-size: 14px; line-height: 2;">
                  <li>Contacter le locataire pour conna√Ætre ses intentions</li>
                  <li>Pr√©parer une proposition de renouvellement</li>
                  <li>Mettre √† jour le dossier locataire</li>
                </ol>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("G√©rer ce bail","{{lien}}","#7C3AED")}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,fr=`
${B("Objectif Atteint !","üéØ",y.colors.success)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- C√©l√©bration -->
              <div style="text-align: center; margin-bottom: 30px;">
                <span style="font-size: 64px;">üéâ</span>
                <h2 style="margin: 20px 0 0 0; color: ${y.colors.success}; font-size: 28px; font-weight: 700;">
                  F√©licitations !
                </h2>
                <p style="margin: 10px 0 0 0; color: ${y.colors.gray}; font-size: 16px;">
                  Un objectif vient de passer au vert
                </p>
              </div>

              <!-- D√©tails de l'objectif -->
              <div style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border-radius: 12px; padding: 30px; margin-bottom: 30px; text-align: center;">
                <p style="margin: 0 0 10px 0; color: ${y.colors.success}; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">
                  {{axe}}
                </p>
                <h3 style="margin: 0 0 15px 0; color: #065F46; font-size: 22px; font-weight: 700;">
                  {{objectif}}
                </h3>
                <div style="display: inline-block; background-color: #FFFFFF; padding: 15px 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <p style="margin: 0; color: ${y.colors.gray}; font-size: 12px;">Valeur atteinte</p>
                  <p style="margin: 5px 0 0 0; color: ${y.colors.success}; font-size: 28px; font-weight: 700;">{{valeur}}</p>
                </div>
              </div>

              <!-- Progression -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                <tr>
                  ${G("üè¢","Centre","{{centre}}","#F0FDF4")}
                  <td style="width: 20px;"></td>
                  ${G("üìà","Progression","{{progression}}","#F0FDF4")}
                </tr>
              </table>

              <!-- Message motivant -->
              <div style="background-color: #F9FAFB; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 30px;">
                <p style="margin: 0; color: ${y.colors.gray}; font-size: 14px; font-style: italic;">
                  "{{messageMotivation}}"
                </p>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Voir le d√©tail","{{lien}}",y.colors.success)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,hr=`
${B("Import Termin√©","üì•",y.colors.info)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Statut -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 25px;">
                    <span style="display: inline-block; background-color: {{statutBg}}; color: {{statutColor}}; padding: 8px 20px; border-radius: 25px; font-size: 14px; font-weight: 600;">
                      {{statutIcon}} {{statutTexte}}
                    </span>
                  </td>
                </tr>
              </table>

              <!-- Titre -->
              <h2 style="margin: 0 0 25px 0; color: ${y.colors.primaryDark}; font-size: 22px; font-weight: 600; text-align: center;">
                Import de donn√©es termin√©
              </h2>

              <!-- R√©sum√© -->
              <div style="background-color: #F9FAFB; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üìÅ Fichier</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600;">{{fichier}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üìä Type d'import</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600;">{{typeImport}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">‚úÖ Lignes import√©es</td>
                          <td style="text-align: right; color: ${y.colors.success}; font-weight: 600;">{{lignesImportees}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">‚ùå Erreurs</td>
                          <td style="text-align: right; color: {{erreursColor}}; font-weight: 600;">{{lignesErreur}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">‚≠ê Score qualit√©</td>
                          <td style="text-align: right; color: {{scoreColor}}; font-weight: 700; font-size: 18px;">{{scoreQualite}}%</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </div>

              <!-- Barre de progression -->
              <div style="margin-bottom: 30px;">
                <p style="margin: 0 0 8px 0; color: ${y.colors.gray}; font-size: 12px;">Qualit√© de l'import</p>
                <div style="background-color: #E5E7EB; border-radius: 10px; height: 12px; overflow: hidden;">
                  <div style="background: linear-gradient(90deg, {{scoreGradient}}); width: {{scoreQualite}}%; height: 100%; border-radius: 10px;"></div>
                </div>
              </div>

              <!-- Erreurs si pr√©sentes -->
              {{erreursHtml}}

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Voir le d√©tail de l'import","{{lien}}",y.colors.info)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,yr=`
${B("Sauvegarde Effectu√©e","üíæ",y.colors.success)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Confirmation -->
              <div style="text-align: center; margin-bottom: 30px;">
                <div style="display: inline-block; background-color: #D1FAE5; border-radius: 50%; padding: 20px;">
                  <span style="font-size: 40px;">‚úÖ</span>
                </div>
                <h2 style="margin: 20px 0 0 0; color: ${y.colors.success}; font-size: 24px; font-weight: 600;">
                  Sauvegarde r√©ussie
                </h2>
                <p style="margin: 10px 0 0 0; color: ${y.colors.gray}; font-size: 15px;">
                  Vos donn√©es ont √©t√© sauvegard√©es avec succ√®s
                </p>
              </div>

              <!-- D√©tails -->
              <div style="background-color: #F0FDF4; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #A7F3D0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: #065F46; font-size: 14px;">üìÖ Date</td>
                          <td style="text-align: right; color: #065F46; font-weight: 600;">{{date}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #A7F3D0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: #065F46; font-size: 14px;">üìä Tables</td>
                          <td style="text-align: right; color: #065F46; font-weight: 600;">{{nbTables}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #A7F3D0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: #065F46; font-size: 14px;">üìù Enregistrements</td>
                          <td style="text-align: right; color: #065F46; font-weight: 600;">{{nbEnregistrements}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: #065F46; font-size: 14px;">üíΩ Taille</td>
                          <td style="text-align: right; color: #065F46; font-weight: 600;">{{taille}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </div>

              <!-- Rappel s√©curit√© -->
              <div style="background-color: #FEF3C7; padding: 15px 20px; border-radius: 8px; margin-bottom: 30px;">
                <p style="margin: 0; color: #92400E; font-size: 13px;">
                  üí° <strong>Conseil:</strong> Conservez r√©guli√®rement une copie de vos sauvegardes sur un support externe (cloud, disque dur).
                </p>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("G√©rer mes sauvegardes","{{lien}}",y.colors.success)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,br=`
${B("Configuration R√©ussie","‚úÖ",y.colors.success)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Message de succ√®s -->
              <div style="text-align: center; margin-bottom: 30px;">
                <span style="font-size: 64px;">üéä</span>
                <h2 style="margin: 20px 0 10px 0; color: ${y.colors.success}; font-size: 26px; font-weight: 700;">
                  F√©licitations !
                </h2>
                <p style="margin: 0; color: ${y.colors.gray}; font-size: 16px;">
                  Votre configuration email fonctionne parfaitement
                </p>
              </div>

              <!-- R√©capitulatif des notifications actives -->
              <div style="background-color: #F9FAFB; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
                <h4 style="margin: 0 0 15px 0; color: ${y.colors.primaryDark}; font-size: 15px; font-weight: 600;">
                  üîî Notifications activ√©es:
                </h4>
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  {{notificationsActives}}
                </table>
              </div>

              <!-- Prochaines √©tapes -->
              <div style="margin-bottom: 30px;">
                <h4 style="margin: 0 0 15px 0; color: ${y.colors.primaryDark}; font-size: 15px; font-weight: 600;">
                  üöÄ Prochaines √©tapes:
                </h4>
                <ol style="margin: 0; padding-left: 20px; color: ${y.colors.gray}; font-size: 14px; line-height: 2;">
                  <li>Explorez votre tableau de bord Cockpit</li>
                  <li>Importez vos premi√®res donn√©es</li>
                  <li>Configurez vos objectifs et KPIs</li>
                  <li>Les alertes vous seront envoy√©es automatiquement</li>
                </ol>
              </div>

              <!-- Info test -->
              <div style="background-color: #EFF6FF; padding: 15px 20px; border-radius: 8px; margin-bottom: 30px; text-align: center;">
                <p style="margin: 0; color: #1E40AF; font-size: 13px;">
                  üìß Cet email a √©t√© envoy√© le <strong>{{date}}</strong> √† <strong>{{email}}</strong>
                </p>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Acc√©der √† Cockpit","{{lien}}")}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V(!1)}
`,Ar=`
${B("Rappel √âch√©ance","‚è∞",y.colors.warning)}
          <!-- Contenu principal -->
          <tr>
            <td style="padding: 40px;">
              <!-- Urgence -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center; padding-bottom: 25px;">
                    <span style="display: inline-block; background-color: #FEF3C7; color: #92400E; padding: 8px 20px; border-radius: 25px; font-size: 14px; font-weight: 600;">
                      üìÖ √âch√©ance dans {{joursRestants}} jour(s)
                    </span>
                  </td>
                </tr>
              </table>

              <!-- Titre action -->
              <h2 style="margin: 0 0 20px 0; color: ${y.colors.primaryDark}; font-size: 22px; font-weight: 600; text-align: center;">
                {{titreAction}}
              </h2>

              <!-- Description -->
              <div style="background-color: #FFFBEB; border-left: 4px solid ${y.colors.warning}; padding: 20px; border-radius: 0 6px 6px 0; margin-bottom: 30px;">
                <p style="margin: 0; color: #78350F; font-size: 15px; line-height: 1.6;">
                  {{description}}
                </p>
              </div>

              <!-- D√©tails -->
              <div style="background-color: #F9FAFB; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üè¢ Centre</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600;">{{centre}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üë§ Responsable</td>
                          <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600;">{{responsable}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0; border-bottom: 1px solid #E5E7EB;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üéØ Priorit√©</td>
                          <td style="text-align: right;">
                            <span style="background-color: {{prioriteBg}}; color: {{prioriteColor}}; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                              {{priorite}}
                            </span>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 10px 0;">
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                        <tr>
                          <td style="color: ${y.colors.gray}; font-size: 14px;">üìÖ Date √©ch√©ance</td>
                          <td style="text-align: right; color: ${y.colors.danger}; font-weight: 700;">{{dateEcheance}}</td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </div>

              <!-- Progression -->
              <div style="margin-bottom: 30px;">
                <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                  <tr>
                    <td style="color: ${y.colors.gray}; font-size: 13px;">Avancement</td>
                    <td style="text-align: right; color: ${y.colors.primaryDark}; font-weight: 600;">{{avancement}}%</td>
                  </tr>
                </table>
                <div style="background-color: #E5E7EB; border-radius: 10px; height: 10px; overflow: hidden; margin-top: 8px;">
                  <div style="background-color: ${y.colors.info}; width: {{avancement}}%; height: 100%; border-radius: 10px;"></div>
                </div>
              </div>

              <!-- Bouton -->
              <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                  <td style="text-align: center;">
                    ${$("Voir l'action","{{lien}}",y.colors.warning)}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
${V()}
`,xr={alerte_critique:dr,alerte_importante:ur,alerte_info:pr,digest_hebdomadaire:mr,rappel_bail:gr,objectif_atteint:fr,import_termine:hr,backup_effectue:yr,test_bienvenue:br,echeance_action:Ar};function Y(i,s){let e=xr[i];for(const[t,r]of Object.entries(s)){const a=new RegExp(`{{${t}}}`,"g");e=e.replace(a,r)}return e}const po={alerte_critique:["titre","message","centre","date","lien"],alerte_importante:["titre","message","centre","date","lien"],alerte_info:["titre","message","centre","date","lien"],digest_hebdomadaire:["dateDebut","dateFin","nbAlertesCritiques","nbAlertesImportantes","nbObjectifsVerts","alertesHtml","echeancesHtml","kpisHtml","lien"],rappel_bail:["locataire","local","centre","loyerMensuel","dateExpiration","joursRestants","lien"],objectif_atteint:["axe","objectif","valeur","centre","progression","messageMotivation","lien"],import_termine:["fichier","typeImport","lignesImportees","lignesErreur","scoreQualite","statutBg","statutColor","statutIcon","statutTexte","erreursColor","scoreColor","scoreGradient","erreursHtml","lien"],backup_effectue:["date","nbTables","nbEnregistrements","taille","lien"],test_bienvenue:["date","email","notificationsActives","lien"],echeance_action:["titreAction","description","centre","responsable","priorite","prioriteBg","prioriteColor","dateEcheance","joursRestants","avancement","lien"]},K=class K{constructor(){I(this,"config",null);I(this,"initialized",!1)}static getInstance(){return K.instance||(K.instance=new K),K.instance}configure(s){var e;this.config=s,this.initialized=s.enabled&&s.service==="emailjs"&&!!((e=s.emailjs)!=null&&e.publicKey)}isConfigured(){var s;return this.initialized&&((s=this.config)==null?void 0:s.enabled)===!0}getConfig(){return this.config}async sendEmail(s){var e;if(!this.isConfigured()||!((e=this.config)!=null&&e.emailjs))return{success:!1,error:"Service email non configur√©",timestamp:new Date().toISOString()};try{const{serviceId:t,templateId:r,publicKey:a}=this.config.emailjs,o={to_email:s.to,to_name:s.toName||s.to,subject:s.subject,message_html:s.htmlContent,message_text:s.textContent||this.stripHtml(s.htmlContent),reply_to:s.replyTo||this.config.destinataireEmail,from_name:"Cockpit - Plateforme de Pilotage"},n=await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:t,template_id:r,user_id:a,template_params:o})});if(n.ok)return{success:!0,messageId:`emailjs_${Date.now()}`,timestamp:new Date().toISOString()};{const d=await n.text();throw new Error(d||`Erreur HTTP ${n.status}`)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erreur inconnue",timestamp:new Date().toISOString()}}}async sendAlertNotification(s,e,t,r,a){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service email non configur√©",timestamp:new Date().toISOString()};const{options:o}=this.config;if(t==="critique"&&!o.alertesCritiques)return{success:!1,error:"Alertes critiques d√©sactiv√©es",timestamp:new Date().toISOString()};if((t==="haute"||t==="normale")&&!o.alertesImportantes)return{success:!1,error:"Alertes importantes d√©sactiv√©es",timestamp:new Date().toISOString()};if(t==="info"&&!o.alertesInfo)return{success:!1,error:"Alertes info d√©sactiv√©es",timestamp:new Date().toISOString()};const d=Y(t==="critique"?"alerte_critique":t==="info"?"alerte_info":"alerte_importante",{titre:s,message:e,centre:r||"Global",date:new Date().toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),lien:a||window.location.origin,unsubscribe_link:`${window.location.origin}/notifications`}),u=t==="critique"?"üö®":t==="haute"?"‚ö†Ô∏è":"‚ÑπÔ∏è";return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`${u} [COCKPIT] ${s}`,htmlContent:d})}async sendBailExpirationReminder(s,e,t,r,a,o){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.baillExpiration)return{success:!1,error:"Rappels bail d√©sactiv√©s",timestamp:new Date().toISOString()};const n=Y("rappel_bail",{locataire:s,local:e,centre:t,dateExpiration:r,joursRestants:String(a),loyerMensuel:o||"N/A",lien:window.location.origin,unsubscribe_link:`${window.location.origin}/notifications`});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`üìã [COCKPIT] Rappel: Bail ${s} expire dans ${a} jours`,htmlContent:n})}async sendWeeklyDigest(s,e,t,r,a){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.digestHebdomadaire)return{success:!1,error:"Digest hebdomadaire d√©sactiv√©",timestamp:new Date().toISOString()};const o=t.length>0?t.map(p=>`
        <div style="padding: 10px; margin: 5px 0; background: ${p.priorite==="critique"?"#FEF2F2":"#FFFBEB"}; border-radius: 4px;">
          ${p.priorite==="critique"?"üö®":"‚ö†Ô∏è"} ${p.titre}
        </div>
      `).join(""):'<p style="color: #6B7280;">Aucune alerte cette semaine</p>',n=r.length>0?r.map(p=>`
        <div style="padding: 10px; margin: 5px 0; background: #F3F4F6; border-radius: 4px;">
          üìÖ ${p.titre} - <strong>${p.date}</strong>
        </div>
      `).join(""):'<p style="color: #6B7280;">Aucune √©ch√©ance proche</p>',d=a.length>0?a.map(p=>{const g=p.statut==="vert"?"#D1FAE5":p.statut==="orange"?"#FEF3C7":"#FEE2E2",A=p.statut==="vert"?"#065F46":p.statut==="orange"?"#92400E":"#991B1B";return`
          <div style="display: inline-block; padding: 10px; margin: 5px; background: ${g}; border-radius: 4px; min-width: 120px;">
            <div style="font-size: 12px; color: #6B7280;">${p.nom}</div>
            <div style="font-size: 18px; font-weight: bold; color: ${A};">${p.valeur}</div>
          </div>
        `}).join(""):'<p style="color: #6B7280;">Aucun KPI √† afficher</p>',u=this.buildEmailFromTemplate("digest_hebdomadaire",{dateDebut:s,dateFin:e,nbAlertes:String(t.length),alertesHtml:o,alertesTexte:t.map(p=>`- ${p.titre}`).join(`
`),echeancesHtml:n,echeancesTexte:r.map(p=>`- ${p.titre} (${p.date})`).join(`
`),kpisHtml:d,kpisTexte:a.map(p=>`- ${p.nom}: ${p.valeur}`).join(`
`),lien:window.location.origin});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`üìä [COCKPIT] R√©sum√© Hebdomadaire - Semaine du ${s}`,htmlContent:u})}async sendTestEmail(){if(!this.config)return{success:!1,error:"Configuration manquante",timestamp:new Date().toISOString()};const s=[{active:this.config.options.alertesCritiques,label:"Alertes critiques",icon:"üö®"},{active:this.config.options.alertesImportantes,label:"Alertes importantes",icon:"‚ö†Ô∏è"},{active:this.config.options.alertesInfo,label:"Notifications info",icon:"‚ÑπÔ∏è"},{active:this.config.options.digestHebdomadaire,label:"Digest hebdomadaire",icon:"üìä"},{active:this.config.options.digestQuotidien,label:"Digest quotidien",icon:"üì∞"},{active:this.config.options.baillExpiration,label:"Rappels expiration baux",icon:"üìã"},{active:this.config.options.nouvelleEcheance,label:"Rappels √©ch√©ances",icon:"üìÖ"},{active:this.config.options.objectifAtteint,label:"Objectifs atteints",icon:"üéØ"}].map(t=>`
      <tr>
        <td style="padding: 8px 0; border-bottom: 1px solid #E5E7EB;">
          <span style="color: ${t.active?"#059669":"#DC2626"}; font-size: 16px; margin-right: 10px;">
            ${t.active?"‚úÖ":"‚ùå"}
          </span>
          <span style="color: ${t.active?"#065F46":"#6B7280"}; font-size: 14px;">
            ${t.icon} ${t.label}
          </span>
        </td>
      </tr>
    `).join(""),e=Y("test_bienvenue",{date:new Date().toLocaleString("fr-FR"),email:this.config.destinataireEmail,notificationsActives:s,lien:window.location.origin});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:"‚úÖ [COCKPIT] Configuration email r√©ussie",htmlContent:e})}async sendObjectifAtteintNotification(s,e,t,r,a){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.objectifAtteint)return{success:!1,error:"Notifications objectifs d√©sactiv√©es",timestamp:new Date().toISOString()};const o=["Continuez sur cette lanc√©e, les r√©sultats sont au rendez-vous !","Excellente performance, votre √©quipe fait un travail remarquable !","Objectif atteint gr√¢ce √† votre engagement quotidien !","Bravo √† toute l'√©quipe pour cet accomplissement !"],n=o[Math.floor(Math.random()*o.length)],d=Y("objectif_atteint",{axe:s,objectif:e,valeur:t,centre:r,progression:a,messageMotivation:n,lien:window.location.origin,unsubscribe_link:`${window.location.origin}/notifications`});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`üéØ [COCKPIT] Objectif atteint: ${e}`,htmlContent:d})}async sendImportTermineNotification(s,e,t,r,a){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.importTermine)return{success:!1,error:"Notifications import d√©sactiv√©es",timestamp:new Date().toISOString()};const o=r===0?"success":r<t?"partial":"error",n={success:{bg:"#D1FAE5",color:"#065F46",icon:"‚úÖ",texte:"Import r√©ussi"},partial:{bg:"#FEF3C7",color:"#92400E",icon:"‚ö†Ô∏è",texte:"Import partiel"},error:{bg:"#FEE2E2",color:"#991B1B",icon:"‚ùå",texte:"Import √©chou√©"}}[o],d=a>=90?"#059669":a>=70?"#D97706":"#DC2626",u=a>=90?"#059669, #10B981":a>=70?"#D97706, #F59E0B":"#DC2626, #EF4444",p=Y("import_termine",{fichier:s,typeImport:e,lignesImportees:String(t),lignesErreur:String(r),scoreQualite:String(a),statutBg:n.bg,statutColor:n.color,statutIcon:n.icon,statutTexte:n.texte,erreursColor:r>0?"#DC2626":"#059669",scoreColor:d,scoreGradient:u,erreursHtml:r>0?`
        <div style="background-color: #FEF2F2; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p style="margin: 0; color: #991B1B; font-size: 14px;">
            ‚ö†Ô∏è ${r} ligne(s) n'ont pas pu √™tre import√©es. Consultez le d√©tail pour corriger les erreurs.
          </p>
        </div>
      `:"",lien:window.location.origin,unsubscribe_link:`${window.location.origin}/notifications`});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`üì• [COCKPIT] Import termin√©: ${s}`,htmlContent:p})}async sendBackupNotification(s,e,t,r){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.backupEffectue)return{success:!1,error:"Notifications backup d√©sactiv√©es",timestamp:new Date().toISOString()};const a=Y("backup_effectue",{date:s,nbTables:String(e),nbEnregistrements:t.toLocaleString("fr-FR"),taille:r,lien:`${window.location.origin}/sauvegarde`,unsubscribe_link:`${window.location.origin}/notifications`});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:"üíæ [COCKPIT] Sauvegarde effectu√©e avec succ√®s",htmlContent:a})}async sendEcheanceActionNotification(s,e,t,r,a,o,n,d){if(!this.isConfigured()||!this.config)return{success:!1,error:"Service non configur√©",timestamp:new Date().toISOString()};if(!this.config.options.nouvelleEcheance)return{success:!1,error:"Rappels √©ch√©ances d√©sactiv√©s",timestamp:new Date().toISOString()};const u={critique:{bg:"#FEE2E2",color:"#991B1B"},haute:{bg:"#FEF3C7",color:"#92400E"},moyenne:{bg:"#DBEAFE",color:"#1E40AF"},basse:{bg:"#F3F4F6",color:"#374151"}},p=u[a]||u.moyenne,g=Y("echeance_action",{titreAction:s,description:e,centre:t,responsable:r,priorite:a.charAt(0).toUpperCase()+a.slice(1),prioriteBg:p.bg,prioriteColor:p.color,dateEcheance:o,joursRestants:String(n),avancement:String(d),lien:window.location.origin,unsubscribe_link:`${window.location.origin}/notifications`});return this.sendEmail({to:this.config.destinataireEmail,toName:this.config.destinataireNom,subject:`‚è∞ [COCKPIT] Rappel: ${s} - √âch√©ance dans ${n} jour(s)`,htmlContent:g})}stripHtml(s){const e=document.createElement("div");return e.innerHTML=s,e.textContent||e.innerText||""}};I(K,"instance");let be=K;const M=be.getInstance(),vr={enabled:!1,service:"none",destinataireEmail:"",destinataireNom:"",options:{alertesCritiques:!0,alertesImportantes:!0,alertesInfo:!1,digestQuotidien:!1,digestHebdomadaire:!0,heureDigest:"08:00",jourDigestHebdo:1,nouvelleEcheance:!0,baillExpiration:!0,objectifAtteint:!0,importTermine:!1,backupEffectue:!1,rappelEcheanceJours:7,rappelBailJours:90}},ae=q()(W((i,s)=>({config:vr,isConfigured:!1,history:[],isLoading:!1,isSending:!1,error:null,lastTestResult:null,updateConfig:e=>{const t={...s().config,...e};i({config:t}),M.configure(t),i({isConfigured:M.isConfigured()})},setEmailJSConfig:e=>{const t={...s().config,service:"emailjs",emailjs:e};i({config:t}),M.configure(t),i({isConfigured:M.isConfigured()})},updateOptions:e=>{const t={...s().config,options:{...s().config.options,...e}};i({config:t}),M.configure(t)},enableNotifications:e=>{const t={...s().config,enabled:e};i({config:t}),M.configure(t),i({isConfigured:M.isConfigured()})},sendTestEmail:async()=>{var t;const{config:e}=s();if(!e.enabled||!((t=e.emailjs)!=null&&t.publicKey))return i({lastTestResult:{success:!1,message:"Configuration EmailJS incompl√®te",date:new Date().toISOString()}}),!1;i({isSending:!0,error:null});try{M.configure(e);const r=await M.sendTestEmail(),a={success:r.success,message:r.success?"Email de test envoy√© avec succ√®s !":r.error||"Erreur inconnue",date:new Date().toISOString()};return i({isSending:!1,lastTestResult:a,config:{...e,lastTestAt:new Date().toISOString(),lastTestSuccess:r.success}}),s().addToHistory({type:"info",sujet:"Test de configuration email",destinataire:e.destinataireEmail,envoyeAt:new Date().toISOString(),statut:r.success?"envoye":"echec",erreur:r.error}),r.success}catch(r){const a=r instanceof Error?r.message:"Erreur inconnue";return i({isSending:!1,error:a,lastTestResult:{success:!1,message:a,date:new Date().toISOString()}}),!1}},sendAlertNotification:async(e,t,r,a,o)=>{const{config:n}=s();if(!n.enabled)return!1;i({isSending:!0});try{M.configure(n);const d=await M.sendAlertNotification(e,t,r,a,o);return i({isSending:!1}),s().addToHistory({type:"alerte",sujet:e,destinataire:n.destinataireEmail,envoyeAt:new Date().toISOString(),statut:d.success?"envoye":"echec",erreur:d.error}),d.success}catch{return i({isSending:!1}),!1}},sendBailReminder:async(e,t,r,a,o)=>{const{config:n}=s();if(!n.enabled||!n.options.baillExpiration)return!1;i({isSending:!0});try{M.configure(n);const d=await M.sendBailExpirationReminder(e,t,r,a,o);return i({isSending:!1}),s().addToHistory({type:"rappel",sujet:`Rappel bail: ${e}`,destinataire:n.destinataireEmail,envoyeAt:new Date().toISOString(),statut:d.success?"envoye":"echec",erreur:d.error}),d.success}catch{return i({isSending:!1}),!1}},sendBackupNotification:async(e,t,r,a,o)=>{const{config:n}=s();if(!n.enabled||!n.options.backupEffectue)return!1;i({isSending:!0});try{M.configure(n);const d=await M.sendBackupNotification(e,t,r,a,o);return i({isSending:!1}),s().addToHistory({type:"info",sujet:a?"Sauvegarde effectu√©e":"√âchec de sauvegarde",destinataire:n.destinataireEmail,envoyeAt:new Date().toISOString(),statut:d.success?"envoye":"echec",erreur:d.error}),d.success}catch{return i({isSending:!1}),!1}},sendImportNotification:async(e,t,r,a,o)=>{const{config:n}=s();if(!n.enabled||!n.options.importTermine)return!1;i({isSending:!0});try{M.configure(n);const d=await M.sendImportTermineNotification(e,t,r,a,o);return i({isSending:!1}),s().addToHistory({type:"info",sujet:a?`Import termin√©: ${e}`:`√âchec import: ${e}`,destinataire:n.destinataireEmail,envoyeAt:new Date().toISOString(),statut:d.success?"envoye":"echec",erreur:d.error}),d.success}catch{return i({isSending:!1}),!1}},sendEcheanceNotification:async(e,t,r,a,o)=>{const{config:n}=s();if(!n.enabled||!n.options.nouvelleEcheance)return!1;i({isSending:!0});try{M.configure(n);const d=await M.sendEcheanceActionNotification(e,t,r,a,o);return i({isSending:!1}),s().addToHistory({type:"rappel",sujet:`√âch√©ance: ${e}`,destinataire:n.destinataireEmail,envoyeAt:new Date().toISOString(),statut:d.success?"envoye":"echec",erreur:d.error}),d.success}catch{return i({isSending:!1}),!1}},sendObjectifAtteintNotification:async(e,t,r,a)=>{const{config:o}=s();if(!o.enabled||!o.options.objectifAtteint)return!1;i({isSending:!0});try{M.configure(o);const n=await M.sendObjectifAtteintNotification(e,t,r,a);return i({isSending:!1}),s().addToHistory({type:"info",sujet:`Objectif atteint: ${e}`,destinataire:o.destinataireEmail,envoyeAt:new Date().toISOString(),statut:n.success?"envoye":"echec",erreur:n.error}),n.success}catch{return i({isSending:!1}),!1}},addToHistory:e=>{const t={...e,id:crypto.randomUUID()};i(r=>({history:[t,...r.history].slice(0,100)}))},clearHistory:()=>{i({history:[]})},getStats:()=>{var a;const{history:e}=s(),t={totalEnvoyes:e.filter(o=>o.statut==="envoye").length,totalEchecs:e.filter(o=>o.statut==="echec").length,dernierEnvoi:(a=e.find(o=>o.statut==="envoye"))==null?void 0:a.envoyeAt,parType:{alertes:e.filter(o=>o.type==="alerte").length,digests:e.filter(o=>o.type==="digest").length,rappels:e.filter(o=>o.type==="rappel").length,infos:e.filter(o=>o.type==="info").length},parJour:[]},r=new Date;for(let o=6;o>=0;o--){const n=new Date(r);n.setDate(n.getDate()-o);const d=n.toISOString().split("T")[0],u=e.filter(p=>p.envoyeAt.startsWith(d)).length;t.parJour.push({date:d,count:u})}return t}}),{name:"cockpit-notifications",partialize:i=>({config:i.config,history:i.history})})),et=q((i,s)=>({alertes:[],isLoading:!1,error:null,loadAlertes:async()=>{i({isLoading:!0,error:null});try{const e=await l.alertes.orderBy("dateCreation").reverse().toArray();i({alertes:e,isLoading:!1})}catch(e){i({error:`Erreur de chargement: ${e}`,isLoading:!1})}},getAlertesNonLues:()=>s().alertes.filter(e=>!e.lue),getAlertesByCentre:e=>s().alertes.filter(t=>t.centreId===e),getAlertesByPriorite:e=>s().alertes.filter(t=>t.priorite===e),addAlerte:async e=>{const t={...e,id:E(),lue:!1,traitee:!1,dateCreation:new Date().toISOString()};await l.alertes.add(t),i(r=>({alertes:[t,...r.alertes]}));try{const r=ae.getState();if(r.config.enabled){let a;if(e.centreId){const o=await l.centres.get(e.centreId);a=o==null?void 0:o.nom}await r.sendAlertNotification(t.titre,t.message,t.priorite,a,t.lien)}}catch{}return t},marquerCommeLue:async e=>{await l.alertes.update(e,{lue:!0}),i(t=>({alertes:t.alertes.map(r=>r.id===e?{...r,lue:!0}:r)}))},marquerCommeTraitee:async e=>{const t=new Date().toISOString();await l.alertes.update(e,{traitee:!0,dateTraitement:t}),i(r=>({alertes:r.alertes.map(a=>a.id===e?{...a,traitee:!0,dateTraitement:t}:a)}))},supprimerAlerte:async e=>{await l.alertes.delete(e),i(t=>({alertes:t.alertes.filter(r=>r.id!==e)}))},supprimerAlertesTraitees:async()=>{const e=s().alertes.filter(t=>t.traitee);await Promise.all(e.map(t=>l.alertes.delete(t.id))),i(t=>({alertes:t.alertes.filter(r=>!r.traitee)}))}})),mo=q((i,s)=>({reunions:[],isLoading:!1,error:null,loadReunions:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.reunions.where("centreId").equals(e).toArray():t=await l.reunions.toArray(),t.sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime()),i({reunions:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getReunionsByCentre:e=>s().reunions.filter(t=>t.centreId===e),getReunionsByType:e=>s().reunions.filter(t=>t.type===e),getReunionsByStatut:e=>s().reunions.filter(t=>t.statut===e),getReunionsAVenir:e=>{const t=new Date;return t.setHours(0,0,0,0),s().reunions.filter(r=>{const a=new Date(r.date);return(e?r.centreId===e:!0)&&a>=t&&r.statut==="planifiee"}).sort((r,a)=>new Date(r.date).getTime()-new Date(a.date).getTime())},getReunionsPassees:e=>{const t=new Date;return t.setHours(0,0,0,0),s().reunions.filter(r=>{const a=new Date(r.date);return(e?r.centreId===e:!0)&&(a<t||r.statut==="realisee")}).sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime())},addReunion:async e=>{const t=new Date().toISOString(),r={...e,id:E(),ordreDuJour:e.ordreDuJour||[],participants:e.participants||[],decisions:e.decisions||[],actionsCreees:e.actionsCreees||[],createdAt:t,updatedAt:t};return await l.reunions.add(r),i(a=>({reunions:[r,...a.reunions].sort((o,n)=>new Date(n.date).getTime()-new Date(o.date).getTime())})),r},updateReunion:async(e,t)=>{const r=new Date().toISOString();await l.reunions.update(e,{...t,updatedAt:r}),i(a=>({reunions:a.reunions.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteReunion:async e=>{await l.reunions.delete(e),i(t=>({reunions:t.reunions.filter(r=>r.id!==e)}))},addDecision:async(e,t)=>{const r={...t,id:E()},a=s().reunions.find(o=>o.id===e);if(a){const o=[...a.decisions,r];await s().updateReunion(e,{decisions:o})}},updateDecision:async(e,t,r)=>{const a=s().reunions.find(o=>o.id===e);if(a){const o=a.decisions.map(n=>n.id===t?{...n,...r}:n);await s().updateReunion(e,{decisions:o})}},deleteDecision:async(e,t)=>{const r=s().reunions.find(a=>a.id===e);if(r){const a=r.decisions.filter(o=>o.id!==t);await s().updateReunion(e,{decisions:a})}},changerStatut:async(e,t)=>{await s().updateReunion(e,{statut:t})},addPointOrdreDuJour:async(e,t)=>{const r=s().reunions.find(a=>a.id===e);if(r){const a=[...r.ordreDuJour,t];await s().updateReunion(e,{ordreDuJour:a})}},removePointOrdreDuJour:async(e,t)=>{const r=s().reunions.find(a=>a.id===e);if(r){const a=r.ordreDuJour.filter((o,n)=>n!==t);await s().updateReunion(e,{ordreDuJour:a})}},updatePointOrdreDuJour:async(e,t,r)=>{const a=s().reunions.find(o=>o.id===e);if(a){const o=a.ordreDuJour.map((n,d)=>d===t?r:n);await s().updateReunion(e,{ordreDuJour:o})}},addParticipant:async(e,t)=>{const r=s().reunions.find(a=>a.id===e);if(r&&!r.participants.includes(t)){const a=[...r.participants,t];await s().updateReunion(e,{participants:a})}},removeParticipant:async(e,t)=>{const r=s().reunions.find(a=>a.id===e);if(r){const a=r.participants.filter(o=>o!==t);await s().updateReunion(e,{participants:a})}}}));function ue(i){const s=i.historique.filter(r=>r.statut==="envoye").sort((r,a)=>new Date(a.dateCreation).getTime()-new Date(r.dateCreation).getTime())[0],e=s?new Date(s.dateCreation):new Date(i.createdAt),t=new Date(e);switch(i.frequence){case"quotidien":t.setDate(t.getDate()+1);break;case"hebdomadaire":t.setDate(t.getDate()+7);break;case"mensuel":t.setMonth(t.getMonth()+1);break;case"bimestriel":t.setMonth(t.getMonth()+2);break;case"trimestriel":t.setMonth(t.getMonth()+3);break;case"semestriel":t.setMonth(t.getMonth()+6);break;case"annuel":t.setFullYear(t.getFullYear()+1);break;default:return null}return t}const go=q((i,s)=>({livrables:[],isLoading:!1,error:null,loadLivrables:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.livrables.where("centreId").equals(e).toArray():t=await l.livrables.toArray(),t.sort((r,a)=>r.titre.localeCompare(a.titre)),i({livrables:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getLivrablesByCentre:e=>s().livrables.filter(t=>t.centreId===e),getLivrablesByAxe:e=>s().livrables.filter(t=>t.axeId===e),getLivrablesByFrequence:e=>s().livrables.filter(t=>t.frequence===e),getLivrablesEnRetard:e=>{const t=new Date;return s().livrables.filter(r=>{if(!(e?r.centreId===e:!0))return!1;const o=ue(r);return o&&o<t})},addLivrable:async e=>{const t=new Date().toISOString(),r={...e,id:E(),historique:e.historique||[],createdAt:t,updatedAt:t};return await l.livrables.add(r),i(a=>({livrables:[...a.livrables,r].sort((o,n)=>o.titre.localeCompare(n.titre))})),r},updateLivrable:async(e,t)=>{const r=new Date().toISOString();await l.livrables.update(e,{...t,updatedAt:r}),i(a=>({livrables:a.livrables.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteLivrable:async e=>{await l.livrables.delete(e),i(t=>({livrables:t.livrables.filter(r=>r.id!==e)}))},addVersion:async(e,t)=>{const r={...t,id:E()},a=s().livrables.find(o=>o.id===e);if(a){const o=[...a.historique,r];await s().updateLivrable(e,{historique:o})}},updateVersion:async(e,t,r)=>{const a=s().livrables.find(o=>o.id===e);if(a){const o=a.historique.map(n=>n.id===t?{...n,...r}:n);await s().updateLivrable(e,{historique:o})}},deleteVersion:async(e,t)=>{const r=s().livrables.find(a=>a.id===e);if(r){const a=r.historique.filter(o=>o.id!==t);await s().updateLivrable(e,{historique:a})}},changerStatutVersion:async(e,t,r)=>{await s().updateVersion(e,t,{statut:r})},getDerniereVersion:e=>{if(e.historique.length!==0)return e.historique.sort((t,r)=>new Date(r.dateCreation).getTime()-new Date(t.dateCreation).getTime())[0]},getProchaineLivraison:e=>ue(e),isLivrableEnRetard:e=>{const t=ue(e);return t?t<new Date:!1}})),fo=q((i,s)=>({audits:[],risques:[],isLoading:!1,error:null,loadAudits:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.audits.where("centreId").equals(e).toArray():t=await l.audits.toArray(),t.sort((r,a)=>new Date(r.datePlanifiee).getTime()-new Date(a.datePlanifiee).getTime()),i({audits:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement audits: ${t}`,isLoading:!1})}},getAuditsByCentre:e=>s().audits.filter(t=>t.centreId===e),getAuditsByType:e=>s().audits.filter(t=>t.type===e),getAuditsByStatut:e=>s().audits.filter(t=>t.statut===e),getAuditsAPlanifier:e=>{const t=new Date,r=new Date;return r.setDate(t.getDate()+30),s().audits.filter(a=>{const o=e?a.centreId===e:!0,n=new Date(a.datePlanifiee);return o&&a.statut==="planifie"&&n<=r})},addAudit:async e=>{const t=new Date().toISOString(),r={...e,id:E(),nonConformites:e.nonConformites||[],createdAt:t,updatedAt:t};return await l.audits.add(r),i(a=>({audits:[...a.audits,r].sort((o,n)=>new Date(o.datePlanifiee).getTime()-new Date(n.datePlanifiee).getTime())})),r},updateAudit:async(e,t)=>{const r=new Date().toISOString();await l.audits.update(e,{...t,updatedAt:r}),i(a=>({audits:a.audits.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteAudit:async e=>{await l.audits.delete(e),i(t=>({audits:t.audits.filter(r=>r.id!==e)}))},changerStatutAudit:async(e,t)=>{const r={statut:t};t==="termine"&&(r.dateRealisation=new Date().toISOString()),await s().updateAudit(e,r)},addNonConformite:async(e,t)=>{const r={...t,id:E()},a=s().audits.find(o=>o.id===e);if(a){const o=[...a.nonConformites,r];await s().updateAudit(e,{nonConformites:o})}},updateNonConformite:async(e,t,r)=>{const a=s().audits.find(o=>o.id===e);if(a){const o=a.nonConformites.map(n=>n.id===t?{...n,...r}:n);await s().updateAudit(e,{nonConformites:o})}},deleteNonConformite:async(e,t)=>{const r=s().audits.find(a=>a.id===e);if(r){const a=r.nonConformites.filter(o=>o.id!==t);await s().updateAudit(e,{nonConformites:a})}},cloturerNonConformite:async(e,t)=>{await s().updateNonConformite(e,t,{statut:"cloturee",dateCloture:new Date().toISOString()})},loadRisques:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.risques.where("centreId").equals(e).toArray():t=await l.risques.toArray(),t.sort((r,a)=>a.scoreRisque-r.scoreRisque),i({risques:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement risques: ${t}`,isLoading:!1})}},getRisquesByCentre:e=>s().risques.filter(t=>t.centreId===e),getRisquesByCategorie:e=>s().risques.filter(t=>t.categorie===e),getRisquesCritiques:e=>s().risques.filter(t=>(e?t.centreId===e:!0)&&t.scoreRisque>=15),addRisque:async e=>{const t=new Date().toISOString(),r={...e,id:E(),scoreRisque:e.probabilite*e.impact,createdAt:t,updatedAt:t};return await l.risques.add(r),i(a=>({risques:[...a.risques,r].sort((o,n)=>n.scoreRisque-o.scoreRisque)})),r},updateRisque:async(e,t)=>{const r=new Date().toISOString(),a=s().risques.find(n=>n.id===e);let o={...t,updatedAt:r};if(t.probabilite!==void 0||t.impact!==void 0){const n=t.probabilite??(a==null?void 0:a.probabilite)??1,d=t.impact??(a==null?void 0:a.impact)??1;o.scoreRisque=n*d}await l.risques.update(e,o),i(n=>({risques:n.risques.map(d=>d.id===e?{...d,...o}:d).sort((d,u)=>u.scoreRisque-d.scoreRisque)}))},deleteRisque:async e=>{await l.risques.delete(e),i(t=>({risques:t.risques.filter(r=>r.id!==e)}))},changerStatutRisque:async(e,t)=>{const r={statut:t};(t==="cloture"||t==="accepte")&&(r.dateDerniereRevue=new Date().toISOString()),await s().updateRisque(e,r)},getStatsAudits:e=>{const t=s().getAuditsByCentre(e),r=t.reduce((o,n)=>o+n.nonConformites.filter(d=>d.statut!=="cloturee").length,0),a=t.reduce((o,n)=>o+n.nonConformites.filter(d=>d.gravite==="critique"&&d.statut!=="cloturee").length,0);return{total:t.length,planifies:t.filter(o=>o.statut==="planifie").length,enCours:t.filter(o=>o.statut==="en_cours").length,termines:t.filter(o=>o.statut==="termine").length,ncOuvertes:r,ncCritiques:a}},getStatsRisques:e=>{const t=s().getRisquesByCentre(e).filter(r=>r.statut!=="cloture");return{total:t.length,critiques:t.filter(r=>r.scoreRisque>=15).length,moyens:t.filter(r=>r.scoreRisque>=8&&r.scoreRisque<15).length,faibles:t.filter(r=>r.scoreRisque<8).length,enTraitement:t.filter(r=>r.statut==="en_traitement").length}}})),De=[{id:"1",nom:"Atteinte des objectifs",poids:25},{id:"2",nom:"Qualit√© du travail",poids:20},{id:"3",nom:"Autonomie et initiative",poids:15},{id:"4",nom:"Travail en √©quipe",poids:15},{id:"5",nom:"Communication",poids:10},{id:"6",nom:"Respect des d√©lais",poids:10},{id:"7",nom:"D√©veloppement des comp√©tences",poids:5}],ho=q((i,s)=>({evaluations:[],isLoading:!1,error:null,loadEvaluations:async e=>{i({isLoading:!0,error:null});try{let t;e?t=await l.evaluations.where("centreId").equals(e).toArray():t=await l.evaluations.toArray(),t.sort((r,a)=>{const o=r.dateEvaluation||r.createdAt,n=a.dateEvaluation||a.createdAt;return new Date(n).getTime()-new Date(o).getTime()}),i({evaluations:t,isLoading:!1})}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getEvaluationsByCentre:e=>s().evaluations.filter(t=>t.centreId===e),getEvaluationsByPoste:e=>s().evaluations.filter(t=>t.posteId===e),getEvaluationsByStatut:e=>s().evaluations.filter(t=>t.statut===e),getEvaluationEnCours:(e,t)=>s().evaluations.find(r=>r.centreId===e&&r.posteId===t&&r.statut!=="valide"),addEvaluation:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.evaluations.add(r),i(a=>({evaluations:[r,...a.evaluations]})),r},updateEvaluation:async(e,t)=>{const r=new Date().toISOString();await l.evaluations.update(e,{...t,updatedAt:r}),i(a=>({evaluations:a.evaluations.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteEvaluation:async e=>{await l.evaluations.delete(e),i(t=>({evaluations:t.evaluations.filter(r=>r.id!==e)}))},creerAutoEvaluation:async(e,t,r)=>{const a=De.map(n=>({...n,id:E(),note:void 0,commentaire:void 0}));return await s().addEvaluation({centreId:e,posteId:t,periode:r,criteres:a,noteGlobale:void 0,pointsForts:[],axesAmelioration:[],objectifsProchainePeriode:[],commentaireGeneral:void 0,statut:"brouillon",dateEvaluation:void 0})},sauvegarderBrouillon:async(e,t)=>{await s().updateEvaluation(e,t)},finaliserAutoEvaluation:async e=>{const t=s().evaluations.find(a=>a.id===e);if(!t)return;const r=s().calculerNoteGlobale(t.criteres);await s().updateEvaluation(e,{statut:"finalise",noteGlobale:r,dateEvaluation:new Date().toISOString()})},validerEvaluation:async(e,t)=>{const r={statut:"valide"};t&&(r.commentaireGeneral=t),await s().updateEvaluation(e,r)},updateCritere:async(e,t,r,a)=>{const o=s().evaluations.find(p=>p.id===e);if(!o)return;const n=o.criteres.map(p=>p.id===t?{...p,note:r,commentaire:a}:p),u=n.every(p=>p.note!==void 0)?s().calculerNoteGlobale(n):void 0;await s().updateEvaluation(e,{criteres:n,noteGlobale:u})},calculerNoteGlobale:e=>{const t=e.filter(o=>o.note!==void 0);if(t.length===0)return 0;const r=t.reduce((o,n)=>o+n.poids,0),a=t.reduce((o,n)=>o+(n.note||0)*n.poids,0);return Math.round(a/r*100)/100},getCriteresParDefaut:()=>De})),yo=q((i,s)=>({membres:[],isLoading:!1,error:null,loadMembres:async e=>{i({isLoading:!0,error:null});try{const t=await l.membresEquipe.where("centreId").equals(e).toArray();i({membres:t,isLoading:!1})}catch(t){i({error:`Erreur chargement √©quipe: ${t}`,isLoading:!1})}},addMembre:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.membresEquipe.add(r),i(a=>({membres:[...a.membres,r]})),r},updateMembre:async(e,t)=>{const r=new Date().toISOString();await l.membresEquipe.update(e,{...t,updatedAt:r}),i(a=>({membres:a.membres.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteMembre:async e=>{await l.membresEquipe.delete(e),i(t=>({membres:t.membres.filter(r=>r.id!==e)}))},addCompetence:async(e,t)=>{const r=s().membres.find(n=>n.id===e);if(!r)return;const a={...t,id:E()},o=[...r.competences,a];await s().updateMembre(e,{competences:o})},removeCompetence:async(e,t)=>{const r=s().membres.find(o=>o.id===e);if(!r)return;const a=r.competences.filter(o=>o.id!==t);await s().updateMembre(e,{competences:a})},addFormation:async(e,t)=>{const r=s().membres.find(n=>n.id===e);if(!r)return;const a={...t,id:E()},o=[...r.formations,a];await s().updateMembre(e,{formations:o})},removeFormation:async(e,t)=>{const r=s().membres.find(o=>o.id===e);if(!r)return;const a=r.formations.filter(o=>o.id!==t);await s().updateMembre(e,{formations:a})},addAbsence:async(e,t)=>{const r=s().membres.find(n=>n.id===e);if(!r)return;const a={...t,id:E()},o=[...r.absences,a];await s().updateMembre(e,{absences:o})},updateAbsence:async(e,t,r)=>{const a=s().membres.find(n=>n.id===e);if(!a)return;const o=a.absences.map(n=>n.id===t?{...n,...r}:n);await s().updateMembre(e,{absences:o})},removeAbsence:async(e,t)=>{const r=s().membres.find(o=>o.id===e);if(!r)return;const a=r.absences.filter(o=>o.id!==t);await s().updateMembre(e,{absences:a})},getMembresByCentre:e=>s().membres.filter(t=>t.centreId===e),getMembresByDepartement:(e,t)=>s().membres.filter(r=>r.centreId===e&&r.departement===t),getMembresByManager:e=>s().membres.filter(t=>t.managerId===e),getMembre:e=>s().membres.find(t=>t.id===e),getStatistiques:e=>{const t=s().getMembresByCentre(e),r=new Date,a={totalMembres:t.length,parDepartement:{direction:0,facility:0,finance:0,securite:0,commercial_marketing:0,administration:0},parTypeContrat:{cdi:0,cdd:0,stage:0,interim:0,consultant:0,prestataire:0},parStatut:{actif:0,conge:0,formation:0,mission:0,inactif:0},masseSalariale:0,ancienneteMovenne:0,tauxPresence:0};let o=0,n=0;return t.forEach(d=>{a.parDepartement[d.departement]++,a.parTypeContrat[d.typeContrat]++,a.parStatut[d.statut]++,d.salaireBase&&(a.masseSalariale+=d.salaireBase);const u=new Date(d.dateEmbauche),p=(r.getTime()-u.getTime())/(1e3*60*60*24*365);o+=p,d.statut==="actif"&&n++}),a.ancienneteMovenne=t.length>0?o/t.length:0,a.tauxPresence=t.length>0?n/t.length*100:0,a},getOrganigramme:e=>{const t=s().getMembresByCentre(e);return t.filter(a=>!a.managerId||!t.find(o=>o.id===a.managerId)).map(a=>({membre:a,subordinates:t.filter(o=>o.managerId===a.id)}))}})),Ir={code:"NOI",nom:"Net Operating Income",nomCourt:"NOI",description:"Revenu net d'exploitation = Revenus locatifs - Charges d'exploitation",formule:"NOI = Revenus_Locatifs - Charges_Exploitation",unite:"EUR",formatAffichage:"0,0 ‚Ç¨",categoriesRequises:["loyers","charges"],seuilVert:0,tendancePositive:"hausse",icone:"TrendingUp"},Er={code:"NOI_M2",nom:"NOI par m¬≤",nomCourt:"NOI/m¬≤",description:"Net Operating Income rapport√© √† la surface locative",formule:"NOI_M2 = NOI / Surface_Locative",unite:"EUR/m2",formatAffichage:"0,0 ‚Ç¨/m¬≤",categoriesRequises:["loyers","charges","surface"],tendancePositive:"hausse",icone:"LayoutGrid"},wr={code:"YIELD_BRUT",nom:"Rendement Brut",nomCourt:"Yield Brut",description:"Taux de rendement brut = Loyers annuels / Valeur d'acquisition",formule:"YIELD_BRUT = (Loyers_Annuels / Valeur_Actif) √ó 100",unite:"%",formatAffichage:"0.00%",categoriesRequises:["loyers","valorisation"],seuilVert:6,seuilOrange:4,seuilRouge:3,tendancePositive:"hausse",icone:"Percent"},Cr={code:"YIELD_NET",nom:"Rendement Net",nomCourt:"Yield Net",description:"Taux de rendement net = NOI / Valeur d'acquisition",formule:"YIELD_NET = (NOI / Valeur_Actif) √ó 100",unite:"%",formatAffichage:"0.00%",categoriesRequises:["loyers","charges","valorisation"],seuilVert:5,seuilOrange:3.5,seuilRouge:2.5,tendancePositive:"hausse",icone:"Percent"},Sr={code:"WAULT",nom:"Weighted Average Unexpired Lease Term",nomCourt:"WAULT",description:"Dur√©e moyenne pond√©r√©e restante des baux jusqu'√† leur terme",formule:"WAULT = Œ£(Dur√©e_Restante √ó Loyer_Annuel) / Œ£(Loyers_Annuels)",unite:"annees",formatAffichage:"0.0 ans",categoriesRequises:["bail","loyers"],seuilVert:4,seuilOrange:2.5,seuilRouge:1.5,tendancePositive:"hausse",icone:"Calendar"},Rr={code:"WALB",nom:"Weighted Average Lease to Break",nomCourt:"WALB",description:"Dur√©e moyenne pond√©r√©e jusqu'√† la prochaine option de sortie",formule:"WALB = Œ£(Dur√©e_to_Break √ó Loyer_Annuel) / Œ£(Loyers_Annuels)",unite:"annees",formatAffichage:"0.0 ans",categoriesRequises:["bail","loyers"],seuilVert:3,seuilOrange:2,seuilRouge:1,tendancePositive:"hausse",icone:"CalendarX"},Tr={code:"TAUX_OCCUPATION_PHYSIQUE",nom:"Taux d'Occupation Physique",nomCourt:"TOP",description:"Ratio de la surface occup√©e sur la surface totale",formule:"TOP = (Surface_Lou√©e / GLA_Total) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["etat_locatif"],seuilVert:95,seuilOrange:90,seuilRouge:85,tendancePositive:"hausse",icone:"Building"},Or={code:"TAUX_OCCUPATION_FINANCIER",nom:"Taux d'Occupation Financier",nomCourt:"TOF",description:"Ratio des loyers per√ßus sur les loyers th√©oriques",formule:"TOF = (Loyers_Per√ßus / Loyers_Th√©oriques) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers","etat_locatif"],seuilVert:95,seuilOrange:90,seuilRouge:85,tendancePositive:"hausse",icone:"Wallet"},Nr={code:"TAUX_VACANCE",nom:"Taux de Vacance",nomCourt:"Vacance",description:"Ratio de la surface vacante sur la surface totale",formule:"VACANCE = (Surface_Vacante / GLA_Total) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["etat_locatif"],seuilVert:5,seuilOrange:10,seuilRouge:15,tendancePositive:"baisse",icone:"Building2"},Pr={code:"TAUX_EFFORT",nom:"Taux d'Effort",nomCourt:"Effort",description:"Ratio du loyer annuel sur le chiffre d'affaires du locataire",formule:"TAUX_EFFORT = (Loyer_Annuel / CA_Locataire) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers","chiffre_affaires"],seuilVert:8,seuilOrange:12,seuilRouge:15,tendancePositive:"baisse",icone:"Activity"},_r={code:"TAUX_EFFORT_MOYEN",nom:"Taux d'Effort Moyen",nomCourt:"Effort Moy.",description:"Moyenne pond√©r√©e des taux d'effort par surface",formule:"EFFORT_MOY = Œ£(Taux_Effort √ó Surface) / Œ£(Surfaces)",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers","chiffre_affaires","etat_locatif"],seuilVert:8,seuilOrange:12,seuilRouge:15,tendancePositive:"baisse",icone:"Activity"},Dr={code:"REVERSION",nom:"Potentiel de R√©version",nomCourt:"R√©version",description:"√âcart entre loyer de march√© et loyer en place",formule:"REVERSION = ((Loyer_March√© - Loyer_Place) / Loyer_Place) √ó 100",unite:"%",formatAffichage:"+0.0%",categoriesRequises:["loyers","etat_locatif"],tendancePositive:"hausse",icone:"ArrowUpRight"},jr={code:"LOYER_MOYEN_M2",nom:"Loyer Moyen par m¬≤",nomCourt:"Loyer/m¬≤",description:"Loyer annuel moyen rapport√© √† la surface",formule:"LOYER_M2 = Loyers_Annuels / Surface_Lou√©e",unite:"EUR/m2/an",formatAffichage:"0 ‚Ç¨/m¬≤/an",categoriesRequises:["loyers","etat_locatif"],tendancePositive:"hausse",icone:"Euro"},Lr={code:"LOYER_TOTAL",nom:"Loyers Totaux",nomCourt:"Loyers",description:"Somme des loyers annuels factur√©s",formule:"LOYERS_TOTAL = Œ£(Loyers_Annuels)",unite:"EUR",formatAffichage:"0,0 ‚Ç¨",categoriesRequises:["loyers"],tendancePositive:"hausse",icone:"Banknote"},kr={code:"CHARGES_TOTALES",nom:"Charges Totales",nomCourt:"Charges",description:"Somme des charges d'exploitation",formule:"CHARGES_TOTAL = Œ£(Charges)",unite:"EUR",formatAffichage:"0,0 ‚Ç¨",categoriesRequises:["charges"],tendancePositive:"baisse",icone:"Receipt"},qr={code:"CHARGES_M2",nom:"Charges par m¬≤",nomCourt:"Charges/m¬≤",description:"Charges annuelles rapport√©es √† la surface",formule:"CHARGES_M2 = Charges_Totales / Surface_Locative",unite:"EUR/m2",formatAffichage:"0 ‚Ç¨/m¬≤",categoriesRequises:["charges","surface"],tendancePositive:"baisse",icone:"LayoutGrid"},Mr={code:"TAUX_REFACTURATION",nom:"Taux de Refacturation",nomCourt:"Refact.",description:"Ratio des charges refactur√©es sur les charges totales",formule:"TAUX_REFACT = (Charges_Refactur√©es / Charges_Totales) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["charges"],seuilVert:85,seuilOrange:75,seuilRouge:65,tendancePositive:"hausse",icone:"Repeat"},Fr={code:"CA_TOTAL",nom:"Chiffre d'Affaires Total",nomCourt:"CA Total",description:"Somme des CA d√©clar√©s par les locataires",formule:"CA_TOTAL = Œ£(CA_Locataires)",unite:"EUR",formatAffichage:"0,0 ‚Ç¨",categoriesRequises:["chiffre_affaires"],tendancePositive:"hausse",icone:"ShoppingCart"},Ur={code:"CA_M2",nom:"CA par m¬≤",nomCourt:"CA/m¬≤",description:"Chiffre d'affaires rapport√© √† la surface",formule:"CA_M2 = CA_Total / Surface_Lou√©e",unite:"EUR/m2",formatAffichage:"0 ‚Ç¨/m¬≤",categoriesRequises:["chiffre_affaires","etat_locatif"],tendancePositive:"hausse",icone:"LayoutGrid"},Br={code:"CA_VISITEUR",nom:"CA par Visiteur",nomCourt:"CA/Visit.",description:"Chiffre d'affaires moyen par visiteur (panier moyen centre)",formule:"CA_VISITEUR = CA_Total / Nombre_Visiteurs",unite:"EUR",formatAffichage:"0.00 ‚Ç¨",categoriesRequises:["chiffre_affaires","frequentation"],tendancePositive:"hausse",icone:"Users"},Vr={code:"FREQUENTATION_TOTALE",nom:"Fr√©quentation Totale",nomCourt:"Fr√©quent.",description:"Nombre total de visiteurs sur la p√©riode",formule:"FREQ_TOTAL = Œ£(Entr√©es)",unite:"visiteurs",formatAffichage:"0,0",categoriesRequises:["frequentation"],tendancePositive:"hausse",icone:"Users"},$r={code:"FREQUENTATION_JOUR_MOYEN",nom:"Fr√©quentation Journali√®re Moyenne",nomCourt:"Fr√©q./Jour",description:"Nombre moyen de visiteurs par jour",formule:"FREQ_JOUR = Fr√©quentation_Totale / Nombre_Jours",unite:"visiteurs",formatAffichage:"0,0",categoriesRequises:["frequentation"],tendancePositive:"hausse",icone:"UserCheck"},zr={code:"TAUX_TRANSFORMATION",nom:"Taux de Transformation",nomCourt:"Transform.",description:"Ratio d'acheteurs sur le nombre de visiteurs",formule:"TRANSFO = (Nombre_Tickets / Nombre_Visiteurs) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["frequentation","chiffre_affaires"],seuilVert:30,seuilOrange:20,seuilRouge:15,tendancePositive:"hausse",icone:"ShoppingBag"},Hr={code:"PANIER_MOYEN",nom:"Panier Moyen",nomCourt:"Panier",description:"Montant moyen par transaction",formule:"PANIER = CA_Total / Nombre_Tickets",unite:"EUR",formatAffichage:"0.00 ‚Ç¨",categoriesRequises:["chiffre_affaires"],tendancePositive:"hausse",icone:"ShoppingCart"},Gr={code:"TAUX_RECOUVREMENT",nom:"Taux de Recouvrement",nomCourt:"Recouv.",description:"Ratio des loyers encaiss√©s sur les loyers appel√©s",formule:"RECOUV = (Loyers_Encaiss√©s / Loyers_Appel√©s) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers"],seuilVert:98,seuilOrange:95,seuilRouge:90,tendancePositive:"hausse",icone:"CheckCircle"},Yr={code:"DSO",nom:"Days Sales Outstanding",nomCourt:"DSO",description:"D√©lai moyen de paiement en jours",formule:"DSO = (Cr√©ances / Loyers_Annuels) √ó 365",unite:"nombre",formatAffichage:"0 jours",categoriesRequises:["loyers"],seuilVert:15,seuilOrange:30,seuilRouge:45,tendancePositive:"baisse",icone:"Clock"},Kr={code:"CONCENTRATION_TOP5",nom:"Concentration Top 5",nomCourt:"Top 5",description:"Part des 5 premiers locataires dans les revenus",formule:"TOP5 = (Loyers_Top5 / Loyers_Totaux) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers","etat_locatif"],seuilVert:25,seuilOrange:35,seuilRouge:50,tendancePositive:"baisse",icone:"PieChart"},Jr={code:"CONCENTRATION_TOP10",nom:"Concentration Top 10",nomCourt:"Top 10",description:"Part des 10 premiers locataires dans les revenus",formule:"TOP10 = (Loyers_Top10 / Loyers_Totaux) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["loyers","etat_locatif"],seuilVert:40,seuilOrange:55,seuilRouge:70,tendancePositive:"baisse",icone:"PieChart"},Xr={code:"DIVERSITE_ACTIVITES",nom:"Diversit√© des Activit√©s",nomCourt:"Diversit√©",description:"Nombre de cat√©gories d'activit√©s repr√©sent√©es",formule:"DIVERSITE = Count(Distinct(Activit√©s))",unite:"nombre",formatAffichage:"0",categoriesRequises:["etat_locatif"],tendancePositive:"hausse",icone:"Layers"},Qr={code:"RATIO_ANCRES",nom:"Ratio Locomotives",nomCourt:"Locomotives",description:"Part des locomotives dans la surface totale",formule:"ANCRES = (Surface_Locomotives / GLA_Total) √ó 100",unite:"%",formatAffichage:"0.0%",categoriesRequises:["etat_locatif"],tendancePositive:"hausse",icone:"Store"},Wr={code:"VALEUR_ACTIF",nom:"Valeur de l'Actif",nomCourt:"Valeur",description:"Valeur v√©nale estim√©e de l'actif",formule:"VALEUR = Derni√®re_Valorisation",unite:"EUR",formatAffichage:"0,0 ‚Ç¨",categoriesRequises:["valorisation"],tendancePositive:"hausse",icone:"Landmark"},Zr={code:"VALEUR_M2",nom:"Valeur par m¬≤",nomCourt:"Valeur/m¬≤",description:"Valeur de l'actif rapport√©e √† la surface",formule:"VALEUR_M2 = Valeur_Actif / GLA_Total",unite:"EUR/m2",formatAffichage:"0 ‚Ç¨/m¬≤",categoriesRequises:["valorisation","surface"],tendancePositive:"hausse",icone:"LayoutGrid"},x={NOI:Ir,NOI_M2:Er,YIELD_BRUT:wr,YIELD_NET:Cr,WAULT:Sr,WALB:Rr,TAUX_OCCUPATION_PHYSIQUE:Tr,TAUX_OCCUPATION_FINANCIER:Or,TAUX_VACANCE:Nr,TAUX_EFFORT:Pr,TAUX_EFFORT_MOYEN:_r,REVERSION:Dr,LOYER_MOYEN_M2:jr,LOYER_TOTAL:Lr,CHARGES_TOTALES:kr,CHARGES_M2:qr,TAUX_REFACTURATION:Mr,CA_TOTAL:Fr,CA_M2:Ur,CA_VISITEUR:Br,FREQUENTATION_TOTALE:Vr,FREQUENTATION_JOUR_MOYEN:$r,TAUX_TRANSFORMATION:zr,PANIER_MOYEN:Hr,TAUX_RECOUVREMENT:Gr,DSO:Yr,CONCENTRATION_TOP5:Kr,CONCENTRATION_TOP10:Jr,DIVERSITE_ACTIVITES:Xr,RATIO_ANCRES:Qr,VALEUR_ACTIF:Wr,VALEUR_M2:Zr};function ea(i,s){return i.seuilVert===void 0?"vert":i.tendancePositive==="hausse"?s>=i.seuilVert?"vert":i.seuilOrange&&s>=i.seuilOrange?"orange":"rouge":s<=i.seuilVert?"vert":i.seuilOrange&&s<=i.seuilOrange?"orange":"rouge"}function m(i,s,e,t,r,a,o=!1){return{id:i,titre:s,titreCourt:e,description:t,ordre:r,kpisCodes:a,graphiquesRecommandes:["barre","ligne"],contenuType:"mixte",optionnel:o}}const ta={id:"perf-actif",code:"PERF_ACTIF",nom:"Performance de l'Actif",nomCourt:"Perf. Actif",description:"Analyse compl√®te de la performance financi√®re et op√©rationnelle de l'actif immobilier",categorie:"asset_management",complexite:"intermediaire",pagesMin:8,pagesMax:15,categoriesRequises:["loyers","charges","valorisation","etat_locatif"],kpis:[x.NOI,x.YIELD_NET,x.TAUX_OCCUPATION_FINANCIER,x.WAULT],sections:[m("exec","R√©sum√© Ex√©cutif","R√©sum√©","Vue synth√©tique des performances",1,["NOI","YIELD_NET"]),m("kpis","Indicateurs Cl√©s","KPIs","Dashboard des KPIs principaux",2,["NOI","YIELD_NET","TAUX_OCCUPATION_FINANCIER","WAULT"]),m("revenus","Analyse des Revenus","Revenus","D√©tail des revenus locatifs",3,["LOYER_TOTAL","LOYER_MOYEN_M2"]),m("charges","Analyse des Charges","Charges","D√©tail des charges d'exploitation",4,["CHARGES_TOTALES","TAUX_REFACTURATION"]),m("occupation","Occupation","Occupation","Taux d'occupation et vacance",5,["TAUX_OCCUPATION_PHYSIQUE","TAUX_VACANCE"]),m("recomm","Recommandations","Recomm.","Actions recommand√©es",6,[],!0)],graphiquesRecommandes:["barre","ligne","camembert","jauge"],frequenceRecommandee:"mensuel",destinatairesTypes:["Asset Manager","Direction","Investisseurs"],combinableAvec:["NOI_ANALYSIS","ANALYSE_PORTEFEUILLE"],icone:"TrendingUp",couleur:"#3b82f6",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ra={id:"analyse-portefeuille",code:"ANALYSE_PORTEFEUILLE",nom:"Analyse de Portefeuille",nomCourt:"Portefeuille",description:"Vision consolid√©e multi-actifs avec comparaisons et benchmarks",categorie:"asset_management",complexite:"avance",pagesMin:15,pagesMax:30,categoriesRequises:["loyers","charges","valorisation","etat_locatif"],kpis:[x.VALEUR_ACTIF,x.YIELD_NET,x.WAULT,x.TAUX_OCCUPATION_PHYSIQUE],sections:[m("exec","R√©sum√© Ex√©cutif","R√©sum√©","Vue synth√©tique du portefeuille",1,["VALEUR_ACTIF","NOI"]),m("compo","Composition du Portefeuille","Compo.","R√©partition par type, g√©ographie",2,[]),m("perf","Performances Compar√©es","Perf.","Benchmark entre actifs",3,["YIELD_NET","NOI_M2"]),m("risques","Analyse des Risques","Risques","Concentration, √©ch√©ances",4,["CONCENTRATION_TOP5","WAULT"]),m("strat","Strat√©gie & Arbitrages","Strat√©gie","Recommandations arbitrages",5,[],!0)],graphiquesRecommandes:["barre","treemap","scatter","radar"],frequenceRecommandee:"trimestriel",destinatairesTypes:["Direction","Comit√© d'Investissement","Investisseurs"],combinableAvec:["PERF_ACTIF"],icone:"Briefcase",couleur:"#3b82f6",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},aa={id:"business-plan",code:"BUSINESS_PLAN",nom:"Business Plan",nomCourt:"BP",description:"Plan d'affaires sur 5-10 ans avec projections et hypoth√®ses",categorie:"asset_management",complexite:"avance",pagesMin:20,pagesMax:40,categoriesRequises:["loyers","charges","valorisation","bail","travaux","budget"],kpis:[x.NOI,x.YIELD_NET,x.WAULT,x.REVERSION],sections:[m("exec","R√©sum√© Ex√©cutif","R√©sum√©","Synth√®se du business plan",1,[]),m("hypo","Hypoth√®ses","Hypoth√®ses","Hypoth√®ses retenues",2,[]),m("locatif","Strat√©gie Locative","Locatif","Plan de commercialisation",3,["WAULT","REVERSION"]),m("capex","Plan CAPEX","CAPEX","Investissements pr√©vus",4,[]),m("proj","Projections Financi√®res","Projections","CF et NOI projet√©s",5,["NOI"]),m("sensi","Analyses de Sensibilit√©","Sensibilit√©","Sc√©narios alternatifs",6,[]),m("sortie","Strat√©gie de Sortie","Sortie","Options de cession",7,["YIELD_NET"],!0)],graphiquesRecommandes:["ligne","aire","waterfall","barre"],frequenceRecommandee:"annuel",destinatairesTypes:["Direction","Comit√© d'Investissement","Banques"],combinableAvec:["VALORISATION_DCF"],icone:"FileText",couleur:"#3b82f6",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ia={id:"valorisation-dcf",code:"VALORISATION_DCF",nom:"Valorisation DCF",nomCourt:"DCF",description:"Valorisation par actualisation des flux de tr√©sorerie",categorie:"asset_management",complexite:"avance",pagesMin:10,pagesMax:20,categoriesRequises:["loyers","charges","valorisation","bail"],kpis:[x.VALEUR_ACTIF,x.NOI,x.YIELD_NET],sections:[m("exec","R√©sum√© Valorisation","R√©sum√©","Valeur retenue et fourchette",1,["VALEUR_ACTIF"]),m("hypo","Hypoth√®ses DCF","Hypoth√®ses","Taux, dur√©e, valeur terminale",2,[]),m("cf","Cash-Flows Projet√©s","CF","Flux par ann√©e",3,["NOI"]),m("sensi","Analyses de Sensibilit√©","Sensibilit√©","Impact des variations",4,[]),m("compa","Comparaison M√©thodes","Compa.","DCF vs Capitalisation",5,["YIELD_NET"])],graphiquesRecommandes:["ligne","waterfall","heatmap"],frequenceRecommandee:"annuel",destinatairesTypes:["Direction","Experts","Banques"],combinableAvec:["BUSINESS_PLAN"],icone:"Calculator",couleur:"#3b82f6",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},sa={id:"etat-locatif-report",code:"ETAT_LOCATIF_REPORT",nom:"√âtat Locatif",nomCourt:"√âtat Loc.",description:"Liste exhaustive des baux et locataires avec d√©tails contractuels",categorie:"property_management",complexite:"simple",pagesMin:5,pagesMax:20,categoriesRequises:["etat_locatif","bail"],kpis:[x.TAUX_OCCUPATION_PHYSIQUE,x.LOYER_TOTAL,x.LOYER_MOYEN_M2],sections:[m("synth","Synth√®se","Synth√®se","Vue d'ensemble de l'occupation",1,["TAUX_OCCUPATION_PHYSIQUE"]),m("liste","Liste des Locataires","Locataires","Tableau d√©taill√©",2,["LOYER_TOTAL"]),m("vacance","Lots Vacants","Vacance","D√©tail des lots disponibles",3,["TAUX_VACANCE"]),m("loyers","Analyse des Loyers","Loyers","R√©partition et moyennes",4,["LOYER_MOYEN_M2"])],graphiquesRecommandes:["camembert","barre","treemap"],frequenceRecommandee:"mensuel",destinatairesTypes:["Property Manager","Asset Manager","Propri√©taire"],combinableAvec:["SUIVI_BAUX"],icone:"ClipboardList",couleur:"#10b981",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},oa={id:"suivi-baux",code:"SUIVI_BAUX",nom:"Suivi des Baux",nomCourt:"Baux",description:"√âch√©ancier des baux avec dates cl√©s et options",categorie:"property_management",complexite:"simple",pagesMin:4,pagesMax:12,categoriesRequises:["bail","etat_locatif"],kpis:[x.WAULT,x.WALB],sections:[m("kpis","Indicateurs","KPIs","WAULT et WALB",1,["WAULT","WALB"]),m("echeances","√âch√©ancier","√âch√©ances","Baux arrivant √† terme",2,[]),m("breaks","Options de Break","Breaks","Dates de sortie possibles",3,[]),m("indexations","Indexations","Index.","Prochaines r√©visions",4,[]),m("actions","Actions Recommand√©es","Actions","Renouvellements prioritaires",5,[],!0)],graphiquesRecommandes:["barre","ligne","waterfall"],frequenceRecommandee:"mensuel",destinatairesTypes:["Property Manager","Leasing Manager","Juridique"],combinableAvec:["ETAT_LOCATIF_REPORT"],icone:"FileSignature",couleur:"#10b981",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},na={id:"gestion-charges",code:"GESTION_CHARGES",nom:"Gestion des Charges",nomCourt:"Charges",description:"Analyse des charges et budget avec taux de refacturation",categorie:"property_management",complexite:"intermediaire",pagesMin:6,pagesMax:15,categoriesRequises:["charges","budget"],kpis:[x.CHARGES_TOTALES,x.CHARGES_M2,x.TAUX_REFACTURATION],sections:[m("synth","Synth√®se","Synth√®se","Vue d'ensemble des charges",1,["CHARGES_TOTALES","TAUX_REFACTURATION"]),m("detail","D√©tail par Poste","D√©tail","Charges par cat√©gorie",2,["CHARGES_M2"]),m("evol","√âvolution","√âvolution","Comparaison N/N-1",3,[]),m("budget","Budget vs R√©el","Budget","√âcarts budg√©taires",4,[]),m("refact","Refacturation","Refact.","Analyse refacturation",5,["TAUX_REFACTURATION"])],graphiquesRecommandes:["barre","camembert","ligne","waterfall"],frequenceRecommandee:"mensuel",destinatairesTypes:["Property Manager","Comptabilit√©","Propri√©taire"],combinableAvec:["BUDGET_VS_REEL"],icone:"Receipt",couleur:"#10b981",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ca={id:"reporting-proprietaire",code:"REPORTING_PROPRIETAIRE",nom:"Reporting Propri√©taire",nomCourt:"Prop. Report",description:"Rapport p√©riodique complet pour le propri√©taire de l'actif",categorie:"property_management",complexite:"intermediaire",pagesMin:10,pagesMax:25,categoriesRequises:["loyers","charges","etat_locatif","bail"],kpis:[x.NOI,x.TAUX_OCCUPATION_PHYSIQUE,x.TAUX_RECOUVREMENT,x.WAULT],sections:[m("exec","R√©sum√© Ex√©cutif","R√©sum√©","Points cl√©s de la p√©riode",1,["NOI","TAUX_OCCUPATION_PHYSIQUE"]),m("locatif","Situation Locative","Locatif","Mouvements et occupation",2,["TAUX_OCCUPATION_PHYSIQUE"]),m("financier","Situation Financi√®re","Financier","Revenus et charges",3,["NOI","TAUX_RECOUVREMENT"]),m("baux","√âch√©ances Baux","Baux","Points d'attention",4,["WAULT"]),m("travaux","Travaux","Travaux","√âtat d'avancement",5,[],!0),m("actions","Actions & Recommandations","Actions","Prochaines √©tapes",6,[])],graphiquesRecommandes:["barre","ligne","camembert","jauge"],frequenceRecommandee:"mensuel",destinatairesTypes:["Propri√©taire","Asset Manager"],combinableAvec:["PERF_ACTIF"],icone:"Building2",couleur:"#10b981",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},la={id:"pipeline-commercial",code:"PIPELINE_COMMERCIAL",nom:"Pipeline Commercial",nomCourt:"Pipeline",description:"Suivi des prospects et n√©gociations en cours",categorie:"leasing",complexite:"simple",pagesMin:4,pagesMax:10,categoriesRequises:["etat_locatif"],kpis:[x.TAUX_VACANCE,x.LOYER_MOYEN_M2],sections:[m("synth","Synth√®se Pipeline","Synth√®se","√âtat des n√©gociations",1,[]),m("prospects","Prospects Actifs","Prospects","Liste et statuts",2,[]),m("offres","Offres en Cours","Offres","D√©tail des propositions",3,["LOYER_MOYEN_M2"]),m("signees","Signatures Pr√©vues","Signatures","Baux √† venir",4,[]),m("vacance","Disponibilit√©s","Vacance","Lots √† commercialiser",5,["TAUX_VACANCE"])],graphiquesRecommandes:["funnel","barre","camembert"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["Leasing Manager","Asset Manager","Direction"],combinableAvec:["SUIVI_VACANCE"],icone:"Target",couleur:"#f97316",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},da={id:"merchandising-mix",code:"MERCHANDISING_MIX",nom:"Merchandising Mix",nomCourt:"Mix",description:"Analyse de la r√©partition des activit√©s et du mix commercial",categorie:"leasing",complexite:"intermediaire",pagesMin:6,pagesMax:15,categoriesRequises:["etat_locatif","chiffre_affaires"],kpis:[x.DIVERSITE_ACTIVITES,x.RATIO_ANCRES,x.CA_M2],sections:[m("synth","Vue d'Ensemble","Synth√®se","R√©partition globale",1,["DIVERSITE_ACTIVITES"]),m("activites","R√©partition par Activit√©","Activit√©s","Surface et CA par secteur",2,[]),m("ancres","Locomotives","Locomotives","R√¥le et performance",3,["RATIO_ANCRES"]),m("perf","Performance par Secteur","Performance","CA/m¬≤ par activit√©",4,["CA_M2"]),m("recomm","Recommandations Mix","Recomm.","Optimisations sugg√©r√©es",5,[],!0)],graphiquesRecommandes:["treemap","camembert","barre_horizontale","radar"],frequenceRecommandee:"trimestriel",destinatairesTypes:["Leasing Manager","Marketing","Direction"],combinableAvec:["PERF_ENSEIGNES"],icone:"Grid3X3",couleur:"#f97316",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ua={id:"benchmark-loyers",code:"BENCHMARK_LOYERS",nom:"Benchmark Loyers",nomCourt:"Benchmark",description:"Comparaison des loyers avec le march√© et potentiel de r√©version",categorie:"leasing",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:["loyers","etat_locatif","bail"],kpis:[x.LOYER_MOYEN_M2,x.REVERSION],sections:[m("synth","Synth√®se","Synth√®se","Position vs march√©",1,["LOYER_MOYEN_M2","REVERSION"]),m("compa","Comparaison March√©","March√©","Loyers place vs march√©",2,[]),m("activite","Par Activit√©","Activit√©s","Benchmark par secteur",3,[]),m("potentiel","Potentiel de R√©version","R√©version","Opportunit√©s identifi√©es",4,["REVERSION"]),m("actions","Actions Commerciales","Actions","Priorit√©s ren√©gociation",5,[])],graphiquesRecommandes:["barre","scatter","barre_horizontale"],frequenceRecommandee:"semestriel",destinatairesTypes:["Leasing Manager","Asset Manager"],combinableAvec:["SUIVI_BAUX"],icone:"Scale",couleur:"#f97316",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},pa={id:"suivi-vacance",code:"SUIVI_VACANCE",nom:"Suivi de la Vacance",nomCourt:"Vacance",description:"Analyse d√©taill√©e des lots vacants et strat√©gie de relocation",categorie:"leasing",complexite:"simple",pagesMin:4,pagesMax:10,categoriesRequises:["etat_locatif"],kpis:[x.TAUX_VACANCE,x.TAUX_OCCUPATION_PHYSIQUE],sections:[m("synth","Synth√®se","Synth√®se","√âtat global de la vacance",1,["TAUX_VACANCE"]),m("lots","Lots Vacants","Lots","Liste d√©taill√©e",2,[]),m("duree","Dur√©e de Vacance","Dur√©e","Anciennet√© par lot",3,[]),m("causes","Analyse des Causes","Causes","Raisons de la vacance",4,[]),m("actions","Plan de Relocation","Actions","Strat√©gie par lot",5,[])],graphiquesRecommandes:["barre","camembert","ligne"],frequenceRecommandee:"mensuel",destinatairesTypes:["Leasing Manager","Property Manager","Asset Manager"],combinableAvec:["PIPELINE_COMMERCIAL"],icone:"Home",couleur:"#f97316",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ma={id:"tdb-centre",code:"TDB_CENTRE",nom:"Tableau de Bord Centre",nomCourt:"TDB",description:"Dashboard op√©rationnel quotidien/hebdomadaire du centre commercial",categorie:"centre_commercial",complexite:"simple",pagesMin:3,pagesMax:8,categoriesRequises:["frequentation","chiffre_affaires","etat_locatif"],kpis:[x.FREQUENTATION_TOTALE,x.CA_TOTAL,x.TAUX_OCCUPATION_PHYSIQUE],sections:[m("flash","Flash","Flash","Chiffres cl√©s instantan√©s",1,["FREQUENTATION_TOTALE","CA_TOTAL","TAUX_OCCUPATION_PHYSIQUE"]),m("freq","Fr√©quentation","Fr√©q.","Courbe et comparaison",2,["FREQUENTATION_TOTALE","FREQUENTATION_JOUR_MOYEN"]),m("ca","Chiffre d'Affaires","CA","Performance commerciale",3,["CA_TOTAL"]),m("alertes","Alertes","Alertes","Points d'attention",4,[])],graphiquesRecommandes:["ligne","jauge","barre"],frequenceRecommandee:"quotidien",destinatairesTypes:["Directeur Centre","Responsable Exploitation"],combinableAvec:["ANALYSE_FREQUENTATION","ANALYSE_CA"],icone:"LayoutDashboard",couleur:"#8b5cf6",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ga={id:"analyse-frequentation",code:"ANALYSE_FREQUENTATION",nom:"Analyse de la Fr√©quentation",nomCourt:"Fr√©quent.",description:"Analyse approfondie des flux visiteurs et tendances",categorie:"centre_commercial",complexite:"intermediaire",pagesMin:8,pagesMax:15,categoriesRequises:["frequentation"],kpis:[x.FREQUENTATION_TOTALE,x.FREQUENTATION_JOUR_MOYEN,x.TAUX_TRANSFORMATION],sections:[m("synth","Synth√®se","Synth√®se","Performance globale",1,["FREQUENTATION_TOTALE"]),m("evol","√âvolution","√âvolution","Tendances mensuelles/annuelles",2,[]),m("jour","Analyse par Jour","Jours","R√©partition hebdomadaire",3,["FREQUENTATION_JOUR_MOYEN"]),m("heure","Analyse Horaire","Heures","Pics et creux",4,[]),m("zones","Par Zone","Zones","Fr√©quentation par entr√©e",5,[],!0),m("events","Impact √âv√©nements","√âv√©nements","Corr√©lation √©v√©nements",6,[],!0)],graphiquesRecommandes:["ligne","aire","heatmap","barre"],frequenceRecommandee:"mensuel",destinatairesTypes:["Directeur Centre","Marketing","Leasing Manager"],combinableAvec:["TDB_CENTRE","ANALYSE_CA"],icone:"Users",couleur:"#8b5cf6",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},fa={id:"perf-enseignes",code:"PERF_ENSEIGNES",nom:"Performance des Enseignes",nomCourt:"Enseignes",description:"Classement et analyse des performances par enseigne",categorie:"centre_commercial",complexite:"intermediaire",pagesMin:8,pagesMax:20,categoriesRequises:["chiffre_affaires","etat_locatif","loyers"],kpis:[x.CA_M2,x.TAUX_EFFORT,x.CA_TOTAL],sections:[m("ranking","Classement G√©n√©ral","Ranking","Top et bottom performers",1,["CA_M2"]),m("activites","Par Activit√©","Activit√©s","Performance par secteur",2,[]),m("effort","Taux d'Effort","Effort","Analyse soutenabilit√©",3,["TAUX_EFFORT"]),m("evol","√âvolution","√âvolution","Tendances vs N-1",4,[]),m("risques","Enseignes √† Risque","Risques","Alertes et surveillance",5,[])],graphiquesRecommandes:["barre_horizontale","scatter","treemap"],frequenceRecommandee:"mensuel",destinatairesTypes:["Directeur Centre","Leasing Manager","Asset Manager"],combinableAvec:["ANALYSE_CA","MERCHANDISING_MIX"],icone:"Store",couleur:"#8b5cf6",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ha={id:"analyse-ca",code:"ANALYSE_CA",nom:"Analyse du Chiffre d'Affaires",nomCourt:"Analyse CA",description:"Analyse d√©taill√©e des CA d√©clar√©s par les locataires",categorie:"centre_commercial",complexite:"intermediaire",pagesMin:8,pagesMax:15,categoriesRequises:["chiffre_affaires","frequentation"],kpis:[x.CA_TOTAL,x.CA_M2,x.CA_VISITEUR,x.PANIER_MOYEN],sections:[m("synth","Synth√®se","Synth√®se","Vue globale CA",1,["CA_TOTAL","CA_M2"]),m("evol","√âvolution","√âvolution","Tendance mensuelle/annuelle",2,[]),m("activites","Par Activit√©","Activit√©s","Contribution par secteur",3,[]),m("transfo","Transformation","Transfo.","CA/visiteur et panier",4,["CA_VISITEUR","PANIER_MOYEN"]),m("compa","Comparaison N-1","N-1","Performance vs ann√©e pr√©c√©dente",5,[])],graphiquesRecommandes:["ligne","barre","aire_empilee","camembert"],frequenceRecommandee:"mensuel",destinatairesTypes:["Directeur Centre","Asset Manager","Leasing Manager"],combinableAvec:["ANALYSE_FREQUENTATION","PERF_ENSEIGNES"],icone:"TrendingUp",couleur:"#8b5cf6",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ya={id:"compte-resultat",code:"COMPTE_RESULTAT",nom:"Compte de R√©sultat",nomCourt:"P&L",description:"√âtat des produits et charges avec analyse des marges",categorie:"financier",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:["loyers","charges"],kpis:[x.LOYER_TOTAL,x.CHARGES_TOTALES,x.NOI],sections:[m("synth","Synth√®se","Synth√®se","P&L r√©sum√©",1,["NOI"]),m("revenus","Revenus","Revenus","D√©tail des produits",2,["LOYER_TOTAL"]),m("charges","Charges","Charges","D√©tail des charges",3,["CHARGES_TOTALES"]),m("result","R√©sultat","R√©sultat","Formation du NOI",4,["NOI"]),m("evol","√âvolution","√âvolution","Comparaison p√©riodes",5,[])],graphiquesRecommandes:["waterfall","barre","ligne"],frequenceRecommandee:"mensuel",destinatairesTypes:["Comptabilit√©","DAF","Asset Manager"],combinableAvec:["NOI_ANALYSIS","BUDGET_VS_REEL"],icone:"FileSpreadsheet",couleur:"#ec4899",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},ba={id:"cf-operationnel",code:"CF_OPERATIONNEL",nom:"Cash-Flow Op√©rationnel",nomCourt:"CF Op√©",description:"Analyse des flux de tr√©sorerie op√©rationnels",categorie:"financier",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:["loyers","charges"],kpis:[x.NOI,x.TAUX_RECOUVREMENT,x.DSO],sections:[m("synth","Synth√®se CF","Synth√®se","Cash-flow net",1,["NOI"]),m("encaiss","Encaissements","Encaiss.","D√©tail des entr√©es",2,["TAUX_RECOUVREMENT"]),m("decaiss","D√©caissements","D√©caiss.","D√©tail des sorties",3,[]),m("bfr","BFR","BFR","√âvolution cr√©ances/dettes",4,["DSO"]),m("prev","Pr√©visionnel","Pr√©vi.","CF √† venir",5,[],!0)],graphiquesRecommandes:["waterfall","ligne","barre"],frequenceRecommandee:"mensuel",destinatairesTypes:["DAF","Tr√©sorerie","Asset Manager"],combinableAvec:["COMPTE_RESULTAT"],icone:"Wallet",couleur:"#ec4899",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Aa={id:"noi-analysis",code:"NOI_ANALYSIS",nom:"Analyse du NOI",nomCourt:"NOI",description:"Analyse d√©taill√©e du Net Operating Income et ses composantes",categorie:"financier",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:["loyers","charges"],kpis:[x.NOI,x.NOI_M2,x.YIELD_NET],sections:[m("synth","Synth√®se NOI","Synth√®se","Vue globale",1,["NOI","NOI_M2"]),m("decomp","D√©composition","D√©comp.","Formation du NOI",2,[]),m("evol","√âvolution","√âvolution","Tendance sur 12 mois",3,[]),m("drivers","Drivers","Drivers","Facteurs d'√©volution",4,[]),m("benchmark","Benchmark","Bench.","Comparaison march√©",5,["YIELD_NET"],!0)],graphiquesRecommandes:["waterfall","ligne","barre","aire"],frequenceRecommandee:"mensuel",destinatairesTypes:["Asset Manager","DAF","Direction"],combinableAvec:["COMPTE_RESULTAT","PERF_ACTIF"],icone:"TrendingUp",couleur:"#ec4899",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},xa={id:"budget-vs-reel",code:"BUDGET_VS_REEL",nom:"Budget vs R√©el",nomCourt:"Budget",description:"Analyse des √©carts entre budget et r√©alis√©",categorie:"financier",complexite:"simple",pagesMin:5,pagesMax:12,categoriesRequises:["budget","loyers","charges"],kpis:[x.NOI,x.LOYER_TOTAL,x.CHARGES_TOTALES],sections:[m("synth","Synth√®se","Synth√®se","√âcarts globaux",1,["NOI"]),m("revenus","Revenus","Revenus","√âcarts sur revenus",2,["LOYER_TOTAL"]),m("charges","Charges","Charges","√âcarts sur charges",3,["CHARGES_TOTALES"]),m("detail","D√©tail par Poste","D√©tail","Analyse ligne par ligne",4,[]),m("actions","Actions Correctives","Actions","Mesures propos√©es",5,[])],graphiquesRecommandes:["barre","waterfall","ligne"],frequenceRecommandee:"mensuel",destinatairesTypes:["Contr√¥le de Gestion","DAF","Asset Manager"],combinableAvec:["COMPTE_RESULTAT","GESTION_CHARGES"],icone:"Scale",couleur:"#ec4899",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},va={id:"due-diligence",code:"DUE_DILIGENCE",nom:"Due Diligence",nomCourt:"Due Dil.",description:"Rapport d'audit complet pour acquisition potentielle",categorie:"investissement",complexite:"avance",pagesMin:30,pagesMax:60,categoriesRequises:["loyers","charges","bail","valorisation","etat_locatif","travaux"],kpis:[x.NOI,x.YIELD_NET,x.WAULT,x.TAUX_OCCUPATION_PHYSIQUE],sections:[m("exec","Executive Summary","Summary","Synth√®se d√©cisionnelle",1,["NOI","YIELD_NET"]),m("actif","Description de l'Actif","Actif","Caract√©ristiques physiques",2,[]),m("locatif","Situation Locative","Locatif","Analyse des baux",3,["WAULT","TAUX_OCCUPATION_PHYSIQUE"]),m("financier","Analyse Financi√®re","Financier","Revenus et charges",4,["NOI"]),m("technique","Audit Technique","Technique","√âtat du b√¢timent",5,[]),m("juridique","Points Juridiques","Juridique","Risques l√©gaux",6,[]),m("risques","Analyse des Risques","Risques","Matrice des risques",7,[]),m("valo","Valorisation","Valorisation","Proposition de prix",8,["YIELD_NET"])],graphiquesRecommandes:["barre","radar","waterfall","heatmap"],frequenceRecommandee:"ponctuel",destinatairesTypes:["Comit√© d'Investissement","Direction","Acqu√©reur"],combinableAvec:["VALORISATION_DCF"],icone:"Search",couleur:"#06b6d4",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Ia={id:"etude-marche",code:"ETUDE_MARCHE",nom:"√âtude de March√©",nomCourt:"March√©",description:"Analyse de la zone de chalandise et du march√© local",categorie:"investissement",complexite:"intermediaire",pagesMin:15,pagesMax:30,categoriesRequises:["frequentation"],kpis:[x.FREQUENTATION_TOTALE,x.CA_M2],sections:[m("exec","Synth√®se","Synth√®se","Points cl√©s du march√©",1,[]),m("zone","Zone de Chalandise","Zone","D√©limitation et population",2,[]),m("socio","Donn√©es Socio-d√©mo","Socio","Profil de la client√®le",3,[]),m("concurrence","Analyse Concurrence","Concurrence","Offre existante",4,[]),m("potentiel","Potentiel Commercial","Potentiel","D√©penses captables",5,["CA_M2"]),m("tendances","Tendances","Tendances","√âvolution du march√©",6,[])],graphiquesRecommandes:["camembert","barre","radar","scatter"],frequenceRecommandee:"ponctuel",destinatairesTypes:["Leasing Manager","Direction","Investisseurs"],combinableAvec:["ANALYSE_CONCURRENTIELLE"],icone:"MapPin",couleur:"#06b6d4",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Ea={id:"analyse-concurrentielle",code:"ANALYSE_CONCURRENTIELLE",nom:"Analyse Concurrentielle",nomCourt:"Concurrence",description:"Benchmark d√©taill√© vs centres commerciaux concurrents",categorie:"investissement",complexite:"intermediaire",pagesMin:10,pagesMax:20,categoriesRequises:["frequentation","chiffre_affaires"],kpis:[x.FREQUENTATION_TOTALE,x.CA_M2,x.LOYER_MOYEN_M2],sections:[m("synth","Synth√®se","Synth√®se","Positionnement global",1,[]),m("mapping","Cartographie","Carte","Localisation concurrents",2,[]),m("compa","Tableau Comparatif","Comparatif","Benchmark d√©taill√©",3,["FREQUENTATION_TOTALE","CA_M2"]),m("forces","Forces/Faiblesses","SWOT","Analyse comparative",4,[]),m("recomm","Recommandations","Recomm.","Positionnement sugg√©r√©",5,[])],graphiquesRecommandes:["radar","barre","scatter"],frequenceRecommandee:"annuel",destinatairesTypes:["Direction","Marketing","Leasing Manager"],combinableAvec:["ETUDE_MARCHE"],icone:"GitCompare",couleur:"#06b6d4",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},wa={id:"scenarios-acquisition",code:"SCENARIOS_ACQUISITION",nom:"Sc√©narios d'Acquisition",nomCourt:"Sc√©narios",description:"Mod√©lisation de diff√©rents sc√©narios d'investissement",categorie:"investissement",complexite:"avance",pagesMin:15,pagesMax:25,categoriesRequises:["loyers","charges","valorisation","bail"],kpis:[x.YIELD_NET,x.NOI,x.VALEUR_ACTIF],sections:[m("exec","Synth√®se","Synth√®se","Comparaison sc√©narios",1,["YIELD_NET"]),m("base","Sc√©nario Base","Base","Hypoth√®ses conservatrices",2,["NOI"]),m("opti","Sc√©nario Optimiste","Optimiste","Hypoth√®ses favorables",3,[]),m("pessi","Sc√©nario Pessimiste","Pessimiste","Hypoth√®ses d√©favorables",4,[]),m("sensi","Sensibilit√©s","Sensibilit√©","Analyses de sensibilit√©",5,[]),m("recomm","Recommandation","Recomm.","Avis et conditions",6,["VALEUR_ACTIF"])],graphiquesRecommandes:["ligne","barre","heatmap","waterfall"],frequenceRecommandee:"ponctuel",destinatairesTypes:["Comit√© d'Investissement","Direction","Banques"],combinableAvec:["DUE_DILIGENCE","VALORISATION_DCF"],icone:"GitBranch",couleur:"#06b6d4",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Ca={id:"dashboard-projet",code:"DASHBOARD_PROJET",nom:"Dashboard Projet",nomCourt:"Dashboard",description:"Vue synth√©tique de l'avancement global du projet de construction/r√©novation",categorie:"projet",complexite:"simple",pagesMin:4,pagesMax:8,categoriesRequises:[],kpis:[],sections:[m("exec","Vue d'Ensemble","Vue","Synth√®se de l'avancement projet",1,[]),m("jalons","Jalons Cl√©s","Jalons","√âtat des jalons principaux",2,[]),m("budget","Budget","Budget","Suivi budg√©taire synth√©tique",3,[]),m("equipe","√âquipe","√âquipe","Avancement du recrutement",4,[]),m("commercial","Commercial","Commercial","Pipeline de commercialisation",5,[]),m("risques","Risques","Risques","Top risques identifi√©s",6,[])],graphiquesRecommandes:["jauge","barre","ligne"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["Directeur Projet","Direction","Comit√© de Pilotage"],combinableAvec:["SUIVI_JALONS","BUDGET_PROJET"],icone:"LayoutDashboard",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Sa={id:"suivi-jalons",code:"SUIVI_JALONS",nom:"Suivi des Jalons",nomCourt:"Jalons",description:"Suivi d√©taill√© des √©tapes cl√©s du projet avec planning et alertes",categorie:"projet",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:[],kpis:[],sections:[m("synth","Synth√®se","Synth√®se","√âtat global des jalons",1,[]),m("gantt","Planning Gantt","Planning","Vue chronologique",2,[]),m("detail","D√©tail par Jalon","D√©tail","Avancement de chaque jalon",3,[]),m("retards","Retards & Alertes","Alertes","Jalons en retard ou √† risque",4,[]),m("deps","D√©pendances","D√©pendances","Liens entre jalons",5,[],!0),m("prev","Pr√©visionnel","Pr√©vi.","Projection de fin de projet",6,[])],graphiquesRecommandes:["ligne","barre","heatmap"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["Chef de Projet","Directeur Projet","MOE/MOA"],combinableAvec:["DASHBOARD_PROJET","RISQUES_PROJET"],icone:"Milestone",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Ra={id:"suivi-recrutement",code:"SUIVI_RECRUTEMENT",nom:"Suivi du Recrutement",nomCourt:"Recrutement",description:"√âtat d'avancement du recrutement de l'√©quipe d'exploitation",categorie:"projet",complexite:"simple",pagesMin:4,pagesMax:10,categoriesRequises:[],kpis:[],sections:[m("synth","Synth√®se","Synth√®se","Vue d'ensemble du recrutement",1,[]),m("organi","Organigramme Cible","Organi.","Structure cible vs actuelle",2,[]),m("postes","D√©tail par Poste","Postes","√âtat de chaque recrutement",3,[]),m("pipeline","Pipeline Candidats","Pipeline","Candidatures en cours",4,[]),m("planning","Planning Int√©gration","Planning","Dates d'arriv√©e pr√©vues",5,[]),m("formation","Plan de Formation","Formation","Besoins de formation",6,[],!0)],graphiquesRecommandes:["barre","camembert","ligne"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["DRH","Directeur Projet","Futur Directeur Centre"],combinableAvec:["DASHBOARD_PROJET"],icone:"Users",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Ta={id:"commercialisation-projet",code:"COMMERCIALISATION_PROJET",nom:"Commercialisation Projet",nomCourt:"Commerc.",description:"Suivi de la pr√©-commercialisation du centre en construction",categorie:"projet",complexite:"intermediaire",pagesMin:8,pagesMax:15,categoriesRequises:[],kpis:[],sections:[m("synth","Synth√®se","Synth√®se","√âtat global de la commercialisation",1,[]),m("objectifs","Objectifs","Objectifs","Cibles GLA et nombre de baux",2,[]),m("signes","Baux Sign√©s","Sign√©s","D√©tail des engagements fermes",3,[]),m("nego","En N√©gociation","N√©go.","Prospects avanc√©s",4,[]),m("pipeline","Pipeline Prospects","Pipeline","Tous les contacts en cours",5,[]),m("mix","Mix Commercial Cible","Mix","R√©partition par activit√©",6,[]),m("risques","Risques Commerciaux","Risques","Alertes et points d'attention",7,[],!0)],graphiquesRecommandes:["funnel","barre","camembert","treemap"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["Directeur Commercial","Directeur Projet","Direction"],combinableAvec:["DASHBOARD_PROJET","PIPELINE_COMMERCIAL"],icone:"Store",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Oa={id:"budget-projet",code:"BUDGET_PROJET",nom:"Budget Projet",nomCourt:"Budget",description:"Suivi budg√©taire d√©taill√© du projet de construction",categorie:"projet",complexite:"intermediaire",pagesMin:8,pagesMax:15,categoriesRequises:["budget","travaux"],kpis:[],sections:[m("synth","Synth√®se Budg√©taire","Synth√®se","Vue d'ensemble budget",1,[]),m("depenses","D√©penses R√©alis√©es","D√©penses","Engagements et paiements",2,[]),m("ecarts","Analyse des √âcarts","√âcarts","Budget vs R√©el",3,[]),m("postes","D√©tail par Poste","Postes","Ventilation par cat√©gorie",4,[]),m("prev","Pr√©visionnel","Pr√©vi.","Projection jusqu'√† livraison",5,[]),m("tresorerie","Plan de Tr√©sorerie","Tr√©so.","Appels de fonds",6,[],!0)],graphiquesRecommandes:["waterfall","barre","ligne","camembert"],frequenceRecommandee:"mensuel",destinatairesTypes:["DAF","Directeur Projet","Comit√© de Pilotage"],combinableAvec:["DASHBOARD_PROJET","BUDGET_VS_REEL"],icone:"Wallet",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Na={id:"risques-projet",code:"RISQUES_PROJET",nom:"Risques Projet",nomCourt:"Risques",description:"Cartographie et suivi des risques du projet",categorie:"projet",complexite:"intermediaire",pagesMin:6,pagesMax:12,categoriesRequises:[],kpis:[],sections:[m("synth","Synth√®se","Synth√®se","Vue d'ensemble des risques",1,[]),m("matrice","Matrice des Risques","Matrice","Impact x Probabilit√©",2,[]),m("top","Top Risques","Top","Risques majeurs d√©taill√©s",3,[]),m("actions","Plans d'Action","Actions","Mesures de mitigation",4,[]),m("suivi","√âvolution","√âvolution","Historique des risques",5,[]),m("opportunites","Opportunit√©s","Opport.","Upside potentiel",6,[],!0)],graphiquesRecommandes:["heatmap","barre","radar"],frequenceRecommandee:"mensuel",destinatairesTypes:["Chef de Projet","Directeur Projet","Comit√© de Pilotage"],combinableAvec:["DASHBOARD_PROJET","SUIVI_JALONS"],icone:"AlertTriangle",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},Pa={id:"handover-checklist",code:"HANDOVER_CHECKLIST",nom:"Checklist Handover",nomCourt:"Handover",description:"Liste de contr√¥le pour la pr√©-ouverture et le transfert aux op√©rations",categorie:"projet",complexite:"intermediaire",pagesMin:10,pagesMax:25,categoriesRequises:[],kpis:[],sections:[m("synth","Synth√®se Pr√©paration","Synth√®se","√âtat de pr√©paration global",1,[]),m("tech","Technique","Technique","R√©ceptions et lev√©es de r√©serves",2,[]),m("admin","Administratif","Admin.","Autorisations et conformit√©",3,[]),m("comm","Commercial","Commercial","√âtat des baux et locataires",4,[]),m("rh","RH & Organisation","RH","√âquipe et proc√©dures",5,[]),m("market","Marketing","Marketing","Plan d'ouverture et communication",6,[]),m("exploit","Exploitation","Exploit.","Contrats et prestataires",7,[]),m("finance","Finance","Finance","Budget d'exploitation",8,[],!0)],graphiquesRecommandes:["barre","jauge","camembert"],frequenceRecommandee:"hebdomadaire",destinatairesTypes:["Directeur Projet","Futur Directeur Centre","Direction"],combinableAvec:["DASHBOARD_PROJET"],icone:"ClipboardCheck",couleur:"#84cc16",estPremium:!1,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},_a={id:"reporting-projet",code:"REPORTING_PROJET",nom:"Reporting Projet",nomCourt:"Report. Proj.",description:"Rapport mensuel complet pour le comit√© de pilotage",categorie:"projet",complexite:"avance",pagesMin:15,pagesMax:30,categoriesRequises:["budget","travaux"],kpis:[],sections:[m("exec","R√©sum√© Ex√©cutif","R√©sum√©","Points cl√©s et d√©cisions",1,[]),m("avancement","Avancement Global","Avancement","√âtat des jalons et planning",2,[]),m("budget","Situation Budg√©taire","Budget","Financier et pr√©visions",3,[]),m("commercial","Commercialisation","Commercial","Pr√©-commercialisation",4,[]),m("rh","Ressources Humaines","RH","Recrutement et formation",5,[]),m("risques","Risques & Opportunit√©s","Risques","Cartographie mise √† jour",6,[]),m("actions","Plan d'Actions","Actions","Prochaines √©tapes",7,[]),m("annexes","Annexes","Annexes","Documents compl√©mentaires",8,[],!0)],graphiquesRecommandes:["barre","ligne","waterfall","heatmap","jauge"],frequenceRecommandee:"mensuel",destinatairesTypes:["Comit√© de Pilotage","Direction G√©n√©rale","Investisseurs"],combinableAvec:["DASHBOARD_PROJET","SUIVI_JALONS","BUDGET_PROJET"],icone:"FileText",couleur:"#84cc16",estPremium:!0,actif:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},tt={PERF_ACTIF:ta,ANALYSE_PORTEFEUILLE:ra,BUSINESS_PLAN:aa,VALORISATION_DCF:ia,ETAT_LOCATIF_REPORT:sa,SUIVI_BAUX:oa,GESTION_CHARGES:na,REPORTING_PROPRIETAIRE:ca,PIPELINE_COMMERCIAL:la,MERCHANDISING_MIX:da,BENCHMARK_LOYERS:ua,SUIVI_VACANCE:pa,TDB_CENTRE:ma,ANALYSE_FREQUENTATION:ga,PERF_ENSEIGNES:fa,ANALYSE_CA:ha,COMPTE_RESULTAT:ya,CF_OPERATIONNEL:ba,NOI_ANALYSIS:Aa,BUDGET_VS_REEL:xa,DUE_DILIGENCE:va,ETUDE_MARCHE:Ia,ANALYSE_CONCURRENTIELLE:Ea,SCENARIOS_ACQUISITION:wa,DASHBOARD_PROJET:Ca,SUIVI_JALONS:Sa,SUIVI_RECRUTEMENT:Ra,COMMERCIALISATION_PROJET:Ta,BUDGET_PROJET:Oa,RISQUES_PROJET:Na,HANDOVER_CHECKLIST:Pa,REPORTING_PROJET:_a},pe=[{id:"pack-mensuel",code:"MENSUEL",nom:"Pack Reporting Mensuel",description:"Ensemble des rapports pour le reporting mensuel standard",rapportsCodes:["PERF_ACTIF","ETAT_LOCATIF_REPORT","TDB_CENTRE","BUDGET_VS_REEL"],pagesEstimees:"30-50",periodicite:"Mensuel",destinataires:["Asset Manager","Property Manager","Directeur Centre"],icone:"Calendar",couleur:"#3b82f6",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-proprietaire",code:"PROPRIETAIRE",nom:"Pack Reporting Propri√©taire",description:"Rapports complets pour le reporting au propri√©taire",rapportsCodes:["REPORTING_PROPRIETAIRE","SUIVI_BAUX","GESTION_CHARGES","NOI_ANALYSIS"],pagesEstimees:"25-40",periodicite:"Mensuel/Trimestriel",destinataires:["Propri√©taire","Asset Manager"],icone:"Building2",couleur:"#10b981",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-centre",code:"CENTRE",nom:"Pack Centre Commercial",description:"Rapports op√©rationnels pour la gestion quotidienne du centre",rapportsCodes:["TDB_CENTRE","ANALYSE_FREQUENTATION","PERF_ENSEIGNES","ANALYSE_CA"],pagesEstimees:"25-45",periodicite:"Hebdomadaire/Mensuel",destinataires:["Directeur Centre","Responsable Marketing"],icone:"ShoppingBag",couleur:"#8b5cf6",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-leasing",code:"LEASING",nom:"Pack Commercialisation",description:"Rapports pour le suivi de la commercialisation",rapportsCodes:["PIPELINE_COMMERCIAL","MERCHANDISING_MIX","BENCHMARK_LOYERS","SUIVI_VACANCE"],pagesEstimees:"20-35",periodicite:"Hebdomadaire/Mensuel",destinataires:["Leasing Manager","Asset Manager"],icone:"Target",couleur:"#f97316",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-investisseur",code:"INVESTISSEUR",nom:"Pack Investisseur",description:"Rapports complets pour les investisseurs et comit√©s",rapportsCodes:["ANALYSE_PORTEFEUILLE","PERF_ACTIF","VALORISATION_DCF","BUSINESS_PLAN"],pagesEstimees:"50-80",periodicite:"Trimestriel/Annuel",destinataires:["Investisseurs","Comit√© d'Investissement","Direction"],icone:"Briefcase",couleur:"#06b6d4",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-acquisition",code:"ACQUISITION",nom:"Pack Acquisition",description:"Documents complets pour une op√©ration d'acquisition",rapportsCodes:["DUE_DILIGENCE","ETUDE_MARCHE","ANALYSE_CONCURRENTIELLE","SCENARIOS_ACQUISITION"],pagesEstimees:"70-120",periodicite:"Ponctuel",destinataires:["Comit√© d'Investissement","Banques","Acqu√©reur"],icone:"Search",couleur:"#06b6d4",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-projet",code:"PROJET",nom:"Pack Projet & Mobilisation",description:"Rapports complets pour le pilotage d'un projet de construction",rapportsCodes:["DASHBOARD_PROJET","SUIVI_JALONS","BUDGET_PROJET","RISQUES_PROJET","REPORTING_PROJET"],pagesEstimees:"40-70",periodicite:"Hebdomadaire/Mensuel",destinataires:["Directeur Projet","Comit√© de Pilotage","Direction"],icone:"HardHat",couleur:"#84cc16",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"pack-preopening",code:"PREOPENING",nom:"Pack Pr√©-Ouverture",description:"Documents pour la phase finale avant ouverture",rapportsCodes:["HANDOVER_CHECKLIST","SUIVI_RECRUTEMENT","COMMERCIALISATION_PROJET"],pagesEstimees:"25-45",periodicite:"Hebdomadaire",destinataires:["Directeur Projet","Futur Directeur Centre","Direction"],icone:"ClipboardCheck",couleur:"#84cc16",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],bo=q((i,s)=>({typesRapport:tt,packs:[...pe],filtres:{},categorieSelectionnee:null,typeRapportSelectionne:null,packSelectionne:null,filtreCategorie:null,recherche:"",kpisFavoris:[],rapportsFavoris:[],isLoading:!1,error:null,donneesDisponiblesParCentre:{},setFiltres:e=>{i({filtres:e})},resetFiltres:()=>{i({filtres:{}})},setFiltreCategorie:e=>{i({filtreCategorie:e})},setRecherche:e=>{i({recherche:e})},toggleKPIFavori:e=>{i(t=>({kpisFavoris:t.kpisFavoris.includes(e)?t.kpisFavoris.filter(r=>r!==e):[...t.kpisFavoris,e]}))},toggleRapportFavori:e=>{i(t=>({rapportsFavoris:t.rapportsFavoris.includes(e)?t.rapportsFavoris.filter(r=>r!==e):[...t.rapportsFavoris,e]}))},selectCategorie:e=>{i({categorieSelectionnee:e,typeRapportSelectionne:null})},selectTypeRapport:e=>{i({typeRapportSelectionne:e})},selectPack:e=>{i({packSelectionne:e})},getTypesRapport:()=>Object.values(s().typesRapport),getTypesRapportFiltres:()=>{const{typesRapport:e,filtres:t}=s();let r=Object.values(e);if(t.categorie&&(r=r.filter(a=>a.categorie===t.categorie)),t.complexite&&(r=r.filter(a=>a.complexite===t.complexite)),t.estPremium!==void 0&&(r=r.filter(a=>a.estPremium===t.estPremium)),t.recherche){const a=t.recherche.toLowerCase();r=r.filter(o=>o.nom.toLowerCase().includes(a)||o.description.toLowerCase().includes(a)||o.code.toLowerCase().includes(a))}return r},getTypeRapport:e=>s().typesRapport[e],getTypesParCategorie:e=>Object.values(s().typesRapport).filter(t=>t.categorie===e),getPacks:()=>s().packs,getPack:e=>s().packs.find(t=>t.id===e),getRapportsCombinables:e=>{const t=s().typesRapport[e];return t?t.combinableAvec.map(r=>s().typesRapport[r]).filter(Boolean):[]},loadDonneesDisponibles:async e=>{i({isLoading:!0,error:null});try{const t=[],r=[{categorie:"etat_locatif",table:l.etatsLocatifs},{categorie:"loyers",table:l.donneesLoyers},{categorie:"frequentation",table:l.donneesFrequentation},{categorie:"chiffre_affaires",table:l.donneesChiffreAffaires},{categorie:"charges",table:l.donneesCharges},{categorie:"bail",table:l.donneesBaux},{categorie:"travaux",table:l.donneesTravaux},{categorie:"valorisation",table:l.donneesValorisation},{categorie:"energie",table:l.donneesEnergie},{categorie:"satisfaction",table:l.donneesSatisfaction}];for(const a of r)await a.table.where("centreId").equals(e).count()>0&&t.push(a.categorie);i(a=>({donneesDisponiblesParCentre:{...a.donneesDisponiblesParCentre,[e]:t},isLoading:!1}))}catch(t){i({error:`Erreur v√©rification donn√©es: ${t}`,isLoading:!1})}},checkDisponibiliteDonnees:(e,t)=>{const r=s().typesRapport[t],a=s().donneesDisponiblesParCentre[e]||[];if(!r)return{categoriesDisponibles:[],categoriesManquantes:[],scoreCompletude:0,estDisponible:!1};const o=r.categoriesRequises,n=o.filter(p=>a.includes(p)),d=o.filter(p=>!a.includes(p)),u=o.length>0?Math.round(n.length/o.length*100):100;return{categoriesDisponibles:n,categoriesManquantes:d,scoreCompletude:u,estDisponible:d.length===0}},getCategoriesManquantes:(e,t)=>{const{categoriesManquantes:r}=s().checkDisponibiliteDonnees(e,t);return r},loadTypesPersonnalises:async()=>{try{const e=await l.typesRapport.toArray();e.length>0&&i(t=>{const r={...t.typesRapport};for(const a of e)r[a.code]=a;return{typesRapport:r}})}catch{}},saveTypePersonnalise:async e=>{const t=new Date().toISOString(),r={...e,updatedAt:t};await l.typesRapport.put(r),i(a=>({typesRapport:{...a.typesRapport,[e.code]:r}}))},loadPacksPersonnalises:async()=>{try{const e=await l.packsRapport.toArray();e.length>0&&i(t=>({packs:[...pe,...e]}))}catch{}},savePackPersonnalise:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.packsRapport.add(r),i(a=>({packs:[...a.packs,r]})),r},deletePackPersonnalise:async e=>{if(pe.find(r=>r.id===e))throw new Error("Impossible de supprimer un pack pr√©d√©fini");await l.packsRapport.delete(e),i(r=>({packs:r.packs.filter(a=>a.id!==e)}))}}));function xe(i,s="EUR"){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:0}).format(i)}function z(i,s=1){return`${i.toFixed(s)}%`}function Z(i,s=0){return new Intl.NumberFormat("fr-FR",{minimumFractionDigits:s,maximumFractionDigits:s}).format(i)}function ve(i){const{loyers:s=[],charges:e=[]}=i,t=s.reduce((o,n)=>o+n.loyerEncaisse,0),r=e.reduce((o,n)=>o+n.montantReel,0),a=t-r;return{valeur:a,valeurFormatee:xe(a),details:{totalLoyers:t,totalCharges:r,chargesRefacturees:s.reduce((o,n)=>o+n.chargesEncaissees,0)},sourcesDonnees:["loyers","charges"]}}function Da(i){const{surfaceTotale:s=0}=i,{valeur:e}=ve(i),t=s>0?e/s:0;return{valeur:t,valeurFormatee:`${Z(t,0)} /m¬≤`,sourcesDonnees:["loyers","charges","surface"]}}function ja(i){const{loyers:s=[],valeurActif:e=0}=i,r=s.reduce((o,n)=>o+n.loyerEncaisse,0)*(12/(s.length||1)),a=e>0?r/e*100:0;return{valeur:a,valeurFormatee:z(a,2),details:{loyersAnnuels:r,valeurActif:e},sourcesDonnees:["loyers","valorisation"]}}function La(i){var a;const{valeurActif:s=0}=i,{valeur:e}=ve(i),t=e*(12/Math.max(((a=i.loyers)==null?void 0:a.length)||1,1)),r=s>0?t/s*100:0;return{valeur:r,valeurFormatee:z(r,2),details:{noiAnnuel:t,valeurActif:s},sourcesDonnees:["loyers","charges","valorisation"]}}function ka(i){const{baux:s=[],etatsLocatifs:e=[]}=i,t=new Date;let r=0,a=0;const o=s.length>0?s:e;for(const d of o){const u=new Date("dateFin"in d?d.dateFin:d.bailFin),p="loyerAnnuel"in d?d.loyerAnnuel:d.loyerMinimumGaranti,g=Math.max(0,(u.getTime()-t.getTime())/(365.25*24*60*60*1e3));r+=p,a+=g*p}const n=r>0?a/r:0;return{valeur:n,valeurFormatee:`${n.toFixed(1)} ans`,details:{nombreBaux:o.length,sommeLoyers:r},sourcesDonnees:["bail","etat_locatif"]}}function qa(i){const{baux:s=[],etatsLocatifs:e=[]}=i,t=new Date;let r=0,a=0;for(const n of s){const d=n.dateBreak?new Date(n.dateBreak):new Date(n.dateFin),u=Math.max(0,(d.getTime()-t.getTime())/(365.25*24*60*60*1e3)),p=e.find(A=>A.lotId===n.lotId),g=(p==null?void 0:p.surfaceGLA)||n.surface||0;r+=g,a+=u*g}const o=r>0?a/r:0;return{valeur:o,valeurFormatee:`${o.toFixed(1)} ans`,details:{nombreBaux:s.length,surfaceTotale:r},sourcesDonnees:["bail","etat_locatif"]}}function rt(i){const{etatsLocatifs:s=[],surfaceTotale:e=0}=i,t=s.filter(o=>o.statutOccupation==="occupe"||o.statutOccupation==="pre_loue").reduce((o,n)=>o+n.surfaceGLA,0),r=e>0?e:s.reduce((o,n)=>o+n.surfaceGLA,0),a=r>0?t/r*100:0;return{valeur:a,valeurFormatee:z(a),details:{surfaceLouee:t,surfaceTotale:r,nombreLotsOccupes:s.filter(o=>o.statutOccupation==="occupe").length},sourcesDonnees:["etat_locatif"]}}function Ma(i){const{loyers:s=[],etatsLocatifs:e=[]}=i,t=s.reduce((o,n)=>o+n.loyerEncaisse,0),r=e.reduce((o,n)=>o+n.loyerMinimumGaranti/12,0)*(s.length||1),a=r>0?t/r*100:0;return{valeur:a,valeurFormatee:z(a),details:{loyersPercus:t,loyersTheoriques:r},sourcesDonnees:["loyers","etat_locatif"]}}function Fa(i){var a,o;const{valeur:s,details:e}=rt(i),t=100-s,r=((a=i.etatsLocatifs)==null?void 0:a.filter(n=>n.statutOccupation==="vacant").reduce((n,d)=>n+d.surfaceGLA,0))||0;return{valeur:t,valeurFormatee:z(t),details:{...e,surfaceVacante:r,nombreLotsVacants:((o=i.etatsLocatifs)==null?void 0:o.filter(n=>n.statutOccupation==="vacant").length)||0},sourcesDonnees:["etat_locatif"]}}function Ua(i){const{etatsLocatifs:s=[],chiffresAffaires:e=[]}=i;let t=0,r=0;const a=[];for(const n of s){const d=e.filter(u=>u.lotId===n.lotId).reduce((u,p)=>u+p.caDeclare,0);if(d>0){const u=n.loyerMinimumGaranti,p=d*(12/e.filter(A=>A.lotId===n.lotId).length),g=u/p*100;a.push({enseigne:n.locataireEnseigne,tauxEffort:g,surface:n.surfaceGLA}),t+=g*n.surfaceGLA,r+=n.surfaceGLA}}const o=r>0?t/r:0;return{valeur:o,valeurFormatee:z(o),details:{nombreLocataires:a.length,detailsParLocataire:a},sourcesDonnees:["loyers","chiffre_affaires","etat_locatif"]}}function Ba(i,s=300){const{etatsLocatifs:e=[]}=i;let t=0,r=0;for(const o of e)o.statutOccupation==="occupe"&&(t+=o.loyerMinimumGaranti,r+=o.surfaceGLA*s);const a=t>0?(r-t)/t*100:0;return{valeur:a,valeurFormatee:`${a>=0?"+":""}${z(a)}`,details:{loyerPlace:t,loyerMarche:r,ecartAbsolu:r-t},sourcesDonnees:["loyers","etat_locatif"]}}function Va(i){const{etatsLocatifs:s=[]}=i,e=s.filter(o=>o.statutOccupation==="occupe"),t=e.reduce((o,n)=>o+n.loyerMinimumGaranti,0),r=e.reduce((o,n)=>o+n.surfaceGLA,0),a=r>0?t/r:0;return{valeur:a,valeurFormatee:`${Z(a,0)} /m¬≤/an`,details:{totalLoyers:t,totalSurface:r},sourcesDonnees:["loyers","etat_locatif"]}}function $a(i){const{frequentation:s=[]}=i,e=s.reduce((t,r)=>t+r.entreesTotal,0);return{valeur:e,valeurFormatee:Z(e),details:{nombreJours:s.length},sourcesDonnees:["frequentation"]}}function za(i){const{frequentation:s=[]}=i,e=s.reduce((r,a)=>r+a.entreesTotal,0),t=s.length>0?e/s.length:0;return{valeur:t,valeurFormatee:Z(t,0),sourcesDonnees:["frequentation"]}}function Ha(i){const{chiffresAffaires:s=[]}=i,e=s.reduce((t,r)=>t+r.caDeclare,0);return{valeur:e,valeurFormatee:xe(e),sourcesDonnees:["chiffre_affaires"]}}function Ga(i){const{chiffresAffaires:s=[],etatsLocatifs:e=[]}=i,t=s.reduce((o,n)=>o+n.caDeclare,0),r=e.filter(o=>o.statutOccupation==="occupe").reduce((o,n)=>o+n.surfaceGLA,0),a=r>0?t/r:0;return{valeur:a,valeurFormatee:`${Z(a,0)} /m¬≤`,sourcesDonnees:["chiffre_affaires","etat_locatif"]}}function Ya(i){const{chiffresAffaires:s=[],frequentation:e=[]}=i,t=s.reduce((o,n)=>o+n.caDeclare,0),r=e.reduce((o,n)=>o+n.entreesTotal,0),a=r>0?t/r:0;return{valeur:a,valeurFormatee:xe(a),sourcesDonnees:["chiffre_affaires","frequentation"]}}function Ka(i){const{charges:s=[],surfaceTotale:e=0,etatsLocatifs:t=[]}=i,r=s.reduce((n,d)=>n+d.montantReel,0),a=e>0?e:t.reduce((n,d)=>n+d.surfaceGLA,0),o=a>0?r/a:0;return{valeur:o,valeurFormatee:`${Z(o,2)} /m¬≤`,details:{totalCharges:r,surfaceTotale:a},sourcesDonnees:["charges","etat_locatif"]}}function Ja(i){const{frequentation:s=[],chiffresAffaires:e=[]}=i,t=s.reduce((d,u)=>d+u.entreesTotal,0),r=e.reduce((d,u)=>d+u.caDeclare,0),a=50,o=e.reduce((d,u)=>"nombreTickets"in u&&typeof u.nombreTickets=="number"?d+u.nombreTickets:d+u.caDeclare/a,0),n=t>0?o/t*100:0;return{valeur:n,valeurFormatee:z(n,1),details:{totalVisiteurs:t,nombreTransactions:Math.round(o),totalCA:r,panierMoyenUtilise:a},sourcesDonnees:["frequentation","chiffre_affaires"]}}function Xa(i){const{loyers:s=[]}=i,e=s.reduce((a,o)=>a+o.loyerAppele+o.chargesAppelees,0),t=s.reduce((a,o)=>a+o.loyerEncaisse+o.chargesEncaissees,0),r=e>0?t/e*100:100;return{valeur:r,valeurFormatee:z(r),details:{loyersAppeles:e,loyersEncaisses:t,impayes:e-t},sourcesDonnees:["loyers"]}}function Qa(i){const{loyers:s=[]}=i,e=s.reduce((d,u)=>d+u.loyerAppele,0),t=s.reduce((d,u)=>d+u.loyerEncaisse,0),r=e-t,a=s.length||1,o=e/a*12,n=o>0?r/o*365:0;return{valeur:n,valeurFormatee:`${Math.round(n)} jours`,details:{creances:r,loyersAnnuels:o},sourcesDonnees:["loyers"]}}function je(i,s){const{etatsLocatifs:e=[]}=i,t={};for(const u of e)u.statutOccupation==="occupe"&&(t[u.locataireEnseigne]=(t[u.locataireEnseigne]||0)+u.loyerMinimumGaranti);const r=Object.entries(t).sort((u,p)=>p[1]-u[1]),a=r.reduce((u,[,p])=>u+p,0),o=r.slice(0,s),n=o.reduce((u,[,p])=>u+p,0),d=a>0?n/a*100:0;return{valeur:d,valeurFormatee:z(d),details:{topLocataires:o.map(([u,p])=>({enseigne:u,loyer:p,part:p/a*100}))},sourcesDonnees:["loyers","etat_locatif"]}}function Wa(i,s){switch(i){case"NOI":return ve(s);case"NOI_M2":return Da(s);case"YIELD_BRUT":return ja(s);case"YIELD_NET":return La(s);case"WAULT":return ka(s);case"WALB":return qa(s);case"TAUX_OCCUPATION_PHYSIQUE":return rt(s);case"TAUX_OCCUPATION_FINANCIER":return Ma(s);case"TAUX_VACANCE":return Fa(s);case"TAUX_EFFORT_MOYEN":return Ua(s);case"REVERSION":return Ba(s);case"LOYER_MOYEN_M2":return Va(s);case"FREQUENTATION_TOTALE":return $a(s);case"FREQUENTATION_JOUR_MOYEN":return za(s);case"CA_TOTAL":return Ha(s);case"CA_M2":return Ga(s);case"CA_VISITEUR":return Ya(s);case"TAUX_RECOUVREMENT":return Xa(s);case"DSO":return Qa(s);case"CONCENTRATION_TOP5":return je(s,5);case"CONCENTRATION_TOP10":return je(s,10);case"CHARGES_M2":return Ka(s);case"TAUX_TRANSFORMATION":return Ja(s);default:return{valeur:0,valeurFormatee:"N/A",sourcesDonnees:[]}}}function at(i,s,e){const t=x[i],r=Wa(i,s);let a,o,n="stable";const d=t?ea(t,r.valeur):"vert";return{id:E(),centreId:s.centreId,typeKPI:i,valeur:r.valeur,valeurFormatee:r.valeurFormatee,unite:(t==null?void 0:t.unite)||"",periodeDebut:s.periodeDebut,periodeFin:s.periodeFin,periodeLabel:`${s.periodeDebut} - ${s.periodeFin}`,valeurN1:e,variationAbsolue:a,variationPourcentage:o,tendance:n,statut:d,details:r.details,sourcesDonnees:r.sourcesDonnees,dateCalcul:new Date().toISOString(),createdAt:new Date().toISOString()}}function Za(i){return["NOI","NOI_M2","YIELD_BRUT","YIELD_NET","WAULT","WALB","TAUX_OCCUPATION_PHYSIQUE","TAUX_OCCUPATION_FINANCIER","TAUX_VACANCE","TAUX_EFFORT_MOYEN","REVERSION","LOYER_MOYEN_M2","CHARGES_M2","FREQUENTATION_TOTALE","FREQUENTATION_JOUR_MOYEN","CA_TOTAL","CA_M2","CA_VISITEUR","TAUX_TRANSFORMATION","TAUX_RECOUVREMENT","DSO","CONCENTRATION_TOP5","CONCENTRATION_TOP10"].map(e=>at(e,i))}async function Le(i,s){const[e,t,r,a,o,n,d,u]=await Promise.all([l.etatsLocatifs.where("centreId").equals(i).toArray(),l.donneesLoyers.where("centreId").equals(i).toArray(),l.donneesChiffreAffaires.where("centreId").equals(i).toArray(),l.donneesCharges.where("centreId").equals(i).toArray(),l.donneesBaux.where("centreId").equals(i).toArray(),l.donneesFrequentation.where("centreId").equals(i).toArray(),l.donneesValorisation.where("centreId").equals(i).toArray(),l.centres.get(i)]),p=d.sort((g,A)=>new Date(A.dateValorisation).getTime()-new Date(g.dateValorisation).getTime())[0];return{centreId:i,periodeDebut:s.debut,periodeFin:s.fin,etatsLocatifs:e,loyers:t,chiffresAffaires:r,charges:a,baux:o,frequentation:n,valorisation:p,surfaceTotale:(u==null?void 0:u.surfaceLocative)||0,valeurActif:(p==null?void 0:p.valeurVenale)||0}}const ke={debut:new Date(new Date().getFullYear(),new Date().getMonth()-1,1).toISOString().split("T")[0],fin:new Date(new Date().getFullYear(),new Date().getMonth(),0).toISOString().split("T")[0],label:"Mois pr√©c√©dent"},Ao=q((i,s)=>({resultatsKPI:[],resultatsKPIParCentre:{},kpisCalcules:[],insights:[],insightsNonTraites:[],reglesAlerte:[],alertesGenerees:[],alertesNonLues:[],alertes:[],predictions:[],benchmarks:[],configurationBI:null,isLoading:!1,isCalculating:!1,error:null,dernierCalcul:null,periodeSelectionnee:ke,periodeAnalyse:ke,loadResultatsKPI:async e=>{i({isLoading:!0,error:null});try{const t=await l.resultatsKPI.where("centreId").equals(e).reverse().sortBy("dateCalcul");i(r=>({resultatsKPI:t,kpisCalcules:t,resultatsKPIParCentre:{...r.resultatsKPIParCentre,[e]:t},isLoading:!1}))}catch(t){i({error:`Erreur chargement KPIs: ${t}`,isLoading:!1})}},loadInsights:async e=>{try{const t=await l.insights.where("centreId").equals(e).reverse().sortBy("dateDetection");i({insights:t,insightsNonTraites:t.filter(r=>!r.traitee)})}catch{}},loadReglesAlerte:async e=>{try{let t;e?t=await l.reglesAlerte.where("centreId").equals(e).or("centreId").equals("").toArray():t=await l.reglesAlerte.toArray(),i({reglesAlerte:t})}catch{}},loadAlertesGenerees:async e=>{try{const t=await l.alertesGenerees.where("centreId").equals(e).reverse().sortBy("dateGeneration");i({alertesGenerees:t,alertes:t,alertesNonLues:t.filter(r=>!r.lue)})}catch{}},loadPredictions:async e=>{try{const t=await l.tendancesPrediction.where("centreId").equals(e).toArray();i({predictions:t})}catch{}},loadConfigurationBI:async e=>{try{const t=await l.configurationsBI.where("centreId").equals(e).first();i({configurationBI:t||null})}catch{}},loadAll:async e=>{i({isLoading:!0,error:null});try{await Promise.all([s().loadResultatsKPI(e),s().loadInsights(e),s().loadReglesAlerte(e),s().loadAlertesGenerees(e),s().loadPredictions(e),s().loadConfigurationBI(e)]),i({isLoading:!1})}catch(t){i({error:`Erreur chargement: ${t}`,isLoading:!1})}},calculerKPIsPourCentre:async(e,t)=>{const r=t||s().periodeSelectionnee;i({isCalculating:!0,error:null});try{const a=await Le(e,r),o=Za(a);return await s().sauvegarderResultatsKPI(o),i(n=>({resultatsKPI:o,kpisCalcules:o,resultatsKPIParCentre:{...n.resultatsKPIParCentre,[e]:o},isCalculating:!1,dernierCalcul:new Date().toISOString()})),o}catch(a){return i({error:`Erreur calcul KPIs: ${a}`,isCalculating:!1}),[]}},calculerKPIUnique:async(e,t,r)=>{try{const a=await Le(e,r),o=at(t,a);return await l.resultatsKPI.add(o),i(n=>({resultatsKPI:[...n.resultatsKPI,o]})),o}catch{return null}},sauvegarderResultatsKPI:async e=>{try{await l.resultatsKPI.bulkPut(e)}catch{}},detecterInsights:async e=>{const t=s().resultatsKPIParCentre[e]||[];s().configurationBI;const r=[],a=new Date().toISOString(),o=t.find(g=>g.typeKPI==="CONCENTRATION_TOP5");o&&o.valeur>50&&r.push({id:E(),centreId:e,type:"concentration_risque",severite:o.valeur>60?"critique":"alerte",titre:"Concentration locataire √©lev√©e",description:`Les 5 premiers locataires repr√©sentent ${o.valeurFormatee} des revenus`,valeurActuelle:o.valeur,seuilReference:50,ecartPourcentage:o.valeur-50,entitesImpactees:[],impact:o.valeur>60?"critique":"eleve",recommandations:["Diversifier le mix locatif","Identifier des enseignes alternatives","N√©gocier des dur√©es de bail plus longues avec les top locataires"],dateDetection:a,traitee:!1,createdAt:a,updatedAt:a});const n=t.find(g=>g.typeKPI==="TAUX_VACANCE");n&&n.valeur>10&&r.push({id:E(),centreId:e,type:"vacance_anormale",severite:n.valeur>15?"critique":"alerte",titre:"Taux de vacance √©lev√©",description:`Le taux de vacance est de ${n.valeurFormatee}`,valeurActuelle:n.valeur,seuilReference:10,ecartPourcentage:n.valeur-10,entitesImpactees:[],impact:n.valeur>15?"critique":"eleve",recommandations:["Acc√©l√©rer la commercialisation des lots vacants","Revoir la politique tarifaire","Analyser les causes de d√©part des locataires"],dateDetection:a,traitee:!1,createdAt:a,updatedAt:a});const d=t.find(g=>g.typeKPI==="WAULT");d&&d.valeur<2&&r.push({id:E(),centreId:e,type:"echeances_groupees",severite:d.valeur<1.5?"critique":"attention",titre:"WAULT faible - √âch√©ances proches",description:`La dur√©e moyenne des baux est de ${d.valeurFormatee}`,valeurActuelle:d.valeur,seuilReference:2,entitesImpactees:[],impact:d.valeur<1.5?"critique":"moyen",recommandations:["Identifier les baux arrivant √† √©ch√©ance","Anticiper les renouvellements","N√©gocier des extensions de dur√©e"],dateDetection:a,traitee:!1,createdAt:a,updatedAt:a});const u=t.find(g=>g.typeKPI==="TAUX_EFFORT_MOYEN");u&&u.valeur>12&&r.push({id:E(),centreId:e,type:"effort_excessif",severite:u.valeur>15?"critique":"attention",titre:"Taux d'effort moyen √©lev√©",description:`Le taux d'effort moyen est de ${u.valeurFormatee}`,valeurActuelle:u.valeur,seuilReference:12,ecartPourcentage:u.valeur-12,entitesImpactees:[],impact:u.valeur>15?"eleve":"moyen",recommandations:["Identifier les locataires en difficult√©","Envisager des am√©nagements de loyer","Surveiller les risques d'impay√©s"],dateDetection:a,traitee:!1,createdAt:a,updatedAt:a});const p=t.find(g=>g.typeKPI==="TAUX_RECOUVREMENT");return p&&p.valeur<95&&r.push({id:E(),centreId:e,type:"impaye_critique",severite:p.valeur<90?"critique":"alerte",titre:"Taux de recouvrement d√©grad√©",description:`Le taux de recouvrement est de ${p.valeurFormatee}`,valeurActuelle:p.valeur,seuilReference:95,ecartPourcentage:95-p.valeur,entitesImpactees:[],impact:p.valeur<90?"critique":"eleve",recommandations:["Relancer les impay√©s","Mettre en place un plan de recouvrement","√âvaluer les provisions pour cr√©ances douteuses"],dateDetection:a,traitee:!1,createdAt:a,updatedAt:a}),r.length>0&&(await l.insights.bulkAdd(r),i(g=>({insights:[...r,...g.insights],insightsNonTraites:[...r,...g.insightsNonTraites]}))),r},ajouterInsight:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.insights.add(r),i(a=>({insights:[r,...a.insights],insightsNonTraites:r.traitee?a.insightsNonTraites:[r,...a.insightsNonTraites]})),r},traiterInsight:async(e,t)=>{const r=new Date().toISOString();await l.insights.update(e,{traitee:!0,dateTraitement:r,commentaireTraitement:t,updatedAt:r}),i(a=>({insights:a.insights.map(o=>o.id===e?{...o,traitee:!0,dateTraitement:r,commentaireTraitement:t}:o),insightsNonTraites:a.insightsNonTraites.filter(o=>o.id!==e)}))},supprimerInsight:async e=>{await l.insights.delete(e),i(t=>({insights:t.insights.filter(r=>r.id!==e),insightsNonTraites:t.insightsNonTraites.filter(r=>r.id!==e)}))},ajouterRegleAlerte:async e=>{const t=new Date().toISOString(),r={...e,id:E(),nombreDeclenchements:0,createdAt:t,updatedAt:t};return await l.reglesAlerte.add(r),i(a=>({reglesAlerte:[...a.reglesAlerte,r]})),r},modifierRegleAlerte:async(e,t)=>{const r=new Date().toISOString();await l.reglesAlerte.update(e,{...t,updatedAt:r}),i(a=>({reglesAlerte:a.reglesAlerte.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},supprimerRegleAlerte:async e=>{await l.reglesAlerte.delete(e),i(t=>({reglesAlerte:t.reglesAlerte.filter(r=>r.id!==e)}))},toggleRegleAlerte:async e=>{const t=s().reglesAlerte.find(r=>r.id===e);t&&await s().modifierRegleAlerte(e,{actif:!t.actif})},verifierAlertes:async e=>{const t=s().reglesAlerte.filter(n=>n.actif),r=s().resultatsKPIParCentre[e]||[],a=[],o=new Date().toISOString();for(const n of t){const d=r.find(p=>p.typeKPI===n.condition.kpi);if(!d)continue;let u=!1;switch(n.condition.operateur){case">":u=d.valeur>n.condition.seuil;break;case"<":u=d.valeur<n.condition.seuil;break;case">=":u=d.valeur>=n.condition.seuil;break;case"<=":u=d.valeur<=n.condition.seuil;break;case"==":u=d.valeur===n.condition.seuil;break;case"!=":u=d.valeur!==n.condition.seuil;break;case"entre":u=d.valeur>=n.condition.seuil&&d.valeur<=(n.condition.seuilMax||n.condition.seuil);break}if(u){const p={id:E(),centreId:e,regleId:n.id,titre:n.nom,message:`${n.description}. Valeur actuelle: ${d.valeurFormatee}, Seuil: ${n.condition.seuil}`,kpiConcerne:n.condition.kpi,valeurActuelle:d.valeur,seuilDeclenche:n.condition.seuil,priorite:n.priorite,lue:!1,traitee:!1,dateGeneration:o,createdAt:o};a.push(p),await l.reglesAlerte.update(n.id,{nombreDeclenchements:n.nombreDeclenchements+1,derniereVerification:o})}}return a.length>0&&(await l.alertesGenerees.bulkAdd(a),i(n=>({alertesGenerees:[...a,...n.alertesGenerees],alertesNonLues:[...a,...n.alertesNonLues]}))),a},marquerAlerteLue:async e=>{await l.alertesGenerees.update(e,{lue:!0}),i(t=>({alertesGenerees:t.alertesGenerees.map(r=>r.id===e?{...r,lue:!0}:r),alertesNonLues:t.alertesNonLues.filter(r=>r.id!==e)}))},traiterAlerte:async e=>{const t=new Date().toISOString();await l.alertesGenerees.update(e,{traitee:!0,dateTraitement:t}),i(r=>({alertesGenerees:r.alertesGenerees.map(a=>a.id===e?{...a,traitee:!0,dateTraitement:t}:a)}))},genererPredictions:async(e,t,r)=>{try{const a=await l.resultatsKPI.where("centreId").equals(e).and(w=>w.typeKPI===t).sortBy("periodeDebut");if(a.length<3)return null;const o=a.map(w=>w.valeur),n=o.length,d=n*(n-1)/2,u=o.reduce((w,R)=>w+R,0),p=o.reduce((w,R,j)=>w+j*R,0),g=n*(n-1)*(2*n-1)/6,A=(n*p-d*u)/(n*g-d*d),h=(u-A*d)/n,b=[],f=Math.sqrt(o.reduce((w,R,j)=>w+Math.pow(R-(h+A*j),2),0)/n);for(let w=1;w<=r;w++){const R=new Date;R.setMonth(R.getMonth()+w);const j=h+A*(n+w-1),k=f*1.96*Math.sqrt(1+1/n+Math.pow(w,2)/g);b.push({periode:R.toISOString().slice(0,7),valeur:j,confianceBasse:j-k,confianceHaute:j+k})}const S=o[o.length-1],T=b[b.length-1].valeur,_=T-S,D=S!==0?_/S*100:0,v=D>2?"hausse":D<-2?"baisse":"stable",L={id:E(),centreId:e,kpi:t,valeurActuelle:S,valeurPredite:T,horizon:r,confiance:Math.max(0,Math.min(100,100-f/S*100)),tendance:v,variationPredite:_,variationPourcentage:D,donneesHistoriques:a.map(w=>({periode:w.periodeDebut,valeur:w.valeur})),predictions:b,methodologie:"lineaire",dateCalcul:new Date().toISOString(),createdAt:new Date().toISOString()};return await s().sauvegarderPrediction(L),L}catch{return null}},sauvegarderPrediction:async e=>{await l.tendancesPrediction.put(e),i(t=>({predictions:[e,...t.predictions.filter(r=>!(r.centreId===e.centreId&&r.kpi===e.kpi))]}))},sauvegarderConfigurationBI:async e=>{const t=new Date().toISOString(),r=s().configurationBI,a={...e,id:(r==null?void 0:r.id)||E(),createdAt:(r==null?void 0:r.createdAt)||t,updatedAt:t};await l.configurationsBI.put(a),i({configurationBI:a})},setPeriode:e=>{i({periodeSelectionnee:e,periodeAnalyse:e})},setPeriodeAnalyse:e=>{i({periodeSelectionnee:e,periodeAnalyse:e})},getKPIParType:(e,t)=>(s().resultatsKPIParCentre[e]||[]).find(a=>a.typeKPI===t),getInsightsParSeverite:e=>s().insights.filter(t=>t.severite===e),getAlertesParPriorite:e=>s().alertesGenerees.filter(t=>t.priorite===e)})),Ie={maxLignes:5e4,ignoreColonnesVides:!0,trimValeurs:!0,detecterTypes:!0,separateurCSV:";",encodageCSV:"UTF-8",feuilleExcel:0};function ei(i){var e;switch((e=i.split(".").pop())==null?void 0:e.toLowerCase()){case"xlsx":case"xls":case"xlsm":return"excel";case"csv":case"txt":return"csv";case"json":return"json";case"pdf":return"pdf";default:return null}}function qe(i){return new Promise((s,e)=>{const t=new FileReader;t.readAsDataURL(i),t.onload=()=>{const a=t.result.split(",")[1];s(a)},t.onerror=r=>e(r)})}function ti(i){const s=atob(i),e=new Uint8Array(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);return e.buffer}function ri(i){const s=i.filter(n=>n!=null&&n!=="");if(s.length===0)return"string";let e=0,t=0,r=0;for(const n of s){const d=String(n).trim().toLowerCase();if(["true","false","oui","non","1","0","yes","no"].includes(d)){r++;continue}const u=parseFloat(d.replace(/\s/g,"").replace(",","."));if(!isNaN(u)&&isFinite(u)){e++;continue}if(ai(d)){t++;continue}}const a=s.length,o=.8;return e/a>=o?"number":t/a>=o?"date":r/a>=o?"boolean":"string"}function ai(i){const s=[/^\d{2}\/\d{2}\/\d{4}$/,/^\d{4}-\d{2}-\d{2}$/,/^\d{2}-\d{2}-\d{4}$/,/^\d{2}\.\d{2}\.\d{4}$/,/^\d{4}\/\d{2}\/\d{2}$/];for(const t of s)if(t.test(i)){const r=new Date(i);if(!isNaN(r.getTime()))return!0}const e=Date.parse(i);return!isNaN(e)&&i.length>6}async function ii(i,s={}){const e={...Ie,...s};try{const t=ti(i),r=It(t,{type:"array",cellDates:!0});let a;typeof e.feuilleExcel=="number"?a=r.SheetNames[e.feuilleExcel]||r.SheetNames[0]:a=e.feuilleExcel||r.SheetNames[0];const o=r.Sheets[a];if(!o)throw new Error(`Feuille "${a}" non trouv√©e`);const n=Et.sheet_to_json(o,{header:1,defval:"",blankrows:!1});if(n.length===0)return{colonnes:[],lignes:[]};const d=n[0].map((A,h)=>String(A||"").trim()||`Colonne_${h+1}`),u=[],p=Math.min(n.length-1,e.maxLignes||5e4);for(let A=1;A<=p;A++){const h=n[A];if(!h)continue;const b={};let f=!1;for(let S=0;S<d.length;S++){let T=h[S];e.trimValeurs&&typeof T=="string"&&(T=T.trim()),T instanceof Date&&(T=T.toISOString().split("T")[0]),b[d[S]]=T,T!==""&&T!==null&&T!==void 0&&(f=!0)}f&&u.push(b)}let g=d;return e.ignoreColonnesVides&&(g=d.filter(A=>u.some(h=>{const b=h[A];return b!==""&&b!==null&&b!==void 0}))),{colonnes:g,lignes:u}}catch(t){throw new Error(`Erreur parsing Excel: ${t}`)}}async function si(i,s={}){const e={...Ie,...s};try{const t=atob(i),r=e.separateurCSV||oi(t),a=t.split(/\r?\n/).filter(u=>u.trim());if(a.length===0)return{colonnes:[],lignes:[]};const o=Me(a[0],r).map((u,p)=>u.trim()||`Colonne_${p+1}`),n=[],d=Math.min(a.length-1,e.maxLignes||5e4);for(let u=1;u<=d;u++){if(!a[u])continue;const p=Me(a[u],r),g={};let A=!1;for(let h=0;h<o.length;h++){let b=p[h]||"";if(e.trimValeurs&&(b=b.trim()),b!==""){const f=parseFloat(b.replace(/\s/g,"").replace(",","."));!isNaN(f)&&isFinite(f)&&(b=f)}g[o[h]]=b,b!==""&&b!==null&&(A=!0)}A&&n.push(g)}return{colonnes:o,lignes:n}}catch(t){throw new Error(`Erreur parsing CSV: ${t}`)}}function oi(i){const s=i.split(/\r?\n/)[0]||"",e=[";",",","	","|"];let t=";",r=0;for(const a of e){const o=(s.match(new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"))||[]).length;o>r&&(r=o,t=a)}return t}function Me(i,s){const e=[];let t="",r=!1;for(let a=0;a<i.length;a++){const o=i[a];o==='"'?r&&i[a+1]==='"'?(t+='"',a++):r=!r:o===s&&!r?(e.push(t),t=""):t+=o}return e.push(t),e}async function ni(i,s={}){const e={...Ie,...s};try{const t=atob(i),r=JSON.parse(t);let a;if(Array.isArray(r))a=r;else if(r.data&&Array.isArray(r.data))a=r.data;else if(r.results&&Array.isArray(r.results))a=r.results;else if(typeof r=="object")a=[r];else throw new Error("Format JSON non support√©");e.maxLignes&&a.length>e.maxLignes&&(a=a.slice(0,e.maxLignes));const o=new Set;for(const u of a)typeof u=="object"&&u!==null&&Object.keys(u).forEach(p=>o.add(p));const n=Array.from(o),d=a.map(u=>{const p={};for(const g of n)p[g]=u[g]??"";return p});return{colonnes:n,lignes:d}}catch(t){throw new Error(`Erreur parsing JSON: ${t}`)}}async function ci(i,s={}){const e=ei(i.name);if(!e)return{nom:i.name,format:"csv",taille:i.size,contenuBase64:"",colonnes:[],lignes:[],lignesTotal:0,apercu:[],typesDetectes:{},erreurParsing:"Format de fichier non support√©"};if(e==="pdf")return{nom:i.name,format:"pdf",taille:i.size,contenuBase64:await qe(i),colonnes:[],lignes:[],lignesTotal:0,apercu:[],typesDetectes:{},erreurParsing:"Le parsing PDF n'est pas encore support√©"};try{const t=await qe(i);let r,a;switch(e){case"excel":({colonnes:r,lignes:a}=await ii(t,s));break;case"csv":({colonnes:r,lignes:a}=await si(t,s));break;case"json":({colonnes:r,lignes:a}=await ni(t,s));break;default:throw new Error(`Format ${e} non support√©`)}const o={};if(s.detecterTypes!==!1)for(const d of r){const u=a.map(p=>p[d]);o[d]=ri(u)}const n=a.slice(0,10);return{nom:i.name,format:e,taille:i.size,contenuBase64:t,colonnes:r,lignes:a,lignesTotal:a.length,apercu:n,typesDetectes:o}}catch(t){return{nom:i.name,format:e,taille:i.size,contenuBase64:"",colonnes:[],lignes:[],lignesTotal:0,apercu:[],typesDetectes:{},erreurParsing:String(t)}}}const li={etat_locatif:{categorie:"etat_locatif",champsCibles:[{champ:"lotReference",labels:["lot","local","reference","ref","code local","n¬∞ lot"],obligatoire:!0},{champ:"locataireEnseigne",labels:["enseigne","locataire","preneur","nom locataire"],obligatoire:!0},{champ:"surfaceGLA",labels:["surface","gla","m2","m¬≤","surface gla"],obligatoire:!0},{champ:"loyerMinimumGaranti",labels:["loyer","lmg","loyer annuel","loyer minimum"],obligatoire:!0},{champ:"bailDebut",labels:["debut bail","date debut","debut","date entr√©e"],obligatoire:!1},{champ:"bailFin",labels:["fin bail","date fin","echeance","terme"],obligatoire:!1},{champ:"activiteCode",labels:["activite","code activite","secteur"],obligatoire:!1},{champ:"statutOccupation",labels:["statut","occupation","etat"],obligatoire:!1}]},loyers:{categorie:"loyers",champsCibles:[{champ:"lotId",labels:["lot","local","reference"],obligatoire:!0},{champ:"locataireEnseigne",labels:["enseigne","locataire"],obligatoire:!0},{champ:"periodeAnnee",labels:["annee","ann√©e","year"],obligatoire:!0},{champ:"periodeMois",labels:["mois","month","periode"],obligatoire:!0},{champ:"loyerAppele",labels:["loyer appele","appel","facturation"],obligatoire:!0},{champ:"loyerEncaisse",labels:["loyer encaisse","encaissement","paiement"],obligatoire:!0},{champ:"chargesAppelees",labels:["charges appelees","charges"],obligatoire:!1},{champ:"chargesEncaissees",labels:["charges encaissees"],obligatoire:!1}]},frequentation:{categorie:"frequentation",champsCibles:[{champ:"date",labels:["date","jour","day"],obligatoire:!0},{champ:"entreesTotal",labels:["entrees","visiteurs","frequentation","comptage"],obligatoire:!0},{champ:"zone",labels:["zone","entree","porte"],obligatoire:!1}]},chiffre_affaires:{categorie:"chiffre_affaires",champsCibles:[{champ:"lotId",labels:["lot","local"],obligatoire:!0},{champ:"locataireEnseigne",labels:["enseigne","locataire"],obligatoire:!0},{champ:"periodeAnnee",labels:["annee","ann√©e"],obligatoire:!0},{champ:"periodeMois",labels:["mois"],obligatoire:!0},{champ:"caDeclare",labels:["ca","chiffre affaires","ca declare","ca mensuel"],obligatoire:!0}]},charges:{categorie:"charges",champsCibles:[{champ:"periodeAnnee",labels:["annee","ann√©e"],obligatoire:!0},{champ:"categorieCharge",labels:["categorie","poste","nature"],obligatoire:!0},{champ:"montantBudget",labels:["budget","montant budget"],obligatoire:!1},{champ:"montantReel",labels:["reel","montant reel","realise"],obligatoire:!0},{champ:"montantRefacturable",labels:["refacturable","recuperable"],obligatoire:!1}]},bail:{categorie:"bail",champsCibles:[{champ:"lotId",labels:["lot","local"],obligatoire:!0},{champ:"locataireEnseigne",labels:["enseigne","locataire"],obligatoire:!0},{champ:"dateDebut",labels:["debut","date debut","prise effet"],obligatoire:!0},{champ:"dateFin",labels:["fin","date fin","echeance","terme"],obligatoire:!0},{champ:"loyerAnnuel",labels:["loyer","loyer annuel"],obligatoire:!0},{champ:"dateBreak",labels:["break","option sortie","date break"],obligatoire:!1}]},travaux:{categorie:"travaux",champsCibles:[{champ:"reference",labels:["reference","numero","id"],obligatoire:!0},{champ:"libelle",labels:["libelle","description","intitule"],obligatoire:!0},{champ:"categorie",labels:["categorie","type"],obligatoire:!0},{champ:"montantBudget",labels:["budget","montant"],obligatoire:!0},{champ:"statut",labels:["statut","etat"],obligatoire:!1}]},budget:{categorie:"budget",champsCibles:[{champ:"poste",labels:["poste","ligne","compte"],obligatoire:!0},{champ:"annee",labels:["annee","exercice"],obligatoire:!0},{champ:"montant",labels:["montant","budget","prevision"],obligatoire:!0}]},valorisation:{categorie:"valorisation",champsCibles:[{champ:"dateValorisation",labels:["date","date valorisation"],obligatoire:!0},{champ:"valeurVenale",labels:["valeur","valeur venale","estimation"],obligatoire:!0},{champ:"tauxCapitalisation",labels:["taux","taux capi","yield"],obligatoire:!1}]},surface:{categorie:"surface",champsCibles:[{champ:"lotId",labels:["lot","local"],obligatoire:!0},{champ:"surface",labels:["surface","m2","gla"],obligatoire:!0},{champ:"type",labels:["type","nature"],obligatoire:!1}]},energie:{categorie:"energie",champsCibles:[{champ:"periodeAnnee",labels:["annee"],obligatoire:!0},{champ:"periodeMois",labels:["mois"],obligatoire:!0},{champ:"typeEnergie",labels:["type","energie","fluide"],obligatoire:!0},{champ:"consommation",labels:["consommation","quantite","volume"],obligatoire:!0},{champ:"cout",labels:["cout","montant","prix"],obligatoire:!1}]},satisfaction:{categorie:"satisfaction",champsCibles:[{champ:"date",labels:["date"],obligatoire:!0},{champ:"scoreGlobal",labels:["score","note","satisfaction"],obligatoire:!0},{champ:"nps",labels:["nps","net promoter"],obligatoire:!1},{champ:"nombreRepondants",labels:["repondants","participants","n"],obligatoire:!1}]}};function di(i,s){const e=li[s];if(!e)return[];const t=[],r=new Set;for(const a of e.champsCibles){let o=null,n=0;for(const d of i){if(r.has(d))continue;const u=d.toLowerCase().replace(/[_\-\s]+/g," ").trim();for(const p of a.labels){const g=p.toLowerCase().replace(/[_\-\s]+/g," ").trim();if(u===g){o=d,n=100;break}if(u.includes(g)||g.includes(u)){const A=g.length/Math.max(u.length,g.length)*80;A>n&&(n=A,o=d)}}if(n===100)break}o&&n>50&&(r.add(o),t.push({colonneSource:o,colonneDestination:a.champ,typeDetecte:"string"}))}return t}const ui={etat_locatif:[{champ:"lotReference",type:"obligatoire",message:"La r√©f√©rence du lot est obligatoire"},{champ:"lotReference",type:"unique",message:"La r√©f√©rence du lot doit √™tre unique"},{champ:"locataireEnseigne",type:"obligatoire",message:"L'enseigne du locataire est obligatoire"},{champ:"surfaceGLA",type:"obligatoire",message:"La surface GLA est obligatoire"},{champ:"surfaceGLA",type:"type",message:"La surface doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"surfaceGLA",type:"plage",message:"La surface doit √™tre positive",params:{min:0}},{champ:"loyerMinimumGaranti",type:"type",message:"Le loyer doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"loyerMinimumGaranti",type:"plage",message:"Le loyer doit √™tre positif",params:{min:0}},{champ:"bailDebut",type:"format",message:"La date de d√©but doit √™tre une date valide",params:{format:"date"}},{champ:"bailFin",type:"format",message:"La date de fin doit √™tre une date valide",params:{format:"date"}},{champ:"bailFin",type:"custom",message:"La date de fin doit √™tre post√©rieure √† la date de d√©but",validateur:(i,s)=>{const e=s.bailDebut,t=s.bailFin;return!e||!t?!0:new Date(t)>new Date(e)}}],loyers:[{champ:"lotId",type:"obligatoire",message:"L'identifiant du lot est obligatoire"},{champ:"periodeAnnee",type:"obligatoire",message:"L'ann√©e est obligatoire"},{champ:"periodeAnnee",type:"plage",message:"L'ann√©e doit √™tre valide",params:{min:2e3,max:2100}},{champ:"periodeMois",type:"obligatoire",message:"Le mois est obligatoire"},{champ:"periodeMois",type:"plage",message:"Le mois doit √™tre entre 1 et 12",params:{min:1,max:12}},{champ:"loyerAppele",type:"type",message:"Le loyer appel√© doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"loyerEncaisse",type:"type",message:"Le loyer encaiss√© doit √™tre un nombre",params:{typeAttendu:"number"}}],frequentation:[{champ:"date",type:"obligatoire",message:"La date est obligatoire"},{champ:"date",type:"format",message:"La date doit √™tre valide",params:{format:"date"}},{champ:"entreesTotal",type:"obligatoire",message:"Le nombre d'entr√©es est obligatoire"},{champ:"entreesTotal",type:"type",message:"Le nombre d'entr√©es doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"entreesTotal",type:"plage",message:"Le nombre d'entr√©es doit √™tre positif",params:{min:0}}],chiffre_affaires:[{champ:"lotId",type:"obligatoire",message:"L'identifiant du lot est obligatoire"},{champ:"locataireEnseigne",type:"obligatoire",message:"L'enseigne est obligatoire"},{champ:"periodeAnnee",type:"obligatoire",message:"L'ann√©e est obligatoire"},{champ:"periodeMois",type:"obligatoire",message:"Le mois est obligatoire"},{champ:"caDeclare",type:"obligatoire",message:"Le CA d√©clar√© est obligatoire"},{champ:"caDeclare",type:"type",message:"Le CA doit √™tre un nombre",params:{typeAttendu:"number"}}],charges:[{champ:"periodeAnnee",type:"obligatoire",message:"L'ann√©e est obligatoire"},{champ:"categorieCharge",type:"obligatoire",message:"La cat√©gorie de charge est obligatoire"},{champ:"montantReel",type:"obligatoire",message:"Le montant r√©el est obligatoire"},{champ:"montantReel",type:"type",message:"Le montant doit √™tre un nombre",params:{typeAttendu:"number"}}],bail:[{champ:"lotId",type:"obligatoire",message:"L'identifiant du lot est obligatoire"},{champ:"locataireEnseigne",type:"obligatoire",message:"L'enseigne est obligatoire"},{champ:"dateDebut",type:"obligatoire",message:"La date de d√©but est obligatoire"},{champ:"dateDebut",type:"format",message:"La date de d√©but doit √™tre valide",params:{format:"date"}},{champ:"dateFin",type:"obligatoire",message:"La date de fin est obligatoire"},{champ:"dateFin",type:"format",message:"La date de fin doit √™tre valide",params:{format:"date"}},{champ:"loyerAnnuel",type:"obligatoire",message:"Le loyer annuel est obligatoire"},{champ:"loyerAnnuel",type:"type",message:"Le loyer doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"loyerAnnuel",type:"plage",message:"Le loyer doit √™tre positif",params:{min:0}}],travaux:[{champ:"reference",type:"obligatoire",message:"La r√©f√©rence est obligatoire"},{champ:"libelle",type:"obligatoire",message:"Le libell√© est obligatoire"},{champ:"categorie",type:"obligatoire",message:"La cat√©gorie est obligatoire"},{champ:"montantBudget",type:"type",message:"Le budget doit √™tre un nombre",params:{typeAttendu:"number"}}],budget:[{champ:"poste",type:"obligatoire",message:"Le poste est obligatoire"},{champ:"annee",type:"obligatoire",message:"L'ann√©e est obligatoire"},{champ:"montant",type:"obligatoire",message:"Le montant est obligatoire"},{champ:"montant",type:"type",message:"Le montant doit √™tre un nombre",params:{typeAttendu:"number"}}],valorisation:[{champ:"dateValorisation",type:"obligatoire",message:"La date de valorisation est obligatoire"},{champ:"dateValorisation",type:"format",message:"La date doit √™tre valide",params:{format:"date"}},{champ:"valeurVenale",type:"obligatoire",message:"La valeur v√©nale est obligatoire"},{champ:"valeurVenale",type:"type",message:"La valeur doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"valeurVenale",type:"plage",message:"La valeur doit √™tre positive",params:{min:0}}],surface:[{champ:"lotId",type:"obligatoire",message:"L'identifiant du lot est obligatoire"},{champ:"surface",type:"obligatoire",message:"La surface est obligatoire"},{champ:"surface",type:"type",message:"La surface doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"surface",type:"plage",message:"La surface doit √™tre positive",params:{min:0}}],energie:[{champ:"periodeAnnee",type:"obligatoire",message:"L'ann√©e est obligatoire"},{champ:"periodeMois",type:"obligatoire",message:"Le mois est obligatoire"},{champ:"typeEnergie",type:"obligatoire",message:"Le type d'√©nergie est obligatoire"},{champ:"consommation",type:"obligatoire",message:"La consommation est obligatoire"},{champ:"consommation",type:"type",message:"La consommation doit √™tre un nombre",params:{typeAttendu:"number"}}],satisfaction:[{champ:"date",type:"obligatoire",message:"La date est obligatoire"},{champ:"date",type:"format",message:"La date doit √™tre valide",params:{format:"date"}},{champ:"scoreGlobal",type:"obligatoire",message:"Le score global est obligatoire"},{champ:"scoreGlobal",type:"type",message:"Le score doit √™tre un nombre",params:{typeAttendu:"number"}},{champ:"scoreGlobal",type:"plage",message:"Le score doit √™tre entre 0 et 100",params:{min:0,max:100}}]};function J(i){return!(i==null||typeof i=="string"&&i.trim()==="")}function pi(i,s){if(!J(i))return!0;switch(s){case"number":if(typeof i=="number")return!isNaN(i);if(typeof i=="string"){const e=parseFloat(i.replace(/\s/g,"").replace(",","."));return!isNaN(e)&&isFinite(e)}return!1;case"string":return typeof i=="string";case"boolean":return typeof i=="boolean"||["true","false","oui","non","1","0"].includes(String(i).toLowerCase());case"date":return it(i);default:return!0}}function it(i){if(!J(i))return!0;const s=String(i).trim(),e=[/^\d{2}\/\d{2}\/\d{4}$/,/^\d{4}-\d{2}-\d{2}$/,/^\d{2}-\d{2}-\d{4}$/];for(const r of e)if(r.test(s)){const a=new Date(s);return!isNaN(a.getTime())}const t=Date.parse(s);return!isNaN(t)}function mi(i,s,e){if(!J(i))return!0;let t;if(typeof i=="number")t=i;else if(typeof i=="string")t=parseFloat(i.replace(/\s/g,"").replace(",","."));else return!1;return!(isNaN(t)||s!==void 0&&t<s||e!==void 0&&t>e)}function gi(i){const s=new Map,e=new Set;return i.forEach((t,r)=>{if(!J(t))return;const a=String(t).toLowerCase().trim(),o=s.get(a);o!==void 0?(e.add(o),e.add(r)):s.set(a,r)}),e}function fi(i,s,e){var f,S,T,_,D;const t=ui[e]||[],r=[],a=[],o=new Set,n={};for(const v of s)n[v.colonneDestination]=v.colonneSource;const d={champsRemplis:{},valeursUniques:{},valeursManquantes:{},typesDetectes:{}},u={},p=t.filter(v=>v.type==="unique");for(const v of p){const L=n[v.champ];L&&(u[v.champ]=i.map(w=>w[L]))}const g={};for(const[v,L]of Object.entries(u))g[v]=gi(L);for(let v=0;v<i.length;v++){const L=i[v],w=v+2;for(const R of t){const j=n[R.champ];if(!j&&R.type!=="custom")continue;const k=j?L[j]:void 0;let H=!0;const ee=R.type==="obligatoire"?"erreur":"avertissement";switch(R.type){case"obligatoire":H=J(k);break;case"type":H=pi(k,(f=R.params)==null?void 0:f.typeAttendu);break;case"format":((S=R.params)==null?void 0:S.format)==="date"&&(H=it(k));break;case"plage":H=mi(k,(T=R.params)==null?void 0:T.min,(_=R.params)==null?void 0:_.max);break;case"unique":H=!((D=g[R.champ])!=null&&D.has(v));break;case"custom":R.validateur&&(H=R.validateur(k,L,v));break}if(!H){const X={ligne:w,colonne:j||R.champ,valeur:String(k??""),erreur:R.message,severite:ee};ee==="erreur"?(r.push(X),o.add(v)):a.push(X)}}for(const R of s){const j=L[R.colonneSource];d.champsRemplis[R.colonneDestination]=(d.champsRemplis[R.colonneDestination]||0)+(J(j)?1:0),d.valeursManquantes[R.colonneDestination]=(d.valeursManquantes[R.colonneDestination]||0)+(J(j)?0:1)}}for(const v of s){const L=new Set(i.map(w=>String(w[v.colonneSource]??"")).filter(w=>w!==""));d.valeursUniques[v.colonneDestination]=L.size}const A=i.length-o.size,h=i.length>0?Math.round(A/i.length*100):100;let b;return h>=95?b="excellent":h>=85?b="bon":h>=70?b="moyen":b="faible",{valide:r.length===0,erreurs:r,avertissements:a,lignesValides:A,lignesErreur:o.size,scoreQualite:h,qualite:b,statistiques:d}}function hi(i,s){return i.map(e=>{const t={};for(const r of s){let a=e[r.colonneSource];switch(r.typeDetecte){case"number":typeof a=="string"&&(a=parseFloat(a.replace(/\s/g,"").replace(",",".")),isNaN(a)&&(a=null));break;case"date":if(a&&typeof a=="string"){const o=yi(a);a=o?o.toISOString().split("T")[0]:a}break;case"boolean":if(typeof a=="string"){const o=a.toLowerCase().trim();["true","oui","1","yes"].includes(o)?a=!0:["false","non","0","no"].includes(o)&&(a=!1)}break}typeof a=="string"&&(a=a.trim()),t[r.colonneDestination]=a}return t})}function yi(i){const s=i.trim();let e=s.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(e)return new Date(parseInt(e[3]),parseInt(e[2])-1,parseInt(e[1]));if(e=s.match(/^(\d{4})-(\d{2})-(\d{2})$/),e)return new Date(parseInt(e[1]),parseInt(e[2])-1,parseInt(e[3]));if(e=s.match(/^(\d{2})-(\d{2})-(\d{4})$/),e)return new Date(parseInt(e[3]),parseInt(e[2])-1,parseInt(e[1]));const t=new Date(s);return isNaN(t.getTime())?null:t}function bi(i){return i.filter(s=>Object.values(s).some(e=>e!=null&&e!=="")).map(s=>{const e={};for(const[t,r]of Object.entries(s))if(typeof r=="string"){const a=r.trim();e[t]=a===""?null:a}else e[t]=r;return e})}const me={fichierParse:null,categorie:null,mapping:[],validation:null,donneesTransformees:[],etape:"upload",progression:0,erreur:null},xo=q((i,s)=>({fichiers:[],fichiersParCentre:{},dossiers:[],dossiersParCentre:{},importEnCours:{...me},isLoading:!1,error:null,loadFichiers:async e=>{i({isLoading:!0,error:null});try{const t=await l.fichiersImport.where("centreId").equals(e).and(r=>r.estDerniereVersion).reverse().sortBy("dateImport");i(r=>({fichiers:t,fichiersParCentre:{...r.fichiersParCentre,[e]:t},isLoading:!1}))}catch(t){i({error:`Erreur chargement fichiers: ${t}`,isLoading:!1})}},loadDossiers:async e=>{try{const t=await l.dossiersImport.where("centreId").equals(e).sortBy("ordre");i(r=>({dossiers:t,dossiersParCentre:{...r.dossiersParCentre,[e]:t}}))}catch{}},loadAll:async e=>{await Promise.all([s().loadFichiers(e),s().loadDossiers(e)])},uploadFichier:async e=>{i(t=>({importEnCours:{...t.importEnCours,etape:"upload",progression:0,erreur:null}}));try{if(e.size>10*1024*1024)throw new Error("Le fichier d√©passe la taille maximale de 10 Mo");i(r=>({importEnCours:{...r.importEnCours,progression:30}}));const t=await ci(e);if(t.erreurParsing)throw new Error(t.erreurParsing);i(r=>({importEnCours:{...r.importEnCours,fichierParse:t,etape:"mapping",progression:100}}))}catch(t){i(r=>({importEnCours:{...r.importEnCours,erreur:String(t),etape:"upload"}}))}},setCategorie:e=>{i(t=>({importEnCours:{...t.importEnCours,categorie:e}})),s().genererMappingAuto()},setMapping:e=>{i(t=>({importEnCours:{...t.importEnCours,mapping:e}}))},genererMappingAuto:()=>{const{fichierParse:e,categorie:t}=s().importEnCours;if(!e||!t)return;const a=di(e.colonnes,t).map(o=>({...o,typeDetecte:e.typesDetectes[o.colonneSource]||"string"}));i(o=>({importEnCours:{...o.importEnCours,mapping:a}}))},valider:()=>{const{fichierParse:e,mapping:t,categorie:r}=s().importEnCours;if(!e||!r||t.length===0)return;i(d=>({importEnCours:{...d.importEnCours,etape:"validation",progression:0}}));const a=bi(e.lignes);i(d=>({importEnCours:{...d.importEnCours,progression:30}}));const o=fi(a,t,r);i(d=>({importEnCours:{...d.importEnCours,progression:60}}));const n=hi(a,t);i(d=>({importEnCours:{...d.importEnCours,validation:o,donneesTransformees:n,progression:100}}))},importerDonnees:async(e,t)=>{var u;const{fichierParse:r,categorie:a,mapping:o,validation:n,donneesTransformees:d}=s().importEnCours;if(!r||!a||!n)return null;i(p=>({importEnCours:{...p.importEnCours,etape:"import",progression:0,erreur:null}}));try{const p=new Date().toISOString(),g=E(),A={id:g,centreId:e,dossierId:t,nom:r.nom,format:r.format,taille:r.taille,contenu:r.contenuBase64,categorie:a,mapping:o,scoreQualite:n.scoreQualite,qualite:n.qualite,lignesTotal:r.lignesTotal,lignesValides:n.lignesValides,lignesErreur:n.lignesErreur,erreurs:n.erreurs,donneesParsees:d,statut:n.valide?"succes":"partiel",version:1,estDerniereVersion:!0,importePar:"utilisateur",dateImport:p,createdAt:p,updatedAt:p};i(h=>({importEnCours:{...h.importEnCours,progression:20}})),await l.fichiersImport.add(A),i(h=>({importEnCours:{...h.importEnCours,progression:40}})),await Ai(e,g,a,d),i(h=>({importEnCours:{...h.importEnCours,etape:"termine",progression:100},fichiers:[A,...h.fichiers],fichiersParCentre:{...h.fichiersParCentre,[e]:[A,...h.fichiersParCentre[e]||[]]}}));try{const h=ae.getState();if(h.config.enabled&&h.config.options.importTermine){const b=Q.getState().getCentre(e);await h.sendImportNotification(A.nom,A.lignesValides,(b==null?void 0:b.nom)||e,!0)}}catch{}return A}catch(p){try{const g=ae.getState();if(g.config.enabled&&g.config.options.importTermine){const A=Q.getState().getCentre(e),h=((u=s().importEnCours.fichierParse)==null?void 0:u.nom)||"Fichier inconnu";await g.sendImportNotification(h,0,(A==null?void 0:A.nom)||e,!1,String(p))}}catch{}return i(g=>({importEnCours:{...g.importEnCours,erreur:`Erreur import: ${p}`,etape:"validation"}})),null}},annulerImport:()=>{i({importEnCours:{...me}})},resetImport:()=>{i({importEnCours:{...me}})},getFichier:e=>s().fichiers.find(t=>t.id===e),supprimerFichier:async e=>{const t=s().getFichier(e);t&&(await xi(t.centreId,e,t.categorie),await l.fichiersImport.delete(e),i(r=>({fichiers:r.fichiers.filter(a=>a.id!==e),fichiersParCentre:{...r.fichiersParCentre,[t.centreId]:(r.fichiersParCentre[t.centreId]||[]).filter(a=>a.id!==e)}})))},getFichiersParCategorie:(e,t)=>(s().fichiersParCentre[e]||[]).filter(a=>a.categorie===t),creerDossier:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.dossiersImport.add(r),i(a=>({dossiers:[...a.dossiers,r],dossiersParCentre:{...a.dossiersParCentre,[r.centreId]:[...a.dossiersParCentre[r.centreId]||[],r]}})),r},renommerDossier:async(e,t)=>{const r=new Date().toISOString();await l.dossiersImport.update(e,{nom:t,updatedAt:r}),i(a=>({dossiers:a.dossiers.map(o=>o.id===e?{...o,nom:t,updatedAt:r}:o)}))},supprimerDossier:async e=>{await l.fichiersImport.where("dossierId").equals(e).modify({dossierId:void 0}),await l.dossiersImport.delete(e),i(t=>({dossiers:t.dossiers.filter(r=>r.id!==e),fichiers:t.fichiers.map(r=>r.dossierId===e?{...r,dossierId:void 0}:r)}))},deplacerFichierDansDossier:async(e,t)=>{const r=new Date().toISOString();await l.fichiersImport.update(e,{dossierId:t||void 0,updatedAt:r}),i(a=>({fichiers:a.fichiers.map(o=>o.id===e?{...o,dossierId:t||void 0,updatedAt:r}:o)}))},getVersionsPrecedentes:async e=>{const t=s().getFichier(e);return t?(await l.fichiersImport.where("centreId").equals(t.centreId).and(a=>a.categorie===t.categorie&&a.nom===t.nom).sortBy("version")).filter(a=>a.id!==e):[]}}));async function Ai(i,s,e,t){const r=new Date().toISOString();switch(e){case"etat_locatif":const a=t.map(f=>({id:E(),centreId:i,fichierImportId:s,lotId:String(f.lotReference||""),lotReference:String(f.lotReference||""),locataireNom:String(f.locataireEnseigne||""),locataireEnseigne:String(f.locataireEnseigne||""),activiteCode:String(f.activiteCode||""),surfaceGLA:Number(f.surfaceGLA)||0,bailDebut:String(f.bailDebut||""),bailFin:String(f.bailFin||""),loyerMinimumGaranti:Number(f.loyerMinimumGaranti)||0,chargesProvision:Number(f.chargesProvision)||0,depotGarantie:Number(f.depotGarantie)||0,indexationIndice:f.indexationIndice||"ILC",statutOccupation:f.statutOccupation||"occupe",createdAt:r}));await l.etatsLocatifs.bulkAdd(a);break;case"loyers":const o=t.map(f=>({id:E(),centreId:i,fichierImportId:s,lotId:String(f.lotId||""),locataireEnseigne:String(f.locataireEnseigne||""),periodeAnnee:Number(f.periodeAnnee)||new Date().getFullYear(),periodeMois:Number(f.periodeMois)||1,loyerAppele:Number(f.loyerAppele)||0,loyerEncaisse:Number(f.loyerEncaisse)||0,chargesAppelees:Number(f.chargesAppelees)||0,chargesEncaissees:Number(f.chargesEncaissees)||0,statut:f.statut||"paye",createdAt:r}));await l.donneesLoyers.bulkAdd(o);break;case"frequentation":const n=t.map(f=>({id:E(),centreId:i,fichierImportId:s,date:String(f.date||""),entreesTotal:Number(f.entreesTotal)||0,zone:f.zone?String(f.zone):void 0,jourSemaine:new Date(String(f.date)).toLocaleDateString("fr-FR",{weekday:"long"}),estJourFerie:!1,createdAt:r}));await l.donneesFrequentation.bulkAdd(n);break;case"chiffre_affaires":const d=t.map(f=>({id:E(),centreId:i,fichierImportId:s,lotId:String(f.lotId||""),locataireEnseigne:String(f.locataireEnseigne||""),periodeAnnee:Number(f.periodeAnnee)||new Date().getFullYear(),periodeMois:Number(f.periodeMois)||1,caDeclare:Number(f.caDeclare)||0,statutDeclaration:"declare",createdAt:r}));await l.donneesChiffreAffaires.bulkAdd(d);break;case"charges":const u=t.map(f=>({id:E(),centreId:i,fichierImportId:s,periodeAnnee:Number(f.periodeAnnee)||new Date().getFullYear(),periodeMois:f.periodeMois?Number(f.periodeMois):void 0,categorieCharge:String(f.categorieCharge||""),montantBudget:Number(f.montantBudget)||0,montantReel:Number(f.montantReel)||0,montantRefacturable:Number(f.montantRefacturable)||0,montantNonRefacturable:Number(f.montantNonRefacturable)||0,cleRepartition:"tantiemes",tauxRefacturation:100,createdAt:r}));await l.donneesCharges.bulkAdd(u);break;case"bail":const p=t.map(f=>({id:E(),centreId:i,fichierImportId:s,lotId:String(f.lotId||""),locataireNom:String(f.locataireEnseigne||""),locataireEnseigne:String(f.locataireEnseigne||""),dateSignature:String(f.dateDebut||""),dateDebut:String(f.dateDebut||""),dateFin:String(f.dateFin||""),dateBreak:f.dateBreak?String(f.dateBreak):void 0,dureeInitiale:9,loyerAnnuel:Number(f.loyerAnnuel)||0,chargesAnnuelles:Number(f.chargesAnnuelles)||0,depotGarantie:Number(f.depotGarantie)||0,indexation:"ILC",createdAt:r}));await l.donneesBaux.bulkAdd(p);break;case"travaux":const g=t.map(f=>({id:E(),centreId:i,fichierImportId:s,reference:String(f.reference||""),libelle:String(f.libelle||""),categorie:f.categorie||"maintenance",montantBudget:Number(f.montantBudget)||0,montantEngage:Number(f.montantEngage)||0,montantRealise:Number(f.montantRealise)||0,dateDebut:String(f.dateDebut||r),statut:f.statut||"planifie",createdAt:r}));await l.donneesTravaux.bulkAdd(g);break;case"valorisation":const A=t.map(f=>({id:E(),centreId:i,fichierImportId:s,dateValorisation:String(f.dateValorisation||""),valeurVenale:Number(f.valeurVenale)||0,valeurLocative:f.valeurLocative?Number(f.valeurLocative):void 0,tauxCapitalisation:Number(f.tauxCapitalisation)||0,methodologie:"capitalisation",createdAt:r}));await l.donneesValorisation.bulkAdd(A);break;case"energie":const h=t.map(f=>({id:E(),centreId:i,fichierImportId:s,periodeAnnee:Number(f.periodeAnnee)||new Date().getFullYear(),periodeMois:Number(f.periodeMois)||1,typeEnergie:f.typeEnergie||"electricite",consommation:Number(f.consommation)||0,unite:String(f.unite||"kWh"),cout:Number(f.cout)||0,createdAt:r}));await l.donneesEnergie.bulkAdd(h);break;case"satisfaction":const b=t.map(f=>({id:E(),centreId:i,fichierImportId:s,date:String(f.date||""),typeEnquete:"satisfaction",scoreGlobal:Number(f.scoreGlobal)||0,nps:f.nps?Number(f.nps):void 0,nombreRepondants:Number(f.nombreRepondants)||0,createdAt:r}));await l.donneesSatisfaction.bulkAdd(b);break}}async function xi(i,s,e){switch(e){case"etat_locatif":await l.etatsLocatifs.where("fichierImportId").equals(s).delete();break;case"loyers":await l.donneesLoyers.where("fichierImportId").equals(s).delete();break;case"frequentation":await l.donneesFrequentation.where("fichierImportId").equals(s).delete();break;case"chiffre_affaires":await l.donneesChiffreAffaires.where("fichierImportId").equals(s).delete();break;case"charges":await l.donneesCharges.where("fichierImportId").equals(s).delete();break;case"bail":await l.donneesBaux.where("fichierImportId").equals(s).delete();break;case"travaux":await l.donneesTravaux.where("fichierImportId").equals(s).delete();break;case"valorisation":await l.donneesValorisation.where("fichierImportId").equals(s).delete();break;case"energie":await l.donneesEnergie.where("fichierImportId").equals(s).delete();break;case"satisfaction":await l.donneesSatisfaction.where("fichierImportId").equals(s).delete();break}}const Fe={rapport:null,sectionSelectionnee:null,blocSelectionne:null,historiqueUndo:[],historiqueRedo:[],isDirty:!1,isSaving:!1};function vi(i){const s={id:E(),ordre:0};switch(i){case"paragraphe":return{...s,type:"paragraphe",contenu:""};case"titre":return{...s,type:"titre",niveau:2,texte:"Nouveau titre"};case"tableau":return{...s,type:"tableau",colonnes:[{key:"col1",label:"Colonne 1"}],donnees:[]};case"graphique":return{...s,type:"graphique",typeGraphique:"barre",donnees:[],configuration:{series:[]}};case"kpi_card":return{...s,type:"kpi_card",kpiCode:"",valeur:0,unite:""};case"kpi_grid":return{...s,type:"kpi_grid",kpis:[],colonnes:3};case"separateur":return{...s,type:"separateur",variante:"ligne"};case"saut_page":return{...s,type:"saut_page"};case"sommaire":return{...s,type:"sommaire",niveauMax:2};case"image":return{...s,type:"image",src:"",largeur:"100%"};default:return{...s,type:"paragraphe",contenu:""}}}function Ii(i){const s=tt[i];return s?s.sections.map((e,t)=>({id:E(),titre:e.titre,ordre:t,blocs:[]})):[]}q((i,s)=>({rapports:[],rapportsParCentre:{},modeles:[],edition:{...Fe},isLoading:!1,error:null,loadRapports:async e=>{i({isLoading:!0,error:null});try{const t=await l.rapports.where("centreId").equals(e).reverse().sortBy("dateCreation");i(r=>({rapports:t,rapportsParCentre:{...r.rapportsParCentre,[e]:t},isLoading:!1}))}catch(t){i({error:`Erreur chargement rapports: ${t}`,isLoading:!1})}},loadModeles:async()=>{try{const e=await l.modelesRapport.toArray();i({modeles:e})}catch{}},loadRapport:async e=>{try{return await l.rapports.get(e)||null}catch{return null}},creerRapport:async e=>{const t=new Date().toISOString(),r=Ii(e.typeRapportCode),a={id:E(),centreId:e.centreId,typeRapportCode:e.typeRapportCode,titre:e.titre,statut:"brouillon",auteur:e.auteur,periodeDebut:e.periodeDebut,periodeFin:e.periodeFin,periodeLabel:`${e.periodeDebut} - ${e.periodeFin}`,sourcesDonneesIds:[],sections:r,versions:[],versionActuelle:1,commentairesRevision:[],exportsGeneres:[],dateCreation:t,dateModification:t,createdAt:t,updatedAt:t};return await l.rapports.add(a),i(o=>({rapports:[a,...o.rapports],rapportsParCentre:{...o.rapportsParCentre,[e.centreId]:[a,...o.rapportsParCentre[e.centreId]||[]]}})),a},dupliquerRapport:async e=>{const t=s().getRapport(e);if(!t)return null;const r=new Date().toISOString(),a={...t,id:E(),titre:`${t.titre} (copie)`,statut:"brouillon",versions:[],versionActuelle:1,commentairesRevision:[],exportsGeneres:[],dateCreation:r,dateModification:r,dateSoumission:void 0,dateApprobation:void 0,datePublication:void 0,createdAt:r,updatedAt:r};return await l.rapports.add(a),i(o=>({rapports:[a,...o.rapports]})),a},supprimerRapport:async e=>{await l.rapports.delete(e),i(t=>({rapports:t.rapports.filter(r=>r.id!==e)}))},ouvrirRapport:async e=>{var r;const t=await s().loadRapport(e);t&&i({edition:{rapport:t,sectionSelectionnee:((r=t.sections[0])==null?void 0:r.id)||null,blocSelectionne:null,historiqueUndo:[],historiqueRedo:[],isDirty:!1,isSaving:!1}})},fermerRapport:()=>{i({edition:{...Fe}})},sauvegarderRapport:async()=>{const{rapport:e}=s().edition;if(e){i(t=>({edition:{...t.edition,isSaving:!0}}));try{const t=new Date().toISOString(),r={...e,dateModification:t,updatedAt:t};await l.rapports.put(r),i(a=>({edition:{...a.edition,rapport:r,isDirty:!1,isSaving:!1},rapports:a.rapports.map(o=>o.id===e.id?r:o)}))}catch(t){i(r=>({edition:{...r.edition,isSaving:!1},error:`Erreur sauvegarde: ${t}`}))}}},ajouterSection:(e,t)=>{const{rapport:r,historiqueUndo:a}=s().edition;if(!r)return;const o={id:E(),titre:e,ordre:t??r.sections.length,blocs:[]},n=[...r.sections],d=t??n.length;n.splice(d,0,o),n.forEach((u,p)=>{u.ordre=p}),i(u=>({edition:{...u.edition,rapport:{...r,sections:n},historiqueUndo:[...a,r],historiqueRedo:[],isDirty:!0,sectionSelectionnee:o.id}}))},modifierSection:(e,t)=>{const{rapport:r,historiqueUndo:a}=s().edition;if(!r)return;const o=r.sections.map(n=>n.id===e?{...n,...t}:n);i(n=>({edition:{...n.edition,rapport:{...r,sections:o},historiqueUndo:[...a,r],historiqueRedo:[],isDirty:!0}}))},supprimerSection:e=>{const{rapport:t,historiqueUndo:r}=s().edition;if(!t)return;const a=t.sections.filter(o=>o.id!==e);a.forEach((o,n)=>{o.ordre=n}),i(o=>{var n;return{edition:{...o.edition,rapport:{...t,sections:a},historiqueUndo:[...r,t],historiqueRedo:[],isDirty:!0,sectionSelectionnee:((n=a[0])==null?void 0:n.id)||null}}})},deplacerSection:(e,t)=>{const{rapport:r,historiqueUndo:a}=s().edition;if(!r)return;const o=[...r.sections],n=o.findIndex(u=>u.id===e);if(n===-1)return;const d=t==="up"?n-1:n+1;d<0||d>=o.length||([o[n],o[d]]=[o[d],o[n]],o.forEach((u,p)=>{u.ordre=p}),i(u=>({edition:{...u.edition,rapport:{...r,sections:o},historiqueUndo:[...a,r],historiqueRedo:[],isDirty:!0}})))},selectionnerSection:e=>{i(t=>({edition:{...t.edition,sectionSelectionnee:e,blocSelectionne:null}}))},ajouterBloc:(e,t,r)=>{const{rapport:a,historiqueUndo:o}=s().edition;if(!a)return;const n=vi(t),d=a.sections.map(u=>{if(u.id!==e)return u;const p=[...u.blocs],g=r??p.length;return n.ordre=g,p.splice(g,0,n),p.forEach((A,h)=>{A.ordre=h}),{...u,blocs:p}});i(u=>({edition:{...u.edition,rapport:{...a,sections:d},historiqueUndo:[...o,a],historiqueRedo:[],isDirty:!0,blocSelectionne:n.id}}))},modifierBloc:(e,t,r)=>{const{rapport:a,historiqueUndo:o}=s().edition;if(!a)return;const n=a.sections.map(d=>{if(d.id!==e)return d;const u=d.blocs.map(p=>p.id===t?{...p,...r}:p);return{...d,blocs:u}});i(d=>({edition:{...d.edition,rapport:{...a,sections:n},historiqueUndo:[...o,a],historiqueRedo:[],isDirty:!0}}))},supprimerBloc:(e,t)=>{const{rapport:r,historiqueUndo:a}=s().edition;if(!r)return;const o=r.sections.map(n=>{if(n.id!==e)return n;const d=n.blocs.filter(u=>u.id!==t);return d.forEach((u,p)=>{u.ordre=p}),{...n,blocs:d}});i(n=>({edition:{...n.edition,rapport:{...r,sections:o},historiqueUndo:[...a,r],historiqueRedo:[],isDirty:!0,blocSelectionne:null}}))},deplacerBloc:(e,t,r)=>{const{rapport:a,historiqueUndo:o}=s().edition;if(!a)return;const n=a.sections.map(d=>{if(d.id!==e)return d;const u=[...d.blocs],p=u.findIndex(A=>A.id===t);if(p===-1)return d;const g=r==="up"?p-1:p+1;return g<0||g>=u.length?d:([u[p],u[g]]=[u[g],u[p]],u.forEach((A,h)=>{A.ordre=h}),{...d,blocs:u})});i(d=>({edition:{...d.edition,rapport:{...a,sections:n},historiqueUndo:[...o,a],historiqueRedo:[],isDirty:!0}}))},deplacerBlocVersSection:(e,t,r)=>{const{rapport:a,historiqueUndo:o}=s().edition;if(!a)return;let n=null,d=a.sections.map(u=>{if(u.id!==t)return u;const p=u.blocs.find(A=>A.id===e);p&&(n=p);const g=u.blocs.filter(A=>A.id!==e);return g.forEach((A,h)=>{A.ordre=h}),{...u,blocs:g}});n&&(d=d.map(u=>{if(u.id!==r)return u;const p=[...u.blocs,{...n,ordre:u.blocs.length}];return{...u,blocs:p}}),i(u=>({edition:{...u.edition,rapport:{...a,sections:d},historiqueUndo:[...o,a],historiqueRedo:[],isDirty:!0}})))},selectionnerBloc:e=>{i(t=>({edition:{...t.edition,blocSelectionne:e}}))},undo:()=>{const{historiqueUndo:e,rapport:t}=s().edition;if(e.length===0||!t)return;const r=e[e.length-1];i(a=>({edition:{...a.edition,rapport:r,historiqueUndo:e.slice(0,-1),historiqueRedo:[t,...a.edition.historiqueRedo],isDirty:!0}}))},redo:()=>{const{historiqueRedo:e,rapport:t}=s().edition;if(e.length===0||!t)return;const r=e[0];i(a=>({edition:{...a.edition,rapport:r,historiqueRedo:e.slice(1),historiqueUndo:[...a.edition.historiqueUndo,t],isDirty:!0}}))},changerStatut:async(e,t)=>{const r=new Date().toISOString();await l.rapports.update(e,{statut:t,updatedAt:r}),i(a=>({rapports:a.rapports.map(o=>o.id===e?{...o,statut:t,updatedAt:r}:o)}))},soumettreRevision:async e=>{const t=new Date().toISOString();await l.rapports.update(e,{statut:"en_revision",dateSoumission:t,updatedAt:t}),i(r=>({rapports:r.rapports.map(a=>a.id===e?{...a,statut:"en_revision",dateSoumission:t,updatedAt:t}:a)}))},approuver:async(e,t)=>{const r=new Date().toISOString();await l.rapports.update(e,{statut:"approuve",approbateur:t,dateApprobation:r,updatedAt:r}),i(a=>({rapports:a.rapports.map(o=>o.id===e?{...o,statut:"approuve",approbateur:t,dateApprobation:r,updatedAt:r}:o)}))},publier:async e=>{const t=new Date().toISOString();await l.rapports.update(e,{statut:"publie",datePublication:t,updatedAt:t}),i(r=>({rapports:r.rapports.map(a=>a.id===e?{...a,statut:"publie",datePublication:t,updatedAt:t}:a)}))},archiver:async e=>{await s().changerStatut(e,"archive")},ajouterCommentaire:async(e,t)=>{const r=s().getRapport(e);if(!r)return;const a={...t,id:E(),dateCreation:new Date().toISOString()},o=[...r.commentairesRevision,a];await l.rapports.update(e,{commentairesRevision:o}),i(n=>({rapports:n.rapports.map(d=>d.id===e?{...d,commentairesRevision:o}:d)}))},resoudreCommentaire:async(e,t)=>{const r=s().getRapport(e);if(!r)return;const a=r.commentairesRevision.map(o=>o.id===t?{...o,resolu:!0}:o);await l.rapports.update(e,{commentairesRevision:a}),i(o=>({rapports:o.rapports.map(n=>n.id===e?{...n,commentairesRevision:a}:n)}))},creerVersion:async e=>{const{rapport:t}=s().edition;if(!t)return;const r={id:E(),numero:t.versionActuelle,contenu:JSON.parse(JSON.stringify(t.sections)),auteur:t.auteur,commentaire:e,dateCreation:new Date().toISOString()},a=[...t.versions,r],o=t.versionActuelle+1;await l.rapports.update(t.id,{versions:a,versionActuelle:o}),i(n=>({edition:{...n.edition,rapport:{...t,versions:a,versionActuelle:o}}}))},restaurerVersion:async e=>{const{rapport:t}=s().edition;if(!t)return;const r=t.versions.find(a=>a.id===e);r&&i(a=>({edition:{...a.edition,rapport:{...t,sections:JSON.parse(JSON.stringify(r.contenu))},isDirty:!0}}))},sauvegarderCommeModele:async(e,t,r=!1)=>{const{rapport:a}=s().edition;if(!a)return null;const o=new Date().toISOString(),n={id:E(),typeRapportCode:a.typeRapportCode,nom:e,description:t,sections:JSON.parse(JSON.stringify(a.sections)),estPublic:r,auteur:a.auteur,nombreUtilisations:0,createdAt:o,updatedAt:o};return await l.modelesRapport.add(n),i(d=>({modeles:[...d.modeles,n]})),n},appliquerModele:e=>{const t=s().modeles.find(o=>o.id===e),{rapport:r,historiqueUndo:a}=s().edition;!t||!r||(i(o=>({edition:{...o.edition,rapport:{...r,sections:JSON.parse(JSON.stringify(t.sections))},historiqueUndo:[...a,r],historiqueRedo:[],isDirty:!0}})),l.modelesRapport.update(e,{nombreUtilisations:t.nombreUtilisations+1}))},supprimerModele:async e=>{await l.modelesRapport.delete(e),i(t=>({modeles:t.modeles.filter(r=>r.id!==e)}))},genererExport:async(e,t)=>{const{rapport:r}=s().edition;if(!r)return null;const a=new Date().toISOString(),{exportRapport:o,downloadBlob:n}=await P(async()=>{const{exportRapport:h,downloadBlob:b}=await import("./reportExport-BgnGCEkm.js");return{exportRapport:h,downloadBlob:b}},__vite__mapDeps([0,1,2])),u={pdf:"pdf",docx:"docx",pptx:"pptx",xlsx:"xlsx",html:"html"}[e]||"pdf",p=await o(r,u,{format:u,quality:(t==null?void 0:t.qualite)||"standard",pageSize:(t==null?void 0:t.taillePage)||"A4",orientation:(t==null?void 0:t.orientation)||"portrait",includeTableOfContents:(t==null?void 0:t.inclureSommaire)??!0,includeCoverPage:(t==null?void 0:t.inclureCouverture)??!0,includeComments:!1});if(!p.success||!p.blob||!p.filename)return null;n(p.blob,p.filename);const g={id:E(),format:e,dateGeneration:a,genereePar:r.auteur,nombreTelechargements:1},A=[...r.exportsGeneres,g];return await l.rapports.update(r.id,{exportsGeneres:A}),i(h=>({edition:{...h.edition,rapport:{...r,exportsGeneres:A}}})),g},getRapport:e=>s().rapports.find(t=>t.id===e),getRapportsParStatut:(e,t)=>(s().rapportsParCentre[e]||[]).filter(a=>a.statut===t)}));const vo=q((i,s)=>({projets:[],phases:[],jalons:[],vaguesRecrutement:[],postesARecruter:[],prospects:[],suiviBEFA:[],reserves:[],documentsDOE:[],risquesProjet:[],isLoading:!1,error:null,loadProjet:async e=>{i({isLoading:!0,error:null});try{const t=await l.projets.where("centreId").equals(e).toArray();if(i({projets:t,isLoading:!1}),t.length>0){const r=t[0].id;await s().loadPhases(r),await s().loadJalons(r),await s().loadRecrutement(r),await s().loadProspects(r),await s().loadBEFA(r),await s().loadReserves(r),await s().loadRisques(r)}}catch(t){i({error:`Erreur de chargement: ${t}`,isLoading:!1})}},getProjetByCentre:e=>s().projets.find(t=>t.centreId===e),createProjet:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.projets.add(r),i(a=>({projets:[...a.projets,r]})),r},updateProjet:async(e,t)=>{const r=new Date().toISOString();await l.projets.update(e,{...t,updatedAt:r}),i(a=>({projets:a.projets.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadPhases:async e=>{const t=await l.phasesProjet.where("projetId").equals(e).sortBy("numero");i({phases:t})},addPhase:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.phasesProjet.add(r),i(a=>({phases:[...a.phases,r]})),r},updatePhase:async(e,t)=>{const r=new Date().toISOString();await l.phasesProjet.update(e,{...t,updatedAt:r}),i(a=>({phases:a.phases.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadJalons:async e=>{const t=await l.jalons.where("projetId").equals(e).sortBy("ordre");i({jalons:t})},addJalon:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.jalons.add(r),i(a=>({jalons:[...a.jalons,r]})),r},updateJalon:async(e,t)=>{const r=new Date().toISOString();await l.jalons.update(e,{...t,updatedAt:r}),i(a=>({jalons:a.jalons.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteJalon:async e=>{await l.jalons.delete(e),i(t=>({jalons:t.jalons.filter(r=>r.id!==e)}))},loadRecrutement:async e=>{const t=await l.vaguesRecrutement.where("projetId").equals(e).sortBy("numero"),r=await l.postesARecruter.where("projetId").equals(e).toArray();i({vaguesRecrutement:t,postesARecruter:r})},addVague:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.vaguesRecrutement.add(r),i(a=>({vaguesRecrutement:[...a.vaguesRecrutement,r]})),r},addPoste:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.postesARecruter.add(r),i(a=>({postesARecruter:[...a.postesARecruter,r]})),r},updatePoste:async(e,t)=>{const r=new Date().toISOString();await l.postesARecruter.update(e,{...t,updatedAt:r}),i(a=>({postesARecruter:a.postesARecruter.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadProspects:async e=>{const t=await l.prospectsCommerciaux.where("projetId").equals(e).toArray();i({prospects:t})},addProspect:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.prospectsCommerciaux.add(r),i(a=>({prospects:[...a.prospects,r]})),r},updateProspect:async(e,t)=>{const r=new Date().toISOString();await l.prospectsCommerciaux.update(e,{...t,updatedAt:r}),i(a=>({prospects:a.prospects.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},deleteProspect:async e=>{await l.prospectsCommerciaux.delete(e),i(t=>({prospects:t.prospects.filter(r=>r.id!==e)}))},loadBEFA:async e=>{const t=await l.suiviBEFA.where("projetId").equals(e).toArray();i({suiviBEFA:t})},addBEFA:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.suiviBEFA.add(r),i(a=>({suiviBEFA:[...a.suiviBEFA,r]})),r},updateBEFA:async(e,t)=>{const r=new Date().toISOString();await l.suiviBEFA.update(e,{...t,updatedAt:r}),i(a=>({suiviBEFA:a.suiviBEFA.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadReserves:async e=>{const t=await l.reserves.where("projetId").equals(e).toArray();i({reserves:t})},addReserve:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.reserves.add(r),i(a=>({reserves:[...a.reserves,r]})),r},updateReserve:async(e,t)=>{const r=new Date().toISOString();await l.reserves.update(e,{...t,updatedAt:r}),i(a=>({reserves:a.reserves.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadDOE:async e=>{const t=await l.documentsDOE.where("projetId").equals(e).toArray();i({documentsDOE:t})},addDocumentDOE:async e=>{const t=new Date().toISOString(),r={...e,id:E(),createdAt:t,updatedAt:t};return await l.documentsDOE.add(r),i(a=>({documentsDOE:[...a.documentsDOE,r]})),r},updateDocumentDOE:async(e,t)=>{const r=new Date().toISOString();await l.documentsDOE.update(e,{...t,updatedAt:r}),i(a=>({documentsDOE:a.documentsDOE.map(o=>o.id===e?{...o,...t,updatedAt:r}:o)}))},loadRisques:async e=>{const t=await l.risquesProjet.where("projetId").equals(e).toArray();i({risquesProjet:t})},addRisque:async e=>{const t=new Date().toISOString(),r={...e,id:E(),criticite:e.probabilite*e.impact,createdAt:t,updatedAt:t};return await l.risquesProjet.add(r),i(a=>({risquesProjet:[...a.risquesProjet,r]})),r},updateRisque:async(e,t)=>{const r=new Date().toISOString(),a={...t,updatedAt:r};if(t.probabilite!==void 0||t.impact!==void 0){const o=s().risquesProjet.find(n=>n.id===e);if(o){const n=t.probabilite??o.probabilite,d=t.impact??o.impact;a.criticite=n*d}}await l.risquesProjet.update(e,a),i(o=>({risquesProjet:o.risquesProjet.map(n=>n.id===e?{...n,...a}:n)}))},deleteRisque:async e=>{await l.risquesProjet.delete(e),i(t=>({risquesProjet:t.risquesProjet.filter(r=>r.id!==e)}))},getStatistiquesProjet:e=>{const t=s().projets.find(v=>v.id===e),r=s().jalons.filter(v=>v.projetId===e),a=s().postesARecruter.filter(v=>v.projetId===e),o=s().prospects.filter(v=>v.projetId===e),n=s().reserves.filter(v=>v.projetId===e),d=s().suiviBEFA.filter(v=>v.projetId===e),u=s().phases.filter(v=>v.projetId===e),p=new Date,g=t?new Date(t.dateSoftOpening):p,A=t?new Date(t.dateInauguration):p,h=r.filter(v=>v.statut==="atteint").length,b=a.filter(v=>v.statut==="integre").length,S=o.filter(v=>v.statut==="bail_signe").reduce((v,L)=>v+L.surface,0),T=t?1e4:0,_=u.reduce((v,L)=>v+L.budgetConsomme,0),D=(t==null?void 0:t.budgetTotal)||0;return{joursAvantSoftOpening:Ce(g,p),joursAvantInauguration:Ce(A,p),jalonsAtteints:h,jalonsTotal:r.length,postesRecrutes:b,postesTotal:a.length,occupationPourcent:T>0?Math.round(S/T*100):0,glaSigne:S,glaTotal:T,budgetConsomme:_,budgetTotal:D,ecartBudget:D>0?Math.round((_-D)/D*100*10)/10:0,reservesBloquantes:n.filter(v=>v.classification==="bloquante"&&v.statut!=="levee").length,reservesTotales:n.filter(v=>v.statut!=="levee").length,befaComplets:d.filter(v=>v.statut==="complet").length,befaTotal:d.length}},initializeDefaultProjet:async(e,t,r,a)=>{const o=new Date().toISOString(),n=await s().createProjet({centreId:e,nom:t,statut:"preparation",dateDebut:o,dateSoftOpening:r,dateInauguration:a,dateFinStabilisation:a,budgetTotal:7205e5,provisions:655e5,phaseActuelle:"preparation",seuilAlerteJalon:7,seuilAlerteBudget:5}),d=[{numero:1,nom:"Pr√©paration",budget:85e6},{numero:2,nom:"Mobilisation",budget:42e7},{numero:3,nom:"Lancement",budget:15e7}];for(const g of d)await s().addPhase({projetId:n.id,numero:g.numero,nom:g.nom,dateDebut:o,dateFin:r,budget:g.budget,budgetEngage:0,budgetConsomme:0,statut:g.numero===1?"en_cours":"a_venir",avancement:0});const u=[{code:"J1",titre:"Center Manager recrut√©",importance:"critique"},{code:"J2",titre:"√âquipe manag√©riale compl√®te",importance:"critique"},{code:"J3",titre:"50% baux sign√©s",importance:"majeur"},{code:"J4",titre:"85% baux sign√©s",importance:"critique"},{code:"J5",titre:"Handover technique",importance:"critique"},{code:"J6",titre:"Commission s√©curit√©",importance:"critique"},{code:"J7",titre:"Soft Opening",importance:"critique"},{code:"J8",titre:"Inauguration",importance:"critique"}];for(let g=0;g<u.length;g++)await s().addJalon({projetId:n.id,code:u[g].code,titre:u[g].titre,description:"",dateCible:g<7?r:a,importance:u[g].importance,statut:"a_venir",dependances:g>0?[u[g-1].code]:[],critereValidation:"",ordre:g+1});const p=[{numero:1,nom:"Management",priorite:"critique"},{numero:2,nom:"Superviseurs",priorite:"haute"},{numero:3,nom:"√âquipe op√©rationnelle",priorite:"moyenne"},{numero:4,nom:"Renfort ouverture",priorite:"basse"}];for(const g of p)await s().addVague({projetId:n.id,numero:g.numero,nom:g.nom,deadline:r,priorite:g.priorite});return n}})),Ue={activeProvider:"openrouter",openrouterApiKey:"",claudeApiKey:"",openrouterModel:"meta-llama/llama-3.1-8b-instruct:free",claudeModel:"claude-3-5-sonnet-20241022",temperature:.7,maxTokens:2048},Ei={totalRequests:0,totalTokens:0,lastUsed:null,requestsToday:0,lastResetDate:new Date().toISOString().split("T")[0],openrouterRequests:0,claudeRequests:0},wi=q()(W((i,s)=>({config:Ue,usage:Ei,conversations:[],isLoading:!1,lastError:null,isPanelOpen:!1,setActiveProvider:e=>i(t=>({config:{...t.config,activeProvider:e}})),setOpenRouterApiKey:e=>i(t=>({config:{...t.config,openrouterApiKey:e}})),setClaudeApiKey:e=>i(t=>({config:{...t.config,claudeApiKey:e}})),setOpenRouterModel:e=>i(t=>({config:{...t.config,openrouterModel:e}})),setClaudeModel:e=>i(t=>({config:{...t.config,claudeModel:e}})),setTemperature:e=>i(t=>({config:{...t.config,temperature:e}})),setMaxTokens:e=>i(t=>({config:{...t.config,maxTokens:e}})),clearConfig:()=>i({config:Ue,conversations:[]}),getCurrentApiKey:()=>{const e=s();return e.config.activeProvider==="claude"?e.config.claudeApiKey:e.config.openrouterApiKey},getCurrentModel:()=>{const e=s();return e.config.activeProvider==="claude"?e.config.claudeModel:e.config.openrouterModel},isCurrentProviderConfigured:()=>{const e=s();return(e.config.activeProvider==="claude"?e.config.claudeApiKey:e.config.openrouterApiKey).length>0},recordUsage:(e,t)=>{const r=new Date().toISOString().split("T")[0];i(a=>{const o=a.usage.lastResetDate!==r;return{usage:{totalRequests:a.usage.totalRequests+1,totalTokens:a.usage.totalTokens+e,lastUsed:new Date().toISOString(),requestsToday:o?1:a.usage.requestsToday+1,lastResetDate:r,openrouterRequests:t==="openrouter"?a.usage.openrouterRequests+1:a.usage.openrouterRequests,claudeRequests:t==="claude"?a.usage.claudeRequests+1:a.usage.claudeRequests}}})},resetDailyUsage:()=>i(e=>({usage:{...e.usage,requestsToday:0,lastResetDate:new Date().toISOString().split("T")[0]}})),addMessage:e=>i(t=>({conversations:[...t.conversations,{...e,id:crypto.randomUUID(),timestamp:new Date().toISOString()}].slice(-100)})),clearConversations:()=>i({conversations:[]}),setLoading:e=>i({isLoading:e}),setError:e=>i({lastError:e}),togglePanel:()=>i(e=>({isPanelOpen:!e.isPanelOpen})),setPanelOpen:e=>i({isPanelOpen:e})}),{name:"cockpit-ai-store",partialize:i=>({config:i.config,usage:i.usage})})),st={langue:"fr",theme:"system",formatDate:"DD/MM/YYYY",formatNombre:"fr-FR",deviseDefaut:"XOF",centreParDefaut:void 0,dashboardWidgets:["kpi-summary","alerts-recent","actions-progress","centres-overview"],notificationsEmail:!1,digestFrequence:"hebdomadaire",exportQualite:"haute",autoSaveInterval:30},ge=()=>({id:"default-user",nom:"",prenom:"",email:"",fonction:"",organisation:"CRMC",preferences:{...st},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Io=q()(W((i,s)=>({profile:null,isLoading:!1,error:null,isInitialized:!1,loadProfile:async()=>{i({isLoading:!0,error:null});try{let e=await l.userProfile.get("default-user");e||(e=ge(),await l.userProfile.add(e)),i({profile:e,isLoading:!1,isInitialized:!0})}catch(e){i({profile:ge(),isLoading:!1,error:String(e),isInitialized:!0})}},updateProfile:async e=>{const{profile:t}=s();if(!t)return;const r={...t,...e,updatedAt:new Date().toISOString()};try{await l.userProfile.put(r),i({profile:r,error:null})}catch(a){i({error:String(a)})}},updatePreferences:async e=>{const{profile:t}=s();if(!t)return;const r={...t,preferences:{...t.preferences,...e},updatedAt:new Date().toISOString()};try{await l.userProfile.put(r),i({profile:r,error:null}),e.theme&&Ci(e.theme),e.langue&&(document.documentElement.lang=e.langue)}catch(a){i({error:String(a)})}},setAvatar:async e=>{await s().updateProfile({avatar:e})},setSignature:async e=>{await s().updateProfile({signature:e})},resetProfile:async()=>{const e=ge();try{await l.userProfile.put(e),i({profile:e,error:null})}catch(t){i({error:String(t)})}},getPreference:e=>{const{profile:t}=s();return(t==null?void 0:t.preferences[e])??st[e]},getFullName:()=>{const{profile:e}=s();return e?`${e.prenom} ${e.nom}`.trim()||"Utilisateur":""},getInitials:()=>{var a,o;const{profile:e}=s();if(!e)return"U";const t=((a=e.prenom)==null?void 0:a[0])||"",r=((o=e.nom)==null?void 0:o[0])||"";return(t+r).toUpperCase()||"U"}}),{name:"cockpit-profile-store",partialize:i=>({isInitialized:i.isInitialized})}));function Ci(i){const s=document.documentElement;if(s.classList.remove("light","dark"),i==="system"){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";s.classList.add(e)}else s.classList.add(i)}const Si=16,Ri=12,Ti=128,Oi=1e5;async function Ni(i,s){const t=new TextEncoder().encode(i),r=await crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:Oi,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Pi(i,s){const e=crypto.getRandomValues(new Uint8Array(Si)),t=crypto.getRandomValues(new Uint8Array(Ri)),r=await Ni(s,e),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:t,tagLength:Ti},r,i),o=new Uint8Array(e.length+t.length+a.byteLength);return o.set(e,0),o.set(t,e.length),o.set(new Uint8Array(a),e.length+t.length),o}const _i={enabled:!1,frequence:"hebdomadaire",heure:"18:00",joursRetenus:10,cibles:{local:!0,onedrive:!1},notifierSiEchec:!0},Eo=q()(W((i,s)=>({history:[],autoBackupConfig:_i,storageStats:null,isLoading:!1,error:null,loadHistory:async()=>{i({isLoading:!0,error:null});try{const e=await l.backupHistory.orderBy("date").reverse().toArray();i({history:e,isLoading:!1})}catch(e){i({error:String(e),isLoading:!1})}},createBackup:async(e,t={})=>{i({isLoading:!0,error:null});try{const r=await Di(t.centreIds),a={version:"1.1",exportDate:new Date().toISOString(),appVersion:"1.1.0",dbVersion:6,checksum:await Be(JSON.stringify(r)),tables:Object.keys(r).length,totalRecords:Object.values(r).reduce((S,T)=>S+(Array.isArray(T)?T.length:0),0),centresInclus:t.centreIds||(await l.centres.toArray()).map(S=>S.id),tailleMo:0},n=JSON.stringify({meta:a,data:r}),d=ce.gzip(n);let u,p=!1;t.password?(u=await Pi(d,t.password),p=!0):u=d,a.tailleMo=u.length/(1024*1024);const h=`cockpit_backup_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}${p?".encrypted":""}.json.gz`,b=new Blob([u],{type:p?"application/octet-stream":"application/gzip"}),f={id:crypto.randomUUID(),date:new Date().toISOString(),type:"manuel",cible:e,tailleMo:a.tailleMo,centresInclus:a.centresInclus.length,enregistrements:a.totalRecords,statut:"succes",checksum:a.checksum};await l.backupHistory.add(f),e==="download"&&Li(b,h),await s().loadHistory();try{const S=ae.getState();S.config.enabled&&S.config.options.rapportsHebdomadaires&&await S.sendBackupNotification(a.tailleMo.toFixed(2),a.totalRecords,a.centresInclus.length,!0)}catch{}return i({isLoading:!1}),{success:!0,message:`Sauvegarde cr√©√©e avec succ√®s (${a.tailleMo.toFixed(2)} MB, ${a.totalRecords} enregistrements)`,filename:h}}catch(r){try{const a=ae.getState();a.config.enabled&&s().autoBackupConfig.notifierSiEchec&&await a.sendBackupNotification("0",0,0,!1,String(r))}catch{}return i({error:String(r),isLoading:!1}),{success:!1,message:String(r)}}},validateBackup:async e=>{var r;const t={isValid:!1,version:"",compatible:!1,dateExport:"",centresCount:0,recordsCount:0,integrityCheck:!1,warnings:[],errors:[]};try{const a=await e.arrayBuffer();let o;try{o=ce.ungzip(new Uint8Array(a),{to:"string"})}catch{o=new TextDecoder().decode(a)}const n=JSON.parse(o);if(!n.meta)return t.errors.push("Structure de sauvegarde invalide: m√©tadonn√©es manquantes"),t;t.version=n.meta.version||"1.0",t.dateExport=n.meta.exportDate||"",t.centresCount=((r=n.meta.centresInclus)==null?void 0:r.length)||0,t.recordsCount=n.meta.totalRecords||0;const d=6,u=n.meta.dbVersion||1;if(t.compatible=u<=d,t.compatible||t.errors.push(`Version de base de donn√©es incompatible (backup: ${u}, actuelle: ${d})`),n.meta.checksum){const p=await Be(JSON.stringify(n.data));t.integrityCheck=p===n.meta.checksum,t.integrityCheck||t.warnings.push("Le checksum ne correspond pas - les donn√©es peuvent avoir √©t√© modifi√©es")}else t.integrityCheck=!0,t.warnings.push("Pas de checksum dans la sauvegarde - impossible de v√©rifier l'int√©grit√©");n.data||t.errors.push("Aucune donn√©e trouv√©e dans la sauvegarde"),t.isValid=t.errors.length===0&&t.compatible}catch(a){t.errors.push(`Erreur de lecture du fichier: ${a}`)}return t},restoreBackup:async(e,t)=>{var o;const r=Date.now(),a={success:!1,message:"",enregistrementsRestaures:0,enregistrementsIgnores:0,conflitsResolus:0,erreurs:[],dureeMs:0};try{const n=await s().validateBackup(e);if(!n.isValid)return a.erreurs=n.errors,a.message="Validation √©chou√©e",a;t.creerSauvegardeAvant&&await s().createBackup("download");const d=await e.arrayBuffer();let u;try{u=ce.ungzip(new Uint8Array(d),{to:"string"})}catch{u=new TextDecoder().decode(d)}const p=JSON.parse(u);if(t.mode==="complet")await ji(p.data),a.enregistrementsRestaures=p.meta.totalRecords;else return a.message="Mode fusion non encore impl√©ment√©",a.erreurs.push("Mode fusion non support√© dans cette version"),a;const g={id:crypto.randomUUID(),date:new Date().toISOString(),type:"manuel",cible:"download",tailleMo:0,centresInclus:((o=p.meta.centresInclus)==null?void 0:o.length)||0,enregistrements:a.enregistrementsRestaures,statut:"succes",checksum:p.meta.checksum||""};await l.backupHistory.add(g),a.success=!0,a.message=`Restauration r√©ussie: ${a.enregistrementsRestaures} enregistrements restaur√©s`,a.dureeMs=Date.now()-r}catch(n){a.erreurs.push(String(n)),a.message=`Erreur de restauration: ${n}`}return a.dureeMs=Date.now()-r,a},deleteBackupEntry:async e=>{try{await l.backupHistory.delete(e),await s().loadHistory()}catch(t){i({error:String(t)})}},setAutoBackupConfig:async e=>{const t={...s().autoBackupConfig,...e};i({autoBackupConfig:t})},calculateStorageStats:async()=>{const e={totalUtilise:0,limiteEstimee:524288e3,parCategorie:{documents:0,donneesM√©tier:0,historiqueImports:0,sauvegardesLocales:0},documentsVolumineux:[]};try{const t=await l.centres.toArray(),r=await l.documents.toArray(),a=await l.fichiersImport.toArray(),o=await l.backupHistory.toArray(),n=JSON.stringify(t).length,d=r.reduce((g,A)=>{const h=A.contenu?A.contenu.length*.75:0;return g+h},0),u=JSON.stringify(a).length,p=JSON.stringify(o).length;e.parCategorie.donneesM√©tier=n,e.parCategorie.documents=d,e.parCategorie.historiqueImports=u,e.parCategorie.sauvegardesLocales=p,e.totalUtilise=n+d+u+p,e.documentsVolumineux=r.filter(g=>g.taille&&g.taille>1024*1024).map(g=>({id:g.id,nom:g.nom,taille:g.taille||0,categorie:g.categorie,dateAjout:g.dateAjout})).sort((g,A)=>A.taille-g.taille).slice(0,10)}catch{}return i({storageStats:e}),e},cleanOldBackups:async e=>{const{history:t}=s(),r=t.slice(e);let a=0;for(const o of r)try{await l.backupHistory.delete(o.id),a++}catch{}return await s().loadHistory(),a}}),{name:"cockpit-backup-store",partialize:i=>({autoBackupConfig:i.autoBackupConfig})}));async function Di(i){const s={};return s.centres=i?await l.centres.where("id").anyOf(i).toArray():await l.centres.toArray(),s.postes=await l.postes.toArray(),s.membresEquipe=await l.membresEquipe.toArray(),s.axes=await l.axes.toArray(),s.objectifs=await l.objectifs.toArray(),s.mesures=await l.mesures.toArray(),s.actions=await l.actions.toArray(),s.reunions=await l.reunions.toArray(),s.livrables=await l.livrables.toArray(),s.evaluations=await l.evaluations.toArray(),s.audits=await l.audits.toArray(),s.risques=await l.risques.toArray(),s.alertes=await l.alertes.toArray(),s.parametres=await l.parametres.toArray(),s.fichiersImport=await l.fichiersImport.toArray(),s.dossiersImport=await l.dossiersImport.toArray(),s.etatsLocatifs=await l.etatsLocatifs.toArray(),s.donneesLoyers=await l.donneesLoyers.toArray(),s.donneesFrequentation=await l.donneesFrequentation.toArray(),s.donneesChiffreAffaires=await l.donneesChiffreAffaires.toArray(),s.donneesCharges=await l.donneesCharges.toArray(),s.donneesBaux=await l.donneesBaux.toArray(),s.donneesTravaux=await l.donneesTravaux.toArray(),s.donneesValorisation=await l.donneesValorisation.toArray(),s.donneesEnergie=await l.donneesEnergie.toArray(),s.donneesSatisfaction=await l.donneesSatisfaction.toArray(),s.typesRapport=await l.typesRapport.toArray(),s.packsRapport=await l.packsRapport.toArray(),s.rapports=await l.rapports.toArray(),s.modelesRapport=await l.modelesRapport.toArray(),s.resultatsKPI=await l.resultatsKPI.toArray(),s.insights=await l.insights.toArray(),s.reglesAlerte=await l.reglesAlerte.toArray(),s.alertesGenerees=await l.alertesGenerees.toArray(),s.tendancesPrediction=await l.tendancesPrediction.toArray(),s.benchmarks=await l.benchmarks.toArray(),s.configurationsBI=await l.configurationsBI.toArray(),s.projets=await l.projets.toArray(),s.phasesProjet=await l.phasesProjet.toArray(),s.jalons=await l.jalons.toArray(),s.vaguesRecrutement=await l.vaguesRecrutement.toArray(),s.postesARecruter=await l.postesARecruter.toArray(),s.prospectsCommerciaux=await l.prospectsCommerciaux.toArray(),s.suiviBEFA=await l.suiviBEFA.toArray(),s.reserves=await l.reserves.toArray(),s.documentsDOE=await l.documentsDOE.toArray(),s.risquesProjet=await l.risquesProjet.toArray(),s.actionsCommunication=await l.actionsCommunication.toArray(),s.evenementsLancement=await l.evenementsLancement.toArray(),s.phasesHandover=await l.phasesHandover.toArray(),s.jalonsCommerciaux=await l.jalonsCommerciaux.toArray(),s.userProfile=await l.userProfile.toArray(),s.journalModifications=await l.journalModifications.toArray(),s.periodesCloturees=await l.periodesCloturees.toArray(),s.documents=await l.documents.toArray(),s.mappingHistory=await l.mappingHistory.toArray(),s}async function ji(i){await l.transaction("rw",l.tables,async()=>{for(const s of l.tables)await s.clear();for(const[s,e]of Object.entries(i))if(Array.isArray(e)&&e.length>0){const t=l.table(s);t&&await t.bulkAdd(e)}})}async function Be(i){const e=new TextEncoder().encode(i),t=await crypto.subtle.digest("SHA-256",e);return"sha256:"+Array.from(new Uint8Array(t)).map(a=>a.toString(16).padStart(2,"0")).join("")}function Li(i,s){const e=URL.createObjectURL(i),t=document.createElement("a");t.href=e,t.download=s,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}const ki={clotureAutomatiqueActive:!0,jourClotureAuto:15,notifierAvantCloture:!0,joursNotificationAvance:3,permettreDeverrouillage:!0,justificationObligatoire:!0},wo=q((i,s)=>({entries:[],periodesCloturees:[],clotureConfig:ki,isLoading:!1,error:null,loadEntries:async(e={})=>{i({isLoading:!0,error:null});try{let a=await l.journalModifications.orderBy("date").reverse().toArray();if(e.dateDebut&&(a=a.filter(o=>o.date>=e.dateDebut)),e.dateFin&&(a=a.filter(o=>o.date<=e.dateFin)),e.actions&&e.actions.length>0&&(a=a.filter(o=>e.actions.includes(o.action))),e.tables&&e.tables.length>0&&(a=a.filter(o=>e.tables.includes(o.table))),e.centreId&&(a=a.filter(o=>o.details.centreId===e.centreId)),e.avecErreurs&&(a=a.filter(o=>o.erreurs&&o.erreurs.length>0)),e.recherche){const o=e.recherche.toLowerCase();a=a.filter(n=>{var d;return n.table.toLowerCase().includes(o)||n.action.toLowerCase().includes(o)||((d=n.details.fichierSource)==null?void 0:d.toLowerCase().includes(o))})}i({entries:a,isLoading:!1})}catch(t){i({error:String(t),isLoading:!1})}},addEntry:async e=>{const t=crypto.randomUUID(),r={...e,id:t,createdAt:new Date().toISOString()};try{await l.journalModifications.add(r);const a=await l.journalModifications.orderBy("date").reverse().limit(100).toArray();return i({entries:a}),t}catch(a){throw a}},loadPeriodesCloturees:async e=>{try{const t=await l.periodesCloturees.where("centreId").equals(e).toArray();i({periodesCloturees:t})}catch{}},cloturerPeriode:async(e,t,r,a)=>{try{if(await l.periodesCloturees.where("[centreId+annee+mois]").equals([e,t,r]).first())return!1;const n=["mesures","donneesLoyers","donneesFrequentation","donneesChiffreAffaires","donneesCharges"],u={id:crypto.randomUUID(),centreId:e,annee:t,mois:r,dateCloture:new Date().toISOString(),clotureParAuto:!1,utilisateur:"Utilisateur",justification:a,donnees:{tables:n,enregistrements:0},deverrouillages:[]};return await l.periodesCloturees.add(u),await s().addEntry({date:new Date().toISOString(),action:"cloture",table:"periodesCloturees",enregistrementsAffectes:1,utilisateur:"Utilisateur",details:{periode:`${t}-${String(r).padStart(2,"0")}`,centreId:e,motifCloture:a}}),await s().loadPeriodesCloturees(e),!0}catch{return!1}},deverrouillerPeriode:async(e,t,r)=>{const{clotureConfig:a}=s();if(!a.permettreDeverrouillage)return!1;try{const o=await l.periodesCloturees.get(e);return o?(o.deverrouillages.push({date:new Date().toISOString(),utilisateur:"Utilisateur",justification:t,dureeHeures:r}),await l.periodesCloturees.put(o),await s().addEntry({date:new Date().toISOString(),action:"modification",table:"periodesCloturees",enregistrementsAffectes:1,utilisateur:"Utilisateur",details:{entiteId:e,champModifie:"deverrouillages",justification:t}}),!0):!1}catch{return!1}},isPeriodeCloturee:(e,t,r)=>{const{periodesCloturees:a}=s();return a.some(o=>o.centreId===e&&o.annee===t&&o.mois===r)},getStats:async(e={})=>{var n,d,u,p;const{entries:t}=s(),r={periodeDebut:((n=t[t.length-1])==null?void 0:n.date)||"",periodeFin:((d=t[0])==null?void 0:d.date)||"",totalEntrees:t.length,parAction:{import:0,modification:0,suppression:0,creation:0,cloture:0,validation:0,annulation:0,restauration:0},parTable:{},erreursTotales:0,avertissementsTotaux:0,scoreQualiteMoyen:0};let a=0,o=0;for(const g of t)r.parAction[g.action]=(r.parAction[g.action]||0)+1,r.parTable[g.table]=(r.parTable[g.table]||0)+1,r.erreursTotales+=((u=g.erreurs)==null?void 0:u.length)||0,r.avertissementsTotaux+=((p=g.avertissements)==null?void 0:p.length)||0,g.scoreQualite!==void 0&&(a+=g.scoreQualite,o++);return o>0&&(r.scoreQualiteMoyen=a/o),r},setClotureConfig:e=>{i({clotureConfig:{...s().clotureConfig,...e}})},logImport:async(e,t,r,a,o,n)=>{await s().addEntry({date:new Date().toISOString(),action:"import",table:t,enregistrementsAffectes:a,utilisateur:"Utilisateur",details:{fichierSource:r,typeImport:t,centreId:e},scoreQualite:n,erreurs:o.length>0?o:void 0})},logModification:async(e,t,r,a,o,n,d)=>{await s().addEntry({date:new Date().toISOString(),action:"modification",table:t,enregistrementsAffectes:1,utilisateur:"Utilisateur",details:{centreId:e,entiteId:r,entiteType:t,champModifie:a,ancienneValeur:o,nouvelleValeur:n,justification:d}})},logSuppression:async(e,t,r,a)=>{await s().addEntry({date:new Date().toISOString(),action:"suppression",table:t,enregistrementsAffectes:1,utilisateur:"Utilisateur",details:{centreId:e,entiteId:r,entiteType:t,justification:a}})}}));async function qi(){const i=crypto.getRandomValues(new Uint8Array(16));return nt(i)}async function ot(i,s){const t=new TextEncoder().encode(i),r=Fi(s),a=await crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits"]),o=await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},a,256);return nt(new Uint8Array(o))}async function Mi(i,s,e){return await ot(i,e)===s}function nt(i){return Array.from(i).map(s=>s.toString(16).padStart(2,"0")).join("")}function Fi(i){const s=new Uint8Array(i.length/2);for(let e=0;e<i.length;e+=2)s[e/2]=parseInt(i.substr(e,2),16);return s}const Ui=24*60*60*1e3,se=q()(W((i,s)=>({session:{isAuthenticated:!1,userId:null,email:null,loginAt:null,rememberMe:!1,expiresAt:void 0},isLoading:!1,error:null,isInitialized:!1,needsSetup:!1,initialize:async()=>{i({isLoading:!0,error:null});try{const t=(await l.authCredentials.toArray()).length===0,{session:r}=s();let a=!1;r.isAuthenticated&&!t&&(r.rememberMe?a=!0:r.expiresAt&&(a=new Date(r.expiresAt)>new Date)),!a&&r.isAuthenticated&&i({session:{isAuthenticated:!1,userId:null,email:null,loginAt:null,rememberMe:!1,expiresAt:void 0}}),i({isLoading:!1,isInitialized:!0,needsSetup:t})}catch(e){i({isLoading:!1,error:String(e),isInitialized:!0,needsSetup:!0})}},login:async e=>{i({isLoading:!0,error:null});try{const t=await l.authCredentials.where("email").equals(e.email.toLowerCase().trim()).first();if(!t)return i({isLoading:!1,error:"Email ou mot de passe incorrect"}),!1;if(!await Mi(e.password,t.passwordHash,t.salt))return i({isLoading:!1,error:"Email ou mot de passe incorrect"}),!1;await l.authCredentials.update(t.id,{lastLoginAt:new Date().toISOString()});const a=new Date,o={isAuthenticated:!0,userId:t.id,email:t.email,loginAt:a.toISOString(),rememberMe:e.rememberMe,expiresAt:e.rememberMe?void 0:new Date(a.getTime()+Ui).toISOString()};return i({session:o,isLoading:!1,error:null}),!0}catch{return i({isLoading:!1,error:"Erreur de connexion"}),!1}},logout:()=>{i({session:{isAuthenticated:!1,userId:null,email:null,loginAt:null,rememberMe:!1,expiresAt:void 0},error:null})},setupAccount:async e=>{i({isLoading:!0,error:null});try{if(e.password!==e.confirmPassword)return i({isLoading:!1,error:"Les mots de passe ne correspondent pas"}),!1;if(e.password.length<6)return i({isLoading:!1,error:"Le mot de passe doit contenir au moins 6 caracteres"}),!1;const t=await qi(),r=await ot(e.password,t),a={id:crypto.randomUUID(),email:e.email.toLowerCase().trim(),passwordHash:r,salt:t,createdAt:new Date().toISOString()};await l.authCredentials.add(a);const o={isAuthenticated:!0,userId:a.id,email:a.email,loginAt:new Date().toISOString(),rememberMe:!0,expiresAt:void 0};return i({session:o,isLoading:!1,needsSetup:!1,error:null}),!0}catch{return i({isLoading:!1,error:"Erreur lors de la creation du compte"}),!1}},checkSession:()=>{const{session:e}=s();return e.isAuthenticated?e.rememberMe?!0:e.expiresAt?new Date(e.expiresAt)>new Date:!1:!1},clearError:()=>i({error:null})}),{name:"cockpit-auth-store",partialize:i=>({session:i.session})}));function Bi(){const i=se.getState();i.isInitialized||i.initialize()}function Vi(){const{sidebarOpen:i,toggleSidebar:s,currentCentreId:e}=ie(),t=Q(b=>e?b.getCentre(e):null),r=[{path:"/",label:"Tableau de bord",icon:c.jsx(Oe,{className:"w-5 h-5"})},{path:"/actions-consolidees",label:"Plan d'action",icon:c.jsx(Ne,{className:"w-5 h-5"})},{path:"/centres",label:"Centres",icon:c.jsx(fe,{className:"w-5 h-5"})}],a=(t==null?void 0:t.statut)==="actif"||(t==null?void 0:t.statut)==="en_construction"&&(t==null?void 0:t.modeExploitationActif),o=e&&a?[{path:`/centre/${e}`,label:"Vue Centre",icon:c.jsx(Oe,{className:"w-5 h-5"})},{path:`/centre/${e}/pilotage`,label:"Pilotage",icon:c.jsx(Te,{className:"w-5 h-5"})},{path:`/centre/${e}/actions`,label:"Plans d'actions",icon:c.jsx(Ne,{className:"w-5 h-5"})},{path:`/centre/${e}/agenda`,label:"Agenda",icon:c.jsx(Dt,{className:"w-5 h-5"})},{path:`/centre/${e}/reporting`,label:"Reporting",icon:c.jsx(Ye,{className:"w-5 h-5"})},{path:`/centre/${e}/equipe`,label:"√âquipe",icon:c.jsx(jt,{className:"w-5 h-5"})},{path:`/centre/${e}/conformite`,label:"Conformit√©",icon:c.jsx(Ke,{className:"w-5 h-5"})},{path:`/centre/${e}/import`,label:"Import donn√©es",icon:c.jsx(Se,{className:"w-5 h-5"})}]:[],n=e?[{path:`/centre/${e}/bi/import`,label:"Import donn√©es",icon:c.jsx(Lt,{className:"w-5 h-5"})},{path:`/centre/${e}/bi/catalogue`,label:"Catalogue BI",icon:c.jsx(kt,{className:"w-5 h-5"})},{path:`/centre/${e}/bi/analyse`,label:"Analyse",icon:c.jsx(qt,{className:"w-5 h-5"})},{path:`/centre/${e}/bi/rapports`,label:"Rapport Studio",icon:c.jsx(Mt,{className:"w-5 h-5"})}]:[],d=e&&(t==null?void 0:t.statut)==="en_construction"?{path:`/centre/${e}/projet`,label:"Mode Projet",icon:c.jsx(Re,{className:"w-5 h-5"})}:null,u=e&&(t==null?void 0:t.statut)==="en_construction"?[{path:`/centre/${e}/projet/jalons`,label:"Jalons",icon:c.jsx(Ct,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/recrutement`,label:"Recrutement",icon:c.jsx(ze,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/commercial`,label:"Commercial",icon:c.jsx(St,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/handover`,label:"Handover",icon:c.jsx(Rt,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/budget`,label:"Budget",icon:c.jsx(Tt,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/risques`,label:"Risques",icon:c.jsx(ne,{className:"w-4 h-4"})},{path:`/centre/${e}/projet/synchronisation`,label:"Synchro",icon:c.jsx(Ot,{className:"w-4 h-4"})},{path:`/centre/${e}/import`,label:"Import",icon:c.jsx(Se,{className:"w-4 h-4"})}]:[],p=(t==null?void 0:t.statut)==="en_construction"&&(t==null?void 0:t.modeExploitationActif),g=[{path:"/templates",label:"Templates Import",icon:c.jsx(Pt,{className:"w-5 h-5"})},{path:"/templates-email",label:"Templates Email",icon:c.jsx(Ge,{className:"w-5 h-5"})},{path:"/journal",label:"Journal",icon:c.jsx(_t,{className:"w-5 h-5"})}],A=[{path:"/parametres",label:"Param√®tres",icon:c.jsx(Ft,{className:"w-5 h-5"})}],h=({item:b})=>{const S=oe().pathname===b.path;return c.jsxs(we,{to:b.path,className:`flex items-center gap-3 px-4 py-3 text-sm transition-colors relative ${S?"bg-primary-100 dark:bg-primary-800 text-primary-900 dark:text-primary-100 font-medium border-r-2 border-primary-900 dark:border-primary-400":"text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-800"}`,children:[b.icon,i&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"flex-1",children:b.label}),b.badge!==void 0&&b.badge>0&&c.jsx("span",{className:"bg-error text-white text-xs px-2 py-0.5 rounded-full",children:b.badge>99?"99+":b.badge})]})]})};return c.jsxs("aside",{className:`fixed left-0 top-0 h-screen bg-white dark:bg-primary-900 border-r border-primary-200 dark:border-primary-700 flex flex-col z-40 transition-all duration-300 ${i?"w-64":"w-16"}`,children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-primary-200 dark:border-primary-700",children:[i&&c.jsx("span",{className:"font-display text-2xl text-primary-900 dark:text-primary-100",children:"Cockpit"}),c.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors",children:c.jsx(Nt,{className:`w-5 h-5 text-primary-500 dark:text-primary-400 transition-transform ${i?"":"rotate-180"}`})})]}),c.jsxs("nav",{className:"flex-1 py-4 overflow-y-auto",children:[c.jsx("div",{className:"space-y-1",children:r.map(b=>c.jsx(h,{item:b},b.path))}),c.jsxs("div",{className:"my-4 px-4",children:[c.jsx("div",{className:"border-t border-primary-200 dark:border-primary-700"}),i&&c.jsx("p",{className:"text-xs text-primary-500 dark:text-primary-400 mt-4 mb-2 font-medium uppercase tracking-wider",children:"Outils"})]}),c.jsx("div",{className:"space-y-1",children:g.map(b=>c.jsx(h,{item:b},b.path))}),e&&t&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"my-4 px-4",children:[c.jsx("div",{className:"border-t border-primary-200 dark:border-primary-700"}),i&&c.jsx("p",{className:"text-xs text-primary-500 dark:text-primary-400 mt-4 mb-2 font-medium uppercase tracking-wider",children:t.code})]}),d&&c.jsxs(c.Fragment,{children:[i&&c.jsx("div",{className:"px-4 mb-2",children:c.jsxs("p",{className:`text-xs font-medium uppercase tracking-wider flex items-center gap-1 ${p?"text-warning":"text-info"}`,children:[c.jsx(Re,{className:"w-3 h-3"}),p?"Transition":"Lancement"]})}),c.jsx("div",{className:"space-y-1",children:c.jsx(h,{item:d})}),u.length>0&&i&&c.jsx("div",{className:"ml-4 mt-1 space-y-0.5 border-l-2 border-primary-200 dark:border-primary-700",children:u.map(b=>c.jsxs(we,{to:b.path,className:({isActive:f})=>`flex items-center gap-2 px-3 py-2 text-xs transition-colors ${f?"text-info font-medium bg-info/5 border-l-2 border-info -ml-[2px]":"text-primary-500 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-200 hover:bg-primary-50 dark:hover:bg-primary-800"}`,children:[b.icon,c.jsx("span",{children:b.label})]},b.path))})]}),o.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"my-4 px-4",children:[c.jsx("div",{className:"border-t border-primary-200 dark:border-primary-700"}),i&&c.jsxs("p",{className:"text-xs text-success mt-4 mb-2 font-medium uppercase tracking-wider flex items-center gap-1",children:[c.jsx(Te,{className:"w-3 h-3"}),"Exploitation"]})]}),c.jsx("div",{className:"space-y-1",children:o.map(b=>c.jsx(h,{item:b},b.path))})]}),n.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"my-4 px-4",children:[c.jsx("div",{className:"border-t border-primary-200 dark:border-primary-700"}),i&&c.jsxs("p",{className:"text-xs text-info mt-4 mb-2 font-medium uppercase tracking-wider flex items-center gap-1",children:[c.jsx(He,{className:"w-3 h-3"}),"Business Intelligence"]})]}),c.jsx("div",{className:"space-y-1",children:n.map(b=>c.jsx(h,{item:b},b.path))})]})]})]}),c.jsx("div",{className:"border-t border-primary-200 dark:border-primary-700 py-4",children:c.jsx("div",{className:"space-y-1",children:A.map(b=>c.jsx(h,{item:b},b.path))})})]})}function $i(){var L;const i=oe(),s=$e(),{centreId:e}=ht(),{theme:t,setTheme:r,currentCentreId:a,setCurrentCentre:o}=ie(),n=et(w=>w.getAlertesNonLues().length),d=Q(w=>w.centres),{session:u,logout:p}=se(),g=Q(w=>a?w.getCentre(a):null),[A,h]=C.useState(!1),b=C.useRef(null);C.useEffect(()=>{function w(R){b.current&&!b.current.contains(R.target)&&h(!1)}return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);const f=w=>{o(w),h(!1);const R=i.pathname.split("/"),j=R.indexOf("centre");j!==-1&&R[j+1]?(R[j+1]=w,s(R.join("/"))):s(`/centre/${w}`)},S=()=>{r(t==="light"?"dark":"light")},T=()=>{p(),s("/login",{replace:!0})},D=(()=>{const w=i.pathname.split("/").filter(Boolean),R=[{label:"Accueil",path:"/"}];let j="";return w.forEach(k=>{j+=`/${k}`,k==="centres"?R.push({label:"Centres",path:"/centres"}):k==="centre"&&g||(g&&k===a?R.push({label:g.nom,path:`/centre/${a}`}):k==="pilotage"?R.push({label:"Pilotage",path:j}):k==="actions"?R.push({label:"Plans d'actions",path:j}):k==="agenda"?R.push({label:"Agenda",path:j}):k==="reporting"?R.push({label:"Reporting",path:j}):k==="equipe"?R.push({label:"√âquipe",path:j}):k==="conformite"?R.push({label:"Conformit√©",path:j}):k==="parametres"?R.push({label:"Param√®tres",path:"/parametres"}):k==="alertes"&&R.push({label:"Alertes",path:"/alertes"}))}),R})(),v=i.pathname.includes("/centre/");return c.jsxs("header",{className:"h-16 bg-white dark:bg-primary-900 border-b border-primary-200 dark:border-primary-700 flex items-center justify-between px-6 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("nav",{className:"flex items-center gap-2 text-sm",children:D.map((w,R)=>c.jsxs(yt.Fragment,{children:[R>0&&c.jsx(Ut,{className:"w-4 h-4 text-primary-400"}),c.jsx("button",{onClick:()=>s(w.path),className:`hover:text-primary-900 dark:hover:text-primary-100 transition-colors ${R===D.length-1?"text-primary-900 dark:text-primary-100 font-medium":"text-primary-500 dark:text-primary-400"}`,children:w.label})]},w.path))}),v&&d.length>1&&c.jsxs("div",{className:"relative",ref:b,children:[c.jsxs("button",{onClick:()=>h(!A),className:"flex items-center gap-2 px-3 py-1.5 bg-primary-100 hover:bg-primary-200 rounded-lg transition-colors",children:[c.jsx(fe,{className:"w-4 h-4 text-primary-600"}),c.jsx("span",{className:"text-sm font-medium text-primary-700 max-w-[150px] truncate",children:(g==null?void 0:g.nom)||"S√©lectionner"}),c.jsx(Je,{className:`w-4 h-4 text-primary-500 transition-transform ${A?"rotate-180":""}`})]}),A&&c.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white rounded-lg shadow-lg border border-primary-200 py-1 z-50 max-h-80 overflow-y-auto",children:[c.jsx("div",{className:"px-3 py-2 border-b border-primary-100",children:c.jsx("p",{className:"text-xs font-medium text-primary-500 uppercase tracking-wide",children:"Changer de centre"})}),d.map(w=>c.jsxs("button",{onClick:()=>f(w.id),className:`w-full flex items-center gap-3 px-3 py-2 hover:bg-primary-50 transition-colors ${w.id===a?"bg-primary-50":""}`,children:[c.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${w.statut==="actif"?"bg-success/10":w.statut==="en_construction"?"bg-warning/10":"bg-primary-100"}`,children:c.jsx(fe,{className:`w-4 h-4 ${w.statut==="actif"?"text-success":w.statut==="en_construction"?"text-warning":"text-primary-400"}`})}),c.jsxs("div",{className:"flex-1 text-left",children:[c.jsx("p",{className:"text-sm font-medium text-primary-900 truncate",children:w.nom}),c.jsx("p",{className:"text-xs text-primary-500",children:w.ville})]}),w.id===a&&c.jsx(Bt,{className:"w-4 h-4 text-success"})]},w.id)),c.jsx("div",{className:"border-t border-primary-100 mt-1 pt-1",children:c.jsx("button",{onClick:()=>{h(!1),s("/centres")},className:"w-full px-3 py-2 text-sm text-primary-600 hover:bg-primary-50 text-left transition-colors",children:"Voir tous les centres ‚Üí"})})]})]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx(Vt,{className:"w-4 h-4 text-primary-400 absolute left-3 top-1/2 -translate-y-1/2"}),c.jsx("input",{type:"text",placeholder:"Rechercher...",className:"pl-9 pr-4 py-2 w-64 bg-primary-50 dark:bg-primary-800 border border-primary-200 dark:border-primary-700 rounded-btn text-sm text-primary-900 dark:text-primary-100 placeholder:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-900/10 dark:focus:ring-primary-500/20 transition-colors"})]}),c.jsx("button",{onClick:S,className:"p-2 rounded-lg hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors",title:t==="light"?"Mode sombre":"Mode clair",children:t==="light"?c.jsx($t,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}):c.jsx(zt,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),c.jsxs("button",{onClick:()=>s("/alertes"),className:"p-2 rounded-lg hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors relative",title:"Alertes",children:[c.jsx(Ht,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),n>0&&c.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-error rounded-full"})]}),c.jsx("button",{onClick:()=>s("/notifications"),className:"p-2 rounded-lg hover:bg-primary-100 dark:hover:bg-primary-800 transition-colors",title:"Notifications",children:c.jsx(Gt,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),c.jsxs("button",{onClick:()=>s("/profil"),className:"flex items-center gap-3 pl-4 border-l border-primary-200 dark:border-primary-700 hover:bg-primary-50 dark:hover:bg-primary-800 rounded-lg pr-2 py-1 transition-colors",title:"Mon Profil",children:[c.jsx("div",{className:"w-8 h-8 bg-primary-200 dark:bg-primary-700 rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-primary-700 dark:text-primary-200 font-medium text-sm",children:((L=u.email)==null?void 0:L.charAt(0).toUpperCase())||"U"})}),c.jsxs("div",{className:"hidden md:block text-left",children:[c.jsx("p",{className:"text-sm font-medium text-primary-900 dark:text-primary-100 max-w-[120px] truncate",children:u.email||"Utilisateur"}),c.jsx("p",{className:"text-xs text-primary-500 dark:text-primary-400",children:"Connecte"})]})]}),c.jsx("button",{onClick:T,className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors group",title:"Deconnexion",children:c.jsx(Yt,{className:"w-5 h-5 text-primary-500 group-hover:text-red-600 dark:text-primary-400 dark:group-hover:text-red-400 transition-colors"})})]})]})}function zi(){const{toasts:i,removeToast:s}=ie();return c.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:i.map(e=>c.jsx(Hi,{toast:e,onClose:()=>s(e.id)},e.id))})}function Hi({toast:i,onClose:s}){C.useEffect(()=>{const r=i.duration||5e3,a=setTimeout(s,r);return()=>clearTimeout(a)},[i.duration,s]);const e={success:c.jsx(We,{className:"w-5 h-5 text-success"}),error:c.jsx(Qe,{className:"w-5 h-5 text-error"}),warning:c.jsx(ne,{className:"w-5 h-5 text-warning"}),info:c.jsx(Xe,{className:"w-5 h-5 text-info"})},t={success:"bg-success/10 border-success/20",error:"bg-error/10 border-error/20",warning:"bg-warning/10 border-warning/20",info:"bg-info/10 border-info/20"};return c.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-card border shadow-lg min-w-[300px] max-w-md animate-slide-in ${t[i.type]}`,style:{animation:"slideIn 0.3s ease-out"},children:[e[i.type],c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-medium text-primary-900",children:i.title}),i.message&&c.jsx("p",{className:"text-sm text-primary-600 mt-1",children:i.message})]}),c.jsx("button",{onClick:s,className:"p-1 hover:bg-primary-200 rounded-full transition-colors",children:c.jsx(Ae,{className:"w-4 h-4 text-primary-500"})})]})}const ct={openrouter:"https://openrouter.ai/api/v1/chat/completions",claude:"https://api.anthropic.com/v1/messages"},lt=[{id:"meta-llama/llama-3.2-3b-instruct:free",name:"Llama 3.2 3B",provider:"Meta",description:"Compact et rapide",contextLength:131072,free:!0},{id:"meta-llama/llama-3.1-8b-instruct:free",name:"Llama 3.1 8B",provider:"Meta",description:"Excellent √©quilibre",contextLength:131072,free:!0},{id:"google/gemma-2-9b-it:free",name:"Gemma 2 9B",provider:"Google",description:"Performant pour l'analyse",contextLength:8192,free:!0},{id:"mistralai/mistral-7b-instruct:free",name:"Mistral 7B",provider:"Mistral AI",description:"Mod√®le fran√ßais performant",contextLength:32768,free:!0},{id:"qwen/qwen-2-7b-instruct:free",name:"Qwen 2 7B",provider:"Alibaba",description:"Bon pour l'analyse",contextLength:32768,free:!0},{id:"microsoft/phi-3-mini-128k-instruct:free",name:"Phi-3 Mini",provider:"Microsoft",description:"Petit mais puissant",contextLength:128e3,free:!0}],dt=[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",provider:"Anthropic",description:"Meilleur rapport qualit√©/prix, tr√®s intelligent",contextLength:2e5,free:!1},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",provider:"Anthropic",description:"Rapide et √©conomique",contextLength:2e5,free:!1},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",provider:"Anthropic",description:"Le plus puissant, id√©al pour t√¢ches complexes",contextLength:2e5,free:!1}];[...lt.map(i=>({...i,apiProvider:"openrouter"})),...dt.map(i=>({...i,apiProvider:"claude"}))];async function Gi(i,s,e,t){var r,a,o;try{const n=await fetch(ct.openrouter,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,"HTTP-Referer":window.location.origin,"X-Title":"Cockpit - Pilotage Strat√©gique"},body:JSON.stringify({model:s,messages:e,temperature:(t==null?void 0:t.temperature)??.7,max_tokens:(t==null?void 0:t.maxTokens)??2048})});if(!n.ok)return{success:!1,error:((r=(await n.json().catch(()=>({}))).error)==null?void 0:r.message)||`Erreur API OpenRouter: ${n.status}`};const d=await n.json();return{success:!0,content:((o=(a=d.choices[0])==null?void 0:a.message)==null?void 0:o.content)||"",model:s,tokens:d.usage?{prompt:d.usage.prompt_tokens,completion:d.usage.completion_tokens,total:d.usage.total_tokens}:void 0}}catch(n){return{success:!1,error:n.message||"Erreur de connexion √† OpenRouter"}}}async function Yi(i,s,e,t){var r,a;try{const o=e.find(p=>p.role==="system"),n=e.filter(p=>p.role!=="system"),d=await fetch(ct.claude,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:s,max_tokens:(t==null?void 0:t.maxTokens)??2048,temperature:(t==null?void 0:t.temperature)??.7,system:(o==null?void 0:o.content)||"",messages:n.map(p=>({role:p.role,content:p.content}))})});if(!d.ok)return{success:!1,error:((r=(await d.json().catch(()=>({}))).error)==null?void 0:r.message)||`Erreur API Claude: ${d.status}`};const u=await d.json();return{success:!0,content:((a=u.content[0])==null?void 0:a.text)||"",model:s,tokens:u.usage?{prompt:u.usage.input_tokens,completion:u.usage.output_tokens,total:u.usage.input_tokens+u.usage.output_tokens}:void 0}}catch(o){return{success:!1,error:o.message||"Erreur de connexion √† Claude"}}}async function ut(i,s,e,t,r){return s?i==="claude"?Yi(s,e,t,r):Gi(s,e,t,r):{success:!1,error:`Cl√© API ${i==="claude"?"Claude":"OpenRouter"} non configur√©e`}}async function Co(i,s){return(await ut(i,s,i==="claude"?"claude-3-5-haiku-20241022":"meta-llama/llama-3.2-3b-instruct:free",[{role:"user",content:"Test"}],{maxTokens:5})).success}const Ki=`Tu es un assistant IA expert en gestion de centres commerciaux et en analyse de donn√©es business.
Tu travailles pour l'application Cockpit, un outil de pilotage strat√©gique pour la gestion multi-centres.
Tu dois r√©pondre en fran√ßais de mani√®re professionnelle et concise.
Utilise des donn√©es chiffr√©es quand c'est pertinent et structure tes r√©ponses avec des titres et listes.`;async function Ve(i,s,e,t,r){const a=r?`
Contexte actuel:
- Centre s√©lectionn√©: ${r.centreName||"Aucun"}
- Page actuelle: ${r.currentPage||"Inconnue"}
${r.data?`- Donn√©es contextuelles: ${JSON.stringify(r.data)}`:""}
`:"",o=`${Ki}
${a}
R√©ponds aux questions de l'utilisateur de mani√®re utile et contextuelle.
Si tu n'as pas assez d'informations, demande des pr√©cisions.`;return ut(i,s,e,[{role:"system",content:o},...t])}const Ji=[{id:"analyze",label:"Analyser mes KPIs",icon:c.jsx(He,{className:"w-4 h-4"}),prompt:"Analyse les KPIs de mon centre commercial et donne-moi des recommandations pour am√©liorer la performance."},{id:"insights",label:"G√©n√©rer des insights",icon:c.jsx(Qt,{className:"w-4 h-4"}),prompt:"G√©n√®re des insights business √† partir de mes donn√©es de ventes et fr√©quentation. Identifie les tendances et opportunit√©s."},{id:"report",label:"Aide rapport",icon:c.jsx(Ye,{className:"w-4 h-4"}),prompt:"Aide-moi √† r√©diger un rapport de performance mensuel professionnel avec les sections cl√©s: synth√®se, KPIs, analyse, recommandations."},{id:"predict",label:"Pr√©dictions",icon:c.jsx(Wt,{className:"w-4 h-4"}),prompt:"Quelles sont les tendances et pr√©dictions pour les prochains mois ? Analyse les patterns saisonniers et donne des projections."}];function Xi(){const{config:i,conversations:s,isLoading:e,isPanelOpen:t,addMessage:r,clearConversations:a,setLoading:o,setError:n,setPanelOpen:d,recordUsage:u,getCurrentApiKey:p,getCurrentModel:g,isCurrentProviderConfigured:A}=wi(),{addToast:h}=ie(),[b,f]=C.useState(""),[S,T]=C.useState(!1),_=C.useRef(null),D=C.useRef(null);C.useEffect(()=>{var O;(O=_.current)==null||O.scrollIntoView({behavior:"smooth"})},[s]),C.useEffect(()=>{var O;t&&!S&&((O=D.current)==null||O.focus())},[t,S]);const v=A(),L=p(),w=g(),R=async()=>{var te,re;if(!b.trim()||e)return;if(!v){h({type:"warning",title:"Proph3et non configur√©",message:`Configurez votre cl√© API ${i.activeProvider==="claude"?"Claude":"OpenRouter"} dans les Param√®tres`});return}const O=b.trim();f(""),r({role:"user",content:O}),o(!0);try{const F=s.slice(-10).map(Ee=>({role:Ee.role,content:Ee.content}));F.push({role:"user",content:O});const U=await Ve(i.activeProvider,L,w,F,{centreName:"Centre actuel"});U.success&&U.content?(r({role:"assistant",content:U.content,model:w,tokens:(te=U.tokens)==null?void 0:te.total,provider:i.activeProvider}),(re=U.tokens)!=null&&re.total&&u(U.tokens.total,i.activeProvider)):(n(U.error||"Erreur inconnue"),h({type:"error",title:"Erreur Proph3et",message:U.error||"Impossible de g√©n√©rer une r√©ponse"}))}catch(F){const U=F;n(U.message),h({type:"error",title:"Erreur",message:U.message})}finally{o(!1)}},j=async O=>{var te,re;if(!v){h({type:"warning",title:"Proph3et non configur√©",message:`Configurez votre cl√© API ${i.activeProvider==="claude"?"Claude":"OpenRouter"} dans les Param√®tres`});return}r({role:"user",content:O.prompt}),o(!0);try{const F=await Ve(i.activeProvider,L,w,[{role:"user",content:O.prompt}],{centreName:"Centre actuel"});F.success&&F.content?(r({role:"assistant",content:F.content,model:w,tokens:(te=F.tokens)==null?void 0:te.total,provider:i.activeProvider}),(re=F.tokens)!=null&&re.total&&u(F.tokens.total,i.activeProvider)):h({type:"error",title:"Erreur Proph3et",message:F.error||"Impossible de g√©n√©rer une r√©ponse"})}catch(F){h({type:"error",title:"Erreur",message:F.message})}finally{o(!1)}},k=O=>{O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),R())},ee=[...lt,...dt].find(O=>O.id===w),X=i.activeProvider==="claude"?"orange":"purple";return t?c.jsxs("div",{className:`fixed bottom-6 right-6 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-primary-200 dark:border-gray-700 z-50 flex flex-col transition-all ${S?"w-80 h-14":"w-96 h-[600px]"}`,children:[c.jsxs("div",{className:`flex items-center justify-between px-4 py-3 bg-gradient-to-r ${i.activeProvider==="claude"?"from-orange-500 to-amber-600":"from-purple-600 to-blue-600"} text-white rounded-t-2xl cursor-pointer`,onClick:()=>S&&T(!1),children:[c.jsxs("div",{className:"flex items-center gap-2",children:[i.activeProvider==="claude"?c.jsx(le,{className:"w-5 h-5"}):c.jsx(de,{className:"w-5 h-5"}),c.jsx("span",{className:"text-xl",style:{fontFamily:"'Grand Hotel', cursive"},children:"Proph3et"}),ee&&c.jsx("span",{className:"text-xs bg-white/20 px-2 py-0.5 rounded-full",children:ee.name})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:O=>{O.stopPropagation(),T(!S)},className:"p-1 hover:bg-white/20 rounded transition-colors",children:S?c.jsx(Kt,{className:"w-4 h-4"}):c.jsx(Je,{className:"w-4 h-4"})}),c.jsx("button",{onClick:O=>{O.stopPropagation(),d(!1)},className:"p-1 hover:bg-white/20 rounded transition-colors",children:c.jsx(Ae,{className:"w-4 h-4"})})]})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.length===0?c.jsxs("div",{className:"text-center py-8",children:[i.activeProvider==="claude"?c.jsx(le,{className:"w-12 h-12 text-orange-300 mx-auto mb-4"}):c.jsx(de,{className:"w-12 h-12 text-purple-300 mx-auto mb-4"}),c.jsx("h3",{className:"text-2xl text-primary-900 dark:text-white mb-2",style:{fontFamily:"'Grand Hotel', cursive"},children:"Proph3et"}),c.jsx("p",{className:"font-medium text-primary-700 dark:text-gray-300 mb-1",children:"Comment puis-je vous aider ?"}),c.jsx("p",{className:"text-sm text-primary-500 dark:text-gray-400 mb-4",children:"Posez-moi des questions sur vos donn√©es, demandez des analyses ou de l'aide pour vos rapports."}),c.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:Ji.map(O=>c.jsxs("button",{onClick:()=>j(O),disabled:!v||e,className:`flex items-center gap-2 p-3 text-left text-sm bg-primary-50 dark:bg-gray-700 hover:bg-${X}-50 dark:hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,children:[c.jsx("span",{className:`text-${X}-600`,children:O.icon}),c.jsx("span",{className:"text-primary-700 dark:text-gray-200",children:O.label})]},O.id))}),!v&&c.jsxs("p",{className:"text-xs text-warning mt-4",children:["Configurez Proph3et (",i.activeProvider==="claude"?"Claude":"OpenRouter",") dans les Param√®tres."]})]}):c.jsxs(c.Fragment,{children:[s.map(O=>c.jsx("div",{className:`flex ${O.role==="user"?"justify-end":"justify-start"}`,children:c.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-2 ${O.role==="user"?i.activeProvider==="claude"?"bg-orange-500 text-white rounded-br-md":"bg-purple-600 text-white rounded-br-md":"bg-primary-100 dark:bg-gray-700 text-primary-900 dark:text-white rounded-bl-md"}`,children:[c.jsx("div",{className:"whitespace-pre-wrap text-sm",children:O.content}),O.role==="assistant"&&(O.tokens||O.provider)&&c.jsxs("div",{className:"text-xs opacity-60 mt-1 flex items-center gap-2",children:[O.provider&&c.jsx("span",{className:"capitalize",children:O.provider}),O.tokens&&c.jsxs("span",{children:[O.tokens," tokens"]})]})]})},O.id)),e&&c.jsx("div",{className:"flex justify-start",children:c.jsx("div",{className:"bg-primary-100 dark:bg-gray-700 rounded-2xl rounded-bl-md px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-2 text-primary-600 dark:text-gray-300",children:[c.jsx(he,{className:"w-4 h-4 animate-spin"}),c.jsx("span",{className:"text-sm",children:"R√©flexion en cours..."})]})})}),c.jsx("div",{ref:_})]})}),c.jsxs("div",{className:"p-4 border-t border-primary-100 dark:border-gray-700",children:[s.length>0&&c.jsx("div",{className:"flex justify-between items-center mb-2",children:c.jsxs("button",{onClick:a,className:"text-xs text-primary-400 hover:text-danger flex items-center gap-1 transition-colors",children:[c.jsx(Jt,{className:"w-3 h-3"}),"Effacer la conversation"]})}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("textarea",{ref:D,value:b,onChange:O=>f(O.target.value),onKeyDown:k,placeholder:v?"Demandez √† Proph3et...":"Configurez Proph3et dans Param√®tres",disabled:!v||e,className:`flex-1 px-3 py-2 border border-primary-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-${X}-500 disabled:bg-primary-50 dark:disabled:bg-gray-800 disabled:cursor-not-allowed`,rows:1,style:{minHeight:"40px",maxHeight:"100px"}}),c.jsx("button",{onClick:R,disabled:!b.trim()||!v||e,className:`px-4 py-2 ${i.activeProvider==="claude"?"bg-orange-500 hover:bg-orange-600":"bg-purple-600 hover:bg-purple-700"} text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-colors`,children:e?c.jsx(he,{className:"w-4 h-4 animate-spin"}):c.jsx(Xt,{className:"w-4 h-4"})})]})]})]})]}):c.jsxs("button",{onClick:()=>d(!0),className:`fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-br ${i.activeProvider==="claude"?"from-orange-500 to-amber-600":"from-purple-600 to-blue-600"} text-white rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center group z-50`,title:"Proph3et - Assistant IA",children:[i.activeProvider==="claude"?c.jsx(le,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}):c.jsx(de,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),v&&c.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]})}function Qi(){const{sidebarOpen:i,isLoading:s,loadingMessage:e}=ie();return c.jsxs("div",{className:"min-h-screen bg-primary-50",children:[c.jsx(Vi,{}),c.jsxs("div",{className:`transition-all duration-300 ${i?"ml-64":"ml-16"}`,children:[c.jsx($i,{}),c.jsx("main",{className:"p-6",children:c.jsx(bt,{})})]}),c.jsx(zi,{}),c.jsx(Xi,{}),s&&c.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center",children:c.jsxs("div",{className:"bg-white rounded-card p-6 shadow-xl flex items-center gap-4",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-900 rounded-full animate-spin"}),c.jsx("span",{className:"text-primary-900 font-medium",children:e||"Chargement..."})]})})]})}function Wi({children:i}){const s=oe(),{session:e,isInitialized:t,checkSession:r,initialize:a}=se();return C.useEffect(()=>{t||a()},[t,a]),t?!e.isAuthenticated||!r()?c.jsx(At,{to:"/login",state:{from:s},replace:!0}):c.jsx(c.Fragment,{children:i}):c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-primary-50 dark:bg-primary-900",children:c.jsxs("div",{className:"flex flex-col items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-900 rounded-full animate-spin"}),c.jsx("p",{className:"text-primary-600 dark:text-primary-400",children:"Chargement..."})]})})}function Zi(i,s){const e=C.useCallback(()=>{if(typeof window>"u")return s;try{const n=window.localStorage.getItem(i);return n?JSON.parse(n):s}catch{return s}},[s,i]),[t,r]=C.useState(e),a=C.useCallback(n=>{try{const d=n instanceof Function?n(t):n;r(d),typeof window<"u"&&window.localStorage.setItem(i,JSON.stringify(d))}catch{}},[i,t]),o=C.useCallback(()=>{try{typeof window<"u"&&window.localStorage.removeItem(i),r(s)}catch{}},[s,i]);return C.useEffect(()=>{const n=d=>{d.key===i&&d.newValue!==null&&r(JSON.parse(d.newValue))};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},[i]),[t,a,o]}function es(){const[i,s]=Zi("cockpit-theme","system"),e=typeof window<"u"?window.matchMedia("(prefers-color-scheme: dark)").matches:!1,t=i==="dark"||i==="system"&&e;return C.useEffect(()=>{const r=window.document.documentElement;t?r.classList.add("dark"):r.classList.remove("dark")},[t]),C.useEffect(()=>{if(i!=="system")return;const r=window.matchMedia("(prefers-color-scheme: dark)"),a=o=>{const n=window.document.documentElement;o.matches?n.classList.add("dark"):n.classList.remove("dark")};return r.addEventListener("change",a),()=>r.removeEventListener("change",a)},[i]),[i,s,t]}const ts=C.createContext(void 0);function rs({children:i}){const[s,e,t]=es(),a={theme:s,setTheme:e,isDark:t,toggleTheme:()=>{e(s==="light"?"dark":s==="dark"?"system":"light")}};return c.jsx(ts.Provider,{value:a,children:i})}class as extends C.Component{constructor(e){super(e);I(this,"handleReload",()=>{window.location.reload()});I(this,"handleGoHome",()=>{window.location.href="/"});I(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var r,a;this.setState({errorInfo:t}),(a=(r=this.props).onError)==null||a.call(r,e,t);try{const o={timestamp:new Date().toISOString(),message:e.message,stack:e.stack,componentStack:t.componentStack},n=JSON.parse(localStorage.getItem("cockpit-error-logs")||"[]");n.push(o),localStorage.setItem("cockpit-error-logs",JSON.stringify(n.slice(-10)))}catch{}}render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:c.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 text-center",children:[c.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:c.jsx(ne,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Oups ! Une erreur s'est produite"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"L'application a rencontr√© un probl√®me inattendu. Vos donn√©es sont en s√©curit√©."}),!1,c.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[c.jsxs("button",{onClick:this.handleReset,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[c.jsx(Zt,{className:"w-4 h-4"}),"R√©essayer"]}),c.jsxs("button",{onClick:this.handleGoHome,className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[c.jsx(er,{className:"w-4 h-4"}),"Accueil"]})]}),c.jsx("p",{className:"mt-6 text-xs text-gray-400",children:"Si le probl√®me persiste, essayez de recharger la page ou de vider le cache."})]})}):this.props.children}}function is({children:i,variant:s="primary",size:e="md",isLoading:t=!1,leftIcon:r,rightIcon:a,className:o="",disabled:n,...d}){const u="inline-flex items-center justify-center font-medium transition-all duration-200 rounded-btn focus:outline-none focus:ring-2 focus:ring-offset-2",p={primary:"bg-primary-900 text-white hover:bg-primary-800 focus:ring-primary-500",secondary:"bg-primary-100 text-primary-900 hover:bg-primary-200 focus:ring-primary-400",ghost:"bg-transparent text-primary-700 hover:bg-primary-100 focus:ring-primary-400",success:"bg-success text-white hover:opacity-90 focus:ring-success",warning:"bg-warning text-white hover:opacity-90 focus:ring-warning",error:"bg-error text-white hover:opacity-90 focus:ring-error"},g={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-2"};return c.jsxs("button",{className:`${u} ${p[s]} ${g[e]} ${n||t?"opacity-50 cursor-not-allowed":""} ${o}`,disabled:n||t,...d,children:[t?c.jsx(he,{className:"w-4 h-4 animate-spin"}):r||null,i,a&&!t&&a]})}function ss({children:i,className:s="",onClick:e,hoverable:t=!1}){return c.jsx("div",{className:`bg-white dark:bg-primary-800 rounded-card shadow-card border border-primary-200 dark:border-primary-700 p-6 transition-colors ${t?"hover:shadow-card-hover cursor-pointer":""} ${s}`,onClick:e,children:i})}function So({children:i,className:s="",action:e}){return c.jsxs("div",{className:`flex items-center justify-between mb-4 ${s}`,children:[c.jsx("div",{children:i}),e&&c.jsx("div",{children:e})]})}function Ro({children:i,className:s=""}){return c.jsx("h3",{className:`text-lg font-semibold text-primary-900 dark:text-primary-50 ${s}`,children:i})}function To({children:i,className:s=""}){return c.jsx("p",{className:`text-sm text-primary-500 dark:text-primary-400 mt-1 ${s}`,children:i})}function os({children:i,className:s=""}){return c.jsx("div",{className:s,children:i})}const ns=q((i,s)=>({toasts:[],position:"top-right",maxToasts:5,addToast:e=>{const t=`toast-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,r={id:t,duration:5e3,dismissible:!0,...e};return i(a=>({toasts:[r,...a.toasts].slice(0,a.maxToasts)})),r.duration&&r.duration>0&&setTimeout(()=>{s().removeToast(t)},r.duration),t},removeToast:e=>{i(t=>({toasts:t.toasts.filter(r=>r.id!==e)}))},clearAll:()=>{i({toasts:[]})},setPosition:e=>{i({position:e})}})),cs={success:We,error:Qe,warning:ne,info:Xe},ls={success:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",error:"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800",warning:"bg-amber-50 border-amber-200 dark:bg-amber-900/20 dark:border-amber-800",info:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800"},ds={success:"text-green-600 dark:text-green-400",error:"text-red-600 dark:text-red-400",warning:"text-amber-600 dark:text-amber-400",info:"text-blue-600 dark:text-blue-400"},us={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4","top-center":"top-4 left-1/2 -translate-x-1/2","bottom-center":"bottom-4 left-1/2 -translate-x-1/2"};function ps({toast:i,onDismiss:s}){const e=cs[i.type];return c.jsxs("div",{role:"alert","aria-live":"polite",className:`
        flex items-start gap-3 p-4 rounded-lg border shadow-lg
        transform transition-all duration-300 ease-out
        animate-slide-in min-w-[320px] max-w-[420px]
        ${ls[i.type]}
      `,children:[c.jsx(e,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${ds[i.type]}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:i.title}),i.message&&c.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:i.message}),i.action&&c.jsx("button",{onClick:i.action.onClick,className:"mt-2 text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400",children:i.action.label})]}),i.dismissible&&c.jsx("button",{onClick:()=>s(i.id),className:"flex-shrink-0 p-1 rounded hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Fermer la notification",children:c.jsx(Ae,{className:"w-4 h-4 text-gray-500"})})]})}function ms(){const{toasts:i,position:s,removeToast:e}=ns(),t=C.useCallback(r=>{e(r)},[e]);return i.length===0?null:c.jsx("div",{className:`fixed z-50 flex flex-col gap-2 ${us[s]}`,"aria-label":"Notifications",children:i.map(r=>c.jsx(ps,{toast:r,onDismiss:t},r.id))})}const gs=`
@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-slide-in {
  animation: slide-in 0.3s ease-out;
}
`;if(typeof document<"u"){const i=document.createElement("style");i.textContent=gs,document.head.querySelector("[data-toast-styles]")||(i.setAttribute("data-toast-styles",""),document.head.appendChild(i))}function fs(){const i=$e(),s=oe(),{session:e,isLoading:t,error:r,needsSetup:a,isInitialized:o,login:n,setupAccount:d,clearError:u,initialize:p}=se(),[g,A]=C.useState(!1),[h,b]=C.useState({email:"",password:"",confirmPassword:"",rememberMe:!0});C.useEffect(()=>{o||p()},[o,p]),C.useEffect(()=>{var S,T;if(e.isAuthenticated){const _=((T=(S=s.state)==null?void 0:S.from)==null?void 0:T.pathname)||"/";i(_,{replace:!0})}},[e.isAuthenticated,i,s]);const f=async S=>{var _,D;S.preventDefault(),u();let T;if(a?T=await d({email:h.email,password:h.password,confirmPassword:h.confirmPassword}):T=await n({email:h.email,password:h.password,rememberMe:h.rememberMe}),T){const v=((D=(_=s.state)==null?void 0:_.from)==null?void 0:D.pathname)||"/";i(v,{replace:!0})}};return o?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900 dark:to-primary-800 flex items-center justify-center p-4",children:c.jsxs("div",{className:"w-full max-w-md",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary-900 dark:bg-primary-100 rounded-2xl mb-4",children:c.jsx(Ke,{className:"w-8 h-8 text-white dark:text-primary-900"})}),c.jsx("h1",{className:"text-3xl font-bold text-primary-900 dark:text-white",children:"Cockpit"}),c.jsx("p",{className:"text-primary-600 dark:text-primary-300 mt-1",children:a?"Configurez votre compte pour commencer":"Connectez-vous pour continuer"})]}),c.jsx(ss,{children:c.jsx(os,{className:"p-6",children:c.jsxs("form",{onSubmit:f,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-primary-700 dark:text-primary-300 mb-1",children:"Email"}),c.jsxs("div",{className:"relative",children:[c.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),c.jsx("input",{type:"email",value:h.email,onChange:S=>b({...h,email:S.target.value}),placeholder:"votre@email.com",required:!0,autoComplete:"email",className:"w-full pl-10 pr-4 py-2.5 border border-primary-200 dark:border-primary-700 rounded-lg bg-white dark:bg-primary-800 text-primary-900 dark:text-white placeholder-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-primary-700 dark:text-primary-300 mb-1",children:"Mot de passe"}),c.jsxs("div",{className:"relative",children:[c.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),c.jsx("input",{type:g?"text":"password",value:h.password,onChange:S=>b({...h,password:S.target.value}),placeholder:a?"Minimum 6 caracteres":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0,autoComplete:a?"new-password":"current-password",className:"w-full pl-10 pr-12 py-2.5 border border-primary-200 dark:border-primary-700 rounded-lg bg-white dark:bg-primary-800 text-primary-900 dark:text-white placeholder-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),c.jsx("button",{type:"button",onClick:()=>A(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-primary-400 hover:text-primary-600 transition-colors",children:g?c.jsx(tr,{className:"w-4 h-4"}):c.jsx(rr,{className:"w-4 h-4"})})]})]}),a&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-primary-700 dark:text-primary-300 mb-1",children:"Confirmer le mot de passe"}),c.jsxs("div",{className:"relative",children:[c.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),c.jsx("input",{type:g?"text":"password",value:h.confirmPassword,onChange:S=>b({...h,confirmPassword:S.target.value}),placeholder:"Confirmez votre mot de passe",required:!0,autoComplete:"new-password",className:"w-full pl-10 pr-4 py-2.5 border border-primary-200 dark:border-primary-700 rounded-lg bg-white dark:bg-primary-800 text-primary-900 dark:text-white placeholder-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),!a&&c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:h.rememberMe,onChange:S=>b({...h,rememberMe:S.target.checked}),className:"w-4 h-4 rounded border-primary-300 text-primary-900 focus:ring-primary-500"}),c.jsx("span",{className:"text-sm text-primary-600 dark:text-primary-400",children:"Se souvenir de moi"})]}),r&&c.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:r})}),c.jsx(is,{type:"submit",className:"w-full",size:"lg",isLoading:t,leftIcon:a?c.jsx(ze,{className:"w-4 h-4"}):c.jsx(ar,{className:"w-4 h-4"}),children:a?"Creer mon compte":"Se connecter"})]})})}),c.jsx("p",{className:"text-center text-xs text-primary-500 dark:text-primary-400 mt-4",children:a?"Vos donnees sont stockees localement sur votre appareil.":"Application locale - Aucune connexion internet requise"})]})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900 dark:to-primary-800 flex items-center justify-center",children:c.jsxs("div",{className:"flex flex-col items-center gap-4",children:[c.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-900 rounded-full animate-spin"}),c.jsx("p",{className:"text-primary-600 dark:text-primary-400",children:"Chargement..."})]})})}const hs=()=>c.jsx("div",{className:"flex items-center justify-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}),ys=C.lazy(()=>P(()=>import("./Dashboard-C_eK16sJ.js"),__vite__mapDeps([3,4,2,5,1,6,7,8])).then(i=>({default:i.Dashboard}))),bs=C.lazy(()=>P(()=>import("./ActionsConsolidees-DV0zflJ-.js"),__vite__mapDeps([9,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.ActionsConsolidees}))),As=C.lazy(()=>P(()=>import("./Centres-HTzUsu8q.js"),__vite__mapDeps([12,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.Centres}))),xs=C.lazy(()=>P(()=>import("./CentreDashboard-Cfh_UF88.js"),__vite__mapDeps([13,4,2,5,7,6,8,1])).then(i=>({default:i.CentreDashboard}))),vs=C.lazy(()=>P(()=>import("./Pilotage-t4M2FoUm.js"),__vite__mapDeps([14,4,2,5,10,11,7,6,1])).then(i=>({default:i.Pilotage}))),Is=C.lazy(()=>P(()=>import("./Actions-Cf-O3pPk.js"),__vite__mapDeps([15,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.Actions}))),Es=C.lazy(()=>P(()=>import("./Agenda-Cd2_AsTC.js"),__vite__mapDeps([16,4,2,10,11,7,6,8,1])).then(i=>({default:i.Agenda}))),ws=C.lazy(()=>P(()=>import("./Reporting-CIW2GV7e.js"),__vite__mapDeps([17,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.Reporting}))),Cs=C.lazy(()=>P(()=>import("./Conformite-7BLGCCzy.js"),__vite__mapDeps([18,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.Conformite}))),Ss=C.lazy(()=>P(()=>import("./Evaluations-CiuvPbP6.js"),__vite__mapDeps([19,4,2,10,11,7,6,8,1])).then(i=>({default:i.Evaluations}))),Rs=C.lazy(()=>P(()=>import("./Alertes-B6sGoBdL.js"),__vite__mapDeps([20,4,2,5,10,7,6,8,1])).then(i=>({default:i.Alertes}))),Ts=C.lazy(()=>P(()=>import("./Parametres-UKaD7awb.js"),__vite__mapDeps([21,4,2,5,10,7,1,6])).then(i=>({default:i.Parametres}))),Os=C.lazy(()=>P(()=>import("./Equipe-Bkm_bBsx.js"),__vite__mapDeps([22,4,2,5,10,11,7,6,1])).then(i=>({default:i.Equipe}))),Ns=C.lazy(()=>P(()=>import("./ImportData-DO5devOz.js"),__vite__mapDeps([23,4,2,1,5,11,7,6])).then(i=>({default:i.ImportData}))),Ps=C.lazy(()=>P(()=>import("./ComparateurCentres-B3pcTrJI.js"),__vite__mapDeps([24,4,2,5,7,1,6])).then(i=>({default:i.ComparateurCentres}))),_s=C.lazy(()=>P(()=>import("./ProjetDashboard-Brd73Ifm.js"),__vite__mapDeps([25,4,2,5,11,7,6,8,1])).then(i=>({default:i.ProjetDashboard}))),Ds=C.lazy(()=>P(()=>import("./ProjetJalons-DQmRg5GS.js"),__vite__mapDeps([26,4,2,5,10,11,7,1,6,8])).then(i=>({default:i.ProjetJalons}))),js=C.lazy(()=>P(()=>import("./ProjetRecrutement-DN6xWXNB.js"),__vite__mapDeps([27,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.ProjetRecrutement}))),Ls=C.lazy(()=>P(()=>import("./ProjetCommercial-Dpi4c2_V.js"),__vite__mapDeps([28,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.ProjetCommercial}))),ks=C.lazy(()=>P(()=>import("./ProjetRisques-Cnkb28LZ.js"),__vite__mapDeps([29,4,2,5,10,11,7,1,6])).then(i=>({default:i.ProjetRisques}))),qs=C.lazy(()=>P(()=>import("./ProjetHandover-COFxiThV.js"),__vite__mapDeps([30,4,2,7,6,8,1])).then(i=>({default:i.ProjetHandover}))),Ms=C.lazy(()=>P(()=>import("./ProjetBudget-Dl4iXPMO.js"),__vite__mapDeps([31,4,2,7,1,6])).then(i=>({default:i.ProjetBudget}))),Fs=C.lazy(()=>P(()=>import("./ProjetSynchronisation-C5JCafNO.js"),__vite__mapDeps([32,4,2,5,10,11,7,6,8,1])).then(i=>({default:i.ProjetSynchronisation}))),Us=C.lazy(()=>P(()=>import("./index-CUAGUUVd.js"),__vite__mapDeps([33,4,2,5,10,11,7,6,0,1])).then(i=>({default:i.ImportPage}))),Bs=C.lazy(()=>P(()=>import("./index-CUAGUUVd.js"),__vite__mapDeps([33,4,2,5,10,11,7,6,0,1])).then(i=>({default:i.CataloguePage}))),Vs=C.lazy(()=>P(()=>import("./index-CUAGUUVd.js"),__vite__mapDeps([33,4,2,5,10,11,7,6,0,1])).then(i=>({default:i.AnalysePage}))),$s=C.lazy(()=>P(()=>import("./index-CUAGUUVd.js"),__vite__mapDeps([33,4,2,5,10,11,7,6,0,1])).then(i=>({default:i.RapportStudioPage}))),zs=C.lazy(()=>P(()=>import("./Profil-2yrSUmE2.js"),__vite__mapDeps([34,4,2,10,7,1,6])).then(i=>({default:i.Profil}))),Hs=C.lazy(()=>P(()=>import("./Templates-Ddyd-dfX.js"),__vite__mapDeps([35,4,2,5,1,7,6])).then(i=>({default:i.Templates}))),Gs=C.lazy(()=>P(()=>import("./Journal-D9OQqFac.js"),__vite__mapDeps([36,4,2,5,10,11,7,1,6])).then(i=>({default:i.Journal}))),Ys=C.lazy(()=>P(()=>import("./Notifications-dqSlxRuO.js"),__vite__mapDeps([37,4,2,5,10,11,7,1,6])).then(i=>({default:i.Notifications}))),Ks=C.lazy(()=>P(()=>import("./TemplatesEmail-DrXWCuZt.js"),__vite__mapDeps([38,4,2,5,11,7,1,6])).then(i=>({default:i.TemplatesEmail}))),Js=C.lazy(()=>P(()=>import("./NotFound-Bww5NLzV.js"),__vite__mapDeps([39,4,2,7])).then(i=>({default:i.NotFound})));function Xs(){const{session:i}=se();return C.useEffect(()=>{(async()=>{try{await nr(),Bi()}catch{}})()},[]),C.useEffect(()=>{i.isAuthenticated&&(Q.getState().loadCentres(),et.getState().loadAlertes())},[i.isAuthenticated]),c.jsx(as,{children:c.jsxs(rs,{children:[c.jsx(xt,{children:c.jsx(C.Suspense,{fallback:c.jsx(hs,{}),children:c.jsxs(vt,{children:[c.jsx(N,{path:"/login",element:c.jsx(fs,{})}),c.jsxs(N,{path:"/",element:c.jsx(Wi,{children:c.jsx(Qi,{})}),children:[c.jsx(N,{index:!0,element:c.jsx(ys,{})}),c.jsx(N,{path:"comparateur",element:c.jsx(Ps,{})}),c.jsx(N,{path:"actions-consolidees",element:c.jsx(bs,{})}),c.jsx(N,{path:"centres",element:c.jsx(As,{})}),c.jsx(N,{path:"centre/:centreId",element:c.jsx(xs,{})}),c.jsx(N,{path:"centre/:centreId/pilotage",element:c.jsx(vs,{})}),c.jsx(N,{path:"centre/:centreId/actions",element:c.jsx(Is,{})}),c.jsx(N,{path:"centre/:centreId/agenda",element:c.jsx(Es,{})}),c.jsx(N,{path:"centre/:centreId/reporting",element:c.jsx(ws,{})}),c.jsx(N,{path:"centre/:centreId/equipe",element:c.jsx(Os,{})}),c.jsx(N,{path:"centre/:centreId/evaluations",element:c.jsx(Ss,{})}),c.jsx(N,{path:"centre/:centreId/conformite",element:c.jsx(Cs,{})}),c.jsx(N,{path:"centre/:centreId/import",element:c.jsx(Ns,{})}),c.jsx(N,{path:"centre/:centreId/bi/import",element:c.jsx(Us,{})}),c.jsx(N,{path:"centre/:centreId/bi/catalogue",element:c.jsx(Bs,{})}),c.jsx(N,{path:"centre/:centreId/bi/analyse",element:c.jsx(Vs,{})}),c.jsx(N,{path:"centre/:centreId/bi/rapports",element:c.jsx($s,{})}),c.jsx(N,{path:"centre/:centreId/projet",element:c.jsx(_s,{})}),c.jsx(N,{path:"centre/:centreId/projet/jalons",element:c.jsx(Ds,{})}),c.jsx(N,{path:"centre/:centreId/projet/recrutement",element:c.jsx(js,{})}),c.jsx(N,{path:"centre/:centreId/projet/commercial",element:c.jsx(Ls,{})}),c.jsx(N,{path:"centre/:centreId/projet/handover",element:c.jsx(qs,{})}),c.jsx(N,{path:"centre/:centreId/projet/budget",element:c.jsx(Ms,{})}),c.jsx(N,{path:"centre/:centreId/projet/risques",element:c.jsx(ks,{})}),c.jsx(N,{path:"centre/:centreId/projet/synchronisation",element:c.jsx(Fs,{})}),c.jsx(N,{path:"centre/:centreId/projet/communication",element:c.jsx(Qs,{title:"Communication"})}),c.jsx(N,{path:"alertes",element:c.jsx(Rs,{})}),c.jsx(N,{path:"parametres",element:c.jsx(Ts,{})}),c.jsx(N,{path:"profil",element:c.jsx(zs,{})}),c.jsx(N,{path:"templates",element:c.jsx(Hs,{})}),c.jsx(N,{path:"journal",element:c.jsx(Gs,{})}),c.jsx(N,{path:"notifications",element:c.jsx(Ys,{})}),c.jsx(N,{path:"templates-email",element:c.jsx(Ks,{})}),c.jsx(N,{path:"*",element:c.jsx(Js,{})})]})]})})}),c.jsx(ms,{})]})})}function Qs({title:i}){return c.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[c.jsx("h1",{className:"text-2xl font-bold text-primary-900 dark:text-white mb-2",children:i}),c.jsx("p",{className:"text-primary-500 dark:text-gray-400",children:"Cette page sera bient√¥t disponible"})]})}const Ws=!!(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Zs(i){if("serviceWorker"in navigator){const s="/sw.js";Ws?(eo(s,i),navigator.serviceWorker.ready.then(()=>{})):pt(s,i),i&&(window.addEventListener("online",()=>{var e;return(e=i.onOnline)==null?void 0:e.call(i)}),window.addEventListener("offline",()=>{var e;return(e=i.onOffline)==null?void 0:e.call(i)}))}}async function pt(i,s){try{const e=await navigator.serviceWorker.register(i);e.onupdatefound=()=>{const t=e.installing;t!=null&&(t.onstatechange=()=>{var r,a;t.state==="installed"&&(navigator.serviceWorker.controller?(r=s==null?void 0:s.onUpdate)==null||r.call(s,e):(a=s==null?void 0:s.onSuccess)==null||a.call(s,e))})}}catch{}}async function eo(i,s){try{const e=await fetch(i,{headers:{"Service-Worker":"script"}}),t=e.headers.get("content-type");e.status===404||t!=null&&t.indexOf("javascript")===-1?(await(await navigator.serviceWorker.ready).unregister(),window.location.reload()):pt(i,s)}catch{}}Ze(document.getElementById("root")).render(c.jsx(C.StrictMode,{children:c.jsx(Xs,{})}));Zs({onSuccess:()=>{},onUpdate:()=>{},onOffline:()=>{},onOnline:()=>{}});export{tt as A,is as B,ss as C,Io as D,wo as E,ae as F,Y as G,lt as O,po as T,Q as a,co as b,lo as c,uo as d,et as e,vo as f,os as g,So as h,Ro as i,mo as j,go as k,fo as l,ho as m,To as n,no as o,wi as p,Eo as q,dt as r,yo as s,l as t,ie as u,Co as v,ut as w,xo as x,bo as y,Ao as z};

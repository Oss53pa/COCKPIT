import{j as e,R as ae,B as Ie,C as _e,X as Oe,Y as Be,T as te,c as z,P as Pe,d as Le,e as qe}from"./vendor-charts-cvMpHz0W.js";import{d as ze,r as l}from"./vendor-react-BdB5Pz3t.js";import{a as Ke,u as Fe,b as Ve,d as Ge,B as g,C,g as D,h as K,i as F}from"./index-IaNwoOYO.js";import{B as We,P as $,S as se}from"./Badge-CM23X0aP.js";import{S as V}from"./Input-BZ7duGHL.js";import{M as Xe}from"./Modal-J_gxoCCM.js";import{b as He,a as Qe,g as Ye,e as Je,h as Ue,f as b,s as Ze,i as er,j as rr,k as ar,l as ie,d as le}from"./vendor-utils-BBD155gO.js";import{a5 as tr,T as de,D as sr,a6 as ir,q as ne,a2 as G,a7 as ce,A as E,P as lr,r as dr,X as me,a8 as nr,a9 as cr,aa as mr,ab as or,ac as oe,C as xr,o as pr,_ as hr,f as ur}from"./vendor-icons-B6Rt7gcW.js";import{f as br}from"./fr-C0qvdQu_.js";import"./vendor-export-C98UG4Mq.js";const yr={critique:"bg-error",haute:"bg-warning",moyenne:"bg-info",basse:"bg-success"},xe={critique:"border-l-error",haute:"border-l-warning",moyenne:"border-l-info",basse:"border-l-success"};function Er(){var U,Z,ee,re;const W=ze(),{centres:x,loadCentres:pe}=Ke(),{theme:he,setCurrentCentre:ue}=Fe(),N=he==="dark",{axes:gr,loadAxes:be,objectifs:jr,loadObjectifs:ye}=Ve(),{actions:m,loadActions:ge,getActionsEnRetard:je,updateAction:fr,changerStatut:fe}=Ge(),[h,A]=l.useState("list"),[u,T]=l.useState("all"),[j,X]=l.useState("all"),[f,H]=l.useState("all"),[v,Q]=l.useState(""),[y,R]=l.useState(new Date),[t,Y]=l.useState(null),[ve,I]=l.useState(!1);l.useEffect(()=>{pe(),be(),ye(),ge()},[]);const k=je(),d=l.useMemo(()=>{const r=m.length,a=m.filter(c=>c.statut==="termine").length,s=m.filter(c=>c.statut==="en_cours").length,i=m.filter(c=>c.statut==="a_faire").length,n=k.length,P=m.filter(c=>c.priorite==="critique"&&c.statut!=="termine"&&c.statut!=="annule").length,L=m.reduce((c,q)=>{var w;return c+(((w=q.budget)==null?void 0:w.prevu)||0)},0),S=m.reduce((c,q)=>{var w;return c+(((w=q.budget)==null?void 0:w.consomme)||0)},0);return{total:r,terminees:a,enCours:s,aFaire:i,enRetard:n,critique:P,budgetTotal:L,budgetConsomme:S}},[m,k]),_=l.useMemo(()=>x.map(r=>{const a=m.filter(n=>n.centreId===r.id),s=a.filter(n=>n.statut==="termine").length,i=a.filter(n=>n.statut!=="termine"&&n.statut!=="annule"&&n.dateEcheance&&new Date(n.dateEcheance)<new Date).length;return{id:r.id,code:r.code,nom:r.nom,couleur:r.couleurTheme||"#171717",total:a.length,terminees:s,enRetard:i,tauxRealisation:a.length>0?Math.round(s/a.length*100):0}}),[x,m]),o=l.useMemo(()=>m.filter(r=>!(u!=="all"&&r.centreId!==u||j!=="all"&&r.priorite!==j||f!=="all"&&r.statut!==f||v&&!r.titre.toLowerCase().includes(v.toLowerCase()))),[m,u,j,f,v]),O={a_faire:o.filter(r=>r.statut==="a_faire"),en_cours:o.filter(r=>r.statut==="en_cours"),en_attente:o.filter(r=>r.statut==="en_attente"),termine:o.filter(r=>r.statut==="termine"),annule:o.filter(r=>r.statut==="annule")},Ne={a_faire:"À faire",en_cours:"En cours",en_attente:"En attente",termine:"Terminé",annule:"Annulé"},ke=l.useMemo(()=>{const r=He(Qe(y),{weekStartsOn:0}),a=Ye(Je(y),{weekStartsOn:0});return Ue({start:r,end:a})},[y]),we=l.useMemo(()=>{const r={};return o.forEach(a=>{if(a.dateEcheance){const s=b(new Date(a.dateEcheance),"yyyy-MM-dd");r[s]||(r[s]=[]),r[s].push(a)}}),r},[o]),Ce=l.useMemo(()=>_.map(r=>({name:r.code,total:r.total,terminees:r.terminees,enRetard:r.enRetard})),[_]),J=[{name:"Terminées",value:d.terminees,color:"#22c55e"},{name:"En cours",value:d.enCours,color:"#3b82f6"},{name:"À faire",value:d.aFaire,color:"#a3a3a3"},{name:"En retard",value:d.enRetard,color:"#ef4444"}],M=r=>{Y(r),I(!0)},B=r=>{ue(r),W(`/centre/${r}/actions`)},De=(r,a)=>{r.dataTransfer.setData("actionId",a.id),r.dataTransfer.setData("dragType","kanban")},Ae=async(r,a)=>{r.preventDefault();const s=r.dataTransfer.getData("actionId"),i=r.dataTransfer.getData("dragType");s&&i==="kanban"&&await fe(s,a)},Me=r=>{r.preventDefault()},p=r=>x.find(a=>a.id===r),Se=[{value:"critique",label:"Critique"},{value:"haute",label:"Haute"},{value:"moyenne",label:"Moyenne"},{value:"basse",label:"Basse"}],$e=[{value:"a_faire",label:"À faire"},{value:"en_cours",label:"En cours"},{value:"en_attente",label:"En attente"},{value:"termine",label:"Terminé"},{value:"annule",label:"Annulé"}],Ee=({action:r})=>{const a=p(r.centreId),s=r.statut!=="termine"&&r.statut!=="annule"&&r.dateEcheance&&new Date(r.dateEcheance)<new Date;return e.jsxs("div",{draggable:!0,onDragStart:i=>De(i,r),onClick:()=>M(r),className:`group bg-white dark:bg-primary-800 p-3 rounded-lg border-l-4 shadow-sm cursor-pointer hover:shadow-md transition-all ${xe[r.priorite]} ${s?"ring-1 ring-error/30":""}`,children:[a&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:a.couleurTheme||"#171717"},children:a.code.substring(0,1)}),e.jsx("span",{className:"text-xs text-primary-500 dark:text-primary-400",children:a.nom})]}),e.jsx("h4",{className:"font-medium text-primary-900 dark:text-primary-100 text-sm line-clamp-2 mb-2",children:r.titre}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:e.jsx($,{priorite:r.priorite})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.dateEcheance&&e.jsxs("div",{className:`flex items-center gap-1 ${s?"text-error":"text-primary-500 dark:text-primary-400"}`,children:[e.jsx(ur,{className:"w-3 h-3"}),b(new Date(r.dateEcheance),"dd/MM")]}),e.jsxs("div",{className:"flex items-center gap-1 text-primary-500 dark:text-primary-400",children:[e.jsx("div",{className:"w-12 h-1 bg-primary-100 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-700 dark:bg-primary-300 rounded-full",style:{width:`${r.avancement}%`}})}),e.jsxs("span",{children:[r.avancement,"%"]})]})]})]})},Te=({action:r})=>{const a=p(r.centreId),s=r.statut!=="termine"&&r.statut!=="annule"&&r.dateEcheance&&new Date(r.dateEcheance)<new Date;return e.jsxs("tr",{className:`border-b border-primary-100 dark:border-primary-700 hover:bg-primary-50 dark:hover:bg-primary-800 cursor-pointer ${s?"bg-error/5":""}`,onClick:()=>M(r),children:[e.jsx("td",{className:"py-3 px-4",children:a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:a.couleurTheme||"#171717"},children:a.code.substring(0,2)}),e.jsx("span",{className:"text-sm text-primary-600 dark:text-primary-400",children:a.nom})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${yr[r.priorite]}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100",children:r.titre}),r.description&&e.jsx("p",{className:"text-xs text-primary-500 dark:text-primary-400 line-clamp-1 max-w-[250px]",children:r.description})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx($,{priorite:r.priorite})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(se,{statut:r.statut})}),e.jsx("td",{className:"py-3 px-4",children:r.dateEcheance?e.jsxs("span",{className:s?"text-error font-medium":"text-primary-700 dark:text-primary-300",children:[b(new Date(r.dateEcheance),"dd/MM/yyyy"),s&&e.jsxs("span",{className:"block text-xs",children:["(",le(new Date,new Date(r.dateEcheance)),"j retard)"]})]}):e.jsx("span",{className:"text-primary-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-primary-200 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-700 dark:bg-primary-300 rounded-full",style:{width:`${r.avancement}%`}})}),e.jsxs("span",{className:"text-sm text-primary-600 dark:text-primary-400",children:[r.avancement,"%"]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(g,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),r.centreId&&B(r.centreId)},children:e.jsx(hr,{className:"w-4 h-4"})})})]})},Re=({action:r})=>{const a=p(r.centreId);return e.jsx("div",{onClick:()=>M(r),className:`group cursor-pointer px-2 py-1 rounded text-xs border-l-2 ${xe[r.priorite]} bg-white dark:bg-primary-800 hover:shadow-sm transition-all mb-1 truncate`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[a&&e.jsx("div",{className:"w-3 h-3 rounded-sm flex-shrink-0",style:{backgroundColor:a.couleurTheme||"#171717"}}),e.jsx("span",{className:"truncate font-medium text-primary-900 dark:text-primary-100",children:r.titre})]})})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>W("/"),className:"p-2 hover:bg-primary-100 dark:hover:bg-primary-800 rounded-lg transition-colors",children:e.jsx(tr,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-primary-900 dark:text-primary-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-800 rounded-xl",children:e.jsx(de,{className:"w-6 h-6 text-primary-600 dark:text-primary-400"})}),"Plan d'action consolidé"]}),e.jsxs("p",{className:"text-primary-500 dark:text-primary-400 mt-1",children:[x.length," centre",x.length>1?"s":""," • ",o.length," action",o.length>1?"s":""]})]})]}),e.jsx(g,{variant:"secondary",leftIcon:e.jsx(sr,{className:"w-4 h-4"}),children:"Exporter"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsx("div",{className:"bg-white dark:bg-primary-900 rounded-xl p-4 border border-primary-100 dark:border-primary-800 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-800 rounded-lg",children:e.jsx(ir,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary-900 dark:text-primary-100",children:d.total}),e.jsx("p",{className:"text-xs text-primary-500",children:"Total"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/30 dark:to-emerald-800/30 rounded-xl p-4 border border-emerald-200 dark:border-emerald-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:d.terminees}),e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400",children:"Terminées"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4 border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:d.enCours}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"En cours"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-primary-900 rounded-xl p-4 border border-primary-100 dark:border-primary-800 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-800 rounded-lg",children:e.jsx(ce,{className:"w-5 h-5 text-primary-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",children:d.aFaire}),e.jsx("p",{className:"text-xs text-primary-500",children:"À faire"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30 rounded-xl p-4 border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:d.enRetard}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"En retard"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/30 dark:to-amber-800/30 rounded-xl p-4 border border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-700 dark:text-amber-300",children:d.critique}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Critiques"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-violet-50 to-violet-100 dark:from-violet-900/30 dark:to-violet-800/30 rounded-xl p-4 border border-violet-200 dark:border-violet-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-500 rounded-lg",children:e.jsx(lr,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-violet-700 dark:text-violet-300",children:[d.total>0?Math.round(d.terminees/d.total*100):0,"%"]}),e.jsx("p",{className:"text-xs text-violet-600 dark:text-violet-400",children:"Réalisation"})]})]})})]}),x.length>0&&e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:_.map(r=>e.jsx("div",{onClick:()=>T(u===r.id?"all":r.id),className:`flex-shrink-0 p-4 rounded-xl border-2 cursor-pointer transition-all hover:shadow-lg ${u===r.id?"border-primary-500 bg-primary-50 dark:bg-primary-800 shadow-lg shadow-primary-500/20":"border-primary-100 dark:border-primary-700 bg-white dark:bg-primary-900 hover:border-primary-300"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold shadow-lg",style:{backgroundColor:r.couleur},children:r.code.substring(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-primary-900 dark:text-primary-100",children:r.nom}),e.jsxs("div",{className:"flex items-center gap-3 text-sm mt-1",children:[e.jsxs("span",{className:"text-primary-500",children:[r.total," actions"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-16 h-1.5 bg-primary-100 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-success rounded-full",style:{width:`${r.tauxRealisation}%`}})}),e.jsxs("span",{className:"text-success font-medium",children:[r.tauxRealisation,"%"]})]}),r.enRetard>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-error/10 text-error text-xs rounded-full font-medium",children:[r.enRetard," en retard"]})]})]})]})},r.id))}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-[300px]",children:[e.jsx(dr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary-400"}),e.jsx("input",{type:"text",value:v,onChange:r=>Q(r.target.value),placeholder:"Rechercher...",className:"w-full pl-9 pr-4 py-2 border border-primary-200 dark:border-primary-700 bg-white dark:bg-primary-800 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 text-primary-900 dark:text-primary-100"})]}),e.jsx(V,{options:[{value:"all",label:"Tous les centres"},...x.map(r=>({value:r.id,label:r.nom}))],value:u,onChange:r=>T(r.target.value),className:"w-44"}),e.jsx(V,{options:[{value:"all",label:"Toutes priorités"},...Se],value:j,onChange:r=>X(r.target.value),className:"w-36"}),e.jsx(V,{options:[{value:"all",label:"Tous statuts"},...$e],value:f,onChange:r=>H(r.target.value),className:"w-36"}),(u!=="all"||j!=="all"||f!=="all"||v)&&e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>{T("all"),X("all"),H("all"),Q("")},children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"Réinitialiser"]}),e.jsxs("div",{className:"flex border border-primary-200 dark:border-primary-700 rounded-lg overflow-hidden ml-auto",children:[e.jsx("button",{onClick:()=>A("list"),className:`p-2 flex items-center gap-1 text-sm ${h==="list"?"bg-primary-900 text-white":"bg-white dark:bg-primary-800 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-700"}`,title:"Vue Liste",children:e.jsx(nr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A("kanban"),className:`p-2 flex items-center gap-1 text-sm ${h==="kanban"?"bg-primary-900 text-white":"bg-white dark:bg-primary-800 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-700"}`,title:"Vue Kanban",children:e.jsx(cr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A("calendar"),className:`p-2 flex items-center gap-1 text-sm ${h==="calendar"?"bg-primary-900 text-white":"bg-white dark:bg-primary-800 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-700"}`,title:"Vue Calendrier",children:e.jsx(mr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A("timeline"),className:`p-2 flex items-center gap-1 text-sm ${h==="timeline"?"bg-primary-900 text-white":"bg-white dark:bg-primary-800 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-700"}`,title:"Vue Graphiques",children:e.jsx(G,{className:"w-4 h-4"})})]})]}),h==="list"&&e.jsx(C,{children:e.jsx(D,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-primary-50 dark:bg-primary-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Centre"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Action"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Priorité"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Statut"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Échéance"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary-700 dark:text-primary-300",children:"Avancement"}),e.jsx("th",{className:"py-3 px-4"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-16",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-3xl bg-gradient-to-br from-primary-100 to-primary-50 dark:from-primary-800 dark:to-primary-900 flex items-center justify-center mb-4",children:e.jsx(de,{className:"w-12 h-12 text-primary-300 dark:text-primary-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-primary-700 dark:text-primary-300 mb-2",children:"Aucune action trouvée"}),e.jsx("p",{className:"text-primary-500 dark:text-primary-400 max-w-md mb-6",children:v||u!=="all"||j!=="all"||f!=="all"?"Modifiez vos filtres pour voir plus de résultats":"Commencez par créer des actions dans vos centres pour les voir apparaître ici"}),x.length>0&&e.jsx(g,{onClick:()=>B(x[0].id),leftIcon:e.jsx(or,{className:"w-4 h-4"}),children:"Créer une action"})]})})}):o.map(r=>e.jsx(Te,{action:r},r.id))})]})})})}),h==="kanban"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-4 min-w-[1200px]",children:["a_faire","en_cours","en_attente","termine","annule"].map(r=>{const a={a_faire:{bg:"bg-slate-50 dark:bg-slate-900/50",border:"border-slate-200 dark:border-slate-700",icon:"text-slate-400"},en_cours:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",icon:"text-blue-400"},en_attente:{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-200 dark:border-amber-800",icon:"text-amber-400"},termine:{bg:"bg-emerald-50 dark:bg-emerald-900/20",border:"border-emerald-200 dark:border-emerald-800",icon:"text-emerald-400"},annule:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",icon:"text-red-400"}},s={a_faire:e.jsx(ce,{className:`w-5 h-5 ${a[r].icon}`}),en_cours:e.jsx(G,{className:`w-5 h-5 ${a[r].icon}`}),en_attente:e.jsx(E,{className:`w-5 h-5 ${a[r].icon}`}),termine:e.jsx(oe,{className:`w-5 h-5 ${a[r].icon}`}),annule:e.jsx(me,{className:`w-5 h-5 ${a[r].icon}`})};return e.jsxs("div",{className:`flex-1 rounded-2xl p-4 min-w-[240px] flex flex-col border-2 ${a[r].bg} ${a[r].border}`,onDrop:i=>Ae(i,r),onDragOver:Me,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s[r],e.jsx("h3",{className:"font-semibold text-primary-900 dark:text-primary-100",children:Ne[r]})]}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-sm font-bold ${r==="termine"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300":r==="en_cours"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":r==="a_faire"?"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300":r==="en_attente"?"bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"}`,children:O[r].length})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto max-h-[500px]",children:[O[r].map(i=>e.jsx(Ee,{action:i},i.id)),O[r].length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl ${a[r].bg} border-2 border-dashed ${a[r].border} flex items-center justify-center mb-3`,children:s[r]}),e.jsx("p",{className:"text-sm font-medium text-primary-400 dark:text-primary-500",children:"Aucune action"}),e.jsx("p",{className:"text-xs text-primary-300 dark:text-primary-600 mt-1",children:"Glissez une action ici"})]})]})]},r)})})}),h==="calendar"&&e.jsx(C,{children:e.jsxs(D,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-primary-200 dark:border-primary-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(Ze(y,1)),className:"p-1.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded-lg",children:e.jsx(xr,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 w-40 text-center",children:b(y,"MMMM yyyy",{locale:br})}),e.jsx("button",{onClick:()=>R(er(y,1)),className:"p-1.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded-lg",children:e.jsx(pr,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})})]}),e.jsx(g,{variant:"secondary",size:"sm",onClick:()=>R(new Date),children:"Aujourd'hui"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-primary-200 dark:border-primary-700",children:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"].map((r,a)=>e.jsx("div",{className:`py-2 text-center text-sm font-medium ${a===0||a===6?"text-primary-400":"text-primary-600 dark:text-primary-400"}`,children:r},r))}),e.jsx("div",{className:"grid grid-cols-7",children:ke.map((r,a)=>{const s=b(r,"yyyy-MM-dd"),i=we[s]||[],n=rr(r,y),P=ar(r),L=ie(r)===0||ie(r)===6;return e.jsxs("div",{className:`border-b border-r border-primary-100 dark:border-primary-700 p-1 min-h-[100px] ${n?L?"bg-primary-50/30 dark:bg-primary-800/30":"bg-white dark:bg-primary-900":"bg-primary-50/50 dark:bg-primary-900/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-sm font-medium w-6 h-6 flex items-center justify-center rounded-full ${P?"bg-primary-900 dark:bg-primary-100 text-white dark:text-primary-900":n?"text-primary-700 dark:text-primary-300":"text-primary-300 dark:text-primary-600"}`,children:b(r,"d")}),i.length>0&&e.jsx(We,{size:"sm",variant:"default",children:i.length})]}),e.jsxs("div",{className:"space-y-0.5 overflow-hidden",children:[i.slice(0,3).map(S=>e.jsx(Re,{action:S},S.id)),i.length>3&&e.jsxs("button",{className:"text-xs text-primary-500 hover:text-primary-700 w-full text-left px-2",children:["+",i.length-3," autres"]})]})]},a)})})]})}),h==="timeline"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(K,{children:e.jsx(F,{children:"Actions par centre"})}),e.jsx(D,{children:e.jsx("div",{className:"h-72",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:Ce,layout:"vertical",children:[e.jsx(_e,{strokeDasharray:"3 3",stroke:N?"#404040":"#e5e5e5"}),e.jsx(Oe,{type:"number",stroke:N?"#a3a3a3":"#737373",fontSize:12}),e.jsx(Be,{dataKey:"name",type:"category",width:60,stroke:N?"#a3a3a3":"#737373",fontSize:12}),e.jsx(te,{contentStyle:{backgroundColor:N?"#262626":"#fff",border:`1px solid ${N?"#404040":"#e5e5e5"}`,borderRadius:"8px"}}),e.jsx(z,{dataKey:"terminees",name:"Terminées",fill:"#22c55e",stackId:"a"}),e.jsx(z,{dataKey:"enRetard",name:"En retard",fill:"#ef4444",stackId:"a"}),e.jsx(z,{dataKey:"total",name:"Total",fill:"#3b82f6"})]})})})})]}),e.jsxs(C,{children:[e.jsx(K,{children:e.jsx(F,{children:"Répartition par statut"})}),e.jsx(D,{children:e.jsx("div",{className:"h-72",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Le,{data:J,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:3,dataKey:"value",label:({name:r,percent:a})=>`${r} ${(a*100).toFixed(0)}%`,children:J.map((r,a)=>e.jsx(qe,{fill:r.color},`cell-${a}`))}),e.jsx(te,{})]})})})})]}),e.jsxs(C,{className:"lg:col-span-2",children:[e.jsx(K,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-error"}),"Actions en retard (",k.length,")"]})}),e.jsx(D,{children:k.length===0?e.jsxs("div",{className:"text-center py-8 text-success",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Aucune action en retard"})]}):e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:k.map(r=>{const a=p(r.centreId),s=le(new Date,new Date(r.dateEcheance));return e.jsxs("div",{onClick:()=>M(r),className:"flex items-center gap-4 p-3 bg-error/5 border border-error/20 rounded-lg cursor-pointer hover:bg-error/10 transition-colors",children:[a&&e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-sm flex-shrink-0",style:{backgroundColor:a.couleurTheme||"#171717"},children:a.code.substring(0,2)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100 truncate",children:r.titre}),e.jsx("p",{className:"text-sm text-primary-500 dark:text-primary-400",children:a==null?void 0:a.nom})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"text-error font-bold",children:[s,"j"]}),e.jsx("p",{className:"text-xs text-primary-500",children:"de retard"})]}),e.jsx($,{priorite:r.priorite})]},r.id)})})})]})]}),e.jsx(Xe,{isOpen:ve,onClose:()=>{I(!1),Y(null)},title:"Détail de l'action",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"ghost",onClick:()=>I(!1),children:"Fermer"}),t&&e.jsx(g,{onClick:()=>{t.centreId&&B(t.centreId)},children:"Voir dans le centre"})]}),children:t&&e.jsxs("div",{className:"space-y-4",children:[p(t.centreId)&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-50 dark:bg-primary-800 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold",style:{backgroundColor:((U=p(t.centreId))==null?void 0:U.couleurTheme)||"#171717"},children:(Z=p(t.centreId))==null?void 0:Z.code.substring(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100",children:(ee=p(t.centreId))==null?void 0:ee.nom}),e.jsx("p",{className:"text-sm text-primary-500",children:(re=p(t.centreId))==null?void 0:re.ville})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100",children:t.titre}),t.description&&e.jsx("p",{className:"text-primary-600 dark:text-primary-400 mt-2",children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{priorite:t.priorite}),e.jsx(se,{statut:t.statut})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500 dark:text-primary-400",children:"Date de début"}),e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100",children:t.dateDebut?b(new Date(t.dateDebut),"dd/MM/yyyy"):"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500 dark:text-primary-400",children:"Date d'échéance"}),e.jsx("p",{className:`font-medium ${t.dateEcheance&&new Date(t.dateEcheance)<new Date&&t.statut!=="termine"?"text-error":"text-primary-900 dark:text-primary-100"}`,children:t.dateEcheance?b(new Date(t.dateEcheance),"dd/MM/yyyy"):"—"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-primary-500 dark:text-primary-400",children:"Avancement"}),e.jsxs("span",{className:"font-medium text-primary-900 dark:text-primary-100",children:[t.avancement,"%"]})]}),e.jsx("div",{className:"h-2 bg-primary-200 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.avancement===100?"bg-success":"bg-info"}`,style:{width:`${t.avancement}%`}})})]}),t.responsableId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-500 dark:text-primary-400",children:"Responsable"}),e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100",children:t.responsableId})]}),t.sousActions&&t.sousActions.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-primary-500 dark:text-primary-400 mb-2",children:["Sous-actions (",t.sousActions.filter(r=>r.statut==="termine").length,"/",t.sousActions.length,")"]}),e.jsx("div",{className:"space-y-1",children:t.sousActions.map(r=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${r.statut==="termine"?"bg-success border-success":"border-primary-300"}`,children:r.statut==="termine"&&e.jsx(ne,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:r.statut==="termine"?"line-through text-primary-400":"text-primary-700 dark:text-primary-300",children:r.description})]},r.id))})]}),t.budget&&t.budget.prevu>0&&e.jsxs("div",{className:"p-3 bg-primary-50 dark:bg-primary-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-primary-500 dark:text-primary-400 mb-2",children:"Budget"}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{children:["Consommé: ",t.budget.consomme.toLocaleString()," ",t.budget.devise]}),e.jsxs("span",{children:["Prévu: ",t.budget.prevu.toLocaleString()," ",t.budget.devise]})]}),e.jsx("div",{className:"h-2 bg-primary-200 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.budget.consomme>t.budget.prevu?"bg-error":"bg-success"}`,style:{width:`${Math.min(t.budget.consomme/t.budget.prevu*100,100)}%`}})})]})]})})]})}export{Er as ActionsConsolidees};

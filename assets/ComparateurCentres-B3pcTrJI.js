import{j as e,R as w,B as z,C as q,X as T,Y as D,T as S,b as O,c as $,g as G,h as X,i as Y,k as F,l as H}from"./vendor-charts-cvMpHz0W.js";import{d as W,r as m}from"./vendor-react-BdB5Pz3t.js";import{a as J,b as Q,c as U,B as Z,C as x,h as f,i as y,g as p}from"./index-IaNwoOYO.js";import{B as _}from"./Badge-CM23X0aP.js";import{a5 as ee,d as re,q as se}from"./vendor-icons-B6Rt7gcW.js";import"./vendor-export-C98UG4Mq.js";import"./vendor-utils-BBD155gO.js";const g=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"];function xe(){const P=W(),{centres:c,loadCentres:R}=J(),{axes:k,loadAxes:A,objectifs:h,loadObjectifs:K}=Q(),{mesures:u,loadMesures:M}=U(),[t,b]=m.useState([]),[te,ae]=m.useState(!1);m.useEffect(()=>{R(),A(),K(),M()},[]),m.useEffect(()=>{c.length>=2&&t.length===0&&b([c[0].id,c[1].id])},[c]);const E=r=>{t.includes(r)?b(t.filter(i=>i!==r)):t.length<4&&b([...t,r])},a=m.useMemo(()=>t.map((r,i)=>{const s=c.find(n=>n.id===r),l=u.filter(n=>n.centreId===r),j=l.filter(n=>n.statut==="vert").length,o=l.length>0?Math.round(j/l.length*100):0;return{id:r,name:(s==null?void 0:s.code)||"N/A",fullName:(s==null?void 0:s.nom)||"N/A",performance:o,objectifs:h.filter(n=>n.centreId===r).length,surface:(s==null?void 0:s.surfaceLocative)||0,color:g[i%g.length],mesuresVertes:j,mesuresOranges:l.filter(n=>n.statut==="orange").length,mesuresRouges:l.filter(n=>n.statut==="rouge").length}}),[t,c,u,h]),v=m.useMemo(()=>k.slice(0,6).map(i=>{const s={axe:i.nom};return t.forEach((l,j)=>{const o=c.find(d=>d.id===l),n=h.filter(d=>d.axeId===i.id&&d.centreId===l),N=u.filter(d=>d.centreId===l&&n.some(V=>V.id===d.objectifId)),L=N.filter(d=>d.statut==="vert").length,I=N.length>0?Math.round(L/N.length*100):0;s[(o==null?void 0:o.code)||`Centre ${j+1}`]=I}),s}),[t,c,k,h,u]),B=m.useMemo(()=>[{name:"Performance",...Object.fromEntries(a.map(r=>[r.name,r.performance]))},{name:"KPIs Verts",...Object.fromEntries(a.map(r=>[r.name,r.mesuresVertes]))},{name:"KPIs Orange",...Object.fromEntries(a.map(r=>[r.name,r.mesuresOranges]))},{name:"KPIs Rouges",...Object.fromEntries(a.map(r=>[r.name,r.mesuresRouges]))}],[a]),C=({active:r,payload:i})=>!r||!i?null:e.jsx("div",{className:"bg-white dark:bg-primary-800 border border-primary-200 dark:border-primary-700 rounded-lg shadow-lg p-3",children:i.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("span",{className:"text-primary-600 dark:text-primary-400",children:[s.name,":"]}),e.jsxs("span",{className:"font-medium text-primary-900 dark:text-primary-100",children:[s.value,s.dataKey==="performance"?"%":""]})]},l))});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Z,{variant:"ghost",onClick:()=>P("/"),children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-900 dark:text-primary-100",children:"Comparateur de centres"}),e.jsx("p",{className:"text-primary-500 dark:text-primary-400 mt-1",children:"Comparez les performances de 2 \\u00e0 4 centres"})]})]})}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsxs(y,{children:["S\\u00e9lection des centres (",t.length,"/4)"]})}),e.jsxs(p,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(r=>{const i=t.includes(r.id),s=t.indexOf(r.id);return e.jsxs("button",{onClick:()=>E(r.id),disabled:!i&&t.length>=4,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${i?"border-transparent text-white":"border-primary-200 dark:border-primary-700 text-primary-700 dark:text-primary-300 hover:bg-primary-50 dark:hover:bg-primary-800"} ${!i&&t.length>=4?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:i?g[s%g.length]:void 0},children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:r.code}),e.jsx("span",{className:"text-sm opacity-75",children:r.nom}),i&&e.jsx(se,{className:"w-4 h-4 ml-1"})]},r.id)})}),t.length<2&&e.jsx("p",{className:"mt-3 text-sm text-warning",children:"S\\u00e9lectionnez au moins 2 centres pour comparer"})]})]}),t.length>=2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:a.map(r=>e.jsx(x,{children:e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold",style:{backgroundColor:r.color},children:r.name.substring(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-900 dark:text-primary-100",children:r.name}),e.jsx("p",{className:"text-xs text-primary-500 dark:text-primary-400",children:r.fullName})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-primary-600 dark:text-primary-400",children:"Performance"}),e.jsxs(_,{variant:r.performance>=80?"success":r.performance>=60?"warning":"error",children:[r.performance,"%"]})]}),e.jsx("div",{className:"h-2 bg-primary-100 dark:bg-primary-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${r.performance}%`,backgroundColor:r.color}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-success",children:r.mesuresVertes}),e.jsx("p",{className:"text-primary-500 dark:text-primary-400",children:"Verts"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-warning",children:r.mesuresOranges}),e.jsx("p",{className:"text-primary-500 dark:text-primary-400",children:"Orange"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-error",children:r.mesuresRouges}),e.jsx("p",{className:"text-primary-500 dark:text-primary-400",children:"Rouges"})]})]}),e.jsxs("div",{className:"text-sm text-primary-500 dark:text-primary-400 pt-2 border-t border-primary-100 dark:border-primary-700",children:["Surface: ",r.surface.toLocaleString()," m\\u00b2"]})]})]})},r.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(y,{children:"Comparaison des performances"})}),e.jsx(p,{children:e.jsx("div",{className:"h-80",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(z,{data:B,children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"var(--chart-grid)"}),e.jsx(T,{dataKey:"name",stroke:"var(--chart-text)",fontSize:12}),e.jsx(D,{stroke:"var(--chart-text)",fontSize:12}),e.jsx(S,{content:e.jsx(C,{})}),e.jsx(O,{}),a.map(r=>e.jsx($,{dataKey:r.name,fill:r.color,radius:[4,4,0,0]},r.id))]})})})})]}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(y,{children:"Performance par axe strat\\u00e9gique"})}),e.jsx(p,{children:e.jsx("div",{className:"h-80",children:v.length>0?e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(G,{data:v,children:[e.jsx(X,{stroke:"var(--chart-grid)"}),e.jsx(Y,{dataKey:"axe",stroke:"var(--chart-text)",fontSize:11}),e.jsx(F,{angle:30,domain:[0,100],stroke:"var(--chart-text)",fontSize:10}),a.map(r=>e.jsx(H,{name:r.name,dataKey:r.name,stroke:r.color,fill:r.color,fillOpacity:.2,strokeWidth:2},r.id)),e.jsx(O,{}),e.jsx(S,{content:e.jsx(C,{})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-primary-500 dark:text-primary-400",children:"Aucun axe strat\\u00e9gique d\\u00e9fini"})})})]})]}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(y,{children:"Tableau comparatif d\\u00e9taill\\u00e9"})}),e.jsx(p,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-primary-200 dark:border-primary-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-primary-600 dark:text-primary-400",children:"M\\u00e9trique"}),a.map(r=>e.jsx("th",{className:"text-center py-3 px-4 font-medium",style:{color:r.color},children:r.name},r.id))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-primary-100 dark:border-primary-700",children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"Performance globale"}),a.map(r=>e.jsxs("td",{className:"text-center py-3 px-4 font-medium text-primary-900 dark:text-primary-100",children:[r.performance,"%"]},r.id))]}),e.jsxs("tr",{className:"border-b border-primary-100 dark:border-primary-700",children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"Objectifs suivis"}),a.map(r=>e.jsx("td",{className:"text-center py-3 px-4 font-medium text-primary-900 dark:text-primary-100",children:r.objectifs},r.id))]}),e.jsxs("tr",{className:"border-b border-primary-100 dark:border-primary-700",children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"Surface locative"}),a.map(r=>e.jsxs("td",{className:"text-center py-3 px-4 font-medium text-primary-900 dark:text-primary-100",children:[r.surface.toLocaleString()," m\\u00b2"]},r.id))]}),e.jsxs("tr",{className:"border-b border-primary-100 dark:border-primary-700",children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"KPIs atteints"}),a.map(r=>e.jsx("td",{className:"text-center py-3 px-4 text-success font-medium",children:r.mesuresVertes},r.id))]}),e.jsxs("tr",{className:"border-b border-primary-100 dark:border-primary-700",children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"KPIs en attention"}),a.map(r=>e.jsx("td",{className:"text-center py-3 px-4 text-warning font-medium",children:r.mesuresOranges},r.id))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 px-4 text-primary-700 dark:text-primary-300",children:"KPIs critiques"}),a.map(r=>e.jsx("td",{className:"text-center py-3 px-4 text-error font-medium",children:r.mesuresRouges},r.id))]})]})]})})})]})]})]})}export{xe as ComparateurCentres};
